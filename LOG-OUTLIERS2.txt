ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ­ EmbeddingEngineFactory inizializzata
ğŸ¯ EmbeddingManager inizializzato
ğŸš€ UMAP disponibile per riduzione dimensionale!
ğŸš€ cuML GPU clustering disponibile!
ğŸ’¥ EmbeddingDestroyer inizializzato - Ready to destroy and rebuild!
ğŸ¯ SimpleEmbeddingManager inizializzato
âœ… Blueprint esempi inizializzato correttamente
ğŸ”„ [LLMConfigService] Configurazione ricaricata
ğŸ”§ [LLMConfigService] Servizio inizializzato con config: /home/ubuntu/classificatore/config.yaml
ğŸš€ Avvio server Flask - Debug: True
 * Serving Flask app 'server'
 * Debug mode: on
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ”§ Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Creo oggetto Tenant da a0fd7600-f4f7-11ef-9315-96000228e7fe...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ“Š Calcolo statistiche per tenant: Humanitas
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Alleanza (alleanza) UUID=a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Tenant risolto: Alleanza (a0fd7600-f4f7-11ef-9315-96000228e7fe)
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant con oggetto Tenant...
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Creo oggetto Tenant da a0fd7600-f4f7-11ef-9315-96000228e7fe...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Alleanza (alleanza) UUID=a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Tenant risolto: Alleanza (a0fd7600-f4f7-11ef-9315-96000228e7fe)
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant con oggetto Tenant...
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ”§ Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ“Š Calcolo statistiche per tenant: Humanitas
ğŸ” [DEBUG] GET /api/prompts/015007d9-d413-11ef-86a5-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Creo oggetto Tenant da 015007d9-d413-11ef-86a5-96000228e7fe...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… [DEBUG] Tenant risolto: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant con oggetto Tenant...
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-30T12:34:13', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id 015007d9-d413-11ef-86a5-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ¯ TRAINING SUPERVISIONATO - Cliente: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“‹ Parametri utente semplificati:
  ï¿½ Max sessioni review: 500
  ğŸ¯ Soglia confidenza: 0.95
  ğŸ”„ Forza review: False
  âš–ï¸  Soglia disagreement: 0.3
ğŸ”§ Inizializzazione pipeline per cliente: 015007d9-d413-11ef-86a5-96000228e7fe (con lock)
âš ï¸ [PIPELINE] DEPRECATO: uso di tenant_slug '015007d9-d413-11ef-86a5-96000228e7fe' - convertendo a oggetto Tenant
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”„ [PIPELINE] Conversione completata: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
âœ… [CONFIG] Configurazione base caricata da /home/ubuntu/classificatore/Utils/../config.yaml
ğŸ¯ [PIPELINE CLUSTERING CONFIG] Caricati parametri personalizzati per tenant 015007d9-d413-11ef-86a5-96000228e7fe:
   allow_single_cluster: non_definito -> False
   alpha: non_definito -> 0.4
   cluster_selection_epsilon: non_definito -> 0.28
   cluster_selection_method: non_definito -> leaf
   max_cluster_size: non_definito -> 0
   metric: non_definito -> euclidean
   min_cluster_size: 5 -> 13
   min_samples: 3 -> 16
   only_user: non_definito -> False
   umap_metric: non_definito -> cosine
   umap_min_dist: non_definito -> 0
   umap_n_components: non_definito -> 17
   umap_n_neighbors: non_definito -> 30
   umap_random_state: non_definito -> 42
   use_umap: non_definito -> True

ğŸš€ [FASE 1: INIZIALIZZAZIONE] Avvio pipeline...
ğŸ¥ [FASE 1: INIZIALIZZAZIONE] Tenant: humanitas
ğŸ¯ [FASE 1: INIZIALIZZAZIONE] Configurazione:
   ğŸ“Š Confidence threshold: 0.7
   ğŸ¤– Auto mode: True
   ğŸ”„ Auto retrain: False
ï¿½ [FASE 1: INIZIALIZZAZIONE] Inizializzazione lettore conversazioni...
âœ… [CONFIG] Configurazione base caricata da /home/ubuntu/classificatore/Utils/../config.yaml
âœ… [CONFIG] Config personalizzata tenant 015007d9-d413-11ef-86a5-96000228e7fe: 15 parametri
ğŸ¯ [ONLY_USER] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: False (da config personalizzata)
ğŸ¯ [LETTORE] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: only_user = False (da config tenant)
ï¿½ [FASE 1: INIZIALIZZAZIONE] Inizializzazione aggregator...
   ğŸ” Schema: 'humanitas'
   ğŸ†” Tenant ID: '015007d9-d413-11ef-86a5-96000228e7fe'
ğŸ¯ [SESSION AGGREGATOR] Inizializzazione con oggetto Tenant: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ¯ [ONLY_USER] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: False (da config personalizzata)
ğŸ¯ [LETTORE] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: only_user = False (da config tenant)
ï¿½ [ONLY_USER] Schema None: False (legacy - no tenant_id)
ğŸ§  [FASE 1: INIZIALIZZAZIONE] Sistema embedder dinamico (lazy loading)
ğŸ”§ [FASE 1: INIZIALIZZAZIONE] Parametri clustering:
   ğŸ“Š Min cluster size: 13
   ğŸ“Š Min samples: 16
ğŸ› DEBUG CLUSTER_ALPHA - PRIMA:
   ğŸ“‹ clustering_config.get('alpha', 1.0): 0.4
   ğŸ“‹ Type: <class 'float'>
ğŸ› DEBUG CLUSTER_ALPHA - DOPO CONVERSIONE:
   ğŸ“‹ cluster_alpha: 0.4
   ğŸ“‹ Type: <class 'float'>
ğŸ› DEBUG CLUSTER_ALPHA - FINALE:
   ğŸ“‹ cluster_alpha finale: 0.4
   ğŸ“‹ Type finale: <class 'float'>
   ğŸ“‹ Alpha > 0: True
âœ… [CONFIG] Config personalizzata tenant 015007d9-d413-11ef-86a5-96000228e7fe: 15 parametri
ğŸ—‚ï¸  [UMAP] Parametri per tenant 015007d9-d413-11ef-86a5-96000228e7fe:
   use_umap: True
   n_neighbors: 30
   min_dist: 0
   n_components: 17
   metric: cosine
ğŸ”§ [FIX DEBUG] Parametri tenant passati a HDBSCANClusterer:
   min_cluster_size: 13
   min_samples: 16
   alpha: 0.4
   cluster_selection_method: leaf
   cluster_selection_epsilon: 0.28
   metric: euclidean
   allow_single_cluster: False
   max_cluster_size: 0
   ğŸ—‚ï¸  use_umap: True
   ğŸ—‚ï¸  umap_n_neighbors: 30
   ğŸ—‚ï¸  umap_min_dist: 0
   ğŸ—‚ï¸  umap_n_components: 17
ğŸ¯ [BERTOPIC] Parametri consistenti configurati:
   ğŸ“Š HDBSCAN: 10 parametri
   ğŸ“Š UMAP: 5 parametri
ğŸ”§ HDBSCANClusterer inizializzato:
   min_cluster_size: 13
   min_samples: 16
   metric: euclidean
   cluster_selection_epsilon: 0.28
   ğŸ—‚ï¸  UMAP enabled: True
     ğŸ“ n_neighbors: 30
     ğŸ“ min_dist: 0
     ğŸ“Š n_components: 17
     ğŸ¯ metric: cosine
   ğŸš€ GPU enabled: True
   ğŸ’¾ GPU memory limit: 80%
   ğŸ”„ CPU fallback: True
   âš ï¸  [GPU MODE] Limitazioni cuML HDBSCAN:
     ğŸš« leaf_size=40 sarÃ  IGNORATO su GPU
     âœ… Parametri supportati: cluster_selection_method, alpha, allow_single_cluster
ğŸ¯ [DEBUG REACT] Parametri configurati:
   cluster_selection_method: leaf
   alpha: 0.4
   allow_single_cluster: False
ğŸ§  Inizializzazione memoria semantica...
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âš ï¸  Fallback a config LEGACY per embedding
ğŸ”§ TokenizationManager inizializzato:
   ğŸ“Š Modello tokenizer: cl100k_base
   ğŸ”¢ Limite massimo token: 8000
   âœ‚ï¸  Strategia troncamento: start
âœ… TokenizationManager integrato in LaBSE per gestione conversazioni lunghe
ğŸš€ Inizializzazione LaBSE embedder su device: cuda
ğŸ“¥ Caricamento modello sentence-transformers/LaBSE...
ğŸš€ Caricamento diretto su GPU...
âœ… Modello caricato con successo!
ğŸ“Š Dimensione embedding: 768
ğŸ”§ Device: cuda
ğŸ® GPU: NVIDIA A10G
ğŸ’¾ GPU Memory: 23.7 GB
ğŸ“ˆ GPU Memory utilizzata: 1.89 GB
ï¿½ Primo parametro su device: cuda:0
ğŸ§ª Test del modello LaBSE...
ğŸ” Encoding 3 testi con LaBSE su device cuda...

ğŸ” TOKENIZZAZIONE PREVENTIVA LABSE CLUSTERING
============================================================
ğŸ” ELABORAZIONE CONVERSAZIONI PER CLUSTERING
   ğŸ“Š Numero conversazioni: 3
   ğŸ†” Session IDs forniti: No

ğŸ“Š STATISTICHE ELABORAZIONE:
   ğŸ”¢ Conversazioni totali: 3
   âœ‚ï¸  Conversazioni troncate: 0
   ğŸ“ Token originali totali: 20
   ğŸ“ Token finali totali: 20
   ğŸ“Š Range token: 6 - 7
âœ… Tokenizzazione LaBSE completata:
   ğŸ“Š Conversazioni processate: 3
   ğŸ“Š Conversazioni troncate: 0
   ğŸ“Š Token limite configurato: 8000
   âœ… Tutte le conversazioni entro i limiti, nessun troncamento
============================================================
âœ… Embedding generati: shape (3, 768)
âœ… Test modello completato con successo!
   Shape: (3, 768)
   Norme: [0.99999994 1.         1.        ]
   Device: cuda
ğŸ¯ Modello pronto per l'uso!
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
ğŸ§  SemanticMemoryManager inizializzato
  ğŸ¯ Soglia riutilizzo etichette: 0.8
  ğŸ” Soglia similaritÃ  semantica: 0.8
  ğŸ’¾ Cache path: semantic_cache/humanitas_015007d9_memory
ğŸ”— Inizializzazione ensemble classifier avanzato...
ğŸ” ML Ensemble Debugger inizializzato e ATTIVO
   ğŸ“ Debug file: ./debug_logs/ml_debug.log
ğŸ” ML Ensemble Debugger attivato
ğŸ”§ Tentativo di inizializzazione IntelligentClassifier tramite LLMFactory...
ğŸ§  GPU Memory prima di LLM: 1.8GB/22.1GB (free: 20.3GB)
âœ… Memoria GPU sufficiente, inizializzazione LLM tramite Factory...
ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ­ LLM Factory inizializzato con cache invalidation intelligente
ğŸ” LLM FACTORY DEBUG: Chiamata ai_config_service.get_tenant_configuration(humanitas) normale...
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id humanitas
ğŸ” [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 31, 23, 59, 51)}
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 31, 23, 59, 51), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
ğŸ¯ LLM FACTORY DEBUG: Modello normale = 'mistral:7b'
ğŸ”§ Creazione LLM classifier mistral:7b per tenant humanitas
ğŸš€ LLM FACTORY DEBUG: Avvio creazione nuovo classifier modello 'mistral:7b'
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto da slug (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“‹ Caricamento parametri LLM globali per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ¯ Config LLM caricata per 015007d9-d413-11ef-86a5-96000228e7fe (fonte: global)
   ğŸ“ Max output tokens: 150
   ğŸ“Š Max input tokens: 8000
   ğŸŒ¡ï¸  Temperature: 0.1
   ğŸ”¢ Top K: 40, Top P: 0.9
ğŸ” LLM Debugger inizializzato e ATTIVO
   ğŸ“ Debug file: ./debug_logs/llm_debug.log
   ğŸ¨ Visual formatting: True
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
ğŸ—„ï¸ MongoClassificationReader inizializzato per tenant: Humanitas
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
Connessione al database TAG stabilita con successo
ğŸ“‹ Recuperati 1 tag dal database TAGS per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
âš ï¸  Fallback a config LEGACY per embedding
ğŸ”§ TokenizationManager inizializzato:
   ğŸ“Š Modello tokenizer: cl100k_base
   ğŸ”¢ Limite massimo token: 8000
   âœ‚ï¸  Strategia troncamento: start
âœ… LLM FACTORY DEBUG: Nuovo classifier creato: mistral:7b
âœ… LLM Classifier mistral:7b (mistral:7b) creato e cached per tenant humanitas
ğŸ­ LLM classifier ottenuto tramite Factory per tenant humanitas
ğŸ¤– LLM classifier creato automaticamente nell'ensemble: mistral:7b
ğŸ’¡ Possibile fine-tuning per humanitas
ğŸ”— Advanced Ensemble Classifier inizializzato
   ğŸ§  LLM weight: 0.60
   ğŸ¤– ML weight: 0.40
   ğŸ¯ Confidence threshold: 0.7
   ğŸ”„ Adaptive weights: True
   ğŸ‘¤ Disaccordi gestiti da QualityGateEngine
âš ï¸ Nessun modello trovato per tenant 'humanitas' nella directory models/
â¸ï¸ Riaddestramento automatico disabilitato (modalitÃ  supervisione/API)
   ğŸ’¡ Per abilitare, usare auto_retrain=True nell'inizializzazione
âœ… Classificatore LLM disponibile nell'ensemble
ğŸ‘¤ Inizializzazione trainer interattivo...
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
ğŸ¯ SIMPLE MANAGER: Usando oggetto Tenant Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“¥ Primo embedder - creazione per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸš€ CREATING FRESH EMBEDDER per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ FORCE NO CACHE: Bypass cache per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”¥ FORCE NO CACHE: Bypasso cache e leggo DIRETTAMENTE dal database per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 31, 23, 59, 51)}
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 31, 23, 59, 51), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
ğŸ” SIMPLE MANAGER: Engine da DB per 015007d9-d413-11ef-86a5-96000228e7fe = 'labse'
ğŸ¯ Engine configurato: labse
ğŸ”§ DIRECT CREATE: labse
ğŸ³ Tentativo connessione a servizio LaBSE dockerizzato...
ğŸ”— LaBSE Remote Client inizializzato
   ğŸ“¡ Service URL: http://localhost:8081
   â±ï¸  Timeout: 300s
   ğŸ”„ Max retries: 3
   ğŸ›¡ï¸ Fallback locale: True
ğŸ”§ Inizializzazione client remoto LaBSE...
âœ… Servizio embedding online e funzionante
âœ… Client remoto LaBSE inizializzato con successo
âœ… LaBSE Remote Client configurato con successo
âœ… FRESH EMBEDDER creato: LaBSERemoteClient per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ§  Inizializzazione dedupplicatore intelligente...
ğŸ’¾ [FASE 1: INIZIALIZZAZIONE] Caricamento memoria semantica...
ğŸ”„ Caricamento memoria semantica dal database...
ğŸ”„ Caricamento memoria semantica da MongoDB...
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Recupero sessioni per tenant: Humanitas
   ğŸ“‚ Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“­ Nessuna classificazione trovata nel database MongoDB
ğŸ“­ Inizializzata memoria semantica vuota
   ğŸ“Š Campioni: 0
   ğŸ·ï¸ Tag: 0
âœ… [FASE 1: INIZIALIZZAZIONE] Completata in 4.45s
ğŸ¯ [FASE 1: INIZIALIZZAZIONE] Pipeline pronta per l'uso!
âœ… Pipeline 015007d9-d413-11ef-86a5-96000228e7fe inizializzata
ğŸš€ TRAINING SUPERVISIONATO CON DATASET COMPLETO
  ğŸ“Š Estrazione: TUTTE le discussioni dal database
  ğŸ§© Clustering: Su tutto il dataset disponibile
  ğŸ‘¤ Review umana: Max 500 sessioni rappresentative
ğŸ¯ Confidence threshold aggiornato a: 0.95
ğŸ“ TRAINING SUPERVISIONATO AVANZATO
ï¿½ NUOVA LOGICA:
  ğŸ”„ Estrazione: TUTTE le discussioni dal database
  ğŸ§© Clustering: Su tutto il dataset completo
  ğŸ‘¤ Review umana: Massimo 500 sessioni rappresentative
--------------------------------------------------
ğŸ“Š FASE 1: ESTRAZIONE COMPLETA DATASET

ï¿½ [FASE 2: ESTRAZIONE] Avvio estrazione sessioni...
ğŸ¥ [FASE 2: ESTRAZIONE] Tenant: humanitas
ğŸ“… [FASE 2: ESTRAZIONE] Giorni indietro: 7
ğŸ”„ [FASE 2: ESTRAZIONE] ModalitÃ  COMPLETA attivata
ğŸ¯ [FASE 2: ESTRAZIONE] Ignorando limite - estrazione totale dataset
ï¿½ [FASE 2: ESTRAZIONE] ModalitÃ : COMPLETA
ï¿½ [FASE 2: ESTRAZIONE] Connessione database...
ğŸ“Š [DEBUG ONLY_USER] Estrazione sessioni aggregate dal schema 'humanitas'...
ğŸ¯ [DEBUG ONLY_USER] Parametro only_user = False (tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“„ [DEBUG ONLY_USER] Estrazione completa (senza limite)
ğŸ“„ [DEBUG ONLY_USER] Filtraggio standard: messaggi USER e AGENT
ğŸ” [DEBUG SQL] =============================================
ğŸ” [DEBUG SQL] Schema utilizzato: 'humanitas'
ğŸ” [DEBUG SQL] Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG SQL] Only User: False
ï¿½ [DEBUG SQL] Filtro applicato: WHERE csm.said_by IN ('USER', 'AGENT')
ğŸ” [DEBUG SQL] =============================================
ğŸ” [DEBUG SQL] QUERY COMPLETA:
ğŸ” [DEBUG SQL] 
        SELECT cs.session_id
             , (SELECT a.agent_name
                  FROM `humanitas`.agents a
                 WHERE a.agent_id = cs.conversation_agent_id) AS conversation_agent_name
             , csm.conversation_status_message_id
             , csm.conversation_message
             , csm.said_by
             , csm.created_at AS message_created_at
          FROM `humanitas`.conversation_status cs
         INNER JOIN `humanitas`.conversation_status_messages csm
            ON cs.conversation_status_id = csm.conversation_status_id
         WHERE csm.said_by IN ('USER', 'AGENT')
         ORDER BY cs.session_id
             , cs.created_at ASC
             , csm.created_at ASC
             , csm.said_by ASC
        
ğŸ” [DEBUG SQL] =============================================
Connessione al database MySQL stabilita con successo
âœ… [DEBUG ONLY_USER] Query eseguita con successo!
ğŸ“Š [DEBUG ONLY_USER] Totale righe: 21895
ğŸ‘¤ [DEBUG ONLY_USER] Messaggi USER: 10929
ğŸ¤– [DEBUG ONLY_USER] Messaggi AGENT: 10966
âœ… [DEBUG ONLY_USER] Filtro funziona correttamente!
âœ… Trovate 21895 righe da aggregare
ğŸ”„ [DEBUG ONLY_USER] Inizio generazione testo completo per 4379 sessioni
ğŸ” [DEBUG ONLY_USER] Sessione 0008ef4f-c2f4-4f5e-933e-646574f3638c: 3 USER, 3 AGENT
ğŸ“ [DEBUG ONLY_USER] Sessione 0008ef4f-c2f4-4f5e-933e-646574f3638c testo finale:
   [UTENTE] tags: 2
   [ASSISTENTE] tags: 2
   Lunghezza testo: 554 caratteri
ğŸ” [DEBUG ONLY_USER] Sessione 000b61d7-4431-40d2-b83c-9abbb70c98be: 4 USER, 4 AGENT
ğŸ“ [DEBUG ONLY_USER] Sessione 000b61d7-4431-40d2-b83c-9abbb70c98be testo finale:
   [UTENTE] tags: 3
   [ASSISTENTE] tags: 3
   Lunghezza testo: 1133 caratteri
ğŸ” [DEBUG ONLY_USER] Sessione 00160700-ac7f-463d-8fa0-fe57f74a73e6: 4 USER, 4 AGENT
âœ… Aggregate 4379 sessioni uniche
ğŸ”„ Saltati 8758 messaggi di benvenuto (primi 2 per sessione)
ğŸ”„ Sessioni vuote (solo benvenuto): 924
ğŸ“¥ [FASE 2: ESTRAZIONE] Sessioni grezze: 4379
ğŸ” [FASE 2: ESTRAZIONE] Filtraggio sessioni...
ğŸ” Filtraggio sessioni vuote/irrilevanti...
âœ… Filtro completato:
  ğŸ“Š Sessioni originali: 4379
  âŒ Sessioni scartate: 924
  âœ… Sessioni valide: 3455
âœ… [FASE 2: ESTRAZIONE] Completata in 0.66s
ğŸ“Š [FASE 2: ESTRAZIONE] Dataset completo: 3455 sessioni
ğŸ—‘ï¸ [FASE 2: ESTRAZIONE] Filtrate: 924 sessioni vuote/irrilevanti
ğŸ¯ [FASE 2: ESTRAZIONE] Pronte per clustering completo
âœ… Dataset completo: 3455 sessioni totali

ğŸ“Š FASE 2: CLUSTERING COMPLETO

ğŸš€ [FASE 4: CLUSTERING] Avvio clustering intelligente...
ğŸ“Š [FASE 4: CLUSTERING] Dataset: 3455 sessioni
ğŸ¯ [FASE 4: CLUSTERING] ModalitÃ : INTELLIGENTE
ğŸ§  [FASE 4: CLUSTERING] Clustering incrementale (se possibile)...

ğŸš€ [FASE 3: EMBEDDINGS] Avvio generazione embeddings...
ï¿½ [FASE 3: EMBEDDINGS] Dataset: 3455 sessioni
ğŸ“Š [FASE 3: EMBEDDINGS] Caratteristiche testo:
   ğŸ“ Lunghezza media: 1009 caratteri
   ğŸ“ Lunghezza massima: 29104 caratteri
   ğŸ“ Lunghezza minima: 75 caratteri
ğŸ§  [FASE 3: EMBEDDINGS] Generazione embeddings...
ğŸ”„ LAZY LOADING: Caricamento embedder dinamico per tenant 'humanitas'
ğŸ¯ SimpleEmbeddingManager inizializzato
ğŸ¯ SIMPLE MANAGER: Usando oggetto Tenant Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“¥ Primo embedder - creazione per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸš€ CREATING FRESH EMBEDDER per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ FORCE NO CACHE: Bypass cache per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”¥ FORCE NO CACHE: Bypasso cache e leggo DIRETTAMENTE dal database per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 31, 23, 59, 51)}
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 31, 23, 59, 51), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
ğŸ” SIMPLE MANAGER: Engine da DB per 015007d9-d413-11ef-86a5-96000228e7fe = 'labse'
ğŸ¯ Engine configurato: labse
ğŸ”§ DIRECT CREATE: labse
ğŸ³ Tentativo connessione a servizio LaBSE dockerizzato...
ğŸ”— LaBSE Remote Client inizializzato
   ğŸ“¡ Service URL: http://localhost:8081
   â±ï¸  Timeout: 300s
   ğŸ”„ Max retries: 3
   ğŸ›¡ï¸ Fallback locale: True
ğŸ”§ Inizializzazione client remoto LaBSE...
âœ… Servizio embedding online e funzionante
âœ… Client remoto LaBSE inizializzato con successo
âœ… LaBSE Remote Client configurato con successo
âœ… FRESH EMBEDDER creato: LaBSERemoteClient per tenant 015007d9-d413-11ef-86a5-96000228e7fe
âœ… Embedder caricato per tenant Humanitas (015007d9-d413-11ef-86a5-96000228e7fe): LaBSERemoteClient
ğŸ“¡ Richiesta embedding remoto per 3455 testi...
âœ… Embedding remoto completato in 7.087s
   ğŸ“Š Shape: (3455, 768)
   âš¡ Tempo servizio: 3.474s
âœ… [FASE 3: EMBEDDINGS] Completata in 7.20s
ğŸ“ˆ [FASE 3: EMBEDDINGS] Shape: (3455, 768)
âš¡ [FASE 3: EMBEDDINGS] Throughput: 479.8 testi/secondo

ğŸ“Š FASE 2A: TRAINING BERTOPIC ANTICIPATO

ğŸš€ TRAINING BERTOPIC ANTICIPATO (NUOVO FLUSSO OTTIMIZZATO):
   ğŸ“Š Dataset completo: 3455 sessioni
   ğŸ“Š Embeddings shape: (3455, 768)
   ğŸ¯ Addestramento su TUTTO il dataset per features ottimali
   ğŸ”¥ Esecuzione bertopic_provider.fit() su dataset completo...
ğŸ“Š BERTopic training su 3455 campioni
   ğŸ¯ Embedder configurato: LaBSERemoteClient
   ğŸ”§ STRATEGIA: BERTopic userÃ  embedder personalizzato via wrapper
   âœ… Wrapper embedder creato per BERTopic
   ğŸ”§ BERTopic userÃ  embedder personalizzato interno
âœ… BERTopic FIT completato su 3455 campioni
   ğŸ”§ SVD Training: Usando embedder personalizzato interno
âœ… SVD addestrato su full probas (k=20)
   âœ… BERTopic FIT completato in 36.59 secondi
   ğŸ”„ Esecuzione bertopic_provider.transform() per features extraction...
ğŸ”§ Transform: BERTopic userÃ  embedder personalizzato interno
   âœ… BERTopic TRANSFORM completato in 3.83 secondi
   ğŸ“Š Topic probabilities shape: (3455, 20)
   ğŸ“Š One-hot shape: None
   âœ… BERTopic provider addestrato con successo su 3455 sessioni
   âœ… BERTopic provider disponibile per augmentation features
   ğŸ”— BERTopic model assegnato al trainer per validazione ALTRO

ğŸ“Š FASE 2B: CLUSTERING HDBSCAN
ğŸ§  Usando clustering INTELLIGENTE (LLM + ML senza pattern)
ğŸ—‚ï¸  [DEBUG] Caricamento config tenant-specific: /home/ubuntu/classificatore/tenant_configs/015007d9-d413-11ef-86a5-96000228e7fe_clustering.yaml
ğŸ—‚ï¸  [DEBUG] Config tenant caricato: ['allow_single_cluster', 'alpha', 'cluster_selection_epsilon', 'cluster_selection_method', 'max_cluster_size', 'metric', 'min_cluster_size', 'min_samples', 'only_user', 'umap_metric', 'umap_min_dist', 'umap_n_components', 'umap_n_neighbors', 'umap_random_state', 'use_umap']
ğŸ—‚ï¸  [DEBUG] UMAP config finale: use_umap=True, n_components=17, min_dist=0
ğŸ§  Clustering intelligente configurato:
   ğŸ¯ Categorie intent suggerite: 12
   ğŸ¤– LLM primario: True
   ğŸ“Š Min confidence: 0.8
   ğŸ“ˆ Min conversations per intent: 2
   ğŸ‘¥ Rappresentanti diversificati: True
   ğŸ”¢ Max rappresentanti per cluster: 5
