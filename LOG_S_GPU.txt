ğŸš€ UMAP disponibile per riduzione dimensionale!
ğŸš€ cuML GPU clustering disponibile!
ğŸ’¥ EmbeddingDestroyer inizializzato - Ready to destroy and rebuild!
ğŸ¯ SimpleEmbeddingManager inizializzato
ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ­ EmbeddingEngineFactory inizializzata
ğŸ¯ EmbeddingManager inizializzato
âœ… Blueprint esempi inizializzato correttamente
ğŸš€ Avvio server Flask - Debug: True
 * Serving Flask app 'server'
 * Debug mode: on
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ”§ Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ“Š Calcolo statistiche per tenant: Humanitas
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ”§ Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] GET /api/prompts/015007d9-d413-11ef-86a5-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(015007d9-d413-11ef-86a5-96000228e7fe)...
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-30T12:34:13', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id 015007d9-d413-11ef-86a5-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ“Š Calcolo statistiche per tenant: Humanitas
ğŸ” API: Recupero prompt per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ”§ API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
âœ… Recuperati 5 prompt per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 28, 16, 51, 54)}
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 28, 16, 51, 54), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
âœ… Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” API: Recupero prompt per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
âœ… Recuperati 5 prompt per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 28, 16, 51, 54), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
âœ… Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ”§ API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
âœ… Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
âœ… Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ­ EmbeddingEngineFactory inizializzata
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
ğŸ” Trovati 22 tenant da TAG.tenants:
  - Alleanza (alleanza) -> a0fd7600-f4f7-11ef-9315-96000228e7fe
  - BluPantheon (blupantheon) -> 6bc4f06f-742e-11f0-acb8-96000228e7fe
  - Boots (boots) -> 0f9d6e90-d319-11ef-86a5-96000228e7fe
  - CEF (cef) -> b1048bdb-b6ff-11ef-86a5-96000228e7fe
  - Cogeda (cogeda) -> cca12133-6955-11f0-9817-96000228e7fe
  - Community (community) -> d365ed2b-b8a6-11ef-86a5-96000228e7fe
  - Consiglio Regione Toscana (crt) -> 78ced6ea-030b-11f0-9a34-96000228e7fe
  - Demo BluPantheon (ai) -> 0c1231de-a58c-11ef-8c7f-96000228e7fe
  - Development BluPantheon (dev) -> 361f77f0-bef1-11ef-86a5-96000228e7fe
  - Don Carlo San Martino (doncarlosanmartino) -> c354c01b-6e25-11f0-acb8-96000228e7fe
  - Fate Bene Fratelli (fatebenefratelli) -> 2d88ac57-73a5-11f0-acb8-96000228e7fe
  - Federfarma Roma (federfarmaroma) -> 3dadd270-3626-11f0-b087-96000228e7fe
  - Forma Camera (formacamera) -> 9b87a910-e477-11ef-9315-96000228e7fe
  - golvalerio (golvalerio) -> f071db89-83e3-11f0-bfd6-96000228e7fe
  - Gruppo Ospedaliero Leonardo (leonardo) -> bc4a964a-efde-11ef-9315-96000228e7fe
  - Homnya (homnya) -> 409a7aa7-fe55-11ef-9a34-96000228e7fe
  - Humanitas (humanitas) -> 015007d9-d413-11ef-86a5-96000228e7fe
  - Mondino (mondino2) -> f7b9e66a-8bd5-11ef-9557-96000228e7fe
  - MSC (msc) -> ccabd07d-1068-11f0-9133-96000228e7fe
  - Ospedale Isola Tiberina - Gemelli Isola (fbf) -> 964e85e1-a7e0-11ef-86a5-96000228e7fe
  - Tenant Evaluation (tenantevaluation) -> 396dba74-4aab-11f0-b6b8-96000228e7fe
  - Wopta (wopta) -> 16c222a9-f293-11ef-9315-96000228e7fe
Connessione al database TAG stabilita con successo
Errore durante l'esecuzione della query: 1146 (42S02): Table 'TAG.session_classifications' doesn't exist
Errore durante l'esecuzione della query: 1146 (42S02): Table 'TAG.session_classifications' doesn't exist
Connessione al database TAG chiusa
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
ğŸ” Trovati 22 tenant da TAG.tenants:
  - Alleanza (alleanza) -> a0fd7600-f4f7-11ef-9315-96000228e7fe
  - BluPantheon (blupantheon) -> 6bc4f06f-742e-11f0-acb8-96000228e7fe
  - Boots (boots) -> 0f9d6e90-d319-11ef-86a5-96000228e7fe
  - CEF (cef) -> b1048bdb-b6ff-11ef-86a5-96000228e7fe
  - Cogeda (cogeda) -> cca12133-6955-11f0-9817-96000228e7fe
  - Community (community) -> d365ed2b-b8a6-11ef-86a5-96000228e7fe
  - Consiglio Regione Toscana (crt) -> 78ced6ea-030b-11f0-9a34-96000228e7fe
  - Demo BluPantheon (ai) -> 0c1231de-a58c-11ef-8c7f-96000228e7fe
  - Development BluPantheon (dev) -> 361f77f0-bef1-11ef-86a5-96000228e7fe
  - Don Carlo San Martino (doncarlosanmartino) -> c354c01b-6e25-11f0-acb8-96000228e7fe
  - Fate Bene Fratelli (fatebenefratelli) -> 2d88ac57-73a5-11f0-acb8-96000228e7fe
  - Federfarma Roma (federfarmaroma) -> 3dadd270-3626-11f0-b087-96000228e7fe
  - Forma Camera (formacamera) -> 9b87a910-e477-11ef-9315-96000228e7fe
  - golvalerio (golvalerio) -> f071db89-83e3-11f0-bfd6-96000228e7fe
  - Gruppo Ospedaliero Leonardo (leonardo) -> bc4a964a-efde-11ef-9315-96000228e7fe
  - Homnya (homnya) -> 409a7aa7-fe55-11ef-9a34-96000228e7fe
  - Humanitas (humanitas) -> 015007d9-d413-11ef-86a5-96000228e7fe
  - Mondino (mondino2) -> f7b9e66a-8bd5-11ef-9557-96000228e7fe
  - MSC (msc) -> ccabd07d-1068-11f0-9133-96000228e7fe
  - Ospedale Isola Tiberina - Gemelli Isola (fbf) -> 964e85e1-a7e0-11ef-86a5-96000228e7fe
  - Tenant Evaluation (tenantevaluation) -> 396dba74-4aab-11f0-b6b8-96000228e7fe
  - Wopta (wopta) -> 16c222a9-f293-11ef-9315-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
Connessione al database TAG stabilita con successo
Errore durante l'esecuzione della query: 1146 (42S02): Table 'TAG.session_classifications' doesn't exist
Errore durante l'esecuzione della query: 1146 (42S02): Table 'TAG.session_classifications' doesn't exist
Connessione al database TAG chiusa
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ” Risoluzione tenant da UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Alleanza (alleanza) UUID=a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… Tenant risolto da UUID: Alleanza (a0fd7600-f4f7-11ef-9315-96000228e7fe)
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
ğŸ” Trovati 22 tenant da TAG.tenants:
  - Alleanza (alleanza) -> a0fd7600-f4f7-11ef-9315-96000228e7fe
  - BluPantheon (blupantheon) -> 6bc4f06f-742e-11f0-acb8-96000228e7fe
  - Boots (boots) -> 0f9d6e90-d319-11ef-86a5-96000228e7fe
  - CEF (cef) -> b1048bdb-b6ff-11ef-86a5-96000228e7fe
  - Cogeda (cogeda) -> cca12133-6955-11f0-9817-96000228e7fe
  - Community (community) -> d365ed2b-b8a6-11ef-86a5-96000228e7fe
  - Consiglio Regione Toscana (crt) -> 78ced6ea-030b-11f0-9a34-96000228e7fe
  - Demo BluPantheon (ai) -> 0c1231de-a58c-11ef-8c7f-96000228e7fe
  - Development BluPantheon (dev) -> 361f77f0-bef1-11ef-86a5-96000228e7fe
  - Don Carlo San Martino (doncarlosanmartino) -> c354c01b-6e25-11f0-acb8-96000228e7fe
  - Fate Bene Fratelli (fatebenefratelli) -> 2d88ac57-73a5-11f0-acb8-96000228e7fe
  - Federfarma Roma (federfarmaroma) -> 3dadd270-3626-11f0-b087-96000228e7fe
  - Forma Camera (formacamera) -> 9b87a910-e477-11ef-9315-96000228e7fe
  - golvalerio (golvalerio) -> f071db89-83e3-11f0-bfd6-96000228e7fe
  - Gruppo Ospedaliero Leonardo (leonardo) -> bc4a964a-efde-11ef-9315-96000228e7fe
  - Homnya (homnya) -> 409a7aa7-fe55-11ef-9a34-96000228e7fe
  - Humanitas (humanitas) -> 015007d9-d413-11ef-86a5-96000228e7fe
  - Mondino (mondino2) -> f7b9e66a-8bd5-11ef-9557-96000228e7fe
  - MSC (msc) -> ccabd07d-1068-11f0-9133-96000228e7fe
  - Ospedale Isola Tiberina - Gemelli Isola (fbf) -> 964e85e1-a7e0-11ef-86a5-96000228e7fe
  - Tenant Evaluation (tenantevaluation) -> 396dba74-4aab-11f0-b6b8-96000228e7fe
  - Wopta (wopta) -> 16c222a9-f293-11ef-9315-96000228e7fe
Connessione al database TAG stabilita con successo
Errore durante l'esecuzione della query: 1146 (42S02): Table 'TAG.session_classifications' doesn't exist
Errore durante l'esecuzione della query: 1146 (42S02): Table 'TAG.session_classifications' doesn't exist
Connessione al database TAG chiusa
ğŸ” Risoluzione tenant da UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
ğŸ” Trovati 22 tenant da TAG.tenants:
  - Alleanza (alleanza) -> a0fd7600-f4f7-11ef-9315-96000228e7fe
  - BluPantheon (blupantheon) -> 6bc4f06f-742e-11f0-acb8-96000228e7fe
  - Boots (boots) -> 0f9d6e90-d319-11ef-86a5-96000228e7fe
  - CEF (cef) -> b1048bdb-b6ff-11ef-86a5-96000228e7fe
  - Cogeda (cogeda) -> cca12133-6955-11f0-9817-96000228e7fe
  - Community (community) -> d365ed2b-b8a6-11ef-86a5-96000228e7fe
  - Consiglio Regione Toscana (crt) -> 78ced6ea-030b-11f0-9a34-96000228e7fe
  - Demo BluPantheon (ai) -> 0c1231de-a58c-11ef-8c7f-96000228e7fe
  - Development BluPantheon (dev) -> 361f77f0-bef1-11ef-86a5-96000228e7fe
  - Don Carlo San Martino (doncarlosanmartino) -> c354c01b-6e25-11f0-acb8-96000228e7fe
  - Fate Bene Fratelli (fatebenefratelli) -> 2d88ac57-73a5-11f0-acb8-96000228e7fe
  - Federfarma Roma (federfarmaroma) -> 3dadd270-3626-11f0-b087-96000228e7fe
  - Forma Camera (formacamera) -> 9b87a910-e477-11ef-9315-96000228e7fe
  - golvalerio (golvalerio) -> f071db89-83e3-11f0-bfd6-96000228e7fe
  - Gruppo Ospedaliero Leonardo (leonardo) -> bc4a964a-efde-11ef-9315-96000228e7fe
  - Homnya (homnya) -> 409a7aa7-fe55-11ef-9a34-96000228e7fe
  - Humanitas (humanitas) -> 015007d9-d413-11ef-86a5-96000228e7fe
  - Mondino (mondino2) -> f7b9e66a-8bd5-11ef-9557-96000228e7fe
  - MSC (msc) -> ccabd07d-1068-11f0-9133-96000228e7fe
  - Ospedale Isola Tiberina - Gemelli Isola (fbf) -> 964e85e1-a7e0-11ef-86a5-96000228e7fe
  - Tenant Evaluation (tenantevaluation) -> 396dba74-4aab-11f0-b6b8-96000228e7fe
  - Wopta (wopta) -> 16c222a9-f293-11ef-9315-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Alleanza (alleanza) UUID=a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… Tenant risolto da UUID: Alleanza (a0fd7600-f4f7-11ef-9315-96000228e7fe)
Connessione al database TAG stabilita con successo
Errore durante l'esecuzione della query: 1146 (42S02): Table 'TAG.session_classifications' doesn't exist
Errore durante l'esecuzione della query: 1146 (42S02): Table 'TAG.session_classifications' doesn't exist
Connessione al database TAG chiusa
ğŸ”§ Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ“Š Calcolo statistiche per tenant: Humanitas
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ”§ Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ“Š Calcolo statistiche per tenant: Humanitas
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ”§ Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ“Š Calcolo statistiche per tenant: Humanitas
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ”§ Creazione MongoClassificationReader per cliente: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” Risoluzione tenant da UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Alleanza (alleanza) UUID=a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… Tenant risolto da UUID: Alleanza (a0fd7600-f4f7-11ef-9315-96000228e7fe)
ğŸ“Š Collection generata: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe per tenant Alleanza
âœ… MongoClassificationReader inizializzato per tenant: Alleanza
   ğŸ“Š Collection: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Alleanza (alleanza)
ğŸ“Š Collection generata: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe per tenant Alleanza
   ğŸ“Š Collection: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe per tenant Alleanza
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Alleanza
ğŸ“Š Calcolo statistiche per tenant: Alleanza
ğŸ” [DEBUG] GET /api/prompts/015007d9-d413-11ef-86a5-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(015007d9-d413-11ef-86a5-96000228e7fe)...
ğŸ”§ Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-30T12:34:13', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id 015007d9-d413-11ef-86a5-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ“Š Calcolo statistiche per tenant: Humanitas
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ”§ Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ“Š Calcolo statistiche per tenant: Humanitas
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ”§ Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ“Š Calcolo statistiche per tenant: Humanitas
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ”§ Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ“Š Calcolo statistiche per tenant: Humanitas
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ”§ Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ“Š Calcolo statistiche per tenant: Humanitas
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ”§ Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ“Š Calcolo statistiche per tenant: Humanitas
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ”§ Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ“Š Calcolo statistiche per tenant: Humanitas
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ” [DEBUG] GET /api/prompts/bc4a964a-efde-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: bc4a964a-efde-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: bc4a964a-efde-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(bc4a964a-efde-11ef-9315-96000228e7fe)...
ğŸ”§ Creazione MongoClassificationReader per cliente: bc4a964a-efde-11ef-9315-96000228e7fe
ğŸ” Risoluzione tenant da UUID: bc4a964a-efde-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Recuperati 0 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 0/0 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'bc4a964a-efde-11ef-9315-96000228e7fe', 'tenant_name': 'unknown', 'total_prompts': 0, 'active_prompts': 0, 'inactive_prompts': 0, 'last_updated': None, 'status': 'no_active_prompts', 'canOperate': False, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': False}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': False}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 3}
âœ… [DEBUG] Status prompt per tenant_id bc4a964a-efde-11ef-9315-96000228e7fe: 0/0 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Gruppo Ospedaliero Leonardo (leonardo) UUID=bc4a964a-efde-11ef-9315-96000228e7fe
âœ… Tenant risolto da UUID: Gruppo Ospedaliero Leonardo (bc4a964a-efde-11ef-9315-96000228e7fe)
ğŸ“Š Collection generata: leonardo_bc4a964a-efde-11ef-9315-96000228e7fe per tenant Gruppo Ospedaliero Leonardo
âœ… MongoClassificationReader inizializzato per tenant: Gruppo Ospedaliero Leonardo
   ğŸ“Š Collection: leonardo_bc4a964a-efde-11ef-9315-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Gruppo Ospedaliero Leonardo (leonardo)
ğŸ“Š Collection generata: leonardo_bc4a964a-efde-11ef-9315-96000228e7fe per tenant Gruppo Ospedaliero Leonardo
   ğŸ“Š Collection: leonardo_bc4a964a-efde-11ef-9315-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: leonardo_bc4a964a-efde-11ef-9315-96000228e7fe per tenant Gruppo Ospedaliero Leonardo
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Gruppo Ospedaliero Leonardo
ğŸ“Š Calcolo statistiche per tenant: Gruppo Ospedaliero Leonardo
ğŸ” Risoluzione tenant da UUID: bc4a964a-efde-11ef-9315-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Gruppo Ospedaliero Leonardo (leonardo) UUID=bc4a964a-efde-11ef-9315-96000228e7fe
âœ… Tenant risolto da UUID: Gruppo Ospedaliero Leonardo (bc4a964a-efde-11ef-9315-96000228e7fe)
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
ğŸ” Trovati 22 tenant da TAG.tenants:
  - Alleanza (alleanza) -> a0fd7600-f4f7-11ef-9315-96000228e7fe
  - BluPantheon (blupantheon) -> 6bc4f06f-742e-11f0-acb8-96000228e7fe
  - Boots (boots) -> 0f9d6e90-d319-11ef-86a5-96000228e7fe
  - CEF (cef) -> b1048bdb-b6ff-11ef-86a5-96000228e7fe
  - Cogeda (cogeda) -> cca12133-6955-11f0-9817-96000228e7fe
  - Community (community) -> d365ed2b-b8a6-11ef-86a5-96000228e7fe
  - Consiglio Regione Toscana (crt) -> 78ced6ea-030b-11f0-9a34-96000228e7fe
  - Demo BluPantheon (ai) -> 0c1231de-a58c-11ef-8c7f-96000228e7fe
  - Development BluPantheon (dev) -> 361f77f0-bef1-11ef-86a5-96000228e7fe
  - Don Carlo San Martino (doncarlosanmartino) -> c354c01b-6e25-11f0-acb8-96000228e7fe
  - Fate Bene Fratelli (fatebenefratelli) -> 2d88ac57-73a5-11f0-acb8-96000228e7fe
  - Federfarma Roma (federfarmaroma) -> 3dadd270-3626-11f0-b087-96000228e7fe
  - Forma Camera (formacamera) -> 9b87a910-e477-11ef-9315-96000228e7fe
  - golvalerio (golvalerio) -> f071db89-83e3-11f0-bfd6-96000228e7fe
  - Gruppo Ospedaliero Leonardo (leonardo) -> bc4a964a-efde-11ef-9315-96000228e7fe
  - Homnya (homnya) -> 409a7aa7-fe55-11ef-9a34-96000228e7fe
  - Humanitas (humanitas) -> 015007d9-d413-11ef-86a5-96000228e7fe
  - Mondino (mondino2) -> f7b9e66a-8bd5-11ef-9557-96000228e7fe
  - MSC (msc) -> ccabd07d-1068-11f0-9133-96000228e7fe
  - Ospedale Isola Tiberina - Gemelli Isola (fbf) -> 964e85e1-a7e0-11ef-86a5-96000228e7fe
  - Tenant Evaluation (tenantevaluation) -> 396dba74-4aab-11f0-b6b8-96000228e7fe
  - Wopta (wopta) -> 16c222a9-f293-11ef-9315-96000228e7fe
Connessione al database TAG stabilita con successo
Errore durante l'esecuzione della query: 1146 (42S02): Table 'TAG.session_classifications' doesn't exist
Errore durante l'esecuzione della query: 1146 (42S02): Table 'TAG.session_classifications' doesn't exist
Connessione al database TAG chiusa
ğŸ” Risoluzione tenant da UUID: bc4a964a-efde-11ef-9315-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
ğŸ” Trovati 22 tenant da TAG.tenants:
  - Alleanza (alleanza) -> a0fd7600-f4f7-11ef-9315-96000228e7fe
  - BluPantheon (blupantheon) -> 6bc4f06f-742e-11f0-acb8-96000228e7fe
  - Boots (boots) -> 0f9d6e90-d319-11ef-86a5-96000228e7fe
  - CEF (cef) -> b1048bdb-b6ff-11ef-86a5-96000228e7fe
  - Cogeda (cogeda) -> cca12133-6955-11f0-9817-96000228e7fe
  - Community (community) -> d365ed2b-b8a6-11ef-86a5-96000228e7fe
  - Consiglio Regione Toscana (crt) -> 78ced6ea-030b-11f0-9a34-96000228e7fe
  - Demo BluPantheon (ai) -> 0c1231de-a58c-11ef-8c7f-96000228e7fe
  - Development BluPantheon (dev) -> 361f77f0-bef1-11ef-86a5-96000228e7fe
  - Don Carlo San Martino (doncarlosanmartino) -> c354c01b-6e25-11f0-acb8-96000228e7fe
  - Fate Bene Fratelli (fatebenefratelli) -> 2d88ac57-73a5-11f0-acb8-96000228e7fe
  - Federfarma Roma (federfarmaroma) -> 3dadd270-3626-11f0-b087-96000228e7fe
  - Forma Camera (formacamera) -> 9b87a910-e477-11ef-9315-96000228e7fe
  - golvalerio (golvalerio) -> f071db89-83e3-11f0-bfd6-96000228e7fe
  - Gruppo Ospedaliero Leonardo (leonardo) -> bc4a964a-efde-11ef-9315-96000228e7fe
  - Homnya (homnya) -> 409a7aa7-fe55-11ef-9a34-96000228e7fe
  - Humanitas (humanitas) -> 015007d9-d413-11ef-86a5-96000228e7fe
  - Mondino (mondino2) -> f7b9e66a-8bd5-11ef-9557-96000228e7fe
  - MSC (msc) -> ccabd07d-1068-11f0-9133-96000228e7fe
  - Ospedale Isola Tiberina - Gemelli Isola (fbf) -> 964e85e1-a7e0-11ef-86a5-96000228e7fe
  - Tenant Evaluation (tenantevaluation) -> 396dba74-4aab-11f0-b6b8-96000228e7fe
  - Wopta (wopta) -> 16c222a9-f293-11ef-9315-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Gruppo Ospedaliero Leonardo (leonardo) UUID=bc4a964a-efde-11ef-9315-96000228e7fe
âœ… Tenant risolto da UUID: Gruppo Ospedaliero Leonardo (bc4a964a-efde-11ef-9315-96000228e7fe)
Connessione al database TAG stabilita con successo
Errore durante l'esecuzione della query: 1146 (42S02): Table 'TAG.session_classifications' doesn't exist
Errore durante l'esecuzione della query: 1146 (42S02): Table 'TAG.session_classifications' doesn't exist
Connessione al database TAG chiusa
ğŸ” [DEBUG] GET /api/prompts/015007d9-d413-11ef-86a5-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant(015007d9-d413-11ef-86a5-96000228e7fe)...
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-30T12:34:13', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id 015007d9-d413-11ef-86a5-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ”§ Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ“Š Calcolo statistiche per tenant: Humanitas
ğŸ¯ TRAINING SUPERVISIONATO - Cliente: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“‹ Parametri utente semplificati:
  ï¿½ Max sessioni review: 500
  ğŸ¯ Soglia confidenza: 0.95
  ğŸ”„ Forza review: True
  âš–ï¸  Soglia disagreement: 0.3
ğŸ”§ Inizializzazione pipeline per cliente: 015007d9-d413-11ef-86a5-96000228e7fe (con lock)
âš ï¸ [PIPELINE] DEPRECATO: uso di tenant_slug '015007d9-d413-11ef-86a5-96000228e7fe' - convertendo a oggetto Tenant
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”„ [PIPELINE] Conversione completata: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
âœ… [CONFIG] Configurazione base caricata da /home/ubuntu/classificatore/Utils/../config.yaml
ğŸ¯ [PIPELINE CLUSTERING CONFIG] Caricati parametri personalizzati per tenant 015007d9-d413-11ef-86a5-96000228e7fe:
   allow_single_cluster: non_definito -> False
   alpha: non_definito -> 0.7
   cluster_selection_epsilon: non_definito -> 0.13
   cluster_selection_method: non_definito -> leaf
   max_cluster_size: non_definito -> 0
   metric: non_definito -> euclidean
   min_cluster_size: 5 -> 21
   min_samples: 3 -> 14
   only_user: non_definito -> False
   umap_metric: non_definito -> cosine
   umap_min_dist: non_definito -> 0.05
   umap_n_components: non_definito -> 100
   umap_n_neighbors: non_definito -> 15
   umap_random_state: non_definito -> 42
   use_umap: non_definito -> True

ğŸš€ [FASE 1: INIZIALIZZAZIONE] Avvio pipeline...
ğŸ¥ [FASE 1: INIZIALIZZAZIONE] Tenant: humanitas
ğŸ¯ [FASE 1: INIZIALIZZAZIONE] Configurazione:
   ğŸ“Š Confidence threshold: 0.7
   ğŸ¤– Auto mode: True
   ğŸ”„ Auto retrain: False
ï¿½ [FASE 1: INIZIALIZZAZIONE] Inizializzazione lettore conversazioni...
âœ… [CONFIG] Configurazione base caricata da /home/ubuntu/classificatore/Utils/../config.yaml
âœ… [CONFIG] Config personalizzata tenant 015007d9-d413-11ef-86a5-96000228e7fe: 15 parametri
ğŸ¯ [ONLY_USER] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: False (da config personalizzata)
ğŸ¯ [LETTORE] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: only_user = False (da config tenant)
ï¿½ [FASE 1: INIZIALIZZAZIONE] Inizializzazione aggregator...
   ğŸ” Schema: 'humanitas'
   ğŸ†” Tenant ID: '015007d9-d413-11ef-86a5-96000228e7fe'
ğŸ¯ [SESSION AGGREGATOR] Inizializzazione con oggetto Tenant: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ¯ [ONLY_USER] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: False (da config personalizzata)
ğŸ¯ [LETTORE] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: only_user = False (da config tenant)
ï¿½ [ONLY_USER] Schema None: False (legacy - no tenant_id)
ğŸ§  [FASE 1: INIZIALIZZAZIONE] Sistema embedder dinamico (lazy loading)
ğŸ”§ [FASE 1: INIZIALIZZAZIONE] Parametri clustering:
   ğŸ“Š Min cluster size: 21
   ğŸ“Š Min samples: 14
ğŸ› DEBUG CLUSTER_ALPHA - PRIMA:
   ğŸ“‹ clustering_config.get('alpha', 1.0): 0.7
   ğŸ“‹ Type: <class 'float'>
ğŸ› DEBUG CLUSTER_ALPHA - DOPO CONVERSIONE:
   ğŸ“‹ cluster_alpha: 0.7
   ğŸ“‹ Type: <class 'float'>
ğŸ› DEBUG CLUSTER_ALPHA - FINALE:
   ğŸ“‹ cluster_alpha finale: 0.7
   ğŸ“‹ Type finale: <class 'float'>
   ğŸ“‹ Alpha > 0: True
âœ… [CONFIG] Config personalizzata tenant 015007d9-d413-11ef-86a5-96000228e7fe: 15 parametri
ğŸ—‚ï¸  [UMAP] Parametri per tenant 015007d9-d413-11ef-86a5-96000228e7fe:
   use_umap: True
   n_neighbors: 15
   min_dist: 0.05
   n_components: 100
   metric: cosine
ğŸ”§ [FIX DEBUG] Parametri tenant passati a HDBSCANClusterer:
   min_cluster_size: 21
   min_samples: 14
   alpha: 0.7
   cluster_selection_method: leaf
   cluster_selection_epsilon: 0.13
   metric: euclidean
   allow_single_cluster: False
   max_cluster_size: 0
   ğŸ—‚ï¸  use_umap: True
   ğŸ—‚ï¸  umap_n_neighbors: 15
   ğŸ—‚ï¸  umap_min_dist: 0.05
   ğŸ—‚ï¸  umap_n_components: 100
ğŸ¯ [BERTOPIC] Parametri consistenti configurati:
   ğŸ“Š HDBSCAN: 10 parametri
   ğŸ“Š UMAP: 5 parametri
ğŸ”§ HDBSCANClusterer inizializzato:
   min_cluster_size: 21
   min_samples: 14
   metric: euclidean
   cluster_selection_epsilon: 0.13
   ğŸ—‚ï¸  UMAP enabled: True
     ğŸ“ n_neighbors: 15
     ğŸ“ min_dist: 0.05
     ğŸ“Š n_components: 100
     ğŸ¯ metric: cosine
   ğŸš€ GPU enabled: True
   ğŸ’¾ GPU memory limit: 80%
   ğŸ”„ CPU fallback: True
   âš ï¸  [GPU MODE] Limitazioni cuML HDBSCAN:
     ğŸš« leaf_size=40 sarÃ  IGNORATO su GPU
     âœ… Parametri supportati: cluster_selection_method, alpha, allow_single_cluster
ğŸ¯ [DEBUG REACT] Parametri configurati:
   cluster_selection_method: leaf
   alpha: 0.7
   allow_single_cluster: False
ğŸ§  Inizializzazione memoria semantica...
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
ğŸ”§ TokenizationManager inizializzato:
   ğŸ“Š Modello tokenizer: cl100k_base
   ğŸ”¢ Limite massimo token: 8000
   âœ‚ï¸  Strategia troncamento: start
âœ… TokenizationManager integrato in LaBSE per gestione conversazioni lunghe
ğŸš€ Inizializzazione LaBSE embedder su device: cuda
ğŸ“¥ Caricamento modello sentence-transformers/LaBSE...
ğŸš€ Caricamento diretto su GPU...
âœ… Modello caricato con successo!
ğŸ“Š Dimensione embedding: 768
ğŸ”§ Device: cuda
ğŸ® GPU: NVIDIA A10G
ğŸ’¾ GPU Memory: 23.7 GB
ğŸ“ˆ GPU Memory utilizzata: 1.89 GB
ï¿½ Primo parametro su device: cuda:0
ğŸ§ª Test del modello LaBSE...
ğŸ” Encoding 3 testi con LaBSE su device cuda...

ğŸ” TOKENIZZAZIONE PREVENTIVA LABSE CLUSTERING
============================================================
ğŸ” ELABORAZIONE CONVERSAZIONI PER CLUSTERING
   ğŸ“Š Numero conversazioni: 3
   ğŸ†” Session IDs forniti: No

ğŸ“Š STATISTICHE ELABORAZIONE:
   ğŸ”¢ Conversazioni totali: 3
   âœ‚ï¸  Conversazioni troncate: 0
   ğŸ“ Token originali totali: 20
   ğŸ“ Token finali totali: 20
   ğŸ“Š Range token: 6 - 7
âœ… Tokenizzazione LaBSE completata:
   ğŸ“Š Conversazioni processate: 3
   ğŸ“Š Conversazioni troncate: 0
   ğŸ“Š Token limite configurato: 8000
   âœ… Tutte le conversazioni entro i limiti, nessun troncamento
============================================================
âœ… Embedding generati: shape (3, 768)
âœ… Test modello completato con successo!
   Shape: (3, 768)
   Norme: [0.99999994 1.         1.        ]
   Device: cuda
ğŸ¯ Modello pronto per l'uso!
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
ğŸ§  SemanticMemoryManager inizializzato
  ğŸ¯ Soglia riutilizzo etichette: 0.8
  ğŸ” Soglia similaritÃ  semantica: 0.8
  ğŸ’¾ Cache path: semantic_cache/humanitas_015007d9_memory
ğŸ”— Inizializzazione ensemble classifier avanzato...
ğŸ” ML Ensemble Debugger inizializzato e ATTIVO
   ğŸ“ Debug file: ./debug_logs/ml_debug.log
ğŸ” ML Ensemble Debugger attivato
ğŸ”§ Tentativo di inizializzazione IntelligentClassifier tramite LLMFactory...
ğŸ§  GPU Memory prima di LLM: 1.8GB/22.1GB (free: 20.3GB)
âœ… Memoria GPU sufficiente, inizializzazione LLM tramite Factory...
ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ­ LLM Factory inizializzato con cache invalidation intelligente
ğŸ” LLM FACTORY DEBUG: Chiamata ai_config_service.get_tenant_configuration(humanitas) normale...
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id humanitas
ğŸ” [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 28, 16, 51, 54)}
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 28, 16, 51, 54), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
ğŸ¯ LLM FACTORY DEBUG: Modello normale = 'mistral:7b'
ğŸ”§ Creazione LLM classifier mistral:7b per tenant humanitas
ğŸš€ LLM FACTORY DEBUG: Avvio creazione nuovo classifier modello 'mistral:7b'
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto da slug (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” LLM Debugger inizializzato e ATTIVO
   ğŸ“ Debug file: ./debug_logs/llm_debug.log
   ğŸ¨ Visual formatting: True
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
ğŸ—„ï¸ MongoClassificationReader inizializzato per tenant: Humanitas
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
Connessione al database TAG stabilita con successo
ğŸ“‹ Recuperati 265 tag dal database TAGS per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
ğŸ”§ TokenizationManager inizializzato:
   ğŸ“Š Modello tokenizer: cl100k_base
   ğŸ”¢ Limite massimo token: 8000
   âœ‚ï¸  Strategia troncamento: start
âœ… LLM FACTORY DEBUG: Nuovo classifier creato: mistral:7b
âœ… LLM Classifier mistral:7b (mistral:7b) creato e cached per tenant humanitas
ğŸ­ LLM classifier ottenuto tramite Factory per tenant humanitas
ğŸ¤– LLM classifier creato automaticamente nell'ensemble: mistral:7b
ğŸ’¡ Possibile fine-tuning per humanitas
ğŸ”— Advanced Ensemble Classifier inizializzato
   ğŸ§  LLM weight: 0.60
   ğŸ¤– ML weight: 0.40
   ğŸ¯ Confidence threshold: 0.7
   ğŸ”„ Adaptive weights: True
   ğŸ‘¤ Disaccordi gestiti da QualityGateEngine
ğŸ“¥ Caricamento ultimo modello per humanitas: humanitas_015007d9_20250829_181313
ğŸ“¥ Caricamento ensemble model...
âœ… ML ensemble caricato
âœ… Configurazione caricata
ğŸ”— Ensemble model caricato da models/humanitas_015007d9_20250829_181313
âœ… Modello caricato con successo

ğŸ” VERIFICA BERTOPIC LOADING:
   ğŸ“‹ BERTopic enabled: True
   ğŸ“‹ BERTopic available: True
   ğŸ“ Provider directory: models/humanitas_015007d9_20250829_181313_bertopic
   ğŸ“ Directory exists: True
   ï¿½ File trovati: 3 -> ['metadata.json', 'bertopic_model', 'svd_model.pkl']

ğŸ”„ CARICAMENTO BERTOPIC:
   ğŸ“ Path completo: /home/ubuntu/classificatore/models/humanitas_015007d9_20250829_181313_bertopic
ğŸ”„ Caricamento BERTopic model da models/humanitas_015007d9_20250829_181313_bertopic/bertopic_model
âœ… BERTopic model caricato con successo
ğŸ“¥ SVD caricato (svd_model.pkl)
   â±ï¸ Caricamento completato in 0.51 secondi
   âœ… BERTopic provider caricato con successo
ğŸ”— BERTopic provider impostato (top_k=10, one_hot=False)
   âœ… BERTopic provider configurato nell'ensemble
â¸ï¸ Riaddestramento automatico disabilitato (modalitÃ  supervisione/API)
   ğŸ’¡ Per abilitare, usare auto_retrain=True nell'inizializzazione
âœ… Classificatore LLM disponibile nell'ensemble
ğŸ‘¤ Inizializzazione trainer interattivo...
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
ğŸ¯ SIMPLE MANAGER: Richiesta embedder per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“¥ Primo embedder - creazione per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸš€ CREATING FRESH EMBEDDER per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ FORCE NO CACHE: Bypass cache per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”¥ FORCE NO CACHE: Bypasso cache e leggo DIRETTAMENTE dal database per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 28, 16, 51, 54)}
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 28, 16, 51, 54), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
ğŸ” SIMPLE MANAGER: Engine da DB per 015007d9-d413-11ef-86a5-96000228e7fe = 'labse'
ğŸ¯ Engine configurato: labse
ğŸ”§ DIRECT CREATE: labse
ğŸ³ Tentativo connessione a servizio LaBSE dockerizzato...
ğŸ”— LaBSE Remote Client inizializzato
   ğŸ“¡ Service URL: http://localhost:8081
   â±ï¸  Timeout: 300s
   ğŸ”„ Max retries: 3
   ğŸ›¡ï¸ Fallback locale: True
ğŸ”§ Inizializzazione client remoto LaBSE...
âœ… Servizio embedding online e funzionante
âœ… Client remoto LaBSE inizializzato con successo
âœ… LaBSE Remote Client configurato con successo
âœ… FRESH EMBEDDER creato: LaBSERemoteClient per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ§  Inizializzazione dedupplicatore intelligente...
ğŸ’¾ [FASE 1: INIZIALIZZAZIONE] Caricamento memoria semantica...
ğŸ”„ Caricamento memoria semantica dal database...
ğŸ”„ Caricamento memoria semantica da MongoDB...
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Recupero sessioni per tenant: Humanitas
   ğŸ“‚ Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“š Trovate 2 classificazioni esistenti in MongoDB
  ğŸ“ Tag 'info_visita_medica': 1 sessioni classificate
  ğŸ“ Tag 'altro': 1 sessioni classificate
âœ… Memoria semantica caricata: 2 tag, 2 sessioni
   ğŸ“Š Campioni: 2
   ğŸ·ï¸ Tag: 2
âœ… [FASE 1: INIZIALIZZAZIONE] Completata in 5.56s
ğŸ¯ [FASE 1: INIZIALIZZAZIONE] Pipeline pronta per l'uso!
âœ… Pipeline 015007d9-d413-11ef-86a5-96000228e7fe inizializzata
ğŸš€ TRAINING SUPERVISIONATO CON DATASET COMPLETO
  ğŸ“Š Estrazione: TUTTE le discussioni dal database
  ğŸ§© Clustering: Su tutto il dataset disponibile
  ğŸ‘¤ Review umana: Max 500 sessioni rappresentative
ğŸ¯ Confidence threshold aggiornato a: 0.95
ğŸ“ TRAINING SUPERVISIONATO AVANZATO
ï¿½ NUOVA LOGICA:
  ğŸ”„ Estrazione: TUTTE le discussioni dal database
  ğŸ§© Clustering: Su tutto il dataset completo
  ğŸ‘¤ Review umana: Massimo 500 sessioni rappresentative
--------------------------------------------------
ğŸ“Š FASE 1: ESTRAZIONE COMPLETA DATASET

ï¿½ [FASE 2: ESTRAZIONE] Avvio estrazione sessioni...
ğŸ¥ [FASE 2: ESTRAZIONE] Tenant: humanitas
ğŸ“… [FASE 2: ESTRAZIONE] Giorni indietro: 7
ğŸ”„ [FASE 2: ESTRAZIONE] ModalitÃ  COMPLETA attivata
ğŸ¯ [FASE 2: ESTRAZIONE] Ignorando limite - estrazione totale dataset
ï¿½ [FASE 2: ESTRAZIONE] ModalitÃ : COMPLETA
ï¿½ [FASE 2: ESTRAZIONE] Connessione database...
ğŸ“Š [DEBUG ONLY_USER] Estrazione sessioni aggregate dal schema 'humanitas'...
ğŸ¯ [DEBUG ONLY_USER] Parametro only_user = False (tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“„ [DEBUG ONLY_USER] Estrazione completa (senza limite)
ğŸ“„ [DEBUG ONLY_USER] Filtraggio standard: messaggi USER e AGENT
ğŸ” [DEBUG ONLY_USER] Esecuzione query per leggere conversazioni dal schema 'humanitas'...
ğŸ¯ [DEBUG ONLY_USER] Parametro only_user = False
ğŸ“‹ [DEBUG ONLY_USER] Filtro applicato: WHERE csm.said_by IN ('USER', 'AGENT')
Connessione al database MySQL stabilita con successo
âœ… [DEBUG ONLY_USER] Query eseguita con successo!
ğŸ“Š [DEBUG ONLY_USER] Totale righe: 21585
ğŸ‘¤ [DEBUG ONLY_USER] Messaggi USER: 10774
ğŸ¤– [DEBUG ONLY_USER] Messaggi AGENT: 10811
âœ… [DEBUG ONLY_USER] Filtro funziona correttamente!
âœ… Trovate 21585 righe da aggregare
ğŸ”„ [DEBUG ONLY_USER] Inizio generazione testo completo per 4305 sessioni
ğŸ” [DEBUG ONLY_USER] Sessione 0008ef4f-c2f4-4f5e-933e-646574f3638c: 3 USER, 3 AGENT
ğŸ“ [DEBUG ONLY_USER] Sessione 0008ef4f-c2f4-4f5e-933e-646574f3638c testo finale:
   [UTENTE] tags: 2
   [ASSISTENTE] tags: 2
   Lunghezza testo: 554 caratteri
ğŸ” [DEBUG ONLY_USER] Sessione 000b61d7-4431-40d2-b83c-9abbb70c98be: 4 USER, 4 AGENT
ğŸ“ [DEBUG ONLY_USER] Sessione 000b61d7-4431-40d2-b83c-9abbb70c98be testo finale:
   [UTENTE] tags: 3
   [ASSISTENTE] tags: 3
   Lunghezza testo: 1133 caratteri
ğŸ” [DEBUG ONLY_USER] Sessione 00160700-ac7f-463d-8fa0-fe57f74a73e6: 4 USER, 4 AGENT
âœ… Aggregate 4305 sessioni uniche
ğŸ”„ Saltati 8610 messaggi di benvenuto (primi 2 per sessione)
ğŸ”„ Sessioni vuote (solo benvenuto): 906
ğŸ“¥ [FASE 2: ESTRAZIONE] Sessioni grezze: 4305
ğŸ” [FASE 2: ESTRAZIONE] Filtraggio sessioni...
ğŸ” Filtraggio sessioni vuote/irrilevanti...
âœ… Filtro completato:
  ğŸ“Š Sessioni originali: 4305
  âŒ Sessioni scartate: 906
  âœ… Sessioni valide: 3399
âœ… [FASE 2: ESTRAZIONE] Completata in 0.65s
ğŸ“Š [FASE 2: ESTRAZIONE] Dataset completo: 3399 sessioni
ğŸ—‘ï¸ [FASE 2: ESTRAZIONE] Filtrate: 906 sessioni vuote/irrilevanti
ğŸ¯ [FASE 2: ESTRAZIONE] Pronte per clustering completo
âœ… Dataset completo: 3399 sessioni totali

ğŸ“Š FASE 2: CLUSTERING COMPLETO

ğŸš€ [FASE 4: CLUSTERING] Avvio clustering intelligente...
ğŸ“Š [FASE 4: CLUSTERING] Dataset: 3399 sessioni
ğŸ¯ [FASE 4: CLUSTERING] ModalitÃ : INTELLIGENTE
ğŸ§  [FASE 4: CLUSTERING] Clustering incrementale (se possibile)...

ğŸš€ [FASE 3: EMBEDDINGS] Avvio generazione embeddings...
ï¿½ [FASE 3: EMBEDDINGS] Dataset: 3399 sessioni
ğŸ“Š [FASE 3: EMBEDDINGS] Caratteristiche testo:
   ğŸ“ Lunghezza media: 1012 caratteri
   ğŸ“ Lunghezza massima: 29104 caratteri
   ğŸ“ Lunghezza minima: 75 caratteri
ğŸ§  [FASE 3: EMBEDDINGS] Generazione embeddings...
ğŸ”„ LAZY LOADING: Caricamento embedder dinamico per tenant 'humanitas'
ğŸ¯ SimpleEmbeddingManager inizializzato
ğŸ”„ SIMPLE MANAGER: Normalizzato 'humanitas' -> '015007d9-d413-11ef-86a5-96000228e7fe'
ğŸ¯ SIMPLE MANAGER: Richiesta embedder per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“¥ Primo embedder - creazione per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸš€ CREATING FRESH EMBEDDER per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ FORCE NO CACHE: Bypass cache per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”¥ FORCE NO CACHE: Bypasso cache e leggo DIRETTAMENTE dal database per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 28, 16, 51, 54)}
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 28, 16, 51, 54), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
ğŸ” SIMPLE MANAGER: Engine da DB per 015007d9-d413-11ef-86a5-96000228e7fe = 'labse'
ğŸ¯ Engine configurato: labse
ğŸ”§ DIRECT CREATE: labse
ğŸ³ Tentativo connessione a servizio LaBSE dockerizzato...
ğŸ”— LaBSE Remote Client inizializzato
   ğŸ“¡ Service URL: http://localhost:8081
   â±ï¸  Timeout: 300s
   ğŸ”„ Max retries: 3
   ğŸ›¡ï¸ Fallback locale: True
ğŸ”§ Inizializzazione client remoto LaBSE...
âœ… Servizio embedding online e funzionante
âœ… Client remoto LaBSE inizializzato con successo
âœ… LaBSE Remote Client configurato con successo
âœ… FRESH EMBEDDER creato: LaBSERemoteClient per tenant 015007d9-d413-11ef-86a5-96000228e7fe
âœ… Embedder caricato per tenant UUID 'humanitas': LaBSERemoteClient
ğŸ“¡ Richiesta embedding remoto per 3399 testi...
âœ… Embedding remoto completato in 6.931s
   ğŸ“Š Shape: (3399, 768)
   âš¡ Tempo servizio: 3.432s
âœ… [FASE 3: EMBEDDINGS] Completata in 7.10s
ğŸ“ˆ [FASE 3: EMBEDDINGS] Shape: (3399, 768)
âš¡ [FASE 3: EMBEDDINGS] Throughput: 479.0 testi/secondo

ğŸ“Š FASE 2A: TRAINING BERTOPIC ANTICIPATO

ğŸš€ TRAINING BERTOPIC ANTICIPATO (NUOVO FLUSSO OTTIMIZZATO):
   ğŸ“Š Dataset completo: 3399 sessioni
   ğŸ“Š Embeddings shape: (3399, 768)
   ğŸ¯ Addestramento su TUTTO il dataset per features ottimali
   ğŸ”¥ Esecuzione bertopic_provider.fit() su dataset completo...
ğŸ“Š BERTopic training su 3399 campioni
   ğŸ¯ Embedder configurato: LaBSERemoteClient
   ğŸ”§ STRATEGIA: BERTopic userÃ  embedder personalizzato via wrapper
   âœ… Wrapper embedder creato per BERTopic
   ğŸ”§ BERTopic userÃ  embedder personalizzato interno
âœ… BERTopic FIT completato su 3399 campioni
   ğŸ”§ SVD Training: Usando embedder personalizzato interno
âœ… SVD addestrato su full probas (k=20)
   âœ… BERTopic FIT completato in 41.15 secondi
   ğŸ”„ Esecuzione bertopic_provider.transform() per features extraction...
ğŸ”§ Transform: BERTopic userÃ  embedder personalizzato interno
   âœ… BERTopic TRANSFORM completato in 4.53 secondi
   ğŸ“Š Topic probabilities shape: (3399, 20)
   ğŸ“Š One-hot shape: None
   âœ… BERTopic provider addestrato con successo su 3399 sessioni
   âœ… BERTopic provider disponibile per augmentation features
   ğŸ”— BERTopic model assegnato al trainer per validazione ALTRO

ğŸ“Š FASE 2B: CLUSTERING HDBSCAN
ğŸ§  Usando clustering INTELLIGENTE (LLM + ML senza pattern)
ğŸ—‚ï¸  [DEBUG] Caricamento config tenant-specific: /home/ubuntu/classificatore/tenant_configs/015007d9-d413-11ef-86a5-96000228e7fe_clustering.yaml
ğŸ—‚ï¸  [DEBUG] Config tenant caricato: ['allow_single_cluster', 'alpha', 'cluster_selection_epsilon', 'cluster_selection_method', 'max_cluster_size', 'metric', 'min_cluster_size', 'min_samples', 'only_user', 'umap_metric', 'umap_min_dist', 'umap_n_components', 'umap_n_neighbors', 'umap_random_state', 'use_umap']
ğŸ—‚ï¸  [DEBUG] UMAP config finale: use_umap=True, n_components=100, min_dist=0.05
ğŸ§  Clustering intelligente configurato:
   ğŸ¯ Categorie intent suggerite: 12
   ğŸ¤– LLM primario: True
   ğŸ“Š Min confidence: 0.8
   ğŸ“ˆ Min conversations per intent: 2
   ğŸ‘¥ Rappresentanti diversificati: True
   ğŸ”¢ Max rappresentanti per cluster: 5
   ğŸ¤ Strategia consenso: majority
ğŸ§  Avvio clustering intelligente OTTIMIZZATO di 3399 conversazioni...
ğŸ“Š Fase 1: Clustering semantico con HDBSCAN...
ğŸ”§ HDBSCANClusterer inizializzato:
   min_cluster_size: 21
   min_samples: 14
   metric: euclidean
   cluster_selection_epsilon: 0.13
   ğŸ—‚ï¸  UMAP enabled: True
     ğŸ“ n_neighbors: 15
     ğŸ“ min_dist: 0.05
     ğŸ“Š n_components: 100
     ğŸ¯ metric: cosine
   ğŸš€ GPU enabled: True
   ğŸ’¾ GPU memory limit: 80%
   ğŸ”„ CPU fallback: True
   âš ï¸  [GPU MODE] Limitazioni cuML HDBSCAN:
     ğŸš« leaf_size=40 sarÃ  IGNORATO su GPU
     âœ… Parametri supportati: cluster_selection_method, alpha, allow_single_cluster
ğŸ¯ [DEBUG REACT] Parametri configurati:
   cluster_selection_method: eom
   alpha: 1.0
   allow_single_cluster: False
ğŸ” Clustering HDBSCAN su 3399 embedding (19.9MB)...
âš™ï¸  Parametri: min_cluster_size=21, min_samples=14, metric=euclidean
ğŸ“Š [DEBUG FIT_PREDICT] Embedding input:
   ğŸ“ Shape: (3399, 768)
   ğŸ”¢ Dtype: float64
   ğŸ“ˆ Range: [-0.1284, 0.0954]
   ğŸ’¾ Memory: 19.9MB

ğŸ—‚ï¸  [DEBUG FIT_PREDICT] STEP 1: Controllo applicazione UMAP...
ğŸ” [DEBUG UMAP] Controllo condizioni applicazione UMAP...
   âœ… self.use_umap = True
   âœ… UMAP_AVAILABLE = True
ï¿½ [DEBUG UMAP] UMAP ABILITATO - Iniziando riduzione dimensionale...
   ğŸ“ Dimensioni input: (3399, 768)
   ğŸ”¢ Tipo dati input: float64
   ğŸ“Š Range valori input: [-0.1284, 0.0954]
   ğŸ¯ Parametri UMAP configurati:
     ğŸ“ n_neighbors: 15
     ğŸ“ min_dist: 0.05
     ğŸ”¢ n_components: 100
     ğŸ“ˆ metric: cosine
     ğŸ² random_state: 42
ğŸ”§ [DEBUG UMAP] Inizializzazione riduttore UMAP...
ğŸ†• [DEBUG UMAP] ModalitÃ  TRAINING - fit nuovo reducer
âœ… [DEBUG UMAP] Riduttore UMAP inizializzato con successo
â³ [DEBUG UMAP] Applicazione fit_transform agli embeddings...
UMAP(angular_rp_forest=True, metric='cosine', min_dist=0.05, n_components=100, n_jobs=1, random_state=42, verbose=True)
Sun Aug 31 09:55:33 2025 Construct fuzzy simplicial set
Sun Aug 31 09:55:48 2025 Finding Nearest Neighbors
Sun Aug 31 09:55:49 2025 Finished Nearest Neighbor Search
Sun Aug 31 09:55:49 2025 Construct embedding
	completed  0  /  500 epochs
	completed  50  /  500 epochs
ğŸ”§ Creazione MongoClassificationReader per cliente: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” Risoluzione tenant da UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Alleanza (alleanza) UUID=a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… Tenant risolto da UUID: Alleanza (a0fd7600-f4f7-11ef-9315-96000228e7fe)
ğŸ“Š Collection generata: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe per tenant Alleanza
âœ… MongoClassificationReader inizializzato per tenant: Alleanza
   ğŸ“Š Collection: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Alleanza (alleanza)
ğŸ“Š Collection generata: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe per tenant Alleanza
   ğŸ“Š Collection: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe
	completed  100  /  500 epochs
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe per tenant Alleanza
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Alleanza
ğŸ“Š Calcolo statistiche per tenant: Alleanza
ğŸ”§ Creazione MongoClassificationReader per cliente: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” Risoluzione tenant da UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
	completed  150  /  500 epochs
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Alleanza (alleanza) UUID=a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… Tenant risolto da UUID: Alleanza (a0fd7600-f4f7-11ef-9315-96000228e7fe)
ğŸ“Š Collection generata: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe per tenant Alleanza
âœ… MongoClassificationReader inizializzato per tenant: Alleanza
   ğŸ“Š Collection: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Alleanza (alleanza)
ğŸ“Š Collection generata: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe per tenant Alleanza
   ğŸ“Š Collection: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe per tenant Alleanza
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Alleanza
ğŸ“Š Calcolo statistiche per tenant: Alleanza
	completed  200  /  500 epochs
	completed  250  /  500 epochs
	completed  300  /  500 epochs
	completed  350  /  500 epochs
	completed  400  /  500 epochs
	completed  450  /  500 epochs
Sun Aug 31 09:56:01 2025 Finished embedding
âœ… [DEBUG UMAP] UMAP COMPLETATO con SUCCESSO in 27.15s
   ğŸ“ Dimensioni output: (3399, 100)
   ï¿½ Tipo dati output: float32
   ï¿½ğŸ“Š Range valori output: [-2.8744, 11.2292]
   ğŸ“ˆ Riduzione dimensionale: 768 â†’ 100 dimensioni
   ğŸ“‰ Fattore riduzione: 7.7x
âœ… [DEBUG UMAP] RIDUZIONE DIMENSIONALE CONFERMATA
âœ… [DEBUG UMAP] Nessun NaN nel risultato UMAP
âœ… [DEBUG UMAP] Nessun valore infinito nel risultato UMAP
ğŸ“Š [DEBUG UMAP] DiversitÃ  embeddings ridotti: 3399/3399 righe uniche
âœ… [DEBUG UMAP] Buona diversitÃ  negli embeddings ridotti
ğŸ“‹ [DEBUG UMAP] Info riduzione salvate nel clusterer
ğŸ“‹ [DEBUG FIT_PREDICT] Risultato UMAP:
   âœ… UMAP applicato: True
   ğŸ“ Shape post-UMAP: (3399, 100)
   ğŸ“ˆ Range post-UMAP: [-2.8744, 11.2292]
   â±ï¸  Tempo riduzione: 27.15s

ğŸ”§ [DEBUG FIT_PREDICT] STEP 2: Normalizzazione per metrica euclidean...
   ğŸ¯ Nessuna normalizzazione necessaria per metrica euclidean
   ğŸ“ Shape finale per clustering: (3399, 100)
   ğŸ“ˆ Range finale: [-2.8744, 11.2292]
   ğŸ¯ Metrica effettiva clustering: euclidean
ğŸ’¾ Memoria GPU: 17.7GB disponibili, 0.1GB necessari
ğŸš€ Utilizzo GPU per clustering accelerato

ğŸš€ [DEBUG FIT_PREDICT] STEP 3: Avvio clustering...
   ğŸ–¥ï¸  ModalitÃ : GPU
ï¿½ [GPU CLUSTERING] Inizializzazione cuML HDBSCAN con parametri supportati...

âœ… [DEBUG FIT_PREDICT] CLUSTERING COMPLETATO in 0.11s con ğŸš€ GPU!
ğŸ“Š Risultati finali:
   ğŸ¯ Cluster trovati: 38
   ğŸ” Outlier: 849 (25.0%)
   ğŸ“ˆ Silhouette score: 0.653

ğŸ“‹ [DEBUG FIT_PREDICT] RIEPILOGO TRASFORMAZIONI:
   ğŸ”¤ Input originale: (3399, 768)
   ğŸ—‚ï¸  Dopo UMAP: (3399, 100)
   ğŸ”§ Dopo normalizzazione: (3399, 100)
   ğŸ¯ Utilizzato per clustering: (3399, 100) con metrica euclidean
   ğŸ“ˆ Cluster HDBSCAN trovati: 38
   ğŸ” Outliers: 849
ğŸ‘¥ Fase 2: Selezione rappresentanti per cluster...
   ï¿½ Cluster 0: 45 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 1: 35 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 2: 28 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 3: 96 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 4: 299 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 5: 156 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 6: 46 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 7: 96 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 8: 65 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 9: 156 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 10: 29 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 11: 45 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 12: 51 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 13: 63 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 14: 27 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 15: 47 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 16: 37 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 17: 191 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 18: 102 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 19: 33 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 20: 37 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 21: 26 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 22: 27 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 23: 57 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 24: 35 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 25: 72 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 26: 22 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 27: 144 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 28: 34 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 29: 33 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 30: 50 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 31: 117 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 32: 23 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 33: 97 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 34: 24 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 35: 42 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 36: 41 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 37: 22 sessioni, 4 rappresentanti selezionati
ğŸ¤– Fase 3: Analisi LLM di 167 rappresentanti...
ğŸ¤– Analisi LLM di 167 conversazioni...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 338
   ğŸ“Š Token totali: 786
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 786 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 338
   ğŸ“Š Token conversazione finale: 338
   ğŸ“Š Token totali: 786
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1089 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao, vorrei prenotare un intervento in regime privato, come devo fare? [ASSISTENTE] Per prenotare un ricovero privato presso Humanitas, puoi contattare l'Ufficio Ricoveri Privati chiamando il numero 02 82 24 62 50, attivo dal lunedÃ¬ al venerdÃ¬ dalle 8:00 alle 17:00, oppure inviare un'em..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2848 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 338
   ğŸ“Š Token totali stimati: 786
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao, vorrei prenotare un intervento in regime privato, come devo fare? [ASSISTENTE] Per prenotare un ricovero privato presso Humanitas, puoi contattare l'Ufficio Ricoveri Privati chiamando il numero 02 82 24 62 50, attivo dal lunedÃ¬ al venerdÃ¬ dalle 8:00 alle 17:00, oppure inviare un'em..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:56:06.868852
====================================================================================================
ğŸ“‹ Session ID: classify_1756634166
â±ï¸  Processing Time: 5.408s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1089 chars):
   [UTENTE] Ciao, vorrei prenotare un intervento in regime privato, come devo fare? [ASSISTENTE] Per prenotare un ricovero privato presso Humanitas, puoi contattare l'Ufficio Ricoveri Privati chiamand...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (449 chars):
   {'predicted_label': 'prenotazione', 'confidence': 0.98, 'motivation': "La conversazione riguarda la prenotazione di un intervento in regime privato presso Humanitas. L'utente chiede come procedere e l'assistente fornisce le informazioni necessarie per contattare l'Ufficio Ricoveri Privati e invia...

ğŸ“Š Parsed Response:
   predicted_label: prenotazione
   confidence: 0.98
   motivation: La conversazione riguarda la prenotazione di un intervento in regime privato presso Humanitas. L'utente chiede come procedere e l'assistente fornisce le informazioni necessarie per contattare l'Ufficio Ricoveri Privati e invia una richiesta di email. Inoltre, l'assistente suggerisce di consultare la pagina delle prenotazioni sul sito web di Humanitas per ulteriori dettagli.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.980
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 98.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un intervento in regime privato presso Humanitas. L'utente chiede come procedere e l'assistente fornisce le informazioni necessarie per contattare l'Ufficio Ricoveri Privati e invia una richiesta di email. Inoltre, l'assistente suggerisce di consultare la pagina delle prenotazioni sul sito web di Humanitas per ulteriori dettagli.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 994777348e56d6c19c747e60c3684247 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 196
   ğŸ“Š Token totali: 644
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 644 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 196
   ğŸ“Š Token conversazione finale: 196
   ğŸ“Š Token totali: 644
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 629 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Non ho ricevuto la documentazione della polizza"
Output: problema_amministrativo
Ragionamento: Problemi con documenti o questioni amministrative
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Volevo sapere se nel Building 8 c'Ã¨ una cappella e a che ora fanno la messa il sabato e la domenica  [ASSISTENTE] Nel Building 8 di Humanitas Ã¨ presente una cappella dedicata al culto cattolico situata al piano terra. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2816 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 196
   ğŸ“Š Token totali stimati: 644
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Non ho ricevuto la documentazione della polizza"
Output: problema_amministrativo
Ragionamento: Problemi con documenti o questioni amministrative
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Volevo sapere se nel Building 8 c'Ã¨ una cappella e a che ora fanno la messa il sabato e la domenica  [ASSISTENTE] Nel Building 8 di Humanitas Ã¨ presente una cappella dedicata al culto cattolico situata al piano terra. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:56:10.151475
====================================================================================================
ğŸ“‹ Session ID: classify_1756634170
â±ï¸  Processing Time: 3.190s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (629 chars):
   [UTENTE] Volevo sapere se nel Building 8 c'Ã¨ una cappella e a che ora fanno la messa il sabato e la domenica  [ASSISTENTE] Nel Building 8 di Humanitas Ã¨ presente una cappella dedicata al culto catt...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (428 chars):
   {'predicted_label': 'info_cappella', 'confidence': 0.98, 'motivation': "La conversazione riguarda la richiesta dell'utente di sapere se nel Building 8 c'Ã¨ una cappella e a che orario fanno le messe il sabato e la domenica. L'assistente fornisce l'informazione che ci sono delle funzioni religiose ...

ğŸ“Š Parsed Response:
   predicted_label: info_cappella
   confidence: 0.98
   motivation: La conversazione riguarda la richiesta dell'utente di sapere se nel Building 8 c'Ã¨ una cappella e a che orario fanno le messe il sabato e la domenica. L'assistente fornisce l'informazione che ci sono delle funzioni religiose nel Building 8, ma suggerisce di verificare direttamente in loco per gli orari specifici delle messe del sabato e della domenica.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.980
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 98.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la richiesta dell'utente di sapere se nel Building 8 c'Ã¨ una cappella e a che orario fanno le messe il sabato e la domenica. L'assistente fornisce l'informazione che ci sono delle funzioni religiose nel Building 8, ma suggerisce di verificare direttamente in loco per gli orari specifici delle messe del sabato e della domenica.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 0c6071bc7202b18f1495b52f9fe10503 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'info_cappella' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 363
   ğŸ“Š Token totali: 811
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 811 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 363
   ğŸ“Š Token conversazione finale: 363
   ğŸ“Š Token totali: 811
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1144 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao il bar al Building 2 quali orari osserva [ASSISTENTE] Il bar situato al primo piano del Building 2, in fondo al corridoio centrale, Ã¨ aperto tutti i giorni dalle 6:30 alle 21:00. [...] it/info/altri-servizi/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2805 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 363
   ğŸ“Š Token totali stimati: 811
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao il bar al Building 2 quali orari osserva [ASSISTENTE] Il bar situato al primo piano del Building 2, in fondo al corridoio centrale, Ã¨ aperto tutti i giorni dalle 6:30 alle 21:00. [...] it/info/altri-servizi/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:56:12.746312
====================================================================================================
ğŸ“‹ Session ID: classify_1756634172
â±ï¸  Processing Time: 2.507s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1144 chars):
   [UTENTE] Ciao il bar al Building 2 quali orari osserva [ASSISTENTE] Il bar situato al primo piano del Building 2, in fondo al corridoio centrale, Ã¨ aperto tutti i giorni dalle 6:30 alle 21:00. 

Pe...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (244 chars):
   {'predicted_label': 'info\\_altri\\_servizi', 'confidence': 0.98, 'motivation': 'La conversazione riguarda l\'informazione sui bar aperti in Humanitas e i loro orari di apertura, quindi la categoria piÃ¹ appropriata Ã¨ "info\\_altri\\_servizi".'}

ğŸ“Š Parsed Response:
   predicted_label: info\_altri\_servizi
   confidence: 0.98
   motivation: La conversazione riguarda l'informazione sui bar aperti in Humanitas e i loro orari di apertura, quindi la categoria piÃ¹ appropriata Ã¨ "info\_altri\_servizi".
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.980
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 98.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda l'informazione sui bar aperti in Humanitas e i loro orari di apertura, quindi la categoria piÃ¹ appropriata Ã¨ "info\_altri\_servizi".
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 6ae551444563cd53ca4a04d16aaa86bf classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  âœ… Nuovo tag 'info\_altri\_servizi' aggiunto per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 284
   ğŸ“Š Token totali: 732
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 732 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 284
   ğŸ“Š Token conversazione finale: 284
   ğŸ“Š Token totali: 732
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 895 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Cosa copre esattamente la polizza vita Wopta?"
Output: info_condizioni_polizza
Ragionamento: Richiesta di informazioni sulle condizioni di polizza
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Divrei prenotare per nedicazione [ASSISTENTE] Potresti chiarire meglio cosa intendi per "nedicazione"? Intendi dire "medicazione" o "indicazione"? Oppure hai bisogno di prenotare una visita o un esame? [UTENTE] Medicazione per ferita che non cicatrizza [ASSISTENTE] Per prenotare una medi..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2805 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 284
   ğŸ“Š Token totali stimati: 732
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Cosa copre esattamente la polizza vita Wopta?"
Output: info_condizioni_polizza
Ragionamento: Richiesta di informazioni sulle condizioni di polizza
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Divrei prenotare per nedicazione [ASSISTENTE] Potresti chiarire meglio cosa intendi per "nedicazione"? Intendi dire "medicazione" o "indicazione"? Oppure hai bisogno di prenotare una visita o un esame? [UTENTE] Medicazione per ferita che non cicatrizza [ASSISTENTE] Per prenotare una medi..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ”§ Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ“Š Calcolo statistiche per tenant: Humanitas

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:56:15.496710
====================================================================================================
ğŸ“‹ Session ID: classify_1756634175
â±ï¸  Processing Time: 2.658s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (895 chars):
   [UTENTE] Divrei prenotare per nedicazione [ASSISTENTE] Potresti chiarire meglio cosa intendi per "nedicazione"? Intendi dire "medicazione" o "indicazione"? Oppure hai bisogno di prenotare una visit...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (299 chars):
   {'predicted_label': 'prenotazione', 'confidence': 0.98, 'motivation': "La conversazione riguarda la prenotazione di una medicazione per una ferita che non cicatrizza. L'utente ha chiesto il numero di prenotazione di Humanitas e l'assistente gli ha fornito le informazioni necessarie per prenotare."}

ğŸ“Š Parsed Response:
   predicted_label: prenotazione
   confidence: 0.98
   motivation: La conversazione riguarda la prenotazione di una medicazione per una ferita che non cicatrizza. L'utente ha chiesto il numero di prenotazione di Humanitas e l'assistente gli ha fornito le informazioni necessarie per prenotare.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.980
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 98.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la prenotazione di una medicazione per una ferita che non cicatrizza. L'utente ha chiesto il numero di prenotazione di Humanitas e l'assistente gli ha fornito le informazioni necessarie per prenotare.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione beb94fb8c62d2db78ae8640535f1b9f8 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 447
   ğŸ’¬ Token conversazione: 318
   ğŸ“Š Token totali: 765
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 765 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 447
   ğŸ“Š Token conversazione originale: 318
   ğŸ“Š Token conversazione finale: 318
   ğŸ“Š Token totali: 765
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1100 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non Ã¨ valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao. [...] 

Se hai bisogno di ulteriore aiuto, sono qui!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2616 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 447
   ğŸ“Š Token conversazione: 318
   ğŸ“Š Token totali stimati: 765
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non Ã¨ valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao. [...] 

Se hai bisogno di ulteriore aiuto, sono qui!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:56:17.870873
====================================================================================================
ğŸ“‹ Session ID: classify_1756634177
â±ï¸  Processing Time: 2.288s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1100 chars):
   [UTENTE] Ciao...non riesco a fare la registrazione  [ASSISTENTE] Per aiutarti al meglio con la registrazione, potresti dirmi se stai cercando di registrarti a [Humanitas con te](https://www.humanit...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [76 more lines] ...
     Line 80: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (192 chars):
   {'predicted_label': 'registrazione', 'confidence': 0.98, 'motivation': 'La conversazione riguarda la registrazione su Humanitas con te, quindi la categoria piÃ¹ appropriata Ã¨ "registrazione".'}

ğŸ“Š Parsed Response:
   predicted_label: registrazione
   confidence: 0.98
   motivation: La conversazione riguarda la registrazione su Humanitas con te, quindi la categoria piÃ¹ appropriata Ã¨ "registrazione".
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.980
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 98.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la registrazione su Humanitas con te, quindi la categoria piÃ¹ appropriata Ã¨ "registrazione".
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 62f4cd292463af1c7b6c5afade544e90 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'registrazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 454
   ğŸ’¬ Token conversazione: 372
   ğŸ“Š Token totali: 826
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 826 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione originale: 372
   ğŸ“Š Token conversazione finale: 372
   ğŸ“Š Token totali: 826
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1236 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: DifficoltÃ  di login al portale assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno Giulia, sono giÃ  registrata ad Humanitas. [...] 

Se hai bisogno di ulteriore supporto, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2706 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione: 372
   ğŸ“Š Token totali stimati: 826
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: DifficoltÃ  di login al portale assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno Giulia, sono giÃ  registrata ad Humanitas. [...] 

Se hai bisogno di ulteriore supporto, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:56:20.956223
====================================================================================================
ğŸ“‹ Session ID: classify_1756634180
â±ï¸  Processing Time: 2.999s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1236 chars):
   [UTENTE] Buongiorno Giulia, sono giÃ  registrata ad Humanitas.it ed ho giÃ  App, ma non riesco piÃ¹ af [ASSISTENTE] Sembra che tu stia riscontrando un problema con l'accesso o l'utilizzo dell'app Huma...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [76 more lines] ...
     Line 80: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (375 chars):
   {'predicted_label': 'problema_accesso_app', 'confidence': 0.95, 'motivation': "L'utente ha espresso un problema con l'accesso all'app Humanitas e non riesce piÃ¹ ad entrare. La risposta dell'assistente fornisce una serie di suggerimenti per risolvere il problema, come controllare l'ID o richiedere...

ğŸ“Š Parsed Response:
   predicted_label: problema_accesso_app
   confidence: 0.95
   motivation: L'utente ha espresso un problema con l'accesso all'app Humanitas e non riesce piÃ¹ ad entrare. La risposta dell'assistente fornisce una serie di suggerimenti per risolvere il problema, come controllare l'ID o richiedere il recupero del PIN o dell'ID attraverso il modulo di contatto o via email.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   L'utente ha espresso un problema con l'accesso all'app Humanitas e non riesce piÃ¹ ad entrare. La risposta dell'assistente fornisce una serie di suggerimenti per risolvere il problema, come controllare l'ID o richiedere il recupero del PIN o dell'ID attraverso il modulo di contatto o via email.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 2388a191d77e99a2a986d90e30fbf8dd classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'problema_accesso_app' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 454
   ğŸ’¬ Token conversazione: 318
   ğŸ“Š Token totali: 772
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 772 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione originale: 318
   ğŸ“Š Token conversazione finale: 318
   ğŸ“Š Token totali: 772
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1059 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non Ã¨ valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "La polizza copre anche viaggi all'estero?"
Output: info_copertura_geografica_assicurazione
Ragionamento: Richiesta informazioni sulla copertura geografica
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] Non riesco ad accedere per ritirare esami  [ASSISTENTE] Per aiutarti al meglio, potresti specificare se hai problemi con l'accesso a [Humanitas con te](https://www. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2799 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione: 318
   ğŸ“Š Token totali stimati: 772
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non Ã¨ valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "La polizza copre anche viaggi all'estero?"
Output: info_copertura_geografica_assicurazione
Ragionamento: Richiesta informazioni sulla copertura geografica
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] Non riesco ad accedere per ritirare esami  [ASSISTENTE] Per aiutarti al meglio, potresti specificare se hai problemi con l'accesso a [Humanitas con te](https://www. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:56:24.317618
====================================================================================================
ğŸ“‹ Session ID: classify_1756634184
â±ï¸  Processing Time: 3.275s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1059 chars):
   [UTENTE] Non riesco ad accedere per ritirare esami  [ASSISTENTE] Per aiutarti al meglio, potresti specificare se hai problemi con l'accesso a [Humanitas con te](https://www.humanitasconte.it) o se ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (454 chars):
   {'predicted_label': 'problema_accesso_app', 'confidence': 0.95, 'motivation': "La conversazione riguarda un problema di accesso all'applicazione Humanitas con te. L'utente ha specificato che non riesce ad accedere per ritirare esami e l'assistente gli ha chiesto se ci sono problemi con l'accesso ...

ğŸ“Š Parsed Response:
   predicted_label: problema_accesso_app
   confidence: 0.95
   motivation: La conversazione riguarda un problema di accesso all'applicazione Humanitas con te. L'utente ha specificato che non riesce ad accedere per ritirare esami e l'assistente gli ha chiesto se ci sono problemi con l'accesso al sito o se il codice ID o PIN Ã¨ corretto. Inoltre, l'assistente ha suggerito di contattare il Servizio di assistenza dedicata per ulteriori informazioni.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda un problema di accesso all'applicazione Humanitas con te. L'utente ha specificato che non riesce ad accedere per ritirare esami e l'assistente gli ha chiesto se ci sono problemi con l'accesso al sito o se il codice ID o PIN Ã¨ corretto. Inoltre, l'assistente ha suggerito di contattare il Servizio di assistenza dedicata per ulteriori informazioni.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 46156fe842d294393fc51fd09074ddc2 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'problema_accesso_app' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 327
   ğŸ“Š Token totali: 755
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 755 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 327
   ğŸ“Š Token conversazione finale: 327
   ğŸ“Š Token totali: 755
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1458 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non Ã¨ valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] English please [ASSISTENTE] Sure! How can I assist you today? [UTENTE] Thank you! I am trying to start my log in at Humanitas Comunicazione Sicura but the system doesnt recognize my cell phone number [ASSISTENTE] If the system does not recognize your cell phone number when trying to log ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2800 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 327
   ğŸ“Š Token totali stimati: 755
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non Ã¨ valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] English please [ASSISTENTE] Sure! How can I assist you today? [UTENTE] Thank you! I am trying to start my log in at Humanitas Comunicazione Sicura but the system doesnt recognize my cell phone number [ASSISTENTE] If the system does not recognize your cell phone number when trying to log ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:56:27.535129
====================================================================================================
ğŸ“‹ Session ID: classify_1756634187
â±ï¸  Processing Time: 3.130s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1458 chars):
   [UTENTE] English please [ASSISTENTE] Sure! How can I assist you today? [UTENTE] Thank you! I am trying to start my log in at Humanitas Comunicazione Sicura but the system doesnt recognize my cell p...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (437 chars):
   {'predicted_label': 'problema_accesso_app', 'confidence': 0.95, 'motivation': "La conversazione riguarda un problema di accesso all'applicazione Humanitas Comunicazione Sicura, in particolare il fatto che il sistema non riconosce il numero di telefono dell'utente. Vengono fornite delle possibili ...

ğŸ“Š Parsed Response:
   predicted_label: problema_accesso_app
   confidence: 0.95
   motivation: La conversazione riguarda un problema di accesso all'applicazione Humanitas Comunicazione Sicura, in particolare il fatto che il sistema non riconosce il numero di telefono dell'utente. Vengono fornite delle possibili soluzioni per risolvere il problema, come controllare se il numero Ã¨ corretto e nel formato giusto, oppure contattare il team di supporto.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda un problema di accesso all'applicazione Humanitas Comunicazione Sicura, in particolare il fatto che il sistema non riconosce il numero di telefono dell'utente. Vengono fornite delle possibili soluzioni per risolvere il problema, come controllare se il numero Ã¨ corretto e nel formato giusto, oppure contattare il team di supporto.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 6fbc4989d7ad0a5d53e1c250e2496273 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'problema_accesso_app' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 157
   ğŸ“Š Token totali: 605
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 605 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 157
   ğŸ“Š Token conversazione finale: 157
   ğŸ“Š Token totali: 605
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 492 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online


TESTO DA CLASSIFICARE:
"[UTENTE] Ho bisogno di sapere gli orari di visita dell'ospedale nÌˆel wek and  [ASSISTENTE] Per visitare i pazienti ricoverati in Humanitas, gli orari di visita possono variare a seconda del reparto. Ti consiglio di consultare le pagine dedicate per maggiori dettagli:

- [Accesso all'Ospedale](htt..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2866 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 157
   ğŸ“Š Token totali stimati: 605
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online


TESTO DA CLASSIFICARE:
"[UTENTE] Ho bisogno di sapere gli orari di visita dell'ospedale nÌˆel wek and  [ASSISTENTE] Per visitare i pazienti ricoverati in Humanitas, gli orari di visita possono variare a seconda del reparto. Ti consiglio di consultare le pagine dedicate per maggiori dettagli:

- [Accesso all'Ospedale](htt..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:56:30.032486
====================================================================================================
ğŸ“‹ Session ID: classify_1756634190
â±ï¸  Processing Time: 2.411s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (492 chars):
   [UTENTE] Ho bisogno di sapere gli orari di visita dell'ospedale nÌˆel wek and  [ASSISTENTE] Per visitare i pazienti ricoverati in Humanitas, gli orari di visita possono variare a seconda del reparto...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [76 more lines] ...
     Line 80: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (216 chars):
   {'predicted_label': 'info\\_orari', 'confidence': 0.95, 'motivation': "La conversazione riguarda gli orari di visita dell'ospedale Humanitas e il bot ha fornito le pagine web dove trovare dettagli sui vari reparti."}

ğŸ“Š Parsed Response:
   predicted_label: info\_orari
   confidence: 0.95
   motivation: La conversazione riguarda gli orari di visita dell'ospedale Humanitas e il bot ha fornito le pagine web dove trovare dettagli sui vari reparti.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda gli orari di visita dell'ospedale Humanitas e il bot ha fornito le pagine web dove trovare dettagli sui vari reparti.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione e198f2cc349c306565019cc02bbfb929 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  âœ… Nuovo tag 'info\_orari' aggiunto per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 87
   ğŸ“Š Token totali: 515
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 515 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 87
   ğŸ“Š Token conversazione finale: 87
   ğŸ“Š Token totali: 515
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 279 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali


TESTO DA CLASSIFICARE:
"[UTENTE] a che ore siete aperti? [ASSISTENTE] Gli orari di apertura possono variare a seconda del servizio o del reparto che desideri visitare. Potresti specificare a quale servizio o reparto ti riferisci? Ad esempio, pronto soccorso, ufficio ritiro referti, punti prelievo, ecc."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2790 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 87
   ğŸ“Š Token totali stimati: 515
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali


TESTO DA CLASSIFICARE:
"[UTENTE] a che ore siete aperti? [ASSISTENTE] Gli orari di apertura possono variare a seconda del servizio o del reparto che desideri visitare. Potresti specificare a quale servizio o reparto ti riferisci? Ad esempio, pronto soccorso, ufficio ritiro referti, punti prelievo, ecc."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:56:32.984413
====================================================================================================
ğŸ“‹ Session ID: classify_1756634192
â±ï¸  Processing Time: 2.857s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (279 chars):
   [UTENTE] a che ore siete aperti? [ASSISTENTE] Gli orari di apertura possono variare a seconda del servizio o del reparto che desideri visitare. Potresti specificare a quale servizio o reparto ti ri...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (340 chars):
   {'predicted_label': 'info\\_orari', 'confidence': 0.95, 'motivation': "La domanda dell'utente riguarda gli orari di apertura del reparto o servizio che desidera visitare. In questo caso, l'assistente ha fornito una risposta generica suggerendo all'utente di specificare il servizio o il reparto pe...

ğŸ“Š Parsed Response:
   predicted_label: info\_orari
   confidence: 0.95
   motivation: La domanda dell'utente riguarda gli orari di apertura del reparto o servizio che desidera visitare. In questo caso, l'assistente ha fornito una risposta generica suggerendo all'utente di specificare il servizio o il reparto per cui vuole sapere gli orari di apertura.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La domanda dell'utente riguarda gli orari di apertura del reparto o servizio che desidera visitare. In questo caso, l'assistente ha fornito una risposta generica suggerendo all'utente di specificare il servizio o il reparto per cui vuole sapere gli orari di apertura.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione dafaa5ccf91dc428b5a2255cbe34ea9c classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'info\_orari' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 143
   ğŸ“Š Token totali: 571
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 571 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 143
   ğŸ“Š Token conversazione finale: 143
   ğŸ“Š Token totali: 571
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 476 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao , quanto tempo passa da pre ricovero al ricovero?  [ASSISTENTE] Il tempo tra il prericovero e il ricovero dipende dalla valutazione clinica e dalla tipologia di intervento. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2697 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 143
   ğŸ“Š Token totali stimati: 571
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao , quanto tempo passa da pre ricovero al ricovero?  [ASSISTENTE] Il tempo tra il prericovero e il ricovero dipende dalla valutazione clinica e dalla tipologia di intervento. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:56:35.898700
====================================================================================================
ğŸ“‹ Session ID: classify_1756634195
â±ï¸  Processing Time: 2.828s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (476 chars):
   [UTENTE] Ciao , quanto tempo passa da pre ricovero al ricovero?  [ASSISTENTE] Il tempo tra il prericovero e il ricovero dipende dalla valutazione clinica e dalla tipologia di intervento. La data de...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (351 chars):
   {'predicted_label': 'info\\_orari', 'confidence': 0.98, 'motivation': 'La risposta fornita Ã¨ una informazione sui tempi di ricovero, che dipende dalla valutazione clinica e dal tipo di intervento. Inoltre viene comunicata successivamente al prericovero dalla segreteria di reparto. Questo tipo di ...

ğŸ“Š Parsed Response:
   predicted_label: info\_orari
   confidence: 0.98
   motivation: La risposta fornita Ã¨ una informazione sui tempi di ricovero, che dipende dalla valutazione clinica e dal tipo di intervento. Inoltre viene comunicata successivamente al prericovero dalla segreteria di reparto. Questo tipo di informazioni rientra nella categoria "info\_orari".
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.980
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 98.0%

ğŸ§  Reasoning/Motivation:
   La risposta fornita Ã¨ una informazione sui tempi di ricovero, che dipende dalla valutazione clinica e dal tipo di intervento. Inoltre viene comunicata successivamente al prericovero dalla segreteria di reparto. Questo tipo di informazioni rientra nella categoria "info\_orari".
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 240e1d59617853447390d1570a04c1f1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'info\_orari' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 188
   ğŸ“Š Token totali: 636
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 636 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 188
   ğŸ“Š Token conversazione finale: 188
   ğŸ“Š Token totali: 636
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 663 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] La struttura Ã¨ convenzionata ma alcuni medici non lo sono Unisalute [ASSISTENTE] Se ti riferisci alla possibilitÃ  di prenotare visite o esami con Unisalute, Ã¨ importante sapere che alcune prestazioni potrebbero essere coperte dalla convenzione, mentre altre no. Inoltre, non tutti i medic..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2848 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 188
   ğŸ“Š Token totali stimati: 636
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] La struttura Ã¨ convenzionata ma alcuni medici non lo sono Unisalute [ASSISTENTE] Se ti riferisci alla possibilitÃ  di prenotare visite o esami con Unisalute, Ã¨ importante sapere che alcune prestazioni potrebbero essere coperte dalla convenzione, mentre altre no. Inoltre, non tutti i medic..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:56:38.328843
====================================================================================================
ğŸ“‹ Session ID: classify_1756634198
â±ï¸  Processing Time: 2.343s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (663 chars):
   [UTENTE] La struttura Ã¨ convenzionata ma alcuni medici non lo sono Unisalute [ASSISTENTE] Se ti riferisci alla possibilitÃ  di prenotare visite o esami con Unisalute, Ã¨ importante sapere che alcune ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (210 chars):
   {'predicted_label': 'info\\_strutture\\_convenzionate', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la convenzione con Unisalute e le prestazioni che possono essere coperte dalla convenzione.'}

ğŸ“Š Parsed Response:
   predicted_label: info\_strutture\_convenzionate
   confidence: 0.95
   motivation: La conversazione riguarda la convenzione con Unisalute e le prestazioni che possono essere coperte dalla convenzione.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la convenzione con Unisalute e le prestazioni che possono essere coperte dalla convenzione.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione a66c235258b634ba0163f9b29b6079e5 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  âœ… Nuovo tag 'info\_strutture\_convenzionate' aggiunto per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 180
   ğŸ“Š Token totali: 628
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 628 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 180
   ğŸ“Š Token conversazione finale: 180
   ğŸ“Š Token totali: 628
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 551 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non Ã¨ valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Dove trovare informazioni per la preparazione di un ecoendoscopia pancreas [ASSISTENTE] Puoi trovare le norme di preparazione per l'ecoendoscopia del pancreas al seguente [link](https://www. [...]  ğŸ˜Š"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2780 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 180
   ğŸ“Š Token totali stimati: 628
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non Ã¨ valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Dove trovare informazioni per la preparazione di un ecoendoscopia pancreas [ASSISTENTE] Puoi trovare le norme di preparazione per l'ecoendoscopia del pancreas al seguente [link](https://www. [...]  ğŸ˜Š"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:56:40.936783
====================================================================================================
ğŸ“‹ Session ID: classify_1756634200
â±ï¸  Processing Time: 2.515s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (551 chars):
   [UTENTE] Dove trovare informazioni per la preparazione di un ecoendoscopia pancreas [ASSISTENTE] Puoi trovare le norme di preparazione per l'ecoendoscopia del pancreas al seguente [link](https://ww...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (260 chars):
   {'predicted_label': 'info\\_preparazione\\_esame', 'confidence': 1.0, 'motivation': 'La conversazione riguarda la richiesta di informazioni sulla preparazione per un ecoendoscopia pancreas, quindi la categoria piÃ¹ appropriata Ã¨ "info\\_preparazione\\_esame".'}

ğŸ“Š Parsed Response:
   predicted_label: info\_preparazione\_esame
   confidence: 1.0
   motivation: La conversazione riguarda la richiesta di informazioni sulla preparazione per un ecoendoscopia pancreas, quindi la categoria piÃ¹ appropriata Ã¨ "info\_preparazione\_esame".
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 1.000
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la richiesta di informazioni sulla preparazione per un ecoendoscopia pancreas, quindi la categoria piÃ¹ appropriata Ã¨ "info\_preparazione\_esame".
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione c9f298679a2a8376f2326b8f82a3c11c classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  âœ… Nuovo tag 'info\_preparazione\_esame' aggiunto per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 180
   ğŸ“Š Token totali: 628
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 628 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 180
   ğŸ“Š Token conversazione finale: 180
   ğŸ“Š Token totali: 628
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 604 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Cosa copre esattamente la polizza vita Wopta?"
Output: info_condizioni_polizza
Ragionamento: Richiesta di informazioni sulle condizioni di polizza
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Volevo sapere se ci sono delle indicazioni da seguire dopo aver effettuato una PET globale corporea con Gallio [ASSISTENTE] Dopo aver effettuato una PET globale corporea con Gallio, Ã¨ importante evitare stretto contatto con donne in gravidanza, in etÃ  fertile o con minorenni per motivi d..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2851 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 180
   ğŸ“Š Token totali stimati: 628
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Cosa copre esattamente la polizza vita Wopta?"
Output: info_condizioni_polizza
Ragionamento: Richiesta di informazioni sulle condizioni di polizza
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Volevo sapere se ci sono delle indicazioni da seguire dopo aver effettuato una PET globale corporea con Gallio [ASSISTENTE] Dopo aver effettuato una PET globale corporea con Gallio, Ã¨ importante evitare stretto contatto con donne in gravidanza, in etÃ  fertile o con minorenni per motivi d..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:56:43.702226
====================================================================================================
ğŸ“‹ Session ID: classify_1756634203
â±ï¸  Processing Time: 2.673s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (604 chars):
   [UTENTE] Volevo sapere se ci sono delle indicazioni da seguire dopo aver effettuato una PET globale corporea con Gallio [ASSISTENTE] Dopo aver effettuato una PET globale corporea con Gallio, Ã¨ impo...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (293 chars):
   {'predicted_label': 'info\\_esame', 'confidence': 0.98, 'motivation': "La conversazione riguarda le indicazioni da seguire dopo aver effettuato una PET globale corporea con Gallio. In particolare, vengono fornite informazioni sulla radioprotezione e sull'utilizzo di ansiolitici per l'esame."}

ğŸ“Š Parsed Response:
   predicted_label: info\_esame
   confidence: 0.98
   motivation: La conversazione riguarda le indicazioni da seguire dopo aver effettuato una PET globale corporea con Gallio. In particolare, vengono fornite informazioni sulla radioprotezione e sull'utilizzo di ansiolitici per l'esame.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.980
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 98.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda le indicazioni da seguire dopo aver effettuato una PET globale corporea con Gallio. In particolare, vengono fornite informazioni sulla radioprotezione e sull'utilizzo di ansiolitici per l'esame.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione a10fade304c4f6bcbc919d953256b260 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  âœ… Nuovo tag 'info\_esame' aggiunto per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 94
   ğŸ“Š Token totali: 522
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 522 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 94
   ğŸ“Š Token conversazione finale: 94
   ğŸ“Š Token totali: 522
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 321 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Preparazione per coronografia  [ASSISTENTE] Per la preparazione alla coronarografia, Ã¨ necessario eseguire l'esame a digiuno e viene effettuato in regime di ricovero. [...] it/visite-ed-esami/coronarografia)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2725 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 94
   ğŸ“Š Token totali stimati: 522
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Preparazione per coronografia  [ASSISTENTE] Per la preparazione alla coronarografia, Ã¨ necessario eseguire l'esame a digiuno e viene effettuato in regime di ricovero. [...] it/visite-ed-esami/coronarografia)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:56:45.977755
====================================================================================================
ğŸ“‹ Session ID: classify_1756634205
â±ï¸  Processing Time: 2.181s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (321 chars):
   [UTENTE] Preparazione per coronografia  [ASSISTENTE] Per la preparazione alla coronarografia, Ã¨ necessario eseguire l'esame a digiuno e viene effettuato in regime di ricovero. Per ulteriori dettagl...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (169 chars):
   {'predicted_label': 'info\\_esame', 'confidence': 1.0, 'motivation': 'La conversazione riguarda la preparazione per un esame medico, in questo caso una coronarografia.'}

ğŸ“Š Parsed Response:
   predicted_label: info\_esame
   confidence: 1.0
   motivation: La conversazione riguarda la preparazione per un esame medico, in questo caso una coronarografia.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 1.000
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la preparazione per un esame medico, in questo caso una coronarografia.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione cd910ccc3d86182b0cb6489e03a3f7ff classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'info\_esame' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 196
   ğŸ“Š Token totali: 645
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 645 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 196
   ğŸ“Š Token conversazione finale: 196
   ğŸ“Š Token totali: 645
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 618 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Cosa copre esattamente la polizza vita Wopta?"
Output: info_condizioni_polizza
Ragionamento: Richiesta di informazioni sulle condizioni di polizza
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] ciao, cosa devo fare per questo esame che faro domani pomeriggio alla Gavazzeni ,tc coronarica e tc di perfusione miocardica [ASSISTENTE] Per la preparazione alla tomografia computerizzata con mezzo di contrasto e studio per perfusione coronarica con stress farmacologico (adenosina o reg..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2835 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 196
   ğŸ“Š Token totali stimati: 645
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Cosa copre esattamente la polizza vita Wopta?"
Output: info_condizioni_polizza
Ragionamento: Richiesta di informazioni sulle condizioni di polizza
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] ciao, cosa devo fare per questo esame che faro domani pomeriggio alla Gavazzeni ,tc coronarica e tc di perfusione miocardica [ASSISTENTE] Per la preparazione alla tomografia computerizzata con mezzo di contrasto e studio per perfusione coronarica con stress farmacologico (adenosina o reg..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:56:49.533345
====================================================================================================
ğŸ“‹ Session ID: classify_1756634209
â±ï¸  Processing Time: 3.469s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (618 chars):
   [UTENTE] ciao, cosa devo fare per questo esame che faro domani pomeriggio alla Gavazzeni ,tc coronarica e tc di perfusione miocardica [ASSISTENTE] Per la preparazione alla tomografia computerizzata...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (429 chars):
   {'predicted_label': 'info\\_esame', 'confidence': 1.0, 'motivation': "La conversazione riguarda l'esame che l'utente dovrÃ  fare domani pomeriggio alla Gavazzeni, precisamente una TC coronarica e una TC di perfusione miocardica. L'assistente ha fornito le norme di preparazione per questi esami al ...

ğŸ“Š Parsed Response:
   predicted_label: info\_esame
   confidence: 1.0
   motivation: La conversazione riguarda l'esame che l'utente dovrÃ  fare domani pomeriggio alla Gavazzeni, precisamente una TC coronarica e una TC di perfusione miocardica. L'assistente ha fornito le norme di preparazione per questi esami al seguente link: [link](https://www.humanitas.it/wp-content/uploads/2022/07/norme-preparazione-NP205-PKPERF-TC-cuore-perfusione.pdf)
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 1.000
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda l'esame che l'utente dovrÃ  fare domani pomeriggio alla Gavazzeni, precisamente una TC coronarica e una TC di perfusione miocardica. L'assistente ha fornito le norme di preparazione per questi esami al seguente link: [link](https://www.humanitas.it/wp-content/uploads/2022/07/norme-preparazione-NP205-PKPERF-TC-cuore-perfusione.pdf)
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione d778296da4685eceb0fd99c0414b7259 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'info\_esame' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 708
   ğŸ“Š Token totali: 1156
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1156 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 708
   ğŸ“Š Token conversazione finale: 708
   ğŸ“Š Token totali: 1156
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2173 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] devo fare la colonscopia mi dici come mi devo preparare ? hai le norme ? [ASSISTENTE] Certamente! Puoi trovare le norme di preparazione alla colonscopia a questo [link](https://www. [...] it)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2761 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 708
   ğŸ“Š Token totali stimati: 1156
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] devo fare la colonscopia mi dici come mi devo preparare ? hai le norme ? [ASSISTENTE] Certamente! Puoi trovare le norme di preparazione alla colonscopia a questo [link](https://www. [...] it)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:56:52.382888
====================================================================================================
ğŸ“‹ Session ID: classify_1756634212
â±ï¸  Processing Time: 2.762s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2173 chars):
   [UTENTE] devo fare la colonscopia mi dici come mi devo preparare ? hai le norme ? [ASSISTENTE] Certamente! Puoi trovare le norme di preparazione alla colonscopia a questo [link](https://www.humanit...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (308 chars):
   {'predicted_label': 'info\\_alopecia', 'confidence': 0.98, 'motivation': "La conversazione riguarda l'alopecia, una condizione caratterizzata dalla perdita di capelli o peli in diverse aree del corpo. L'utente ha chiesto cosa sia l'alopecia e l'assistente ha fornito una breve spiegazione della co...

ğŸ“Š Parsed Response:
   predicted_label: info\_alopecia
   confidence: 0.98
   motivation: La conversazione riguarda l'alopecia, una condizione caratterizzata dalla perdita di capelli o peli in diverse aree del corpo. L'utente ha chiesto cosa sia l'alopecia e l'assistente ha fornito una breve spiegazione della condizione.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.980
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 98.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda l'alopecia, una condizione caratterizzata dalla perdita di capelli o peli in diverse aree del corpo. L'utente ha chiesto cosa sia l'alopecia e l'assistente ha fornito una breve spiegazione della condizione.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 8749e7661214b9a58fecd8f0d6d9eed9 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  âœ… Nuovo tag 'info\_alopecia' aggiunto per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 381
   ğŸ“Š Token totali: 830
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 830 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 381
   ğŸ“Š Token conversazione finale: 381
   ğŸ“Š Token totali: 830
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1128 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non Ã¨ valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Vorrei prenotare una visita urologica [ASSISTENTE] Per prenotare una visita urologica presso l'Istituto Clinico Humanitas, puoi utilizzare i seguenti canali di prenotazione:

1. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2788 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 381
   ğŸ“Š Token totali stimati: 830
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non Ã¨ valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Vorrei prenotare una visita urologica [ASSISTENTE] Per prenotare una visita urologica presso l'Istituto Clinico Humanitas, puoi utilizzare i seguenti canali di prenotazione:

1. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:56:55.064072
====================================================================================================
ğŸ“‹ Session ID: classify_1756634215
â±ï¸  Processing Time: 2.587s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1128 chars):
   [UTENTE] Vorrei prenotare una visita urologica [ASSISTENTE] Per prenotare una visita urologica presso l'Istituto Clinico Humanitas, puoi utilizzare i seguenti canali di prenotazione:

1. **Privatam...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [76 more lines] ...
     Line 80: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (263 chars):
   {'predicted_label': 'prenotazione_visita_urologica', 'confidence': 1.0, 'motivation': 'La conversazione riguarda la prenotazione di una visita urologica presso l\'Istituto Clinico Humanitas, quindi la categoria piÃ¹ appropriata Ã¨ "prenotazione_visita_urologica".'}

ğŸ“Š Parsed Response:
   predicted_label: prenotazione_visita_urologica
   confidence: 1.0
   motivation: La conversazione riguarda la prenotazione di una visita urologica presso l'Istituto Clinico Humanitas, quindi la categoria piÃ¹ appropriata Ã¨ "prenotazione_visita_urologica".
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 1.000
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la prenotazione di una visita urologica presso l'Istituto Clinico Humanitas, quindi la categoria piÃ¹ appropriata Ã¨ "prenotazione_visita_urologica".
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione e1506f6d890578d819094e8ec1463bb4 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  âœ… Nuovo tag 'prenotazione_visita_urologica' aggiunto per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 319
   ğŸ“Š Token totali: 747
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 747 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 319
   ğŸ“Š Token conversazione finale: 319
   ğŸ“Š Token totali: 747
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1078 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao  [ASSISTENTE] Ciao! Come posso esserti utile? ğŸ˜Š [UTENTE] Si  [ASSISTENTE] Perfetto! Dimmi pure, come posso aiutarti? ğŸ˜Š [UTENTE] ho prenotato per il 15 settembre con il Dr. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2683 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 319
   ğŸ“Š Token totali stimati: 747
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao  [ASSISTENTE] Ciao! Come posso esserti utile? ğŸ˜Š [UTENTE] Si  [ASSISTENTE] Perfetto! Dimmi pure, come posso aiutarti? ğŸ˜Š [UTENTE] ho prenotato per il 15 settembre con il Dr. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:56:57.923329
====================================================================================================
ğŸ“‹ Session ID: classify_1756634217
â±ï¸  Processing Time: 2.763s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1078 chars):
   [UTENTE] Ciao  [ASSISTENTE] Ciao! Come posso esserti utile? ğŸ˜Š [UTENTE] Si  [ASSISTENTE] Perfetto! Dimmi pure, come posso aiutarti? ğŸ˜Š [UTENTE] ho prenotato per il 15 settembre con il Dr. Lamberto Zo...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (341 chars):
   {'predicted_label': 'prenotazione_visita', 'confidence': 0.98, 'motivation': 'La conversazione riguarda una prenotazione per un esame medico, in questo caso "Mapping Nevi Computerizzato â€“ Dermatologia". L\'utente ha chiesto conferma sull\'utilizzo del sistema FotoFinder e sulla disponibilitÃ  dell...

ğŸ“Š Parsed Response:
   predicted_label: prenotazione_visita
   confidence: 0.98
   motivation: La conversazione riguarda una prenotazione per un esame medico, in questo caso "Mapping Nevi Computerizzato â€“ Dermatologia". L'utente ha chiesto conferma sull'utilizzo del sistema FotoFinder e sulla disponibilitÃ  delle immagini in formato digitale o cartaceo.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.980
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 98.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda una prenotazione per un esame medico, in questo caso "Mapping Nevi Computerizzato â€“ Dermatologia". L'utente ha chiesto conferma sull'utilizzo del sistema FotoFinder e sulla disponibilitÃ  delle immagini in formato digitale o cartaceo.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f664b65de9fca671efb552caaba657b8 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'prenotazione_visita' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 195
   ğŸ“Š Token totali: 623
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 623 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 195
   ğŸ“Š Token conversazione finale: 195
   ğŸ“Š Token totali: 623
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 661 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Dovrei effettuare una enteroscopia con biopsia Humatis effettua questo tipo di prestazione  e il costo in regime privato [ASSISTENTE] Humanitas effettua l'enteroscopia con biopsia, una procedura che consente di esaminare il piccolo intestino e prelevare campioni di tessuto per analisi is..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2779 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 195
   ğŸ“Š Token totali stimati: 623
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Dovrei effettuare una enteroscopia con biopsia Humatis effettua questo tipo di prestazione  e il costo in regime privato [ASSISTENTE] Humanitas effettua l'enteroscopia con biopsia, una procedura che consente di esaminare il piccolo intestino e prelevare campioni di tessuto per analisi is..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:57:00.275805
====================================================================================================
ğŸ“‹ Session ID: classify_1756634220
â±ï¸  Processing Time: 2.264s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (661 chars):
   [UTENTE] Dovrei effettuare una enteroscopia con biopsia Humatis effettua questo tipo di prestazione  e il costo in regime privato [ASSISTENTE] Humanitas effettua l'enteroscopia con biopsia, una pro...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (171 chars):
   {'predicted_label': 'info\\_esame', 'confidence': 1.0, 'motivation': "La conversazione riguarda una procedura medica, l'enteroscopia con biopsia, che Ã¨ un tipo di esame."}

ğŸ“Š Parsed Response:
   predicted_label: info\_esame
   confidence: 1.0
   motivation: La conversazione riguarda una procedura medica, l'enteroscopia con biopsia, che Ã¨ un tipo di esame.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 1.000
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda una procedura medica, l'enteroscopia con biopsia, che Ã¨ un tipo di esame.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione dcf83c09a3dbd5a9c9cc927493b1a133 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'info\_esame' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 407
   ğŸ“Š Token totali: 856
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 856 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 407
   ğŸ“Š Token conversazione finale: 407
   ğŸ“Š Token totali: 856
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1204 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno, sono Fava Piera (05/07/48) paziente del cardiologo dr Carlo Ceriotti che mi ha visitata ila Rozzano il 25/06/25 prescrivendo ECOCARDIO di controllo da fare entro 6 mesi x importante patologia. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2851 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 407
   ğŸ“Š Token totali stimati: 856
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno, sono Fava Piera (05/07/48) paziente del cardiologo dr Carlo Ceriotti che mi ha visitata ila Rozzano il 25/06/25 prescrivendo ECOCARDIO di controllo da fare entro 6 mesi x importante patologia. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:57:02.943597
====================================================================================================
ğŸ“‹ Session ID: classify_1756634222
â±ï¸  Processing Time: 2.579s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1204 chars):
   [UTENTE] Buongiorno, sono Fava Piera (05/07/48) paziente del cardiologo dr Carlo Ceriotti che mi ha visitata ila Rozzano il 25/06/25 prescrivendo ECOCARDIO di controllo da fare entro 6 mesi x impor...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [76 more lines] ...
     Line 80: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (271 chars):
   {'predicted_label': 'prenotazione_esame', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un esame medico (ecocardiogramma) e fornisce informazioni su come prenotarlo sia privatamente che attraverso il Servizio Sanitario Nazionale (SSN).'}

ğŸ“Š Parsed Response:
   predicted_label: prenotazione_esame
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di un esame medico (ecocardiogramma) e fornisce informazioni su come prenotarlo sia privatamente che attraverso il Servizio Sanitario Nazionale (SSN).
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un esame medico (ecocardiogramma) e fornisce informazioni su come prenotarlo sia privatamente che attraverso il Servizio Sanitario Nazionale (SSN).
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione e523a8cf7ddbebc225ce0be4027e44d5 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'prenotazione_esame' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 406
   ğŸ“Š Token totali: 855
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 855 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 406
   ğŸ“Š Token conversazione finale: 406
   ğŸ“Š Token totali: 855
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1266 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao Giulia Ascolta c'Ã¨ mia mamma che avrebbe bisogno di fare radioterapia adesso si trova il Vito Fazzi di Lecce i tempi di attesa sono piuttosto lunghi prima del 20 di agosto nulla Mi chiedevo se eventualmente nella vostra struttura i tempi di attesa son [ASSISTENTE] Per conoscere i te..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2807 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 406
   ğŸ“Š Token totali stimati: 855
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao Giulia Ascolta c'Ã¨ mia mamma che avrebbe bisogno di fare radioterapia adesso si trova il Vito Fazzi di Lecce i tempi di attesa sono piuttosto lunghi prima del 20 di agosto nulla Mi chiedevo se eventualmente nella vostra struttura i tempi di attesa son [ASSISTENTE] Per conoscere i te..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:57:06.272321
====================================================================================================
ğŸ“‹ Session ID: classify_1756634226
â±ï¸  Processing Time: 3.242s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1266 chars):
   [UTENTE] Ciao Giulia Ascolta c'Ã¨ mia mamma che avrebbe bisogno di fare radioterapia adesso si trova il Vito Fazzi di Lecce i tempi di attesa sono piuttosto lunghi prima del 20 di agosto nulla Mi ch...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (481 chars):
   {'predicted_label': 'prenotazione', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione per una radioterapia presso Humanitas. Il utente chiede informazioni sui tempi di attesa e viene fornito un elenco dei canali di prenotazione disponibili, sia per coloro che hanno fond...

ğŸ“Š Parsed Response:
   predicted_label: prenotazione
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione per una radioterapia presso Humanitas. Il utente chiede informazioni sui tempi di attesa e viene fornito un elenco dei canali di prenotazione disponibili, sia per coloro che hanno fondi e assicurazioni private che quelli che utilizzano il Servizio Sanitario Nazionale (SSN). Vengono inoltre fornite informazioni su come contattare Humanitas online o telefonicamente.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la prenotazione per una radioterapia presso Humanitas. Il utente chiede informazioni sui tempi di attesa e viene fornito un elenco dei canali di prenotazione disponibili, sia per coloro che hanno fondi e assicurazioni private che quelli che utilizzano il Servizio Sanitario Nazionale (SSN). Vengono inoltre fornite informazioni su come contattare Humanitas online o telef...
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 08729e0e748ce887ec3ae227a447aab8 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 247
   ğŸ“Š Token totali: 695
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 695 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 247
   ğŸ“Š Token conversazione finale: 247
   ğŸ“Š Token totali: 695
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 844 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: DifficoltÃ  di login al portale assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste


TESTO DA CLASSIFICARE:
"[UTENTE] Ritiro referti  [ASSISTENTE] Puoi dirmi di quale tipo di referto hai bisogno? Ad esempio, se si tratta di un test HIV, esami istologici, citologici, tamponi, esami genetici o altro. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2839 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 247
   ğŸ“Š Token totali stimati: 695
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: DifficoltÃ  di login al portale assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste


TESTO DA CLASSIFICARE:
"[UTENTE] Ritiro referti  [ASSISTENTE] Puoi dirmi di quale tipo di referto hai bisogno? Ad esempio, se si tratta di un test HIV, esami istologici, citologici, tamponi, esami genetici o altro. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:57:09.341216
====================================================================================================
ğŸ“‹ Session ID: classify_1756634229
â±ï¸  Processing Time: 2.979s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (844 chars):
   [UTENTE] Ritiro referti  [ASSISTENTE] Puoi dirmi di quale tipo di referto hai bisogno? Ad esempio, se si tratta di un test HIV, esami istologici, citologici, tamponi, esami genetici o altro. Alcuni...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [76 more lines] ...
     Line 80: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (393 chars):
   {'predicted_label': 'ritiro referti', 'confidence': 0.98, 'motivation': "La conversazione riguarda il ritiro di un referto medico e l'assistente fornisce informazioni su come accedere al portale online per consultare i referti, come registrarsi e inserire l'ID fornito all'accettazione. Inoltre, v...

ğŸ“Š Parsed Response:
   predicted_label: ritiro referti
   confidence: 0.98
   motivation: La conversazione riguarda il ritiro di un referto medico e l'assistente fornisce informazioni su come accedere al portale online per consultare i referti, come registrarsi e inserire l'ID fornito all'accettazione. Inoltre, viene suggerito di contattare il servizio dedicato se si ha problemi con il ritiro del referto.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.980
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 98.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda il ritiro di un referto medico e l'assistente fornisce informazioni su come accedere al portale online per consultare i referti, come registrarsi e inserire l'ID fornito all'accettazione. Inoltre, viene suggerito di contattare il servizio dedicato se si ha problemi con il ritiro del referto.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione d5620900ba031583ff188c164c4e3af0 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  âœ… Nuovo tag 'ritiro referti' aggiunto per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 363
   ğŸ“Š Token totali: 811
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 811 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 363
   ğŸ“Š Token conversazione finale: 363
   ğŸ“Š Token totali: 811
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1340 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno, in data 28 maggio ho effettuato la richiesta della consegna delle immagini delle tac e delle risonanza magnetiche, effettuate a mio marito Vincenzo Rubino, tramite chiavetta usb e consegna con corriere. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2861 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 363
   ğŸ“Š Token totali stimati: 811
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno, in data 28 maggio ho effettuato la richiesta della consegna delle immagini delle tac e delle risonanza magnetiche, effettuate a mio marito Vincenzo Rubino, tramite chiavetta usb e consegna con corriere. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:57:12.624977
====================================================================================================
ğŸ“‹ Session ID: classify_1756634232
â±ï¸  Processing Time: 3.189s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1340 chars):
   [UTENTE] Buongiorno, in data 28 maggio ho effettuato la richiesta della consegna delle immagini delle tac e delle risonanza magnetiche, effettuate a mio marito Vincenzo Rubino, tramite chiavetta us...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [76 more lines] ...
     Line 80: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (463 chars):
   {'predicted_label': 'problema_accesso_referti', 'confidence': 1.0, 'motivation': 'La conversazione riguarda un problema di accesso alle immagini delle tac e delle risonanze magnetiche richieste tramite chiavetta USB e consegna con corriere. Il richiedente ha segnalato che la richiesta Ã¨ ancora ne...

ğŸ“Š Parsed Response:
   predicted_label: problema_accesso_referti
   confidence: 1.0
   motivation: La conversazione riguarda un problema di accesso alle immagini delle tac e delle risonanze magnetiche richieste tramite chiavetta USB e consegna con corriere. Il richiedente ha segnalato che la richiesta Ã¨ ancora nello stato "processing" e chiede informazioni sulla tempistica, sul metodo di pagamento del corriere e su come contattare l'assistenza per avere ulteriori dettagli.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 1.000
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda un problema di accesso alle immagini delle tac e delle risonanze magnetiche richieste tramite chiavetta USB e consegna con corriere. Il richiedente ha segnalato che la richiesta Ã¨ ancora nello stato "processing" e chiede informazioni sulla tempistica, sul metodo di pagamento del corriere e su come contattare l'assistenza per avere ulteriori dettagli.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 10eb207864785b90b8db2e62c14528a2 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'problema_accesso_referti' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 144
   ğŸ“Š Token totali: 572
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 572 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 144
   ğŸ“Š Token conversazione finale: 144
   ğŸ“Š Token totali: 572
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 441 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non Ã¨ valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Æuongiorno,l'accettazione per ritiro CD rx fino a che ora Ã¨ aperto? [ASSISTENTE] L'accettazione per il ritiro dei CD RX Ã¨ aperta dal lunedÃ¬ al venerdÃ¬ dalle 10:00 alle 18:00 e il sabato dalle 9:00 alle 13:00ã€6:0â€ scraped_https___www. [...] it/info/referti-cartelle-cliniche/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2783 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 144
   ğŸ“Š Token totali stimati: 572
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non Ã¨ valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Æuongiorno,l'accettazione per ritiro CD rx fino a che ora Ã¨ aperto? [ASSISTENTE] L'accettazione per il ritiro dei CD RX Ã¨ aperta dal lunedÃ¬ al venerdÃ¬ dalle 10:00 alle 18:00 e il sabato dalle 9:00 alle 13:00ã€6:0â€ scraped_https___www. [...] it/info/referti-cartelle-cliniche/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:57:14.928984
====================================================================================================
ğŸ“‹ Session ID: classify_1756634234
â±ï¸  Processing Time: 2.217s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (441 chars):
   [UTENTE] Æuongiorno,l'accettazione per ritiro CD rx fino a che ora Ã¨ aperto? [ASSISTENTE] L'accettazione per il ritiro dei CD RX Ã¨ aperta dal lunedÃ¬ al venerdÃ¬ dalle 10:00 alle 18:00 e il sabato da...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (164 chars):
   {'predicted_label': 'info\\_orari', 'confidence': 1.0, 'motivation': "La conversazione riguarda l'orario di accettazione per il ritiro dei CD RX presso Humanitas."}

ğŸ“Š Parsed Response:
   predicted_label: info\_orari
   confidence: 1.0
   motivation: La conversazione riguarda l'orario di accettazione per il ritiro dei CD RX presso Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 1.000
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda l'orario di accettazione per il ritiro dei CD RX presso Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione ea55736eaf7e991c371cb4ce91da0123 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'info\_orari' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 877
   ğŸ“Š Token totali: 1325
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1325 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 877
   ğŸ“Š Token conversazione finale: 877
   ğŸ“Š Token totali: 1325
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2780 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno

vorrei maggiori informazioni riguardo delle analisi fecali. [...]  Se hai bisogno di altro, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2687 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 877
   ğŸ“Š Token totali stimati: 1325
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno

vorrei maggiori informazioni riguardo delle analisi fecali. [...]  Se hai bisogno di altro, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:57:20.156782
====================================================================================================
ğŸ“‹ Session ID: classify_1756634240
â±ï¸  Processing Time: 5.142s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2780 chars):
   [UTENTE] Buongiorno

vorrei maggiori informazioni riguardo delle analisi fecali.

In particolare, vorrei sapere se fate le seguenti analisi:
- Test metagenomico per lo studio funzionale
- Sequenzia...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [76 more lines] ...
     Line 80: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (314 chars):
   {'predicted_label': 'prenotazione_analisi', 'confidence': 1.0, 'motivation': "La conversazione riguarda la richiesta di informazioni su una serie di analisi fecali e sulle modalitÃ  per contattare il centro delle analisi di Humanitas. In particolare, l'utente chiede se Ã¨ possibile effettuare le se...

ğŸ“Š Parsed Response:
   predicted_label: prenotazione_analisi
   confidence: 1.0
   motivation: La conversazione riguarda la richiesta di informazioni su una serie di analisi fecali e sulle modalitÃ  per contattare il centro delle analisi di Humanitas. In particolare, l'utente chiede se Ã¨ possibile effettuare le seguenti analisi:
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 1.000
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la richiesta di informazioni su una serie di analisi fecali e sulle modalitÃ  per contattare il centro delle analisi di Humanitas. In particolare, l'utente chiede se Ã¨ possibile effettuare le seguenti analisi:
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 6bf00dffc187f4c9c2835e087b79d951 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'prenotazione_analisi' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 440
   ğŸ“Š Token totali: 888
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 888 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 440
   ğŸ“Š Token conversazione finale: 440
   ğŸ“Š Token totali: 888
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1584 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao, mi chiamo Ditjon, sonno dal Albania, ho un problema che dopo gli esami che ho fatto mi hanno detto hai, prostatite chrono non bacteriale, penso che le cause, perche non ho nessune bacterie in urina, in spermocultura, in af genital, e in swab test,le cause sonno, per prima Ibs soffr..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2868 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 440
   ğŸ“Š Token totali stimati: 888
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao, mi chiamo Ditjon, sonno dal Albania, ho un problema che dopo gli esami che ho fatto mi hanno detto hai, prostatite chrono non bacteriale, penso che le cause, perche non ho nessune bacterie in urina, in spermocultura, in af genital, e in swab test,le cause sonno, per prima Ibs soffr..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:57:22.661608
====================================================================================================
ğŸ“‹ Session ID: classify_1756634242
â±ï¸  Processing Time: 2.418s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1584 chars):
   [UTENTE] Ciao, mi chiamo Ditjon, sonno dal Albania, ho un problema che dopo gli esami che ho fatto mi hanno detto hai, prostatite chrono non bacteriale, penso che le cause, perche non ho nessune ba...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (220 chars):
   {'predicted_label': 'prenotazione_visita', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di un appuntamento con un medico specializzato in dolore pelvico cronico presso l'ospedale Humanitas."}

ğŸ“Š Parsed Response:
   predicted_label: prenotazione_visita
   confidence: 0.95
   motivation: La conversazione riguarda la richiesta di un appuntamento con un medico specializzato in dolore pelvico cronico presso l'ospedale Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la richiesta di un appuntamento con un medico specializzato in dolore pelvico cronico presso l'ospedale Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione b5cfdceb2898ec4edb922f7fb13ccce7 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'prenotazione_visita' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 513
   ğŸ“Š Token totali: 961
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 961 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 513
   ğŸ“Š Token conversazione finale: 513
   ğŸ“Š Token totali: 961
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1694 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "La polizza copre anche viaggi all'estero?"
Output: info_copertura_geografica_assicurazione
Ragionamento: Richiesta informazioni sulla copertura geografica
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Devo fare prelievo di sangue presso Humanitas Via Sardegna. [...] it/info/esami-di-laboratorio/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2647 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 513
   ğŸ“Š Token totali stimati: 961
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "La polizza copre anche viaggi all'estero?"
Output: info_copertura_geografica_assicurazione
Ragionamento: Richiesta informazioni sulla copertura geografica
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Devo fare prelievo di sangue presso Humanitas Via Sardegna. [...] it/info/esami-di-laboratorio/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:57:25.610002
====================================================================================================
ğŸ“‹ Session ID: classify_1756634245
â±ï¸  Processing Time: 2.861s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1694 chars):
   [UTENTE] Devo fare prelievo di sangue presso Humanitas Via Sardegna. Sono incinta, devo prenotare? [ASSISTENTE] SÃ¬, Ã¨ necessario prenotare per effettuare un prelievo di sangue presso Humanitas. Puo...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (360 chars):
   {'predicted_label': 'prenotazione_prelievi', 'confidence': 0.98, 'motivation': 'La conversazione riguarda la necessitÃ  di prenotare un prelievo di sangue presso Humanitas, e vengono forniti i canali per effettuare la prenotazione (online o telefono). Inoltre viene precisato che le donne in gravid...

ğŸ“Š Parsed Response:
   predicted_label: prenotazione_prelievi
   confidence: 0.98
   motivation: La conversazione riguarda la necessitÃ  di prenotare un prelievo di sangue presso Humanitas, e vengono forniti i canali per effettuare la prenotazione (online o telefono). Inoltre viene precisato che le donne in gravidanza hanno precedenza presso il Medical Center di Fiordaliso.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.980
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 98.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la necessitÃ  di prenotare un prelievo di sangue presso Humanitas, e vengono forniti i canali per effettuare la prenotazione (online o telefono). Inoltre viene precisato che le donne in gravidanza hanno precedenza presso il Medical Center di Fiordaliso.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 69ce375d640dea3f8f7818889d0b9027 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  âœ… Nuovo tag 'prenotazione_prelievi' aggiunto per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 186
   ğŸ“Š Token totali: 635
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 635 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 186
   ğŸ“Š Token conversazione finale: 186
   ğŸ“Š Token totali: 635
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 567 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non Ã¨ valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Il punto prelievi di viale sardegna Ã¨ aperto in estate?  [ASSISTENTE] Il punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele, Ã¨ aperto durante l'estate con i seguenti orari: da lunedÃ¬ a venerdÃ¬ dalle 7:00 alle 13:00. [...] it/info/esami-di-laboratorio/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2846 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 186
   ğŸ“Š Token totali stimati: 635
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non Ã¨ valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Il punto prelievi di viale sardegna Ã¨ aperto in estate?  [ASSISTENTE] Il punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele, Ã¨ aperto durante l'estate con i seguenti orari: da lunedÃ¬ a venerdÃ¬ dalle 7:00 alle 13:00. [...] it/info/esami-di-laboratorio/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:57:28.818150
====================================================================================================
ğŸ“‹ Session ID: classify_1756634248
â±ï¸  Processing Time: 3.111s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (567 chars):
   [UTENTE] Il punto prelievi di viale sardegna Ã¨ aperto in estate?  [ASSISTENTE] Il punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele, Ã¨ aperto durante l'estate con i seguenti orari: da ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (342 chars):
   {'predicted_label': 'info\\_orari', 'confidence': 1.0, 'motivation': "La domanda dell'utente riguarda gli orari di apertura del punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele. L'assistente ha fornito la risposta che il punto prelievi Ã¨ aperto durante l'estate con i seguenti orari:...

ğŸ“Š Parsed Response:
   predicted_label: info\_orari
   confidence: 1.0
   motivation: La domanda dell'utente riguarda gli orari di apertura del punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele. L'assistente ha fornito la risposta che il punto prelievi Ã¨ aperto durante l'estate con i seguenti orari: da lunedÃ¬ a venerdÃ¬ dalle 7:00 alle 13:00.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 1.000
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100.0%

ğŸ§  Reasoning/Motivation:
   La domanda dell'utente riguarda gli orari di apertura del punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele. L'assistente ha fornito la risposta che il punto prelievi Ã¨ aperto durante l'estate con i seguenti orari: da lunedÃ¬ a venerdÃ¬ dalle 7:00 alle 13:00.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 0699ae8f580941c9da884f50ea13bbd6 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'info\_orari' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 474
   ğŸ“Š Token totali: 922
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 922 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 474
   ğŸ“Š Token conversazione finale: 474
   ğŸ“Š Token totali: 922
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1553 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Vorrei sapere se sabato 30 settembre 2025 Ã¨ possibile fare gli esami del sangue Humanitas fiordaliso? [ASSISTENTE] Presso Humanitas Medical Care Rozzano-Fiordaliso, il sabato Ã¨ possibile effettuare prelievi del sangue dalle 7:30 alle 10:00 solo su prenotazione, e dalle 10:00 alle 11:00 c..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2878 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 474
   ğŸ“Š Token totali stimati: 922
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Vorrei sapere se sabato 30 settembre 2025 Ã¨ possibile fare gli esami del sangue Humanitas fiordaliso? [ASSISTENTE] Presso Humanitas Medical Care Rozzano-Fiordaliso, il sabato Ã¨ possibile effettuare prelievi del sangue dalle 7:30 alle 10:00 solo su prenotazione, e dalle 10:00 alle 11:00 c..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:57:31.613506
====================================================================================================
ğŸ“‹ Session ID: classify_1756634251
â±ï¸  Processing Time: 2.709s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1553 chars):
   [UTENTE] Vorrei sapere se sabato 30 settembre 2025 Ã¨ possibile fare gli esami del sangue Humanitas fiordaliso? [ASSISTENTE] Presso Humanitas Medical Care Rozzano-Fiordaliso, il sabato Ã¨ possibile e...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (282 chars):
   {'predicted_label': 'prenotazione_esami', 'confidence': 1.0, 'motivation': "La conversazione riguarda l'accesso agli esami del sangue presso Humanitas Medical Care Rozzano-Fiordaliso e il fatto che Ã¨ possibile effettuare la prenotazione o accedere liberamente a determinati orari."}

ğŸ“Š Parsed Response:
   predicted_label: prenotazione_esami
   confidence: 1.0
   motivation: La conversazione riguarda l'accesso agli esami del sangue presso Humanitas Medical Care Rozzano-Fiordaliso e il fatto che Ã¨ possibile effettuare la prenotazione o accedere liberamente a determinati orari.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 1.000
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda l'accesso agli esami del sangue presso Humanitas Medical Care Rozzano-Fiordaliso e il fatto che Ã¨ possibile effettuare la prenotazione o accedere liberamente a determinati orari.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 8ec926debd5d2134b704ed9f33debc15 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  âœ… Nuovo tag 'prenotazione_esami' aggiunto per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 191
   ğŸ“Š Token totali: 640
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 640 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 191
   ğŸ“Š Token conversazione finale: 191
   ğŸ“Š Token totali: 640
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 648 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online


TESTO DA CLASSIFICARE:
"[UTENTE] Posso presentarmi senza appuntamento per gli esami del sangue con esenzione c03? [ASSISTENTE] Per effettuare esami del sangue con esenzione C03 presso Humanitas, Ã¨ necessario prenotare. [...] it/info/esami-di-laboratorio/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2778 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 191
   ğŸ“Š Token totali stimati: 640
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online


TESTO DA CLASSIFICARE:
"[UTENTE] Posso presentarmi senza appuntamento per gli esami del sangue con esenzione c03? [ASSISTENTE] Per effettuare esami del sangue con esenzione C03 presso Humanitas, Ã¨ necessario prenotare. [...] it/info/esami-di-laboratorio/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:57:33.997590
====================================================================================================
ğŸ“‹ Session ID: classify_1756634253
â±ï¸  Processing Time: 2.290s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (648 chars):
   [UTENTE] Posso presentarmi senza appuntamento per gli esami del sangue con esenzione c03? [ASSISTENTE] Per effettuare esami del sangue con esenzione C03 presso Humanitas, Ã¨ necessario prenotare. L'...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (182 chars):
   {'predicted_label': 'prenotazione_esami', 'confidence': 1.0, 'motivation': "La conversazione riguarda l'esame di laboratorio e il fatto che Ã¨ necessario prenotarsi per effettuarlo."}

ğŸ“Š Parsed Response:
   predicted_label: prenotazione_esami
   confidence: 1.0
   motivation: La conversazione riguarda l'esame di laboratorio e il fatto che Ã¨ necessario prenotarsi per effettuarlo.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 1.000
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda l'esame di laboratorio e il fatto che Ã¨ necessario prenotarsi per effettuarlo.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione e75abcfbadd32ec3c8c556c8ce6dce48 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'prenotazione_esami' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 268
   ğŸ“Š Token totali: 717
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 717 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 268
   ğŸ“Š Token conversazione finale: 268
   ğŸ“Š Token totali: 717
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 778 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] devo prenotare in humanitas con ssn. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2646 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 268
   ğŸ“Š Token totali stimati: 717
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] devo prenotare in humanitas con ssn. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:57:36.922033
====================================================================================================
ğŸ“‹ Session ID: classify_1756634256
â±ï¸  Processing Time: 2.839s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (778 chars):
   [UTENTE] devo prenotare in humanitas con ssn. come faccio ? [ASSISTENTE] Per prenotare una visita o un esame tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas, puoi utilizzare i seguen...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (353 chars):
   {'predicted_label': 'prenotazione', 'confidence': 1.0, 'motivation': 'La conversazione riguarda la richiesta di prenotazione presso Humanitas tramite il Servizio Sanitario Nazionale (SSN). Il messaggio dell\'utente Ã¨ "devo prenotare in humanitas con ssn. come faccio ?" e l\'assistente fornisce in...

ğŸ“Š Parsed Response:
   predicted_label: prenotazione
   confidence: 1.0
   motivation: La conversazione riguarda la richiesta di prenotazione presso Humanitas tramite il Servizio Sanitario Nazionale (SSN). Il messaggio dell'utente Ã¨ "devo prenotare in humanitas con ssn. come faccio ?" e l'assistente fornisce informazioni su come prenotare online o telefonicamente.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 1.000
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la richiesta di prenotazione presso Humanitas tramite il Servizio Sanitario Nazionale (SSN). Il messaggio dell'utente Ã¨ "devo prenotare in humanitas con ssn. come faccio ?" e l'assistente fornisce informazioni su come prenotare online o telefonicamente.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione b38f5bd11129417f713b6637b0f9c420 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 311
   ğŸ“Š Token totali: 759
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 759 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 311
   ğŸ“Š Token conversazione finale: 311
   ğŸ“Š Token totali: 759
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 945 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Non ho ricevuto la documentazione della polizza"
Output: problema_amministrativo
Ragionamento: Problemi con documenti o questioni amministrative
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Buonasera, avrei bisogno di sapere per mia mamma se possibile fare una RM addome sup senza e con MDC per gennaio, in convenzione ssn grazie  [ASSISTENTE] Per prenotare una Risonanza Magnetica (RM) dell'addome superiore senza e con mezzo di contrasto (MDC) in convenzione con il Servizio S..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2866 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 311
   ğŸ“Š Token totali stimati: 759
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Non ho ricevuto la documentazione della polizza"
Output: problema_amministrativo
Ragionamento: Problemi con documenti o questioni amministrative
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Buonasera, avrei bisogno di sapere per mia mamma se possibile fare una RM addome sup senza e con MDC per gennaio, in convenzione ssn grazie  [ASSISTENTE] Per prenotare una Risonanza Magnetica (RM) dell'addome superiore senza e con mezzo di contrasto (MDC) in convenzione con il Servizio S..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥


====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-08-31T09:57:39.562423
====================================================================================================
ğŸ“‹ Session ID: classify_1756634259
â±ï¸  Processing Time: 2.554s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (945 chars):
   [UTENTE] Buonasera, avrei bisogno di sapere per mia mamma se possibile fare una RM addome sup senza e con MDC per gennaio, in convenzione ssn grazie  [ASSISTENTE] Per prenotare una Risonanza Magnet...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (251 chars):
   {'predicted_label': 'prenotazione_rm_addome', 'confidence': 0.98, 'motivation': 'La conversazione riguarda la richiesta di prenotare una Risonanza Magnetica (RM) dell\'addome superiore, quindi la categoria piÃ¹ appropriata Ã¨ "prenotazione_rm_addome".'}

ğŸ“Š Parsed Response:
   predicted_label: prenotazione_rm_addome
   confidence: 0.98
   motivation: La conversazione riguarda la richiesta di prenotare una Risonanza Magnetica (RM) dell'addome superiore, quindi la categoria piÃ¹ appropriata Ã¨ "prenotazione_rm_addome".
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.980
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 98.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la richiesta di prenotare una Risonanza Magnetica (RM) dell'addome superiore, quindi la categoria piÃ¹ appropriata Ã¨ "prenotazione_rm_addome".
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: True
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 7301c119d7bc1199c40050eead56cbf7 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'prenotazione_rm_addome' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 124
   ğŸ“Š Token totali: 573
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 573 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 124
   ğŸ“Š Token conversazione finale: 124
   ğŸ“Š Token totali: 573
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 434 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quanti anni puÃ² durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non Ã¨ valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Ã¨ possibile eseguire una visita dermatologica in ssn a Castellanza? [ASSISTENTE] SÃ¬, Ã¨ possibile eseguire una visita dermatologica tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater Domini a Castellanza. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2832 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 124
   ğŸ“Š Token totali stimati: 573
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
