ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ­ EmbeddingEngineFactory inizializzata
ğŸ¯ EmbeddingManager inizializzato
ğŸš€ UMAP disponibile per riduzione dimensionale!
ğŸš€ cuML GPU clustering disponibile!
ğŸ’¥ EmbeddingDestroyer inizializzato - Ready to destroy and rebuild!
ğŸ¯ SimpleEmbeddingManager inizializzato
âœ… Blueprint esempi inizializzato correttamente
ğŸ”„ [LLMConfigService] Configurazione ricaricata
ğŸ”§ [LLMConfigService] Servizio inizializzato con config: /home/ubuntu/classificatore/config.yaml
ğŸš€ Avvio server Flask - Debug: True
 * Serving Flask app 'server'
 * Debug mode: on
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ” [DEBUG] GET review cases per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Creo oggetto Tenant da a0fd7600-f4f7-11ef-9315-96000228e7fe...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… [DEBUG] Tenant risolto: Humanitas (humanitas)
ğŸ” [DEBUG] Ottieni mongo reader per tenant: humanitas
ğŸ”§ Creazione MongoClassificationReader per cliente: humanitas
ğŸ” Risoluzione tenant da slug: humanitas
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Alleanza (alleanza) UUID=a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Tenant risolto: Alleanza (a0fd7600-f4f7-11ef-9315-96000228e7fe)
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant con oggetto Tenant...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto da slug (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da slug: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ“Š Calcolo statistiche per tenant: Humanitas
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Creo oggetto Tenant da a0fd7600-f4f7-11ef-9315-96000228e7fe...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Alleanza (alleanza) UUID=a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Tenant risolto: Alleanza (a0fd7600-f4f7-11ef-9315-96000228e7fe)
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant con oggetto Tenant...
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ” [DEBUG] GET review cases per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] GET /api/prompts/015007d9-d413-11ef-86a5-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Creo oggetto Tenant da 015007d9-d413-11ef-86a5-96000228e7fe...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… [DEBUG] Tenant risolto: Humanitas (humanitas)
ğŸ” [DEBUG] Ottieni mongo reader per tenant: humanitas
ğŸ”§ Creazione MongoClassificationReader per cliente: humanitas
ğŸ” Risoluzione tenant da slug: humanitas
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… [DEBUG] Tenant risolto: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant con oggetto Tenant...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto da slug (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da slug: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ“Š Calcolo statistiche per tenant: Humanitas
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-09-01T21:31:51', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id 015007d9-d413-11ef-86a5-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ¯ TRAINING SUPERVISIONATO - Cliente: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“‹ Parametri utente semplificati:
  ï¿½ Max sessioni review: 500
  ğŸ¯ Soglia confidenza: 0.95
  ğŸ”„ Forza review: False
  âš–ï¸  Soglia disagreement: 0.3
ğŸ”§ Inizializzazione pipeline per cliente: 015007d9-d413-11ef-86a5-96000228e7fe (con lock)
âš ï¸ [PIPELINE] DEPRECATO: uso di tenant_slug '015007d9-d413-11ef-86a5-96000228e7fe' - convertendo a oggetto Tenant
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”„ [PIPELINE] Conversione completata: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
âœ… [CONFIG] Configurazione base caricata da /home/ubuntu/classificatore/Utils/../config.yaml
ğŸ¯ [PIPELINE CLUSTERING CONFIG] Caricati parametri personalizzati per tenant 015007d9-d413-11ef-86a5-96000228e7fe:
   allow_single_cluster: non_definito -> False
   alpha: non_definito -> 0.4
   cluster_selection_epsilon: non_definito -> 0.28
   cluster_selection_method: non_definito -> leaf
   max_cluster_size: non_definito -> 0
   metric: non_definito -> euclidean
   min_cluster_size: 5 -> 13
   min_samples: 3 -> 16
   only_user: non_definito -> False
   umap_metric: non_definito -> cosine
   umap_min_dist: non_definito -> 0
   umap_n_components: non_definito -> 17
   umap_n_neighbors: non_definito -> 30
   umap_random_state: non_definito -> 42
   use_umap: non_definito -> True

ğŸš€ [FASE 1: INIZIALIZZAZIONE] Avvio pipeline...
ğŸ¥ [FASE 1: INIZIALIZZAZIONE] Tenant: humanitas
ğŸ¯ [FASE 1: INIZIALIZZAZIONE] Configurazione:
   ğŸ“Š Confidence threshold: 0.7
   ğŸ¤– Auto mode: True
   ğŸ”„ Auto retrain: False
ï¿½ [FASE 1: INIZIALIZZAZIONE] Inizializzazione lettore conversazioni...
âœ… [CONFIG] Configurazione base caricata da /home/ubuntu/classificatore/Utils/../config.yaml
âœ… [CONFIG] Config personalizzata tenant 015007d9-d413-11ef-86a5-96000228e7fe: 15 parametri
ğŸ¯ [ONLY_USER] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: False (da config personalizzata)
ğŸ¯ [LETTORE] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: only_user = False (da config tenant)
ï¿½ [FASE 1: INIZIALIZZAZIONE] Inizializzazione aggregator...
   ğŸ” Schema: 'humanitas'
   ğŸ†” Tenant ID: '015007d9-d413-11ef-86a5-96000228e7fe'
ğŸ¯ [SESSION AGGREGATOR] Inizializzazione con oggetto Tenant: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ¯ [ONLY_USER] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: False (da config personalizzata)
ğŸ¯ [LETTORE] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: only_user = False (da config tenant)
ï¿½ [ONLY_USER] Schema None: False (legacy - no tenant_id)
ğŸ§  [FASE 1: INIZIALIZZAZIONE] Sistema embedder dinamico (lazy loading)
ğŸ”§ [FASE 1: INIZIALIZZAZIONE] Parametri clustering:
   ğŸ“Š Min cluster size: 13
   ğŸ“Š Min samples: 16
ğŸ› DEBUG CLUSTER_ALPHA - PRIMA:
   ğŸ“‹ clustering_config.get('alpha', 1.0): 0.4
   ğŸ“‹ Type: <class 'float'>
ğŸ› DEBUG CLUSTER_ALPHA - DOPO CONVERSIONE:
   ğŸ“‹ cluster_alpha: 0.4
   ğŸ“‹ Type: <class 'float'>
ğŸ› DEBUG CLUSTER_ALPHA - FINALE:
   ğŸ“‹ cluster_alpha finale: 0.4
   ğŸ“‹ Type finale: <class 'float'>
   ğŸ“‹ Alpha > 0: True
âœ… [CONFIG] Config personalizzata tenant 015007d9-d413-11ef-86a5-96000228e7fe: 15 parametri
ğŸ—‚ï¸  [UMAP] Parametri per tenant 015007d9-d413-11ef-86a5-96000228e7fe:
   use_umap: True
   n_neighbors: 30
   min_dist: 0
   n_components: 17
   metric: cosine
ğŸ”§ [FIX DEBUG] Parametri tenant passati a HDBSCANClusterer:
   min_cluster_size: 13
   min_samples: 16
   alpha: 0.4
   cluster_selection_method: leaf
   cluster_selection_epsilon: 0.28
   metric: euclidean
   allow_single_cluster: False
   max_cluster_size: 0
   ğŸ—‚ï¸  use_umap: True
   ğŸ—‚ï¸  umap_n_neighbors: 30
   ğŸ—‚ï¸  umap_min_dist: 0
   ğŸ—‚ï¸  umap_n_components: 17
ğŸ¯ [BERTOPIC] Parametri consistenti configurati:
   ğŸ“Š HDBSCAN: 10 parametri
   ğŸ“Š UMAP: 5 parametri
ğŸ”§ HDBSCANClusterer inizializzato:
   min_cluster_size: 13
   min_samples: 16
   metric: euclidean
   cluster_selection_epsilon: 0.28
   ğŸ—‚ï¸  UMAP enabled: True
     ğŸ“ n_neighbors: 30
     ğŸ“ min_dist: 0
     ğŸ“Š n_components: 17
     ğŸ¯ metric: cosine
   ğŸš€ GPU enabled: True
   ğŸ’¾ GPU memory limit: 80%
   ğŸ”„ CPU fallback: True
   âš ï¸  [GPU MODE] Limitazioni cuML HDBSCAN:
     ğŸš« leaf_size=40 sarÃ  IGNORATO su GPU
     âœ… Parametri supportati: cluster_selection_method, alpha, allow_single_cluster
ğŸ¯ [DEBUG REACT] Parametri configurati:
   cluster_selection_method: leaf
   alpha: 0.4
   allow_single_cluster: False
ğŸ§  Inizializzazione memoria semantica...
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âš ï¸  Fallback a config LEGACY per embedding
ğŸ”§ TokenizationManager inizializzato:
   ğŸ“Š Modello tokenizer: cl100k_base
   ğŸ”¢ Limite massimo token: 8000
   âœ‚ï¸  Strategia troncamento: start
âœ… TokenizationManager integrato in LaBSE per gestione conversazioni lunghe
ğŸš€ Inizializzazione LaBSE embedder su device: cuda
ğŸ“¥ Caricamento modello sentence-transformers/LaBSE...
ğŸš€ Caricamento diretto su GPU...
âœ… Modello caricato con successo!
ğŸ“Š Dimensione embedding: 768
ğŸ”§ Device: cuda
ğŸ® GPU: NVIDIA A10G
ğŸ’¾ GPU Memory: 23.7 GB
ğŸ“ˆ GPU Memory utilizzata: 1.89 GB
ï¿½ Primo parametro su device: cuda:0
ğŸ§ª Test del modello LaBSE...
ğŸ” Encoding 3 testi con LaBSE su device cuda...

ğŸ” TOKENIZZAZIONE PREVENTIVA LABSE CLUSTERING
============================================================
ğŸ” ELABORAZIONE CONVERSAZIONI PER CLUSTERING
   ğŸ“Š Numero conversazioni: 3
   ğŸ†” Session IDs forniti: No

ğŸ“Š STATISTICHE ELABORAZIONE:
   ğŸ”¢ Conversazioni totali: 3
   âœ‚ï¸  Conversazioni troncate: 0
   ğŸ“ Token originali totali: 20
   ğŸ“ Token finali totali: 20
   ğŸ“Š Range token: 6 - 7
âœ… Tokenizzazione LaBSE completata:
   ğŸ“Š Conversazioni processate: 3
   ğŸ“Š Conversazioni troncate: 0
   ğŸ“Š Token limite configurato: 8000
   âœ… Tutte le conversazioni entro i limiti, nessun troncamento
============================================================
âœ… Embedding generati: shape (3, 768)
âœ… Test modello completato con successo!
   Shape: (3, 768)
   Norme: [0.99999994 1.         1.        ]
   Device: cuda
ğŸ¯ Modello pronto per l'uso!
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
ğŸ§  SemanticMemoryManager inizializzato
  ğŸ¯ Soglia riutilizzo etichette: 0.8
  ğŸ” Soglia similaritÃ  semantica: 0.8
  ğŸ’¾ Cache path: semantic_cache/humanitas_015007d9_memory
ğŸ”— Inizializzazione ensemble classifier avanzato...
ğŸ” ML Ensemble Debugger inizializzato e ATTIVO
   ğŸ“ Debug file: ./debug_logs/ml_debug.log
ğŸ” ML Ensemble Debugger attivato
ğŸ”§ Tentativo di inizializzazione IntelligentClassifier tramite LLMFactory...
ğŸ§  GPU Memory prima di LLM: 1.8GB/22.1GB (free: 20.3GB)
âœ… Memoria GPU sufficiente, inizializzazione LLM tramite Factory...
ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ­ LLM Factory inizializzato con cache invalidation intelligente
ğŸ” LLM FACTORY DEBUG: Chiamata ai_config_service.get_tenant_configuration(humanitas) normale...
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id humanitas
ğŸ” [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45)}
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ¯ LLM FACTORY DEBUG: Modello normale = 'mistral-nemo:latest'
ğŸ”§ Creazione LLM classifier mistral-nemo:latest per tenant humanitas
ğŸš€ LLM FACTORY DEBUG: Avvio creazione nuovo classifier modello 'mistral-nemo:latest'
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto da slug (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“‹ Caricamento parametri LLM globali per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ¯ Config LLM caricata per 015007d9-d413-11ef-86a5-96000228e7fe (fonte: global)
   ğŸ“ Max output tokens: 150
   ğŸ“Š Max input tokens: 8000
   ğŸŒ¡ï¸  Temperature: 0.1
   ğŸ”¢ Top K: 40, Top P: 0.9
ğŸ¯ Uso modello esplicito: mistral-nemo:latest
ğŸ” LLM Debugger inizializzato e ATTIVO
   ğŸ“ Debug file: ./debug_logs/llm_debug.log
   ğŸ¨ Visual formatting: True
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
ğŸ—„ï¸ MongoClassificationReader inizializzato per tenant: Humanitas
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
Connessione al database TAG stabilita con successo
ğŸ“‹ Recuperati 29 tag dal database TAGS per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
âš ï¸  Fallback a config LEGACY per embedding
ğŸ”§ TokenizationManager inizializzato:
   ğŸ“Š Modello tokenizer: cl100k_base
   ğŸ”¢ Limite massimo token: 8000
   âœ‚ï¸  Strategia troncamento: start
âœ… LLM FACTORY DEBUG: Nuovo classifier creato: mistral-nemo:latest
âœ… LLM Classifier mistral-nemo:latest (mistral-nemo:latest) creato e cached per tenant humanitas
ğŸ­ LLM classifier ottenuto tramite Factory per tenant humanitas
ğŸ¤– LLM classifier creato automaticamente nell'ensemble: mistral-nemo:latest
ğŸ’¡ Possibile fine-tuning per humanitas
ğŸ”— Advanced Ensemble Classifier inizializzato
   ğŸ§  LLM weight: 0.60
   ğŸ¤– ML weight: 0.40
   ğŸ¯ Confidence threshold: 0.7
   ğŸ”„ Adaptive weights: True
   ğŸ‘¤ Disaccordi gestiti da QualityGateEngine
ğŸ“¥ Caricamento ultimo modello per humanitas: humanitas_015007d9_20250901_180026
ğŸ“¥ Caricamento ensemble model...
âœ… ML ensemble caricato
âœ… Configurazione caricata
ğŸ”— Ensemble model caricato da models/humanitas_015007d9_20250901_180026
âœ… Modello caricato con successo

ğŸ” VERIFICA BERTOPIC LOADING:
   ğŸ“‹ BERTopic enabled: True
   ğŸ“‹ BERTopic available: True
   ğŸ“ Provider directory: models/humanitas_015007d9_20250901_180026_bertopic
   ğŸ“ Directory exists: True
   ï¿½ File trovati: 3 -> ['metadata.json', 'bertopic_model', 'svd_model.pkl']

ğŸ”„ CARICAMENTO BERTOPIC:
   ğŸ“ Path completo: /home/ubuntu/classificatore/models/humanitas_015007d9_20250901_180026_bertopic
ğŸ”„ Caricamento BERTopic model da models/humanitas_015007d9_20250901_180026_bertopic/bertopic_model
âœ… BERTopic model caricato con successo
ğŸ“¥ SVD caricato (svd_model.pkl)
   â±ï¸ Caricamento completato in 0.21 secondi
   âœ… BERTopic provider caricato con successo
ğŸ”— BERTopic provider impostato (top_k=10, one_hot=False)
   âœ… BERTopic provider configurato nell'ensemble
â¸ï¸ Riaddestramento automatico disabilitato (modalitÃ  supervisione/API)
   ğŸ’¡ Per abilitare, usare auto_retrain=True nell'inizializzazione
âœ… Classificatore LLM disponibile nell'ensemble
ğŸ‘¤ Inizializzazione trainer interattivo...
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
ğŸ¯ SIMPLE MANAGER: Usando oggetto Tenant Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“¥ Primo embedder - creazione per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸš€ CREATING FRESH EMBEDDER per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ FORCE NO CACHE: Bypass cache per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”¥ FORCE NO CACHE: Bypasso cache e leggo DIRETTAMENTE dal database per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45)}
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ” SIMPLE MANAGER: Engine da DB per 015007d9-d413-11ef-86a5-96000228e7fe = 'labse'
ğŸ¯ Engine configurato: labse
ğŸ”§ DIRECT CREATE: labse
ğŸ³ Tentativo connessione a servizio LaBSE dockerizzato...
ğŸ”— LaBSE Remote Client inizializzato
   ğŸ“¡ Service URL: http://localhost:8081
   â±ï¸  Timeout: 300s
   ğŸ”„ Max retries: 3
   ğŸ›¡ï¸ Fallback locale: True
ğŸ”§ Inizializzazione client remoto LaBSE...
âœ… Servizio embedding online e funzionante
âœ… Client remoto LaBSE inizializzato con successo
âœ… LaBSE Remote Client configurato con successo
âœ… FRESH EMBEDDER creato: LaBSERemoteClient per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ§  Inizializzazione dedupplicatore intelligente...
ğŸ’¾ [FASE 1: INIZIALIZZAZIONE] Caricamento memoria semantica...
ğŸ“¦ Memoria semantica caricata da cache (77 sessioni)
   ğŸ“Š Campioni: 75
   ğŸ·ï¸ Tag: 10
âœ… [FASE 1: INIZIALIZZAZIONE] Completata in 4.80s
ğŸ¯ [FASE 1: INIZIALIZZAZIONE] Pipeline pronta per l'uso!
âœ… Pipeline 015007d9-d413-11ef-86a5-96000228e7fe inizializzata
ğŸš€ TRAINING SUPERVISIONATO CON DATASET COMPLETO
  ğŸ“Š Estrazione: TUTTE le discussioni dal database
  ğŸ§© Clustering: Su tutto il dataset disponibile
  ğŸ‘¤ Review umana: Max 500 sessioni rappresentative
ğŸ¯ Confidence threshold aggiornato a: 0.95
ğŸ“ TRAINING SUPERVISIONATO AVANZATO
ï¿½ NUOVA LOGICA:
  ğŸ”„ Estrazione: TUTTE le discussioni dal database
  ğŸ§© Clustering: Su tutto il dataset completo
  ğŸ‘¤ Review umana: Massimo 500 sessioni rappresentative
--------------------------------------------------
ğŸ“Š FASE 1: ESTRAZIONE COMPLETA DATASET

ï¿½ [FASE 2: ESTRAZIONE] Avvio estrazione sessioni...
ğŸ¥ [FASE 2: ESTRAZIONE] Tenant: humanitas
ğŸ“… [FASE 2: ESTRAZIONE] Giorni indietro: 7
ğŸ”„ [FASE 2: ESTRAZIONE] ModalitÃ  COMPLETA attivata
ğŸ¯ [FASE 2: ESTRAZIONE] Ignorando limite - estrazione totale dataset
ï¿½ [FASE 2: ESTRAZIONE] ModalitÃ : COMPLETA
ï¿½ [FASE 2: ESTRAZIONE] Connessione database...
ğŸ“Š [DEBUG ONLY_USER] Estrazione sessioni aggregate dal schema 'humanitas'...
ğŸ¯ [DEBUG ONLY_USER] Parametro only_user = False (tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“„ [DEBUG ONLY_USER] Estrazione completa (senza limite)
ğŸ“„ [DEBUG ONLY_USER] Filtraggio standard: messaggi USER e AGENT
ğŸ” [DEBUG SQL] =============================================
ğŸ” [DEBUG SQL] Schema utilizzato: 'humanitas'
ğŸ” [DEBUG SQL] Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG SQL] Only User: False
ï¿½ [DEBUG SQL] Filtro applicato: WHERE csm.said_by IN ('USER', 'AGENT')
ğŸ” [DEBUG SQL] =============================================
ğŸ” [DEBUG SQL] QUERY COMPLETA:
ğŸ” [DEBUG SQL] 
        SELECT cs.session_id
             , (SELECT a.agent_name
                  FROM `humanitas`.agents a
                 WHERE a.agent_id = cs.conversation_agent_id) AS conversation_agent_name
             , csm.conversation_status_message_id
             , csm.conversation_message
             , csm.said_by
             , csm.created_at AS message_created_at
          FROM `humanitas`.conversation_status cs
         INNER JOIN `humanitas`.conversation_status_messages csm
            ON cs.conversation_status_id = csm.conversation_status_id
         WHERE csm.said_by IN ('USER', 'AGENT')
         ORDER BY cs.session_id
             , cs.created_at ASC
             , csm.created_at ASC
             , csm.said_by ASC
        
ğŸ” [DEBUG SQL] =============================================
Connessione al database MySQL stabilita con successo
âœ… [DEBUG ONLY_USER] Query eseguita con successo!
ğŸ“Š [DEBUG ONLY_USER] Totale righe: 22250
ğŸ‘¤ [DEBUG ONLY_USER] Messaggi USER: 11106
ğŸ¤– [DEBUG ONLY_USER] Messaggi AGENT: 11144
âœ… [DEBUG ONLY_USER] Filtro funziona correttamente!
âœ… Trovate 22250 righe da aggregare
ğŸ”„ [DEBUG ONLY_USER] Inizio generazione testo completo per 4453 sessioni
ğŸ” [DEBUG ONLY_USER] Sessione 0008ef4f-c2f4-4f5e-933e-646574f3638c: 3 USER, 3 AGENT
ğŸ“ [DEBUG ONLY_USER] Sessione 0008ef4f-c2f4-4f5e-933e-646574f3638c testo finale:
   [UTENTE] tags: 2
   [ASSISTENTE] tags: 2
   Lunghezza testo: 554 caratteri
ğŸ” [DEBUG ONLY_USER] Sessione 000b61d7-4431-40d2-b83c-9abbb70c98be: 4 USER, 4 AGENT
ğŸ“ [DEBUG ONLY_USER] Sessione 000b61d7-4431-40d2-b83c-9abbb70c98be testo finale:
   [UTENTE] tags: 3
   [ASSISTENTE] tags: 3
   Lunghezza testo: 1133 caratteri
ğŸ” [DEBUG ONLY_USER] Sessione 00160700-ac7f-463d-8fa0-fe57f74a73e6: 4 USER, 4 AGENT
âœ… Aggregate 4453 sessioni uniche
ğŸ”„ Saltati 8906 messaggi di benvenuto (primi 2 per sessione)
ğŸ”„ Sessioni vuote (solo benvenuto): 944
ğŸ“¥ [FASE 2: ESTRAZIONE] Sessioni grezze: 4453
ğŸ” [FASE 2: ESTRAZIONE] Filtraggio sessioni...
ğŸ” Filtraggio sessioni vuote/irrilevanti...
âœ… Filtro completato:
  ğŸ“Š Sessioni originali: 4453
  âŒ Sessioni scartate: 944
  âœ… Sessioni valide: 3509
âœ… [FASE 2: ESTRAZIONE] Completata in 0.67s
ğŸ“Š [FASE 2: ESTRAZIONE] Dataset completo: 3509 sessioni
ğŸ—‘ï¸ [FASE 2: ESTRAZIONE] Filtrate: 944 sessioni vuote/irrilevanti
ğŸ¯ [FASE 2: ESTRAZIONE] Pronte per clustering completo
âœ… Dataset completo: 3509 sessioni totali

ğŸ“Š FASE 2: CLUSTERING COMPLETO

ğŸš€ [FASE 4: CLUSTERING] Avvio clustering intelligente...
ğŸ“Š [FASE 4: CLUSTERING] Dataset: 3509 sessioni
ğŸ¯ [FASE 4: CLUSTERING] ModalitÃ : INTELLIGENTE
ğŸ§  [FASE 4: CLUSTERING] Clustering incrementale (se possibile)...

ğŸš€ [FASE 3: EMBEDDINGS] Avvio generazione embeddings...
ï¿½ [FASE 3: EMBEDDINGS] Dataset: 3509 sessioni
ğŸ“Š [FASE 3: EMBEDDINGS] Caratteristiche testo:
   ğŸ“ Lunghezza media: 1005 caratteri
   ğŸ“ Lunghezza massima: 29104 caratteri
   ğŸ“ Lunghezza minima: 75 caratteri
ğŸ§  [FASE 3: EMBEDDINGS] Generazione embeddings...
ğŸ”„ LAZY LOADING: Caricamento embedder dinamico per tenant 'humanitas'
ğŸ¯ SimpleEmbeddingManager inizializzato
ğŸ¯ SIMPLE MANAGER: Usando oggetto Tenant Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“¥ Primo embedder - creazione per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸš€ CREATING FRESH EMBEDDER per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ FORCE NO CACHE: Bypass cache per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”¥ FORCE NO CACHE: Bypasso cache e leggo DIRETTAMENTE dal database per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45)}
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ” SIMPLE MANAGER: Engine da DB per 015007d9-d413-11ef-86a5-96000228e7fe = 'labse'
ğŸ¯ Engine configurato: labse
ğŸ”§ DIRECT CREATE: labse
ğŸ³ Tentativo connessione a servizio LaBSE dockerizzato...
ğŸ”— LaBSE Remote Client inizializzato
   ğŸ“¡ Service URL: http://localhost:8081
   â±ï¸  Timeout: 300s
   ğŸ”„ Max retries: 3
   ğŸ›¡ï¸ Fallback locale: True
ğŸ”§ Inizializzazione client remoto LaBSE...
âœ… Servizio embedding online e funzionante
âœ… Client remoto LaBSE inizializzato con successo
âœ… LaBSE Remote Client configurato con successo
âœ… FRESH EMBEDDER creato: LaBSERemoteClient per tenant 015007d9-d413-11ef-86a5-96000228e7fe
âœ… Embedder caricato per tenant Humanitas (015007d9-d413-11ef-86a5-96000228e7fe): LaBSERemoteClient
ğŸ“¡ Richiesta embedding remoto per 3509 testi...
âœ… Embedding remoto completato in 7.171s
   ğŸ“Š Shape: (3509, 768)
   âš¡ Tempo servizio: 3.505s
âœ… [FASE 3: EMBEDDINGS] Completata in 7.29s
ğŸ“ˆ [FASE 3: EMBEDDINGS] Shape: (3509, 768)
âš¡ [FASE 3: EMBEDDINGS] Throughput: 481.6 testi/secondo

ğŸ“Š FASE 2A: TRAINING BERTOPIC ANTICIPATO

ğŸš€ TRAINING BERTOPIC ANTICIPATO (NUOVO FLUSSO OTTIMIZZATO):
   ğŸ“Š Dataset completo: 3509 sessioni
   ğŸ“Š Embeddings shape: (3509, 768)
   ğŸ¯ Addestramento su TUTTO il dataset per features ottimali
   ğŸ”¥ Esecuzione bertopic_provider.fit() su dataset completo...
ğŸ“Š BERTopic training su 3509 campioni
   ğŸ¯ Embedder configurato: LaBSERemoteClient
   ğŸ”§ STRATEGIA: BERTopic userÃ  embedder personalizzato via wrapper
   âœ… Wrapper embedder creato per BERTopic
   ğŸ”§ BERTopic userÃ  embedder personalizzato interno
âœ… BERTopic FIT completato su 3509 campioni
   ğŸ”§ SVD Training: Usando embedder personalizzato interno
âœ… SVD addestrato su full probas (k=20)
   âœ… BERTopic FIT completato in 37.18 secondi
   ğŸ”„ Esecuzione bertopic_provider.transform() per features extraction...
ğŸ”§ Transform: BERTopic userÃ  embedder personalizzato interno
   âœ… BERTopic TRANSFORM completato in 3.89 secondi
   ğŸ“Š Topic probabilities shape: (3509, 20)
   ğŸ“Š One-hot shape: None
   âœ… BERTopic provider addestrato con successo su 3509 sessioni
   âœ… BERTopic provider disponibile per augmentation features
   ğŸ”— BERTopic model assegnato al trainer per validazione ALTRO

ğŸ“Š FASE 2B: CLUSTERING HDBSCAN
ğŸ§  Usando clustering INTELLIGENTE (LLM + ML senza pattern)
ğŸ—‚ï¸  [DEBUG] Caricamento config tenant-specific: /home/ubuntu/classificatore/tenant_configs/015007d9-d413-11ef-86a5-96000228e7fe_clustering.yaml
ğŸ—‚ï¸  [DEBUG] Config tenant caricato: ['allow_single_cluster', 'alpha', 'cluster_selection_epsilon', 'cluster_selection_method', 'max_cluster_size', 'metric', 'min_cluster_size', 'min_samples', 'only_user', 'umap_metric', 'umap_min_dist', 'umap_n_components', 'umap_n_neighbors', 'umap_random_state', 'use_umap']
ğŸ—‚ï¸  [DEBUG] UMAP config finale: use_umap=True, n_components=17, min_dist=0
ğŸ§  Clustering intelligente configurato:
   ğŸ¯ Categorie intent suggerite: 12
   ğŸ¤– LLM primario: True
   ğŸ“Š Min confidence: 0.8
   ğŸ“ˆ Min conversations per intent: 2
   ğŸ‘¥ Rappresentanti diversificati: True
   ğŸ”¢ Max rappresentanti per cluster: 5
   ğŸ¤ Strategia consenso: majority
ğŸ§  Avvio clustering intelligente OTTIMIZZATO di 3509 conversazioni...
ğŸ“Š Fase 1: Clustering semantico con HDBSCAN...
ğŸ”§ HDBSCANClusterer inizializzato:
   min_cluster_size: 13
   min_samples: 16
   metric: euclidean
   cluster_selection_epsilon: 0.28
   ğŸ—‚ï¸  UMAP enabled: True
     ğŸ“ n_neighbors: 30
     ğŸ“ min_dist: 0
     ğŸ“Š n_components: 17
     ğŸ¯ metric: cosine
   ğŸš€ GPU enabled: True
   ğŸ’¾ GPU memory limit: 80%
   ğŸ”„ CPU fallback: True
   âš ï¸  [GPU MODE] Limitazioni cuML HDBSCAN:
     ğŸš« leaf_size=40 sarÃ  IGNORATO su GPU
     âœ… Parametri supportati: cluster_selection_method, alpha, allow_single_cluster
ğŸ¯ [DEBUG REACT] Parametri configurati:
   cluster_selection_method: eom
   alpha: 1.0
   allow_single_cluster: False
ğŸ” Clustering HDBSCAN su 3509 embedding (20.6MB)...
âš™ï¸  Parametri: min_cluster_size=13, min_samples=16, metric=euclidean
ğŸ“Š [DEBUG FIT_PREDICT] Embedding input:
   ğŸ“ Shape: (3509, 768)
   ğŸ”¢ Dtype: float64
   ğŸ“ˆ Range: [-0.1284, 0.0954]
   ğŸ’¾ Memory: 20.6MB

ğŸ—‚ï¸  [DEBUG FIT_PREDICT] STEP 1: Controllo applicazione UMAP...
ğŸ” [DEBUG UMAP] Controllo condizioni applicazione UMAP...
   âœ… self.use_umap = True
   âœ… UMAP_AVAILABLE = True
ï¿½ [DEBUG UMAP] UMAP ABILITATO - Iniziando riduzione dimensionale...
   ğŸ“ Dimensioni input: (3509, 768)
   ğŸ”¢ Tipo dati input: float64
   ğŸ“Š Range valori input: [-0.1284, 0.0954]
   ğŸ¯ Parametri UMAP configurati:
     ğŸ“ n_neighbors: 30
     ğŸ“ min_dist: 0
     ğŸ”¢ n_components: 17
     ğŸ“ˆ metric: cosine
     ğŸ² random_state: 42
ğŸ”§ [DEBUG UMAP] Inizializzazione riduttore UMAP...
ğŸ†• [DEBUG UMAP] ModalitÃ  TRAINING - fit nuovo reducer
âœ… [DEBUG UMAP] Riduttore UMAP inizializzato con successo
â³ [DEBUG UMAP] Applicazione fit_transform agli embeddings...
UMAP(angular_rp_forest=True, metric='cosine', min_dist=0, n_components=17, n_jobs=1, n_neighbors=30, random_state=42, verbose=True)
Mon Sep  1 21:33:51 2025 Construct fuzzy simplicial set
Mon Sep  1 21:34:06 2025 Finding Nearest Neighbors
Mon Sep  1 21:34:07 2025 Finished Nearest Neighbor Search
Mon Sep  1 21:34:07 2025 Construct embedding
	completed  0  /  500 epochs
	completed  50  /  500 epochs
	completed  100  /  500 epochs
	completed  150  /  500 epochs
	completed  200  /  500 epochs
	completed  250  /  500 epochs
	completed  300  /  500 epochs
	completed  350  /  500 epochs
	completed  400  /  500 epochs
	completed  450  /  500 epochs
Mon Sep  1 21:34:15 2025 Finished embedding
âœ… [DEBUG UMAP] UMAP COMPLETATO con SUCCESSO in 24.09s
   ğŸ“ Dimensioni output: (3509, 17)
   ï¿½ Tipo dati output: float32
   ï¿½ğŸ“Š Range valori output: [-1.0108, 11.1780]
   ğŸ“ˆ Riduzione dimensionale: 768 â†’ 17 dimensioni
   ğŸ“‰ Fattore riduzione: 45.2x
âœ… [DEBUG UMAP] RIDUZIONE DIMENSIONALE CONFERMATA
âœ… [DEBUG UMAP] Nessun NaN nel risultato UMAP
âœ… [DEBUG UMAP] Nessun valore infinito nel risultato UMAP
ğŸ“Š [DEBUG UMAP] DiversitÃ  embeddings ridotti: 3509/3509 righe uniche
âœ… [DEBUG UMAP] Buona diversitÃ  negli embeddings ridotti
ğŸ“‹ [DEBUG UMAP] Info riduzione salvate nel clusterer
ğŸ“‹ [DEBUG FIT_PREDICT] Risultato UMAP:
   âœ… UMAP applicato: True
   ğŸ“ Shape post-UMAP: (3509, 17)
   ğŸ“ˆ Range post-UMAP: [-1.0108, 11.1780]
   â±ï¸  Tempo riduzione: 24.09s

ğŸ”§ [DEBUG FIT_PREDICT] STEP 2: Normalizzazione per metrica euclidean...
   ğŸ¯ Nessuna normalizzazione necessaria per metrica euclidean
   ğŸ“ Shape finale per clustering: (3509, 17)
   ğŸ“ˆ Range finale: [-1.0108, 11.1780]
   ğŸ¯ Metrica effettiva clustering: euclidean
ğŸ’¾ Memoria GPU: 17.7GB disponibili, 0.1GB necessari
ğŸš€ Utilizzo GPU per clustering accelerato

ğŸš€ [DEBUG FIT_PREDICT] STEP 3: Avvio clustering...
   ğŸ–¥ï¸  ModalitÃ : GPU
ï¿½ [GPU CLUSTERING] Inizializzazione cuML HDBSCAN con parametri supportati...

âœ… [DEBUG FIT_PREDICT] CLUSTERING COMPLETATO in 0.12s con ğŸš€ GPU!
ğŸ“Š Risultati finali:
   ğŸ¯ Cluster trovati: 35
   ğŸ” Outlier: 624 (17.8%)
   ğŸ“ˆ Silhouette score: 0.610

ğŸ“‹ [DEBUG FIT_PREDICT] RIEPILOGO TRASFORMAZIONI:
   ğŸ”¤ Input originale: (3509, 768)
   ğŸ—‚ï¸  Dopo UMAP: (3509, 17)
   ğŸ”§ Dopo normalizzazione: (3509, 17)
   ğŸ¯ Utilizzato per clustering: (3509, 17) con metrica euclidean
   ğŸ“ˆ Cluster HDBSCAN trovati: 35
   ğŸ” Outliers: 624
ğŸ‘¥ Fase 2: Selezione rappresentanti per cluster...
   ï¿½ Cluster 0: 38 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 1: 46 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 2: 19 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 3: 98 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 4: 97 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 5: 202 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 6: 302 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 7: 97 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 8: 152 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 9: 35 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 10: 52 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 11: 313 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 12: 34 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 13: 47 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 14: 17 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 15: 30 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 16: 24 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 17: 42 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 18: 241 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 19: 46 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 20: 19 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 21: 26 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 22: 74 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 23: 29 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 24: 50 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 25: 32 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 26: 51 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 27: 36 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 28: 200 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 29: 91 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 30: 164 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 31: 81 sessioni, 5 rappresentanti selezionati
   ï¿½ Cluster 32: 36 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 33: 42 sessioni, 4 rappresentanti selezionati
   ï¿½ Cluster 34: 22 sessioni, 4 rappresentanti selezionati
ğŸ¤– Fase 3: Analisi LLM di 155 rappresentanti...
ğŸ¤– Analisi LLM di 155 conversazioni...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 67
   ğŸ“Š Token totali: 515
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 515 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 67
   ğŸ“Š Token conversazione finale: 67
   ğŸ“Š Token totali: 515
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 215 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno vorrei sapere come posso disdire un appuntamento privato grazie  [ASSISTENTE] Ti chiedo scusa, adesso non posso risponderti perchÃ© impegnata in un aggiornamento.
Puoi riprovare piÃ¹ tardi? Grazie."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2883 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 67
   ğŸ“Š Token totali stimati: 515
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno vorrei sapere come posso disdire un appuntamento privato grazie  [ASSISTENTE] Ti chiedo scusa, adesso non posso risponderti perchÃ© impegnata in un aggiornamento.
Puoi riprovare piÃ¹ tardi? Grazie."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Prenotazione",\n  "confidence": 0.95,\n  "m'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:18.961739
====================================================================================================
ğŸ“‹ Session ID: classify_1756762458
â±ï¸  Processing Time: 3.039s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (215 chars):
   [UTENTE] Buongiorno vorrei sapere come posso disdire un appuntamento privato grazie  [ASSISTENTE] Ti chiedo scusa, adesso non posso risponderti perchÃ© impegnata in un aggiornamento.
Puoi riprovare ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (197 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Prenotazione",\n  "confidence": 0.95,\n  "m'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Prenotazione",
  "confidence": 0.95,
  "m
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Prenotazione",
  "confidence": 0.95,
  "m
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 3af245d743af3e79f6470fcee5c41600 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 27
   ğŸ“Š Token totali: 455
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 455 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 27
   ğŸ“Š Token conversazione finale: 27
   ğŸ“Š Token totali: 455
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 78 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] prova [ASSISTENTE] Eccomi qui! Dimmi pure come posso esserti utile. ğŸ˜Š"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2674 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 27
   ğŸ“Š Token totali stimati: 455
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] prova [ASSISTENTE] Eccomi qui! Dimmi pure come posso esserti utile. ğŸ˜Š"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.9, 'motivation': "La conversazione non sembra riguardare specifici servizi o informazioni sull'ospedale Humanitas.", 'predicted_label': 'altro'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:20.699028
====================================================================================================
ğŸ“‹ Session ID: classify_1756762460
â±ï¸  Processing Time: 1.628s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (78 chars):
   [UTENTE] prova [ASSISTENTE] Eccomi qui! Dimmi pure come posso esserti utile. ğŸ˜Š

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (161 chars):
   {'confidence': 0.9, 'motivation': "La conversazione non sembra riguardare specifici servizi o informazioni sull'ospedale Humanitas.", 'predicted_label': 'altro'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.9
   motivation: La conversazione non sembra riguardare specifici servizi o informazioni sull'ospedale Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.900
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 90.0%

ğŸ§  Reasoning/Motivation:
   La conversazione non sembra riguardare specifici servizi o informazioni sull'ospedale Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 003a656b4ddfb85ecf1df5d3cdc1b4ce classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 47
   ğŸ“Š Token totali: 475
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 475 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 47
   ğŸ“Š Token conversazione finale: 47
   ğŸ“Š Token totali: 475
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 151 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia non ho bisogno [ASSISTENTE] Va bene, se hai bisogno di informazioni o assistenza in futuro, sono qui per aiutarti. Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2747 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 47
   ğŸ“Š Token totali stimati: 475
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia non ho bisogno [ASSISTENTE] Va bene, se hai bisogno di informazioni o assistenza in futuro, sono qui per aiutarti. Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione non richiede assistenza specifica e l'utente esprime solo un saluto di cortesia.", 'predicted_label': 'altro'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:22.218053
====================================================================================================
ğŸ“‹ Session ID: classify_1756762462
â±ï¸  Processing Time: 1.432s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (151 chars):
   [UTENTE] Ciao Giulia non ho bisogno [ASSISTENTE] Va bene, se hai bisogno di informazioni o assistenza in futuro, sono qui per aiutarti. Buona giornata!

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (163 chars):
   {'confidence': 0.95, 'motivation': "La conversazione non richiede assistenza specifica e l'utente esprime solo un saluto di cortesia.", 'predicted_label': 'altro'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.95
   motivation: La conversazione non richiede assistenza specifica e l'utente esprime solo un saluto di cortesia.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione non richiede assistenza specifica e l'utente esprime solo un saluto di cortesia.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione c4458a8fe3f675f0bf8a0af8f2045ef7 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 47
   ğŸ“Š Token totali: 495
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 495 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 47
   ğŸ“Š Token conversazione finale: 47
   ğŸ“Š Token totali: 495
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 143 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ok ho guardato non c'Ã¨ nulla aspettiamo un attimo [ASSISTENTE] Va bene, resto a disposizione! Fammi sapere come posso esserti utile. ğŸ˜Š"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2811 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 47
   ğŸ“Š Token totali stimati: 495
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ok ho guardato non c'Ã¨ nulla aspettiamo un attimo [ASSISTENTE] Va bene, resto a disposizione! Fammi sapere come posso esserti utile. ğŸ˜Š"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.85, 'motivation': "La conversazione non riguarda esplicitamente un servizio o una richiesta di informazioni specifici sull'ospedale Humanitas.", 'predicted_label': 'altro'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:23.721121
====================================================================================================
ğŸ“‹ Session ID: classify_1756762463
â±ï¸  Processing Time: 1.414s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (143 chars):
   [UTENTE] Ok ho guardato non c'Ã¨ nulla aspettiamo un attimo [ASSISTENTE] Va bene, resto a disposizione! Fammi sapere come posso esserti utile. ğŸ˜Š

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (189 chars):
   {'confidence': 0.85, 'motivation': "La conversazione non riguarda esplicitamente un servizio o una richiesta di informazioni specifici sull'ospedale Humanitas.", 'predicted_label': 'altro'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.85
   motivation: La conversazione non riguarda esplicitamente un servizio o una richiesta di informazioni specifici sull'ospedale Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.850
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] 85.0%

ğŸ§  Reasoning/Motivation:
   La conversazione non riguarda esplicitamente un servizio o una richiesta di informazioni specifici sull'ospedale Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 088e9aee65fad833aac6cb233db6480e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 338
   ğŸ“Š Token totali: 786
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 786 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 338
   ğŸ“Š Token conversazione finale: 338
   ğŸ“Š Token totali: 786
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1089 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao, vorrei prenotare un intervento in regime privato, come devo fare? [ASSISTENTE] Per prenotare un ricovero privato presso Humanitas, puoi contattare l'Ufficio Ricoveri Privati chiamando il numero 02 82 24 62 50, attivo dal lunedÃ¬ al venerdÃ¬ dalle 8:00 alle 17:00, oppure inviare un'em..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 338
   ğŸ“Š Token totali stimati: 786
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao, vorrei prenotare un intervento in regime privato, come devo fare? [ASSISTENTE] Per prenotare un ricovero privato presso Humanitas, puoi contattare l'Ufficio Ricoveri Privati chiamando il numero 02 82 24 62 50, attivo dal lunedÃ¬ al venerdÃ¬ dalle 8:00 alle 17:00, oppure inviare un'em..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Classification of conversation:**\n\n```json\n{\n  "predicted_label": "Prenotazione",\n  "confidence": '}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:26.852448
====================================================================================================
ğŸ“‹ Session ID: classify_1756762466
â±ï¸  Processing Time: 3.045s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1089 chars):
   [UTENTE] Ciao, vorrei prenotare un intervento in regime privato, come devo fare? [ASSISTENTE] Per prenotare un ricovero privato presso Humanitas, puoi contattare l'Ufficio Ricoveri Privati chiamand...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (196 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Classification of conversation:**\n\n```json\n{\n  "predicted_label": "Prenotazione",\n  "confidence": '}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **Classification of conversation:**

```json
{
  "predicted_label": "Prenotazione",
  "confidence": 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **Classification of conversation:**

```json
{
  "predicted_label": "Prenotazione",
  "confidence": 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 0c836bcfee3b0864307964656a0c29d1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 196
   ğŸ“Š Token totali: 644
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 644 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 196
   ğŸ“Š Token conversazione finale: 196
   ğŸ“Š Token totali: 644
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 629 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Volevo sapere se nel Building 8 c'Ã¨ una cappella e a che ora fanno la messa il sabato e la domenica  [ASSISTENTE] Nel Building 8 di Humanitas Ã¨ presente una cappella dedicata al culto cattolico situata al piano terra. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2917 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 196
   ğŸ“Š Token totali stimati: 644
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Volevo sapere se nel Building 8 c'Ã¨ una cappella e a che ora fanno la messa il sabato e la domenica  [ASSISTENTE] Nel Building 8 di Humanitas Ã¨ presente una cappella dedicata al culto cattolico situata al piano terra. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'esistenza di una cappella nel Building 8 e sugli orari delle funzioni religiose, il che indica chiaramente una richiesta relativa all'alloggio.", 'predicted_label': 'alloggio'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:28.696287
====================================================================================================
ğŸ“‹ Session ID: classify_1756762468
â±ï¸  Processing Time: 1.757s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (629 chars):
   [UTENTE] Volevo sapere se nel Building 8 c'Ã¨ una cappella e a che ora fanno la messa il sabato e la domenica  [ASSISTENTE] Nel Building 8 di Humanitas Ã¨ presente una cappella dedicata al culto catt...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (240 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'esistenza di una cappella nel Building 8 e sugli orari delle funzioni religiose, il che indica chiaramente una richiesta relativa all'alloggio.", 'predicted_label': 'alloggio'}

ğŸ“Š Parsed Response:
   predicted_label: alloggio
   confidence: 0.95
   motivation: La conversazione verte sull'esistenza di una cappella nel Building 8 e sugli orari delle funzioni religiose, il che indica chiaramente una richiesta relativa all'alloggio.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'esistenza di una cappella nel Building 8 e sugli orari delle funzioni religiose, il che indica chiaramente una richiesta relativa all'alloggio.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 65cbbb0a09877a6665baa0cef6728a6f classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'alloggio' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 363
   ğŸ“Š Token totali: 811
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 811 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 363
   ğŸ“Š Token conversazione finale: 363
   ğŸ“Š Token totali: 811
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1144 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao il bar al Building 2 quali orari osserva [ASSISTENTE] Il bar situato al primo piano del Building 2, in fondo al corridoio centrale, Ã¨ aperto tutti i giorni dalle 6:30 alle 21:00. [...] it/info/altri-servizi/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2890 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 363
   ğŸ“Š Token totali stimati: 811
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao il bar al Building 2 quali orari osserva [ASSISTENTE] Il bar situato al primo piano del Building 2, in fondo al corridoio centrale, Ã¨ aperto tutti i giorni dalle 6:30 alle 21:00. [...] it/info/altri-servizi/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted label:** servizi aziendali\n\n**Confidence:** 0.9\n\n**Motivation:** La conversazione verte '}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:30.389555
====================================================================================================
ğŸ“‹ Session ID: classify_1756762470
â±ï¸  Processing Time: 1.607s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1144 chars):
   [UTENTE] Ciao il bar al Building 2 quali orari osserva [ASSISTENTE] Il bar situato al primo piano del Building 2, in fondo al corridoio centrale, Ã¨ aperto tutti i giorni dalle 6:30 alle 21:00. 

Pe...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (195 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted label:** servizi aziendali\n\n**Confidence:** 0.9\n\n**Motivation:** La conversazione verte '}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **Predicted label:** servizi aziendali

**Confidence:** 0.9

**Motivation:** La conversazione verte 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **Predicted label:** servizi aziendali

**Confidence:** 0.9

**Motivation:** La conversazione verte 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione ce30da963d55c61c4fb87d03c1d87b26 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 284
   ğŸ“Š Token totali: 732
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 732 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 284
   ğŸ“Š Token conversazione finale: 284
   ğŸ“Š Token totali: 732
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 895 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Divrei prenotare per nedicazione [ASSISTENTE] Potresti chiarire meglio cosa intendi per "nedicazione"? Intendi dire "medicazione" o "indicazione"? Oppure hai bisogno di prenotare una visita o un esame? [UTENTE] Medicazione per ferita che non cicatrizza [ASSISTENTE] Per prenotare una medi..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 284
   ğŸ“Š Token totali stimati: 732
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Divrei prenotare per nedicazione [ASSISTENTE] Potresti chiarire meglio cosa intendi per "nedicazione"? Intendi dire "medicazione" o "indicazione"? Oppure hai bisogno di prenotare una visita o un esame? [UTENTE] Medicazione per ferita che non cicatrizza [ASSISTENTE] Per prenotare una medi..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:31.968786
====================================================================================================
ğŸ“‹ Session ID: classify_1756762471
â±ï¸  Processing Time: 1.493s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (895 chars):
   [UTENTE] Divrei prenotare per nedicazione [ASSISTENTE] Potresti chiarire meglio cosa intendi per "nedicazione"? Intendi dire "medicazione" o "indicazione"? Oppure hai bisogno di prenotare una visit...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 1590f2b90c775b1196070cbde12392d1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 162
   ğŸ“Š Token totali: 611
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 611 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 162
   ğŸ“Š Token conversazione finale: 162
   ğŸ“Š Token totali: 611
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 570 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Devo registrarmi  [ASSISTENTE] Per registrarti a [Humanitas con te](https://www. [...]  

Se hai altre domande, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2812 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 162
   ğŸ“Š Token totali stimati: 611
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Devo registrarmi  [ASSISTENTE] Per registrarti a [Humanitas con te](https://www. [...]  

Se hai altre domande, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Humanitas con te - Registrazio'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:33.687551
====================================================================================================
ğŸ“‹ Session ID: classify_1756762473
â±ï¸  Processing Time: 1.633s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (570 chars):
   [UTENTE] Devo registrarmi  [ASSISTENTE] Per registrarti a [Humanitas con te](https://www.humanitasconte.it), segui questi passaggi:

1. Accedi al sito [Humanitas con te](https://www.humanitasconte....

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Humanitas con te - Registrazio'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Humanitas con te - Registrazio
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Humanitas con te - Registrazio
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 0138bb9019bb13d93381f26f058afe2e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 454
   ğŸ’¬ Token conversazione: 508
   ğŸ“Š Token totali: 962
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 962 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione originale: 508
   ğŸ“Š Token conversazione finale: 508
   ğŸ“Š Token totali: 962
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1675 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] sono giÃ  registrato in Humanitas conte: devo scaricare referto OTP 814328 come devo procedere passo passo? [ASSISTENTE] Per scaricare il referto su [Humanitas con te](https://www. [...] it"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione: 508
   ğŸ“Š Token totali stimati: 962
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] sono giÃ  registrato in Humanitas conte: devo scaricare referto OTP 814328 come devo procedere passo passo? [ASSISTENTE] Per scaricare il referto su [Humanitas con te](https://www. [...] it"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” [DEBUG] GET review cases per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… [DEBUG] Tenant risolto: Humanitas (humanitas)
ğŸ” [DEBUG] Ottieni mongo reader per tenant: humanitas
ğŸ”§ Creazione MongoClassificationReader per cliente: humanitas
ğŸ” Risoluzione tenant da slug: humanitas
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto da slug (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da slug: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ“Š Calcolo statistiche per tenant: Humanitas
ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:35.613966
====================================================================================================
ğŸ“‹ Session ID: classify_1756762475
â±ï¸  Processing Time: 1.841s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1675 chars):
   [UTENTE] sono giÃ  registrato in Humanitas conte: devo scaricare referto OTP 814328 come devo procedere passo passo? [ASSISTENTE] Per scaricare il referto su [Humanitas con te](https://www.humanitas...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (97 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 205035e4b2c6cd1b270a4a452c2dae96 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 454
   ğŸ’¬ Token conversazione: 271
   ğŸ“Š Token totali: 725
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 725 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione originale: 271
   ğŸ“Š Token conversazione finale: 271
   ğŸ“Š Token totali: 725
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 923 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buon pomeriggio,non riesco a prenotare una visita privata, online  [ASSISTENTE] Se hai difficoltÃ  a prenotare una visita privata online, ti consiglio di seguire questi passaggi:

1. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2912 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione: 271
   ğŸ“Š Token totali stimati: 725
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buon pomeriggio,non riesco a prenotare una visita privata, online  [ASSISTENTE] Se hai difficoltÃ  a prenotare una visita privata online, ti consiglio di seguire questi passaggi:

1. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte principalmente sulla prenotazione di una visita privata e sull'assistenza per effettuare la procedura online.", 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:37.243724
====================================================================================================
ğŸ“‹ Session ID: classify_1756762477
â±ï¸  Processing Time: 1.544s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (923 chars):
   [UTENTE] Buon pomeriggio,non riesco a prenotare una visita privata, online  [ASSISTENTE] Se hai difficoltÃ  a prenotare una visita privata online, ti consiglio di seguire questi passaggi:

1. Accedi...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (205 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte principalmente sulla prenotazione di una visita privata e sull'assistenza per effettuare la procedura online.", 'predicted_label': 'Prenotazione'}

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.95
   motivation: La conversazione verte principalmente sulla prenotazione di una visita privata e sull'assistenza per effettuare la procedura online.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte principalmente sulla prenotazione di una visita privata e sull'assistenza per effettuare la procedura online.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 26b1dfeca7e2339617cd1400dd2eb1c2 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 454
   ğŸ’¬ Token conversazione: 261
   ğŸ“Š Token totali: 715
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 715 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione originale: 261
   ğŸ“Š Token conversazione finale: 261
   ğŸ“Š Token totali: 715
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 915 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] non riesco a registrami per scaricare i referti [ASSISTENTE] Per registrarti e scaricare i referti su [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2915 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione: 261
   ğŸ“Š Token totali stimati: 715
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] non riesco a registrami per scaricare i referti [ASSISTENTE] Per registrarti e scaricare i referti su [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sulla difficoltÃ  dell'utente nel registrarsi per scaricare i referti e l'assistente fornisce istruzioni dettagliate su come farlo attraverso il portale Humanitas con te.", 'predicted_label': 'Humanitas con te - Registrazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:39.471905
====================================================================================================
ğŸ“‹ Session ID: classify_1756762479
â±ï¸  Processing Time: 2.142s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (915 chars):
   [UTENTE] non riesco a registrami per scaricare i referti [ASSISTENTE] Per registrarti e scaricare i referti su [Humanitas con te](https://www.humanitasconte.it), Ã¨ necessario seguire questi passagg...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (285 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sulla difficoltÃ  dell'utente nel registrarsi per scaricare i referti e l'assistente fornisce istruzioni dettagliate su come farlo attraverso il portale Humanitas con te.", 'predicted_label': 'Humanitas con te - Registrazione'}

ğŸ“Š Parsed Response:
   predicted_label: Humanitas con te - Registrazione
   confidence: 0.95
   motivation: La conversazione verte sulla difficoltÃ  dell'utente nel registrarsi per scaricare i referti e l'assistente fornisce istruzioni dettagliate su come farlo attraverso il portale Humanitas con te.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sulla difficoltÃ  dell'utente nel registrarsi per scaricare i referti e l'assistente fornisce istruzioni dettagliate su come farlo attraverso il portale Humanitas con te.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 2933a529d5b1a148965e5e36b7906a43 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Humanitas con te - Registrazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 447
   ğŸ’¬ Token conversazione: 221
   ğŸ“Š Token totali: 668
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 668 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 447
   ğŸ“Š Token conversazione originale: 221
   ğŸ“Š Token conversazione finale: 221
   ğŸ“Š Token totali: 668
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 771 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ho bisogno di sapere il mio codice ID Humanitas con te [ASSISTENTE] Per recuperare lâ€™ID di [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2861 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 447
   ğŸ“Š Token conversazione: 221
   ğŸ“Š Token totali stimati: 668
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ho bisogno di sapere il mio codice ID Humanitas con te [ASSISTENTE] Per recuperare lâ€™ID di [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:42.292241
====================================================================================================
ğŸ“‹ Session ID: classify_1756762482
â±ï¸  Processing Time: 2.733s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (771 chars):
   [UTENTE] Ho bisogno di sapere il mio codice ID Humanitas con te [ASSISTENTE] Per recuperare lâ€™ID di [Humanitas con te](https://www.humanitasconte.it), ti consiglio di controllare tra i documenti fo...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (97 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 45bcd32fa70a4784f3e8cb0354890c56 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 115
   ğŸ“Š Token totali: 563
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 563 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 115
   ğŸ“Š Token conversazione finale: 115
   ğŸ“Š Token totali: 563
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 393 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Mi Ã¨ arrivato il messaggio che Ã¨ pronto il referto ma cosa mi serve per ritirarlo? [ASSISTENTE] Per ritirare il referto, ti servirÃ  il tagliando di promemoria ritiro referto rilasciato al momento dellâ€™accettazione (sia al totem che allo sportello). Questo tagliando contiene l'ID necessar..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 115
   ğŸ“Š Token totali stimati: 563
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Mi Ã¨ arrivato il messaggio che Ã¨ pronto il referto ma cosa mi serve per ritirarlo? [ASSISTENTE] Per ritirare il referto, ti servirÃ  il tagliando di promemoria ritiro referto rilasciato al momento dellâ€™accettazione (sia al totem che allo sportello). Questo tagliando contiene l'ID necessar..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:44.084921
====================================================================================================
ğŸ“‹ Session ID: classify_1756762484
â±ï¸  Processing Time: 1.706s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (393 chars):
   [UTENTE] Mi Ã¨ arrivato il messaggio che Ã¨ pronto il referto ma cosa mi serve per ritirarlo? [ASSISTENTE] Per ritirare il referto, ti servirÃ  il tagliando di promemoria ritiro referto rilasciato al ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 56b885eedbfd75ac74167169719d6d2f classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 1063
   ğŸ“Š Token totali: 1491
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1491 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 1063
   ğŸ“Š Token conversazione finale: 1063
   ğŸ“Š Token totali: 1491
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 3525 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno dovrei richiedere il referto di una TAC del 28 febbraio 2025 sono Pedroli Marisa ma non ho il messaggio con il querrecode sa come posso fare gay [ASSISTENTE] Per richiedere il referto della TAC, puoi accedere al portale [Humanitas con te](https://www.humanitasconte.it). Se non..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 1063
   ğŸ“Š Token totali stimati: 1491
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno dovrei richiedere il referto di una TAC del 28 febbraio 2025 sono Pedroli Marisa ma non ho il messaggio con il querrecode sa come posso fare gay [ASSISTENTE] Per richiedere il referto della TAC, puoi accedere al portale [Humanitas con te](https://www.humanitasconte.it). Se non..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Referti e Cartelle Cliniche",\n  "confiden'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:46.497896
====================================================================================================
ğŸ“‹ Session ID: classify_1756762486
â±ï¸  Processing Time: 2.328s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (3525 chars):
   [UTENTE] Buongiorno dovrei richiedere il referto di una TAC del 28 febbraio 2025 sono Pedroli Marisa ma non ho il messaggio con il querrecode sa come posso fare gay [ASSISTENTE] Per richiedere il r...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (196 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Referti e Cartelle Cliniche",\n  "confiden'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Referti e Cartelle Cliniche",
  "confiden
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Referti e Cartelle Cliniche",
  "confiden
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 2183e6f1d7366f2c050ab6a42db9605e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 274
   ğŸ“Š Token totali: 723
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 723 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 274
   ğŸ“Š Token conversazione finale: 274
   ğŸ“Š Token totali: 723
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 988 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ho bisogno di recuperare il mio ID Huawei [ASSISTENTE] Non posso aiutarti con il recupero dell'ID Huawei, in quanto mi occupo esclusivamente di informazioni relative all'Istituto Clinico Humanitas. [...] it, indicando nome, cognome, codice fiscale e motivo della richiesta di assistenza"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2964 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 274
   ğŸ“Š Token totali stimati: 723
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ho bisogno di recuperare il mio ID Huawei [ASSISTENTE] Non posso aiutarti con il recupero dell'ID Huawei, in quanto mi occupo esclusivamente di informazioni relative all'Istituto Clinico Humanitas. [...] it, indicando nome, cognome, codice fiscale e motivo della richiesta di assistenza"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "altro", "confidence": 0.95, "m'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:48.055583
====================================================================================================
ğŸ“‹ Session ID: classify_1756762488
â±ï¸  Processing Time: 1.471s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (988 chars):
   [UTENTE] ho bisogno di recuperare il mio ID Huawei [ASSISTENTE] Non posso aiutarti con il recupero dell'ID Huawei, in quanto mi occupo esclusivamente di informazioni relative all'Istituto Clinico H...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "altro", "confidence": 0.95, "m'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "altro", "confidence": 0.95, "m
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "altro", "confidence": 0.95, "m
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione a882748da2ffff4ad43859ace0c0b9f5 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 284
   ğŸ“Š Token totali: 732
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 732 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 284
   ğŸ“Š Token conversazione finale: 284
   ğŸ“Š Token totali: 732
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 964 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Sono  Bove Marianna  devo scaricare cartelle cliniche ma quando inserisco il codice id mi dice il dato inserito non Ã¨ corretto, prego ricontrollare. [...]  Se hai bisogno di ulteriore assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2886 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 284
   ğŸ“Š Token totali stimati: 732
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Sono  Bove Marianna  devo scaricare cartelle cliniche ma quando inserisco il codice id mi dice il dato inserito non Ã¨ corretto, prego ricontrollare. [...]  Se hai bisogno di ulteriore assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'accesso alle cartelle cliniche dell'utente, quindi la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.", 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:49.932671
====================================================================================================
ğŸ“‹ Session ID: classify_1756762489
â±ï¸  Processing Time: 1.791s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (964 chars):
   [UTENTE] Sono  Bove Marianna  devo scaricare cartelle cliniche ma quando inserisco il codice id mi dice il dato inserito non Ã¨ corretto, prego ricontrollare. Ma sul promemoria ritiro referti c'Ã¨ il...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (224 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'accesso alle cartelle cliniche dell'utente, quindi la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.", 'predicted_label': 'Referti e Cartelle Cliniche'}

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione verte sull'accesso alle cartelle cliniche dell'utente, quindi la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'accesso alle cartelle cliniche dell'utente, quindi la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 30c484f46b6c199ff78c00181bf8e94e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 180
   ğŸ“Š Token totali: 628
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 628 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 180
   ğŸ“Š Token conversazione finale: 180
   ğŸ“Š Token totali: 628
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 551 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Dove trovare informazioni per la preparazione di un ecoendoscopia pancreas [ASSISTENTE] Puoi trovare le norme di preparazione per l'ecoendoscopia del pancreas al seguente [link](https://www. [...]  ğŸ˜Š"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2876 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 180
   ğŸ“Š Token totali stimati: 628
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Dove trovare informazioni per la preparazione di un ecoendoscopia pancreas [ASSISTENTE] Puoi trovare le norme di preparazione per l'ecoendoscopia del pancreas al seguente [link](https://www. [...]  ğŸ˜Š"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Analisi', 'confidence': 0.6, 'motivation': "La conversazione verte sull'ecoendoscopia del pancreas, che Ã¨ una procedura diagnostica utilizzata per esaminare il pancreas e le vie biliari. Pertant"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:51.810043
====================================================================================================
ğŸ“‹ Session ID: classify_1756762491
â±ï¸  Processing Time: 1.790s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (551 chars):
   [UTENTE] Dove trovare informazioni per la preparazione di un ecoendoscopia pancreas [ASSISTENTE] Puoi trovare le norme di preparazione per l'ecoendoscopia del pancreas al seguente [link](https://ww...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (217 chars):
   {'predicted_label': 'Analisi', 'confidence': 0.6, 'motivation': "La conversazione verte sull'ecoendoscopia del pancreas, che Ã¨ una procedura diagnostica utilizzata per esaminare il pancreas e le vie biliari. Pertant"}

ğŸ“Š Parsed Response:
   predicted_label: Analisi
   confidence: 0.6
   motivation: La conversazione verte sull'ecoendoscopia del pancreas, che Ã¨ una procedura diagnostica utilizzata per esaminare il pancreas e le vie biliari. Pertant
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.600
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 60.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'ecoendoscopia del pancreas, che Ã¨ una procedura diagnostica utilizzata per esaminare il pancreas e le vie biliari. Pertant
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 456b76fc7425eae024c9d6cd0ea227de classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Analisi' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 180
   ğŸ“Š Token totali: 628
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 628 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 180
   ğŸ“Š Token conversazione finale: 180
   ğŸ“Š Token totali: 628
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 604 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Volevo sapere se ci sono delle indicazioni da seguire dopo aver effettuato una PET globale corporea con Gallio [ASSISTENTE] Dopo aver effettuato una PET globale corporea con Gallio, Ã¨ importante evitare stretto contatto con donne in gravidanza, in etÃ  fertile o con minorenni per motivi d..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 180
   ğŸ“Š Token totali stimati: 628
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Volevo sapere se ci sono delle indicazioni da seguire dopo aver effettuato una PET globale corporea con Gallio [ASSISTENTE] Dopo aver effettuato una PET globale corporea con Gallio, Ã¨ importante evitare stretto contatto con donne in gravidanza, in etÃ  fertile o con minorenni per motivi d..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'esecuzione di una PET globale corporea con Gallio e le precauzioni da seguire dopo l'esame.", 'predicted_label': 'Analisi'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:53.611651
====================================================================================================
ğŸ“‹ Session ID: classify_1756762493
â±ï¸  Processing Time: 1.714s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (604 chars):
   [UTENTE] Volevo sapere se ci sono delle indicazioni da seguire dopo aver effettuato una PET globale corporea con Gallio [ASSISTENTE] Dopo aver effettuato una PET globale corporea con Gallio, Ã¨ impo...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (187 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'esecuzione di una PET globale corporea con Gallio e le precauzioni da seguire dopo l'esame.", 'predicted_label': 'Analisi'}

ğŸ“Š Parsed Response:
   predicted_label: Analisi
   confidence: 0.95
   motivation: La conversazione verte sull'esecuzione di una PET globale corporea con Gallio e le precauzioni da seguire dopo l'esame.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'esecuzione di una PET globale corporea con Gallio e le precauzioni da seguire dopo l'esame.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione a57c3464e4de9d602167a02982755d4e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Analisi' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 94
   ğŸ“Š Token totali: 522
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 522 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 94
   ğŸ“Š Token conversazione finale: 94
   ğŸ“Š Token totali: 522
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 321 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Preparazione per coronografia  [ASSISTENTE] Per la preparazione alla coronarografia, Ã¨ necessario eseguire l'esame a digiuno e viene effettuato in regime di ricovero. [...] it/visite-ed-esami/coronarografia)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2812 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 94
   ğŸ“Š Token totali stimati: 522
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Preparazione per coronografia  [ASSISTENTE] Per la preparazione alla coronarografia, Ã¨ necessario eseguire l'esame a digiuno e viene effettuato in regime di ricovero. [...] it/visite-ed-esami/coronarografia)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'analisi', 'confidence': 0.6, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:54.955064
====================================================================================================
ğŸ“‹ Session ID: classify_1756762494
â±ï¸  Processing Time: 1.256s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (321 chars):
   [UTENTE] Preparazione per coronografia  [ASSISTENTE] Per la preparazione alla coronarografia, Ã¨ necessario eseguire l'esame a digiuno e viene effettuato in regime di ricovero. Per ulteriori dettagl...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (99 chars):
   {'predicted_label': 'analisi', 'confidence': 0.6, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: analisi
   confidence: 0.6
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.600
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 60.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione bc2d6f2612e1a90512971155136dcbe1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'analisi' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 196
   ğŸ“Š Token totali: 645
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 645 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 196
   ğŸ“Š Token conversazione finale: 196
   ğŸ“Š Token totali: 645
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 618 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao, cosa devo fare per questo esame che faro domani pomeriggio alla Gavazzeni ,tc coronarica e tc di perfusione miocardica [ASSISTENTE] Per la preparazione alla tomografia computerizzata con mezzo di contrasto e studio per perfusione coronarica con stress farmacologico (adenosina o reg..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 196
   ğŸ“Š Token totali stimati: 645
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao, cosa devo fare per questo esame che faro domani pomeriggio alla Gavazzeni ,tc coronarica e tc di perfusione miocardica [ASSISTENTE] Per la preparazione alla tomografia computerizzata con mezzo di contrasto e studio per perfusione coronarica con stress farmacologico (adenosina o reg..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Analisi', 'confidence': 0.6, 'motivation': '| Etichetta predetta | Confidenza | Motivazione |'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:34:57.805771
====================================================================================================
ğŸ“‹ Session ID: classify_1756762497
â±ï¸  Processing Time: 2.763s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (618 chars):
   [UTENTE] ciao, cosa devo fare per questo esame che faro domani pomeriggio alla Gavazzeni ,tc coronarica e tc di perfusione miocardica [ASSISTENTE] Per la preparazione alla tomografia computerizzata...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (116 chars):
   {'predicted_label': 'Analisi', 'confidence': 0.6, 'motivation': '| Etichetta predetta | Confidenza | Motivazione |'}

ğŸ“Š Parsed Response:
   predicted_label: Analisi
   confidence: 0.6
   motivation: | Etichetta predetta | Confidenza | Motivazione |
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.600
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 60.0%

ğŸ§  Reasoning/Motivation:
   | Etichetta predetta | Confidenza | Motivazione |
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione bfbd0b3ec2d331dc3cd41694613448a9 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Analisi' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 708
   ğŸ“Š Token totali: 1156
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1156 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 708
   ğŸ“Š Token conversazione finale: 708
   ğŸ“Š Token totali: 1156
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2173 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] devo fare la colonscopia mi dici come mi devo preparare ? hai le norme ? [ASSISTENTE] Certamente! Puoi trovare le norme di preparazione alla colonscopia a questo [link](https://www. [...] it)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2868 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 708
   ğŸ“Š Token totali stimati: 1156
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] devo fare la colonscopia mi dici come mi devo preparare ? hai le norme ? [ASSISTENTE] Certamente! Puoi trovare le norme di preparazione alla colonscopia a questo [link](https://www. [...] it)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione inizia con una richiesta di informazioni sulla colonscopia e sulla sua preparazione. Successivamente, l'utente chiede come raggiun"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:01.174593
====================================================================================================
ğŸ“‹ Session ID: classify_1756762501
â±ï¸  Processing Time: 3.282s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2173 chars):
   [UTENTE] devo fare la colonscopia mi dici come mi devo preparare ? hai le norme ? [ASSISTENTE] Certamente! Puoi trovare le norme di preparazione alla colonscopia a questo [link](https://www.humanit...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione inizia con una richiesta di informazioni sulla colonscopia e sulla sua preparazione. Successivamente, l'utente chiede come raggiun"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione inizia con una richiesta di informazioni sulla colonscopia e sulla sua preparazione. Successivamente, l'utente chiede come raggiun
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione inizia con una richiesta di informazioni sulla colonscopia e sulla sua preparazione. Successivamente, l'utente chiede come raggiun
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 425160c10aa9703fa1a86f2db8d76bb1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 206
   ğŸ“Š Token totali: 634
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 634 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 206
   ğŸ“Š Token conversazione finale: 206
   ğŸ“Š Token totali: 634
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 733 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco accedere a referto  [ASSISTENTE] Se non riesci ad accedere al tuo referto, ti consiglio di verificare di aver inserito correttamente l'ID Humanitas con te. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2840 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 206
   ğŸ“Š Token totali stimati: 634
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco accedere a referto  [ASSISTENTE] Se non riesci ad accedere al tuo referto, ti consiglio di verificare di aver inserito correttamente l'ID Humanitas con te. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:02.816962
====================================================================================================
ğŸ“‹ Session ID: classify_1756762502
â±ï¸  Processing Time: 1.556s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (733 chars):
   [UTENTE] Non riesco accedere a referto  [ASSISTENTE] Se non riesci ad accedere al tuo referto, ti consiglio di verificare di aver inserito correttamente l'ID Humanitas con te. L'ID si trova sul tag...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 2855c5afbe98fec42680125ac325b00a classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 399
   ğŸ“Š Token totali: 827
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 827 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 399
   ğŸ“Š Token conversazione finale: 399
   ğŸ“Š Token totali: 827
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1397 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Mia figlia, Giovanna Barberis Canonico, ha fatto una risonanza sabato, il referto avrebbe dovuto essere disponibile oggi dalle 14:45, invece non c'Ã¨ sul sito Humanitas con te. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2854 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 399
   ğŸ“Š Token totali stimati: 827
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Mia figlia, Giovanna Barberis Canonico, ha fatto una risonanza sabato, il referto avrebbe dovuto essere disponibile oggi dalle 14:45, invece non c'Ã¨ sul sito Humanitas con te. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted Label:** Referti e Cartelle Cliniche\n**Confidence:** 0.95\n**Motivation:** La conversazio'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:05.997814
====================================================================================================
ğŸ“‹ Session ID: classify_1756762505
â±ï¸  Processing Time: 3.094s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1397 chars):
   [UTENTE] Mia figlia, Giovanna Barberis Canonico, ha fatto una risonanza sabato, il referto avrebbe dovuto essere disponibile oggi dalle 14:45, invece non c'Ã¨ sul sito Humanitas con te. Come mai? [A...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (193 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted Label:** Referti e Cartelle Cliniche\n**Confidence:** 0.95\n**Motivation:** La conversazio'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **Predicted Label:** Referti e Cartelle Cliniche
**Confidence:** 0.95
**Motivation:** La conversazio
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **Predicted Label:** Referti e Cartelle Cliniche
**Confidence:** 0.95
**Motivation:** La conversazio
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 01d4ce00889d1966b513b08d3190f376 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 392
   ğŸ“Š Token totali: 841
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 841 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 392
   ğŸ“Š Token conversazione finale: 392
   ğŸ“Š Token totali: 841
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1350 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ho effettuato un esame in data 13 giugno l'indicazione era che l'esito sarebbe stato disponibile dal 20 giugno, ma ad oggi 26 giugno ancora non lo vedo nell'area referti, come mai? cosa posso fare? [ASSISTENTE] Se l'esito del tuo esame non Ã¨ ancora visibile nell'area referti, ti consigli..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 392
   ğŸ“Š Token totali stimati: 841
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ho effettuato un esame in data 13 giugno l'indicazione era che l'esito sarebbe stato disponibile dal 20 giugno, ma ad oggi 26 giugno ancora non lo vedo nell'area referti, come mai? cosa posso fare? [ASSISTENTE] Se l'esito del tuo esame non Ã¨ ancora visibile nell'area referti, ti consigli..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **predicted_label:** "Referti e Cartelle Cliniche"\n\n**confidence:** 0.9\n\n**motivation:** La conversa'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:08.679559
====================================================================================================
ğŸ“‹ Session ID: classify_1756762508
â±ï¸  Processing Time: 2.595s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1350 chars):
   [UTENTE] ho effettuato un esame in data 13 giugno l'indicazione era che l'esito sarebbe stato disponibile dal 20 giugno, ma ad oggi 26 giugno ancora non lo vedo nell'area referti, come mai? cosa po...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (195 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **predicted_label:** "Referti e Cartelle Cliniche"\n\n**confidence:** 0.9\n\n**motivation:** La conversa'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **predicted_label:** "Referti e Cartelle Cliniche"

**confidence:** 0.9

**motivation:** La conversa
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **predicted_label:** "Referti e Cartelle Cliniche"

**confidence:** 0.9

**motivation:** La conversa
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 8ed6d94314fdd444c42eec7d2ad901bc classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 454
   ğŸ’¬ Token conversazione: 289
   ğŸ“Š Token totali: 743
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 743 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione originale: 289
   ğŸ“Š Token conversazione finale: 289
   ğŸ“Š Token totali: 743
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1056 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco a visualizzare e scaricare una densitometria fatta il 20 agosto 2025 [ASSISTENTE] Per aiutarti con il problema della visualizzazione o del download del referto della densitometria, ti consiglio di verificare quanto segue:

1. Assicurati di essere registrato a [Humanitas con te..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2999 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione: 289
   ğŸ“Š Token totali stimati: 743
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco a visualizzare e scaricare una densitometria fatta il 20 agosto 2025 [ASSISTENTE] Per aiutarti con il problema della visualizzazione o del download del referto della densitometria, ti consiglio di verificare quanto segue:

1. Assicurati di essere registrato a [Humanitas con te..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:10.436579
====================================================================================================
ğŸ“‹ Session ID: classify_1756762510
â±ï¸  Processing Time: 1.671s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1056 chars):
   [UTENTE] Non riesco a visualizzare e scaricare una densitometria fatta il 20 agosto 2025 [ASSISTENTE] Per aiutarti con il problema della visualizzazione o del download del referto della densitometr...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 8ce797961bf23e374065f5fe28874df2 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 454
   ğŸ’¬ Token conversazione: 933
   ğŸ“Š Token totali: 1387
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1387 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione originale: 933
   ğŸ“Š Token conversazione finale: 933
   ğŸ“Š Token totali: 1387
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 3220 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Devo scaricare degli esami di mio papÃ  e devo registrarlo inserisco il codice fiscale ma me lo dÃ  errato l'ho ripetuto piÃ¹ volte ma il codice fiscale corretto solo che mi dice che non va bene [ASSISTENTE] Se il codice fiscale Ã¨ corretto ma il sistema lo segnala come errato, ti consiglio ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2999 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione: 933
   ğŸ“Š Token totali stimati: 1387
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Devo scaricare degli esami di mio papÃ  e devo registrarlo inserisco il codice fiscale ma me lo dÃ  errato l'ho ripetuto piÃ¹ volte ma il codice fiscale corretto solo che mi dice che non va bene [ASSISTENTE] Se il codice fiscale Ã¨ corretto ma il sistema lo segnala come errato, ti consiglio ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted label:** "Humanitas con te - Registrazione"\n\n**Confidence:** 0.9\n\n**Motivation:** La con'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:12.809207
====================================================================================================
ğŸ“‹ Session ID: classify_1756762512
â±ï¸  Processing Time: 2.286s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (3220 chars):
   [UTENTE] Devo scaricare degli esami di mio papÃ  e devo registrarlo inserisco il codice fiscale ma me lo dÃ  errato l'ho ripetuto piÃ¹ volte ma il codice fiscale corretto solo che mi dice che non va b...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (195 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted label:** "Humanitas con te - Registrazione"\n\n**Confidence:** 0.9\n\n**Motivation:** La con'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **Predicted label:** "Humanitas con te - Registrazione"

**Confidence:** 0.9

**Motivation:** La con
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **Predicted label:** "Humanitas con te - Registrazione"

**Confidence:** 0.9

**Motivation:** La con
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 5d95d7da569066146e63e9e1aebdf076 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 156
   ğŸ“Š Token totali: 584
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 584 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 156
   ğŸ“Š Token conversazione finale: 156
   ğŸ“Š Token totali: 584
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 536 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei consultare i miei referti  [ASSISTENTE] Per consultare i tuoi referti, devi essere registrato a [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2813 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 156
   ğŸ“Š Token totali stimati: 584
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei consultare i miei referti  [ASSISTENTE] Per consultare i tuoi referti, devi essere registrato a [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:14.572731
====================================================================================================
ğŸ“‹ Session ID: classify_1756762514
â±ï¸  Processing Time: 1.677s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (536 chars):
   [UTENTE] Vorrei consultare i miei referti  [ASSISTENTE] Per consultare i tuoi referti, devi essere registrato a [Humanitas con te](https://www.humanitasconte.it). Anche se hai giÃ  un ID, Ã¨ necessar...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f1f67d4e23f29f7ae6a0fe42d3d427a8 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 388
   ğŸ“Š Token totali: 816
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 816 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 388
   ğŸ“Š Token conversazione finale: 388
   ğŸ“Š Token totali: 816
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1330 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno mi Ã¨ arrivata una mail con l'invito a leggere un allegato con la procedura comunicazionr sicura ma non riesco ad [ASSISTENTE] Potresti caricare l'allegato o fornirmi maggiori dettagli sulla procedura che stai cercando di seguire? CosÃ¬ posso aiutarti meglio! [UTENTE] Aprire l'a..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 388
   ğŸ“Š Token totali stimati: 816
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno mi Ã¨ arrivata una mail con l'invito a leggere un allegato con la procedura comunicazionr sicura ma non riesco ad [ASSISTENTE] Potresti caricare l'allegato o fornirmi maggiori dettagli sulla procedura che stai cercando di seguire? CosÃ¬ posso aiutarti meglio! [UTENTE] Aprire l'a..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.85, 'motivation': "La conversazione verte sull'accesso a un allegato inviato via email e sulle difficoltÃ  riscontrate dall'utente nel farlo. L'assistenza fornita riguarda la procedura da seguire per risolvere il problema, pertanto la categoria 'Servizi aziendali' Ã¨ appropriata.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:17.002164
====================================================================================================
ğŸ“‹ Session ID: classify_1756762517
â±ï¸  Processing Time: 2.343s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1330 chars):
   [UTENTE] Buongiorno mi Ã¨ arrivata una mail con l'invito a leggere un allegato con la procedura comunicazionr sicura ma non riesco ad [ASSISTENTE] Potresti caricare l'allegato o fornirmi maggiori de...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (337 chars):
   {'confidence': 0.85, 'motivation': "La conversazione verte sull'accesso a un allegato inviato via email e sulle difficoltÃ  riscontrate dall'utente nel farlo. L'assistenza fornita riguarda la procedura da seguire per risolvere il problema, pertanto la categoria 'Servizi aziendali' Ã¨ appropriata.",...

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.85
   motivation: La conversazione verte sull'accesso a un allegato inviato via email e sulle difficoltÃ  riscontrate dall'utente nel farlo. L'assistenza fornita riguarda la procedura da seguire per risolvere il problema, pertanto la categoria 'Servizi aziendali' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.850
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] 85.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'accesso a un allegato inviato via email e sulle difficoltÃ  riscontrate dall'utente nel farlo. L'assistenza fornita riguarda la procedura da seguire per risolvere il problema, pertanto la categoria 'Servizi aziendali' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione a9b321cacf305ffba61b3650fa1af275 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 231
   ğŸ“Š Token totali: 679
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 679 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 231
   ğŸ“Š Token conversazione finale: 231
   ğŸ“Š Token totali: 679
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 787 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Sto aspettando che qualcuno mi contatti con URGENZA per poter scaricare gli esami di laboratorio fatti a Torino in Humaniyas Cellini pet Luciana Sanna e Leandro Difino. [...]  Sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2875 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 231
   ğŸ“Š Token totali stimati: 679
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Sto aspettando che qualcuno mi contatti con URGENZA per poter scaricare gli esami di laboratorio fatti a Torino in Humaniyas Cellini pet Luciana Sanna e Leandro Difino. [...]  Sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla necessitÃ  dell'utente di scaricare gli esami di laboratorio effettuati a Torino presso Humanitas Cellin"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:20.073311
====================================================================================================
ğŸ“‹ Session ID: classify_1756762520
â±ï¸  Processing Time: 2.985s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (787 chars):
   [UTENTE] Sto aspettando che qualcuno mi contatti con URGENZA per poter scaricare gli esami di laboratorio fatti a Torino in Humaniyas Cellini pet Luciana Sanna e Leandro Difino. Sono urgentissimo e...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla necessitÃ  dell'utente di scaricare gli esami di laboratorio effettuati a Torino presso Humanitas Cellin"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte principalmente sulla necessitÃ  dell'utente di scaricare gli esami di laboratorio effettuati a Torino presso Humanitas Cellin
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte principalmente sulla necessitÃ  dell'utente di scaricare gli esami di laboratorio effettuati a Torino presso Humanitas Cellin
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione b181d34c1ef8d2595682031297f829e2 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 121
   ğŸ“Š Token totali: 569
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 569 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 121
   ğŸ“Š Token conversazione finale: 121
   ğŸ“Š Token totali: 569
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 410 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Giulia, avrei bisogno della copia della cartella clinica di mia figlia minorenne  [ASSISTENTE] Per richiedere la copia della cartella clinica di un minore, Ã¨ necessario seguire una procedura specifica. [...]  

Se hai bisogno di ulteriori dettagli o assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2952 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 121
   ğŸ“Š Token totali stimati: 569
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Giulia, avrei bisogno della copia della cartella clinica di mia figlia minorenne  [ASSISTENTE] Per richiedere la copia della cartella clinica di un minore, Ã¨ necessario seguire una procedura specifica. [...]  

Se hai bisogno di ulteriori dettagli o assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:21.502105
====================================================================================================
ğŸ“‹ Session ID: classify_1756762521
â±ï¸  Processing Time: 1.343s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (410 chars):
   [UTENTE] Giulia, avrei bisogno della copia della cartella clinica di mia figlia minorenne  [ASSISTENTE] Per richiedere la copia della cartella clinica di un minore, Ã¨ necessario seguire una procedu...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione eb7bb108299d8cc701def26ef7d7e7c3 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 357
   ğŸ“Š Token totali: 805
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 805 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 357
   ğŸ“Š Token conversazione finale: 357
   ğŸ“Š Token totali: 805
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1266 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] come si sporge un reclamo? [ASSISTENTE] Puoi sporgere un reclamo o inviare una segnalazione tramite il form dedicato disponibile alla pagina [Invia un ticket](https://urp. [...]  Se c'Ã¨ qualcosa di specifico su cui posso esserti utile, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2926 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 357
   ğŸ“Š Token totali stimati: 805
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] come si sporge un reclamo? [ASSISTENTE] Puoi sporgere un reclamo o inviare una segnalazione tramite il form dedicato disponibile alla pagina [Invia un ticket](https://urp. [...]  Se c'Ã¨ qualcosa di specifico su cui posso esserti utile, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla difficoltÃ  dell'utente nel comunicare con un medico dopo il ricovero del padre in pronto soccorso e sul"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:24.631130
====================================================================================================
ğŸ“‹ Session ID: classify_1756762524
â±ï¸  Processing Time: 3.042s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1266 chars):
   [UTENTE] come si sporge un reclamo? [ASSISTENTE] Puoi sporgere un reclamo o inviare una segnalazione tramite il form dedicato disponibile alla pagina [Invia un ticket](https://urp.humanitas.it/supp...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla difficoltÃ  dell'utente nel comunicare con un medico dopo il ricovero del padre in pronto soccorso e sul"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte principalmente sulla difficoltÃ  dell'utente nel comunicare con un medico dopo il ricovero del padre in pronto soccorso e sul
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte principalmente sulla difficoltÃ  dell'utente nel comunicare con un medico dopo il ricovero del padre in pronto soccorso e sul
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione b4c4f5abcaed61e24734d8cfe00e2476 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 268
   ğŸ“Š Token totali: 717
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 717 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 268
   ğŸ“Š Token conversazione finale: 268
   ğŸ“Š Token totali: 717
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 778 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] devo prenotare in humanitas con ssn. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2743 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 268
   ğŸ“Š Token totali stimati: 717
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] devo prenotare in humanitas con ssn. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:26.189437
====================================================================================================
ğŸ“‹ Session ID: classify_1756762526
â±ï¸  Processing Time: 1.473s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (778 chars):
   [UTENTE] devo prenotare in humanitas con ssn. come faccio ? [ASSISTENTE] Per prenotare una visita o un esame tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas, puoi utilizzare i seguen...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 63b8ba66590a4a7f6ed84eca098e07b6 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 209
   ğŸ“Š Token totali: 637
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 637 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 209
   ğŸ“Š Token conversazione finale: 209
   ğŸ“Š Token totali: 637
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 595 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] quali sedi ci sono in provincia di varese? [ASSISTENTE] In provincia di Varese, le sedi Humanitas sono:

1. [...] 

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2785 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 209
   ğŸ“Š Token totali stimati: 637
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] quali sedi ci sono in provincia di varese? [ASSISTENTE] In provincia di Varese, le sedi Humanitas sono:

1. [...] 

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:27.927967
====================================================================================================
ğŸ“‹ Session ID: classify_1756762527
â±ï¸  Processing Time: 1.652s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (595 chars):
   [UTENTE] quali sedi ci sono in provincia di varese? [ASSISTENTE] In provincia di Varese, le sedi Humanitas sono:

1. **Humanitas Mater Domini**:
   - Edificio 1: Via Gerenzano, 2, 21053 - Castellan...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [76 more lines] ...
     Line 80: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (97 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione ce24377acf6fc9177cfdd50a49b26534 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 311
   ğŸ“Š Token totali: 759
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 759 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 311
   ğŸ“Š Token conversazione finale: 311
   ğŸ“Š Token totali: 759
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 945 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buonasera, avrei bisogno di sapere per mia mamma se possibile fare una RM addome sup senza e con MDC per gennaio, in convenzione ssn grazie  [ASSISTENTE] Per prenotare una Risonanza Magnetica (RM) dell'addome superiore senza e con mezzo di contrasto (MDC) in convenzione con il Servizio S..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 311
   ğŸ“Š Token totali stimati: 759
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buonasera, avrei bisogno di sapere per mia mamma se possibile fare una RM addome sup senza e con MDC per gennaio, in convenzione ssn grazie  [ASSISTENTE] Per prenotare una Risonanza Magnetica (RM) dell'addome superiore senza e con mezzo di contrasto (MDC) in convenzione con il Servizio S..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di una Risonanza Magnetica (RM) dell'addome superiore senza e con mezzo di contrasto (MDC).", 'predicted_label': 'Risonanza magnetica'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:29.776496
====================================================================================================
ğŸ“‹ Session ID: classify_1756762529
â±ï¸  Processing Time: 1.762s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (945 chars):
   [UTENTE] Buonasera, avrei bisogno di sapere per mia mamma se possibile fare una RM addome sup senza e con MDC per gennaio, in convenzione ssn grazie  [ASSISTENTE] Per prenotare una Risonanza Magnet...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (213 chars):
   {'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di una Risonanza Magnetica (RM) dell'addome superiore senza e con mezzo di contrasto (MDC).", 'predicted_label': 'Risonanza magnetica'}

ğŸ“Š Parsed Response:
   predicted_label: Risonanza magnetica
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di una Risonanza Magnetica (RM) dell'addome superiore senza e con mezzo di contrasto (MDC).
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la prenotazione di una Risonanza Magnetica (RM) dell'addome superiore senza e con mezzo di contrasto (MDC).
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione bbb1c7813f4e90e6e11f1d5eff4d5134 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Risonanza magnetica' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 124
   ğŸ“Š Token totali: 573
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 573 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 124
   ğŸ“Š Token conversazione finale: 124
   ğŸ“Š Token totali: 573
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 434 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ã¨ possibile eseguire una visita dermatologica in ssn a Castellanza? [ASSISTENTE] SÃ¬, Ã¨ possibile eseguire una visita dermatologica tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater Domini a Castellanza. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2928 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 124
   ğŸ“Š Token totali stimati: 573
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ã¨ possibile eseguire una visita dermatologica in ssn a Castellanza? [ASSISTENTE] SÃ¬, Ã¨ possibile eseguire una visita dermatologica tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater Domini a Castellanza. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': '** La conversazione verte sulla possibilitÃ  di eseguire una visita dermatologica tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater '}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:32.208134
====================================================================================================
ğŸ“‹ Session ID: classify_1756762532
â±ï¸  Processing Time: 2.345s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (434 chars):
   [UTENTE] Ã¨ possibile eseguire una visita dermatologica in ssn a Castellanza? [ASSISTENTE] SÃ¬, Ã¨ possibile eseguire una visita dermatologica tramite il Servizio Sanitario Nazionale (SSN) presso Huma...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': '** La conversazione verte sulla possibilitÃ  di eseguire una visita dermatologica tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater '}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte sulla possibilitÃ  di eseguire una visita dermatologica tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte sulla possibilitÃ  di eseguire una visita dermatologica tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f6c1bb7b058236e910a55c2b844602f7 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 1502
   ğŸ“Š Token totali: 1950
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1950 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 1502
   ğŸ“Š Token conversazione finale: 1502
   ğŸ“Š Token totali: 1950
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 4728 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao giulia [ASSISTENTE] Ciao! Come posso esserti utile oggi? ğŸ˜Š [UTENTE] vorrei prenotare una colonscopia ma l'attesa telefonica Ã¨ troppo lunga e non ci sono posti [ASSISTENTE] Capisco la tua situazione. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2903 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 1502
   ğŸ“Š Token totali stimati: 1950
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao giulia [ASSISTENTE] Ciao! Come posso esserti utile oggi? ğŸ˜Š [UTENTE] vorrei prenotare una colonscopia ma l'attesa telefonica Ã¨ troppo lunga e non ci sono posti [ASSISTENTE] Capisco la tua situazione. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: La conversazione Ã¨ incentrata principalmente sulla prenotazione di visite mediche e la ricerca di in'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:35.096774
====================================================================================================
ğŸ“‹ Session ID: classify_1756762535
â±ï¸  Processing Time: 2.801s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (4728 chars):
   [UTENTE] ciao giulia [ASSISTENTE] Ciao! Come posso esserti utile oggi? ğŸ˜Š [UTENTE] vorrei prenotare una colonscopia ma l'attesa telefonica Ã¨ troppo lunga e non ci sono posti [ASSISTENTE] Capisco la ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: La conversazione Ã¨ incentrata principalmente sulla prenotazione di visite mediche e la ricerca di in'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: La conversazione Ã¨ incentrata principalmente sulla prenotazione di visite mediche e la ricerca di in
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: La conversazione Ã¨ incentrata principalmente sulla prenotazione di visite mediche e la ricerca di in
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 09aba1b9dc0e9ed3da7fd4b2a21b7ffa classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 247
   ğŸ“Š Token totali: 695
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 695 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 247
   ğŸ“Š Token conversazione finale: 247
   ğŸ“Š Token totali: 695
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 844 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ritiro referti  [ASSISTENTE] Puoi dirmi di quale tipo di referto hai bisogno? Ad esempio, se si tratta di un test HIV, esami istologici, citologici, tamponi, esami genetici o altro. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2932 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 247
   ğŸ“Š Token totali stimati: 695
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ritiro referti  [ASSISTENTE] Puoi dirmi di quale tipo di referto hai bisogno? Ad esempio, se si tratta di un test HIV, esami istologici, citologici, tamponi, esami genetici o altro. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "La conversazione ruota attorno al ritiro dei referti medici. L'assistente fornisce informazioni su come ottenere i risultati degli esami del sangue tr"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:37.157954
====================================================================================================
ğŸ“‹ Session ID: classify_1756762537
â±ï¸  Processing Time: 1.975s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (844 chars):
   [UTENTE] Ritiro referti  [ASSISTENTE] Puoi dirmi di quale tipo di referto hai bisogno? Ad esempio, se si tratta di un test HIV, esami istologici, citologici, tamponi, esami genetici o altro. Alcuni...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "La conversazione ruota attorno al ritiro dei referti medici. L'assistente fornisce informazioni su come ottenere i risultati degli esami del sangue tr"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: La conversazione ruota attorno al ritiro dei referti medici. L'assistente fornisce informazioni su come ottenere i risultati degli esami del sangue tr
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   La conversazione ruota attorno al ritiro dei referti medici. L'assistente fornisce informazioni su come ottenere i risultati degli esami del sangue tr
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 38d48d19ed827556b8fcd1a993130d22 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 877
   ğŸ“Š Token totali: 1325
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1325 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 877
   ğŸ“Š Token conversazione finale: 877
   ğŸ“Š Token totali: 1325
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2780 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno

vorrei maggiori informazioni riguardo delle analisi fecali. [...]  Se hai bisogno di altro, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2803 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 877
   ğŸ“Š Token totali stimati: 1325
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno

vorrei maggiori informazioni riguardo delle analisi fecali. [...]  Se hai bisogno di altro, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: #### Classificazione conversazione\n\nLa conversazione fornisce informazioni su diverse analisi medich'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:40.590432
====================================================================================================
ğŸ“‹ Session ID: classify_1756762540
â±ï¸  Processing Time: 3.347s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2780 chars):
   [UTENTE] Buongiorno

vorrei maggiori informazioni riguardo delle analisi fecali.

In particolare, vorrei sapere se fate le seguenti analisi:
- Test metagenomico per lo studio funzionale
- Sequenzia...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (193 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: #### Classificazione conversazione\n\nLa conversazione fornisce informazioni su diverse analisi medich'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: #### Classificazione conversazione

La conversazione fornisce informazioni su diverse analisi medich
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: #### Classificazione conversazione

La conversazione fornisce informazioni su diverse analisi medich
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 93c2d6a612b1a6243ede6b4886b609ca classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 440
   ğŸ“Š Token totali: 888
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 888 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 440
   ğŸ“Š Token conversazione finale: 440
   ğŸ“Š Token totali: 888
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1584 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao, mi chiamo Ditjon, sonno dal Albania, ho un problema che dopo gli esami che ho fatto mi hanno detto hai, prostatite chrono non bacteriale, penso che le cause, perche non ho nessune bacterie in urina, in spermocultura, in af genital, e in swab test,le cause sonno, per prima Ibs soffr..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 440
   ğŸ“Š Token totali stimati: 888
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao, mi chiamo Ditjon, sonno dal Albania, ho un problema che dopo gli esami che ho fatto mi hanno detto hai, prostatite chrono non bacteriale, penso che le cause, perche non ho nessune bacterie in urina, in spermocultura, in af genital, e in swab test,le cause sonno, per prima Ibs soffr..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte principalmente sulla necessitÃ  dell'utente di prenotare una visita con un medico specializzato in chronic pelvic pain e sui costi associati.", 'predicted_label': 'Visita Specialistica'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:42.485154
====================================================================================================
ğŸ“‹ Session ID: classify_1756762542
â±ï¸  Processing Time: 1.808s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1584 chars):
   [UTENTE] Ciao, mi chiamo Ditjon, sonno dal Albania, ho un problema che dopo gli esami che ho fatto mi hanno detto hai, prostatite chrono non bacteriale, penso che le cause, perche non ho nessune ba...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (244 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte principalmente sulla necessitÃ  dell'utente di prenotare una visita con un medico specializzato in chronic pelvic pain e sui costi associati.", 'predicted_label': 'Visita Specialistica'}

ğŸ“Š Parsed Response:
   predicted_label: Visita Specialistica
   confidence: 0.95
   motivation: La conversazione verte principalmente sulla necessitÃ  dell'utente di prenotare una visita con un medico specializzato in chronic pelvic pain e sui costi associati.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte principalmente sulla necessitÃ  dell'utente di prenotare una visita con un medico specializzato in chronic pelvic pain e sui costi associati.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 4023e96926f73d35c8803f2cba09ed7e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Visita Specialistica' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 49
   ğŸ“Š Token totali: 477
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 477 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 49
   ğŸ“Š Token conversazione finale: 49
   ğŸ“Š Token totali: 477
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 155 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Risultato? [ASSISTENTE] Potresti specificare meglio la tua richiesta? Intendi il risultato di un esame, un referto o altro? Sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2751 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 49
   ğŸ“Š Token totali stimati: 477
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Risultato? [ASSISTENTE] Potresti specificare meglio la tua richiesta? Intendi il risultato di un esame, un referto o altro? Sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.85, 'motivation': "L'utente chiede informazioni sul risultato di un esame o referto.", 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:43.921437
====================================================================================================
ğŸ“‹ Session ID: classify_1756762543
â±ï¸  Processing Time: 1.350s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (155 chars):
   [UTENTE] Risultato? [ASSISTENTE] Potresti specificare meglio la tua richiesta? Intendi il risultato di un esame, un referto o altro? Sono qui per aiutarti!

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (153 chars):
   {'confidence': 0.85, 'motivation': "L'utente chiede informazioni sul risultato di un esame o referto.", 'predicted_label': 'Referti e Cartelle Cliniche'}

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.85
   motivation: L'utente chiede informazioni sul risultato di un esame o referto.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.850
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] 85.0%

ğŸ§  Reasoning/Motivation:
   L'utente chiede informazioni sul risultato di un esame o referto.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 013ac967909ceef03b67cb47b23121ed classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 303
   ğŸ“Š Token totali: 751
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 751 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 303
   ğŸ“Š Token conversazione finale: 303
   ğŸ“Š Token totali: 751
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1011 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] Sono la Sig. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2837 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 303
   ğŸ“Š Token totali stimati: 751
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] Sono la Sig. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Referti e Cartelle Cliniche",\n  "confiden'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:45.750934
====================================================================================================
ğŸ“‹ Session ID: classify_1756762545
â±ï¸  Processing Time: 1.743s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1011 chars):
   [UTENTE] Buongiorno, [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] Sono la Sig.ra Mazzucco Gabriella, io ho fatto una colonscopia il 15.04.2025 con esame istologico. Mi avevano d...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (196 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Referti e Cartelle Cliniche",\n  "confiden'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Referti e Cartelle Cliniche",
  "confiden
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Referti e Cartelle Cliniche",
  "confiden
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione be215c590f7919675c95444e504dceec classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 452
   ğŸ’¬ Token conversazione: 305
   ğŸ“Š Token totali: 757
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 757 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 452
   ğŸ“Š Token conversazione originale: 305
   ğŸ“Š Token conversazione finale: 305
   ğŸ“Š Token totali: 757
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1026 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco a registrarmi. [...] it**, indicando:
   - Nome e cognome
   - Codice fiscale
   - Motivo della richiesta di assistenza

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2884 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 452
   ğŸ“Š Token conversazione: 305
   ğŸ“Š Token totali stimati: 757
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco a registrarmi. [...] it**, indicando:
   - Nome e cognome
   - Codice fiscale
   - Motivo della richiesta di assistenza

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Humanitas con te - Registrazio'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:47.612590
====================================================================================================
ğŸ“‹ Session ID: classify_1756762547
â±ï¸  Processing Time: 1.775s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1026 chars):
   [UTENTE] Non riesco a registrarmi. [ASSISTENTE] Mi dispiace che stai riscontrando difficoltÃ  con la registrazione. Potresti dirmi se stai cercando di registrarti su [Humanitas con te](https://www.h...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [78 more lines] ...
     Line 82: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Humanitas con te - Registrazio'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Humanitas con te - Registrazio
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Humanitas con te - Registrazio
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f7ce3b3a0e99caab64801ccea299f6d7 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 454
   ğŸ’¬ Token conversazione: 443
   ğŸ“Š Token totali: 897
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 897 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione originale: 443
   ğŸ“Š Token conversazione finale: 443
   ğŸ“Š Token totali: 897
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1567 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco ad accedere al sito [ASSISTENTE] Se hai problemi ad accedere al sito di Humanitas o al portale [Humanitas con te](https://www. [...]  Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2913 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione: 443
   ğŸ“Š Token totali stimati: 897
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco ad accedere al sito [ASSISTENTE] Se hai problemi ad accedere al sito di Humanitas o al portale [Humanitas con te](https://www. [...]  Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'accesso al sito di Humanitas e sui problemi riscontrati dall'utente nell'inserire il proprio codice fiscale. Entrambi questi argomenti rientrano nella categoria dei servizi aziendali.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:49.857598
====================================================================================================
ğŸ“‹ Session ID: classify_1756762549
â±ï¸  Processing Time: 2.158s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1567 chars):
   [UTENTE] Non riesco ad accedere al sito [ASSISTENTE] Se hai problemi ad accedere al sito di Humanitas o al portale [Humanitas con te](https://www.humanitasconte.it), ti consiglio di verificare quan...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (289 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'accesso al sito di Humanitas e sui problemi riscontrati dall'utente nell'inserire il proprio codice fiscale. Entrambi questi argomenti rientrano nella categoria dei servizi aziendali.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.95
   motivation: La conversazione verte sull'accesso al sito di Humanitas e sui problemi riscontrati dall'utente nell'inserire il proprio codice fiscale. Entrambi questi argomenti rientrano nella categoria dei servizi aziendali.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'accesso al sito di Humanitas e sui problemi riscontrati dall'utente nell'inserire il proprio codice fiscale. Entrambi questi argomenti rientrano nella categoria dei servizi aziendali.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 05f4db5cb60513aff2eeaf88a25ad272 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 210
   ğŸ“Š Token totali: 658
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 658 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 210
   ğŸ“Š Token conversazione finale: 210
   ğŸ“Š Token totali: 658
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 731 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Inserire numero impegnative con giÃ  appuntamento  [ASSISTENTE] Potresti chiarire meglio la tua richiesta? Intendi dire che desideri sapere come inserire il numero di un'impegnativa per un appuntamento giÃ  prenotato? [UTENTE] Si [ASSISTENTE] Per inserire il numero di un'impegnativa per un..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 210
   ğŸ“Š Token totali stimati: 658
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Inserire numero impegnative con giÃ  appuntamento  [ASSISTENTE] Potresti chiarire meglio la tua richiesta? Intendi dire che desideri sapere come inserire il numero di un'impegnativa per un appuntamento giÃ  prenotato? [UTENTE] Si [ASSISTENTE] Per inserire il numero di un'impegnativa per un..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Humanitas con te - Registrazio'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:51.837958
====================================================================================================
ğŸ“‹ Session ID: classify_1756762551
â±ï¸  Processing Time: 1.894s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (731 chars):
   [UTENTE] Inserire numero impegnative con giÃ  appuntamento  [ASSISTENTE] Potresti chiarire meglio la tua richiesta? Intendi dire che desideri sapere come inserire il numero di un'impegnativa per un ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Humanitas con te - Registrazio'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Humanitas con te - Registrazio
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Humanitas con te - Registrazio
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 102ed97e47a18b14f6fa41fea25b8482 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 454
   ğŸ’¬ Token conversazione: 259
   ğŸ“Š Token totali: 713
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 713 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione originale: 259
   ğŸ“Š Token conversazione finale: 259
   ğŸ“Š Token totali: 713
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 954 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, non riesco a completare la registrazione a nome di Chorna Valentina ( mi dice che Ã¨ giÃ  registrata. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2888 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione: 259
   ğŸ“Š Token totali stimati: 713
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, non riesco a completare la registrazione a nome di Chorna Valentina ( mi dice che Ã¨ giÃ  registrata. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'assistenza per la registrazione su Humanitas con te, quindi la categoria 'Humanitas con te - Registrazione' Ã¨ appropriata.", 'predicted_label': 'Humanitas con te - Registrazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:53.670826
====================================================================================================
ğŸ“‹ Session ID: classify_1756762553
â±ï¸  Processing Time: 1.745s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (954 chars):
   [UTENTE] Buongiorno, non riesco a completare la registrazione a nome di Chorna Valentina ( mi dice che Ã¨ giÃ  registrata...come posso modificare? [ASSISTENTE] Se il sistema segnala che il nome Ã¨ giÃ ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (243 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'assistenza per la registrazione su Humanitas con te, quindi la categoria 'Humanitas con te - Registrazione' Ã¨ appropriata.", 'predicted_label': 'Humanitas con te - Registrazione'}

ğŸ“Š Parsed Response:
   predicted_label: Humanitas con te - Registrazione
   confidence: 0.95
   motivation: La conversazione verte sull'assistenza per la registrazione su Humanitas con te, quindi la categoria 'Humanitas con te - Registrazione' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'assistenza per la registrazione su Humanitas con te, quindi la categoria 'Humanitas con te - Registrazione' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 14e3c62b334211a16f2051ecfc1e5606 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Humanitas con te - Registrazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 513
   ğŸ“Š Token totali: 961
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 961 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 513
   ğŸ“Š Token conversazione finale: 513
   ğŸ“Š Token totali: 961
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1694 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Devo fare prelievo di sangue presso Humanitas Via Sardegna. [...] it/info/esami-di-laboratorio/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2773 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 513
   ğŸ“Š Token totali stimati: 961
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Devo fare prelievo di sangue presso Humanitas Via Sardegna. [...] it/info/esami-di-laboratorio/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': 'La conversazione verte principalmente sulla necessitÃ  di prenotare per un prelievo di sangue presso Humanitas Via Sardegna, anche in caso di gravidanza.', 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:55.616958
====================================================================================================
ğŸ“‹ Session ID: classify_1756762555
â±ï¸  Processing Time: 1.860s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1694 chars):
   [UTENTE] Devo fare prelievo di sangue presso Humanitas Via Sardegna. Sono incinta, devo prenotare? [ASSISTENTE] SÃ¬, Ã¨ necessario prenotare per effettuare un prelievo di sangue presso Humanitas. Puo...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (225 chars):
   {'confidence': 0.95, 'motivation': 'La conversazione verte principalmente sulla necessitÃ  di prenotare per un prelievo di sangue presso Humanitas Via Sardegna, anche in caso di gravidanza.', 'predicted_label': 'Prenotazione'}

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.95
   motivation: La conversazione verte principalmente sulla necessitÃ  di prenotare per un prelievo di sangue presso Humanitas Via Sardegna, anche in caso di gravidanza.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte principalmente sulla necessitÃ  di prenotare per un prelievo di sangue presso Humanitas Via Sardegna, anche in caso di gravidanza.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 9926c3158b56418fa03c6daa26a86879 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 186
   ğŸ“Š Token totali: 635
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 635 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 186
   ğŸ“Š Token conversazione finale: 186
   ğŸ“Š Token totali: 635
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 567 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Il punto prelievi di viale sardegna Ã¨ aperto in estate?  [ASSISTENTE] Il punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele, Ã¨ aperto durante l'estate con i seguenti orari: da lunedÃ¬ a venerdÃ¬ dalle 7:00 alle 13:00. [...] it/info/esami-di-laboratorio/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2942 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 186
   ğŸ“Š Token totali stimati: 635
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Il punto prelievi di viale sardegna Ã¨ aperto in estate?  [ASSISTENTE] Il punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele, Ã¨ aperto durante l'estate con i seguenti orari: da lunedÃ¬ a venerdÃ¬ dalle 7:00 alle 13:00. [...] it/info/esami-di-laboratorio/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:57.452981
====================================================================================================
ğŸ“‹ Session ID: classify_1756762557
â±ï¸  Processing Time: 1.749s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (567 chars):
   [UTENTE] Il punto prelievi di viale sardegna Ã¨ aperto in estate?  [ASSISTENTE] Il punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele, Ã¨ aperto durante l'estate con i seguenti orari: da ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 596f9d96544cccbb7a427fd69ce4fc0f classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 474
   ğŸ“Š Token totali: 922
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 922 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 474
   ğŸ“Š Token conversazione finale: 474
   ğŸ“Š Token totali: 922
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1553 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei sapere se sabato 30 settembre 2025 Ã¨ possibile fare gli esami del sangue Humanitas fiordaliso? [ASSISTENTE] Presso Humanitas Medical Care Rozzano-Fiordaliso, il sabato Ã¨ possibile effettuare prelievi del sangue dalle 7:30 alle 10:00 solo su prenotazione, e dalle 10:00 alle 11:00 c..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 474
   ğŸ“Š Token totali stimati: 922
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei sapere se sabato 30 settembre 2025 Ã¨ possibile fare gli esami del sangue Humanitas fiordaliso? [ASSISTENTE] Presso Humanitas Medical Care Rozzano-Fiordaliso, il sabato Ã¨ possibile effettuare prelievi del sangue dalle 7:30 alle 10:00 solo su prenotazione, e dalle 10:00 alle 11:00 c..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': 'La conversazione verte principalmente sulla prenotazione per gli esami del sangue e sulle modalitÃ  di accesso per persone con invaliditÃ .', 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:35:59.276169
====================================================================================================
ğŸ“‹ Session ID: classify_1756762559
â±ï¸  Processing Time: 1.736s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1553 chars):
   [UTENTE] Vorrei sapere se sabato 30 settembre 2025 Ã¨ possibile fare gli esami del sangue Humanitas fiordaliso? [ASSISTENTE] Presso Humanitas Medical Care Rozzano-Fiordaliso, il sabato Ã¨ possibile e...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (210 chars):
   {'confidence': 0.95, 'motivation': 'La conversazione verte principalmente sulla prenotazione per gli esami del sangue e sulle modalitÃ  di accesso per persone con invaliditÃ .', 'predicted_label': 'Prenotazione'}

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.95
   motivation: La conversazione verte principalmente sulla prenotazione per gli esami del sangue e sulle modalitÃ  di accesso per persone con invaliditÃ .
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte principalmente sulla prenotazione per gli esami del sangue e sulle modalitÃ  di accesso per persone con invaliditÃ .
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 3070f2d301d2fa6d7286ec7bd80d8440 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 203
   ğŸ“Š Token totali: 631
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 631 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 203
   ğŸ“Š Token conversazione finale: 203
   ğŸ“Š Token totali: 631
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 614 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Orari farmacia per ritiro puntura [ASSISTENTE] La Farmacia dellâ€™Istituto Clinico Humanitas Ã¨ aperta dal lunedÃ¬ al venerdÃ¬ (esclusi i festivi) con i seguenti orari:  
- Mattina: dalle 8:30 alle 13:00;  
- Pomeriggio: dalle 14:00 alle 17:30. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2856 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 203
   ğŸ“Š Token totali stimati: 631
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Orari farmacia per ritiro puntura [ASSISTENTE] La Farmacia dellâ€™Istituto Clinico Humanitas Ã¨ aperta dal lunedÃ¬ al venerdÃ¬ (esclusi i festivi) con i seguenti orari:  
- Mattina: dalle 8:30 alle 13:00;  
- Pomeriggio: dalle 14:00 alle 17:30. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:00.952045
====================================================================================================
ğŸ“‹ Session ID: classify_1756762560
â±ï¸  Processing Time: 1.589s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (614 chars):
   [UTENTE] Orari farmacia per ritiro puntura [ASSISTENTE] La Farmacia dellâ€™Istituto Clinico Humanitas Ã¨ aperta dal lunedÃ¬ al venerdÃ¬ (esclusi i festivi) con i seguenti orari:  
- Mattina: dalle 8:30 ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (97 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f68801e969c03682810e8ae393459e2c classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
   ğŸ“ˆ Progresso LLM: 50/155
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 695
   ğŸ“Š Token totali: 1143
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1143 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 695
   ğŸ“Š Token conversazione finale: 695
   ğŸ“Š Token totali: 1143
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2214 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Voglio sapere si posso fare domani, sabato, i seguenti esami de sangue: omocisteina, fattore di necrose tumorale, interleuchina 6 si 8 [ASSISTENTE] Puoi effettuare gli esami del sangue richiesti (omocisteina, fattore di necrosi tumorale, interleuchina 6 e 8) il sabato presso l'Istituto C..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 695
   ğŸ“Š Token totali stimati: 1143
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Voglio sapere si posso fare domani, sabato, i seguenti esami de sangue: omocisteina, fattore di necrose tumorale, interleuchina 6 si 8 [ASSISTENTE] Puoi effettuare gli esami del sangue richiesti (omocisteina, fattore di necrosi tumorale, interleuchina 6 e 8) il sabato presso l'Istituto C..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Classification of conversation:**\n\n- predicted_label: "Analisi"\n- confidence: 0.9\n- motivation: La'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:02.739577
====================================================================================================
ğŸ“‹ Session ID: classify_1756762562
â±ï¸  Processing Time: 1.702s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2214 chars):
   [UTENTE] Voglio sapere si posso fare domani, sabato, i seguenti esami de sangue: omocisteina, fattore di necrose tumorale, interleuchina 6 si 8 [ASSISTENTE] Puoi effettuare gli esami del sangue ric...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (195 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Classification of conversation:**\n\n- predicted_label: "Analisi"\n- confidence: 0.9\n- motivation: La'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **Classification of conversation:**

- predicted_label: "Analisi"
- confidence: 0.9
- motivation: La
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **Classification of conversation:**

- predicted_label: "Analisi"
- confidence: 0.9
- motivation: La
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 03ec2500e7bb3a5c3cba6cc8f8c833e7 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 381
   ğŸ“Š Token totali: 830
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 830 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 381
   ğŸ“Š Token conversazione finale: 381
   ğŸ“Š Token totali: 830
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1128 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei prenotare una visita urologica [ASSISTENTE] Per prenotare una visita urologica presso l'Istituto Clinico Humanitas, puoi utilizzare i seguenti canali di prenotazione:

1. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2884 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 381
   ğŸ“Š Token totali stimati: 830
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei prenotare una visita urologica [ASSISTENTE] Per prenotare una visita urologica presso l'Istituto Clinico Humanitas, puoi utilizzare i seguenti canali di prenotazione:

1. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica"}}'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:03.696681
====================================================================================================
ğŸ“‹ Session ID: classify_1756762563
â±ï¸  Processing Time: 0.871s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1128 chars):
   [UTENTE] Vorrei prenotare una visita urologica [ASSISTENTE] Per prenotare una visita urologica presso l'Istituto Clinico Humanitas, puoi utilizzare i seguenti canali di prenotazione:

1. **Privatam...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (184 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica"}}'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica"}}
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica"}}
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f9444c0df80a7e19c67b464617643c1a classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 208
   ğŸ“Š Token totali: 636
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 636 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 208
   ğŸ“Š Token conversazione finale: 208
   ğŸ“Š Token totali: 636
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 671 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] HO PRENOTATO UNA TELEVISITA. [...] docxã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2645 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 208
   ğŸ“Š Token totali stimati: 636
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] HO PRENOTATO UNA TELEVISITA. [...] docxã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sulla procedura di una televisita con uno specialista dell'ospedale Humanitas.", 'predicted_label': 'Visita Specialistica'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:05.259797
====================================================================================================
ğŸ“‹ Session ID: classify_1756762565
â±ï¸  Processing Time: 1.477s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (671 chars):
   [UTENTE] HO PRENOTATO UNA TELEVISITA. COME FUNZIONA? [ASSISTENTE] La televisita si svolge in questo modo:

1. All'orario fissato, accedi alla piattaforma cliccando sul link ricevuto via email.
2. V...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (182 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sulla procedura di una televisita con uno specialista dell'ospedale Humanitas.", 'predicted_label': 'Visita Specialistica'}

ğŸ“Š Parsed Response:
   predicted_label: Visita Specialistica
   confidence: 0.95
   motivation: La conversazione verte sulla procedura di una televisita con uno specialista dell'ospedale Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sulla procedura di una televisita con uno specialista dell'ospedale Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 533225af92535905192c288476ab3877 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Visita Specialistica' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 319
   ğŸ“Š Token totali: 747
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 747 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 319
   ğŸ“Š Token conversazione finale: 319
   ğŸ“Š Token totali: 747
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1078 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao  [ASSISTENTE] Ciao! Come posso esserti utile? ğŸ˜Š [UTENTE] Si  [ASSISTENTE] Perfetto! Dimmi pure, come posso aiutarti? ğŸ˜Š [UTENTE] ho prenotato per il 15 settembre con il Dr. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2810 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 319
   ğŸ“Š Token totali stimati: 747
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao  [ASSISTENTE] Ciao! Come posso esserti utile? ğŸ˜Š [UTENTE] Si  [ASSISTENTE] Perfetto! Dimmi pure, come posso aiutarti? ğŸ˜Š [UTENTE] ho prenotato per il 15 settembre con il Dr. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla conferma dell'utilizzo di un sistema specifico durante una prestazione medica prenotata e la disponibil"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:07.825709
====================================================================================================
ğŸ“‹ Session ID: classify_1756762567
â±ï¸  Processing Time: 2.479s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1078 chars):
   [UTENTE] Ciao  [ASSISTENTE] Ciao! Come posso esserti utile? ğŸ˜Š [UTENTE] Si  [ASSISTENTE] Perfetto! Dimmi pure, come posso aiutarti? ğŸ˜Š [UTENTE] ho prenotato per il 15 settembre con il Dr. Lamberto Zo...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla conferma dell'utilizzo di un sistema specifico durante una prestazione medica prenotata e la disponibil"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte principalmente sulla conferma dell'utilizzo di un sistema specifico durante una prestazione medica prenotata e la disponibil
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte principalmente sulla conferma dell'utilizzo di un sistema specifico durante una prestazione medica prenotata e la disponibil
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 77d5065d35a033ca622b2aeb437ddc75 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 195
   ğŸ“Š Token totali: 623
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 623 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 195
   ğŸ“Š Token conversazione finale: 195
   ğŸ“Š Token totali: 623
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 661 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Dovrei effettuare una enteroscopia con biopsia Humatis effettua questo tipo di prestazione  e il costo in regime privato [ASSISTENTE] Humanitas effettua l'enteroscopia con biopsia, una procedura che consente di esaminare il piccolo intestino e prelevare campioni di tessuto per analisi is..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 195
   ğŸ“Š Token totali stimati: 623
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Dovrei effettuare una enteroscopia con biopsia Humatis effettua questo tipo di prestazione  e il costo in regime privato [ASSISTENTE] Humanitas effettua l'enteroscopia con biopsia, una procedura che consente di esaminare il piccolo intestino e prelevare campioni di tessuto per analisi is..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica"}}'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:08.670027
====================================================================================================
ğŸ“‹ Session ID: classify_1756762568
â±ï¸  Processing Time: 0.758s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (661 chars):
   [UTENTE] Dovrei effettuare una enteroscopia con biopsia Humatis effettua questo tipo di prestazione  e il costo in regime privato [ASSISTENTE] Humanitas effettua l'enteroscopia con biopsia, una pro...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (184 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica"}}'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica"}}
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica"}}
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 4812ae45d0a43331e661a7f47b82fc1d classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 407
   ğŸ“Š Token totali: 856
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 856 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 407
   ğŸ“Š Token conversazione finale: 407
   ğŸ“Š Token totali: 856
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1204 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, sono Fava Piera (05/07/48) paziente del cardiologo dr Carlo Ceriotti che mi ha visitata ila Rozzano il 25/06/25 prescrivendo ECOCARDIO di controllo da fare entro 6 mesi x importante patologia. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2953 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 407
   ğŸ“Š Token totali stimati: 856
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, sono Fava Piera (05/07/48) paziente del cardiologo dr Carlo Ceriotti che mi ha visitata ila Rozzano il 25/06/25 prescrivendo ECOCARDIO di controllo da fare entro 6 mesi x importante patologia. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Prenotazione",\n  "confidence": 0.85,\n  "m'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:10.696408
====================================================================================================
ğŸ“‹ Session ID: classify_1756762570
â±ï¸  Processing Time: 1.939s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1204 chars):
   [UTENTE] Buongiorno, sono Fava Piera (05/07/48) paziente del cardiologo dr Carlo Ceriotti che mi ha visitata ila Rozzano il 25/06/25 prescrivendo ECOCARDIO di controllo da fare entro 6 mesi x impor...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (197 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Prenotazione",\n  "confidence": 0.85,\n  "m'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Prenotazione",
  "confidence": 0.85,
  "m
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Prenotazione",
  "confidence": 0.85,
  "m
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 35ae94791c2a1703e15b2da159f5a8bb classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 150
   ğŸ“Š Token totali: 598
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 598 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 150
   ğŸ“Š Token conversazione finale: 150
   ğŸ“Š Token totali: 598
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 487 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei sapere gli orari di visita ai pazienti nel reparto ortopedia [ASSISTENTE] Per visitare i pazienti ricoverati in Humanitas, gli orari di visita possono variare a seconda del reparto. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2937 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 150
   ğŸ“Š Token totali stimati: 598
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei sapere gli orari di visita ai pazienti nel reparto ortopedia [ASSISTENTE] Per visitare i pazienti ricoverati in Humanitas, gli orari di visita possono variare a seconda del reparto. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Servizi aziendali",\n  "confidence": 0.95,'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:12.431508
====================================================================================================
ğŸ“‹ Session ID: classify_1756762572
â±ï¸  Processing Time: 1.649s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (487 chars):
   [UTENTE] Vorrei sapere gli orari di visita ai pazienti nel reparto ortopedia [ASSISTENTE] Per visitare i pazienti ricoverati in Humanitas, gli orari di visita possono variare a seconda del reparto....

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (196 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Servizi aziendali",\n  "confidence": 0.95,'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Servizi aziendali",
  "confidence": 0.95,
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Servizi aziendali",
  "confidence": 0.95,
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 43927d21cf26ba716367049ee01bdaa1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 276
   ğŸ“Š Token totali: 724
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 724 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 276
   ğŸ“Š Token conversazione finale: 276
   ğŸ“Š Token totali: 724
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 841 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia, vorrei mettermi in contatto con la ginecologia del pio x [ASSISTENTE] Per contattare la ginecologia presso Humanitas San Pio X, puoi fare riferimento al Punto Nascita. [...]  Se hai bisogno di ulteriori dettagli, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2916 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 276
   ğŸ“Š Token totali stimati: 724
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia, vorrei mettermi in contatto con la ginecologia del pio x [ASSISTENTE] Per contattare la ginecologia presso Humanitas San Pio X, puoi fare riferimento al Punto Nascita. [...]  Se hai bisogno di ulteriori dettagli, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:15.533438
====================================================================================================
ğŸ“‹ Session ID: classify_1756762575
â±ï¸  Processing Time: 3.016s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (841 chars):
   [UTENTE] Ciao Giulia, vorrei mettermi in contatto con la ginecologia del pio x [ASSISTENTE] Per contattare la ginecologia presso Humanitas San Pio X, puoi fare riferimento al Punto Nascita. Ãˆ attiv...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (97 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 4026fc304cb11a0a5396a688e11fb8ad classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 87
   ğŸ“Š Token totali: 515
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 515 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 87
   ğŸ“Š Token conversazione finale: 87
   ğŸ“Š Token totali: 515
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 279 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] a che ore siete aperti? [ASSISTENTE] Gli orari di apertura possono variare a seconda del servizio o del reparto che desideri visitare. Potresti specificare a quale servizio o reparto ti riferisci? Ad esempio, pronto soccorso, ufficio ritiro referti, punti prelievo, ecc."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2875 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 87
   ğŸ“Š Token totali stimati: 515
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] a che ore siete aperti? [ASSISTENTE] Gli orari di apertura possono variare a seconda del servizio o del reparto che desideri visitare. Potresti specificare a quale servizio o reparto ti riferisci? Ad esempio, pronto soccorso, ufficio ritiro referti, punti prelievo, ecc."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'orario di apertura dei servizi dell'ospedale, pertanto la categoria piÃ¹ adatta Ã¨ 'Servizi aziendali'.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:17.269009
====================================================================================================
ğŸ“‹ Session ID: classify_1756762577
â±ï¸  Processing Time: 1.649s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (279 chars):
   [UTENTE] a che ore siete aperti? [ASSISTENTE] Gli orari di apertura possono variare a seconda del servizio o del reparto che desideri visitare. Potresti specificare a quale servizio o reparto ti ri...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (207 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'orario di apertura dei servizi dell'ospedale, pertanto la categoria piÃ¹ adatta Ã¨ 'Servizi aziendali'.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.95
   motivation: La conversazione verte sull'orario di apertura dei servizi dell'ospedale, pertanto la categoria piÃ¹ adatta Ã¨ 'Servizi aziendali'.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'orario di apertura dei servizi dell'ospedale, pertanto la categoria piÃ¹ adatta Ã¨ 'Servizi aziendali'.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione e4bb731e7e10f0cc4a92df05f0e40ec1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 188
   ğŸ“Š Token totali: 636
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 636 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 188
   ğŸ“Š Token conversazione finale: 188
   ğŸ“Š Token totali: 636
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 663 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] La struttura Ã¨ convenzionata ma alcuni medici non lo sono Unisalute [ASSISTENTE] Se ti riferisci alla possibilitÃ  di prenotare visite o esami con Unisalute, Ã¨ importante sapere che alcune prestazioni potrebbero essere coperte dalla convenzione, mentre altre no. Inoltre, non tutti i medic..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 188
   ğŸ“Š Token totali stimati: 636
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] La struttura Ã¨ convenzionata ma alcuni medici non lo sono Unisalute [ASSISTENTE] Se ti riferisci alla possibilitÃ  di prenotare visite o esami con Unisalute, Ã¨ importante sapere che alcune prestazioni potrebbero essere coperte dalla convenzione, mentre altre no. Inoltre, non tutti i medic..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'prenotazione', 'confidence': 0.6, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:20.044760
====================================================================================================
ğŸ“‹ Session ID: classify_1756762580
â±ï¸  Processing Time: 2.688s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (663 chars):
   [UTENTE] La struttura Ã¨ convenzionata ma alcuni medici non lo sono Unisalute [ASSISTENTE] Se ti riferisci alla possibilitÃ  di prenotare visite o esami con Unisalute, Ã¨ importante sapere che alcune ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (104 chars):
   {'predicted_label': 'prenotazione', 'confidence': 0.6, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: prenotazione
   confidence: 0.6
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.600
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 60.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione ae96a6e07793fe268c5fa208380808c3 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 129
   ğŸ“Š Token totali: 578
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 578 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 129
   ğŸ“Š Token conversazione finale: 129
   ğŸ“Š Token totali: 578
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 457 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] come prenotare albergo convenzionato [ASSISTENTE] Per prenotare una struttura alberghiera convenzionata con Humanitas, puoi consultare l'elenco delle strutture disponibili alla pagina dedicata sul sito di Humanitas. [...] 

Se hai necessitÃ  di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 129
   ğŸ“Š Token totali stimati: 578
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] come prenotare albergo convenzionato [ASSISTENTE] Per prenotare una struttura alberghiera convenzionata con Humanitas, puoi consultare l'elenco delle strutture disponibili alla pagina dedicata sul sito di Humanitas. [...] 

Se hai necessitÃ  di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "alloggio", "confidence": 0.95,'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:21.522425
====================================================================================================
ğŸ“‹ Session ID: classify_1756762581
â±ï¸  Processing Time: 1.390s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (457 chars):
   [UTENTE] come prenotare albergo convenzionato [ASSISTENTE] Per prenotare una struttura alberghiera convenzionata con Humanitas, puoi consultare l'elenco delle strutture disponibili alla pagina dedi...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "alloggio", "confidence": 0.95,'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "alloggio", "confidence": 0.95,
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "alloggio", "confidence": 0.95,
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione b7f210973519ed8ef2fc5c5b98395523 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 169
   ğŸ“Š Token totali: 618
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 618 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 169
   ğŸ“Š Token conversazione finale: 169
   ğŸ“Š Token totali: 618
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 557 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ci sono navette da Milano Linate per l'ospedale? [ASSISTENTE] Non ci sono informazioni specifiche sulla presenza di navette dirette da Milano Linate all'Istituto Clinico Humanitas. [...] it/info/viaggi)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2880 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 169
   ğŸ“Š Token totali stimati: 618
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ci sono navette da Milano Linate per l'ospedale? [ASSISTENTE] Non ci sono informazioni specifiche sulla presenza di navette dirette da Milano Linate all'Istituto Clinico Humanitas. [...] it/info/viaggi)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:23.192395
====================================================================================================
ğŸ“‹ Session ID: classify_1756762583
â±ï¸  Processing Time: 1.575s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (557 chars):
   [UTENTE] Ci sono navette da Milano Linate per l'ospedale? [ASSISTENTE] Non ci sono informazioni specifiche sulla presenza di navette dirette da Milano Linate all'Istituto Clinico Humanitas. Tuttavi...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f7ba3d5a54ba3bf7c169fa060090785e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 447
   ğŸ’¬ Token conversazione: 731
   ğŸ“Š Token totali: 1178
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1178 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 447
   ğŸ“Š Token conversazione originale: 731
   ğŸ“Š Token conversazione finale: 731
   ğŸ“Š Token totali: 1178
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2360 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao sono Giada, ho bisogno di aiuto per l'aereo  [ASSISTENTE] Ciao Giada! Potresti spiegarmi meglio di cosa hai bisogno riguardo l'aereo? Ad esempio, hai bisogno di indicazioni per raggiungere un aeroporto, informazioni sui voli o altro? Sono qui per aiutarti! [UTENTE] Informazioni sui ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2960 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 447
   ğŸ“Š Token conversazione: 731
   ğŸ“Š Token totali stimati: 1178
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao sono Giada, ho bisogno di aiuto per l'aereo  [ASSISTENTE] Ciao Giada! Potresti spiegarmi meglio di cosa hai bisogno riguardo l'aereo? Ad esempio, hai bisogno di indicazioni per raggiungere un aeroporto, informazioni sui voli o altro? Sono qui per aiutarti! [UTENTE] Informazioni sui ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: Ecco i risultati della classificazione automatica della conversazione:\n\n| predicted_label       | co'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:26.524837
====================================================================================================
ğŸ“‹ Session ID: classify_1756762586
â±ï¸  Processing Time: 3.246s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2360 chars):
   [UTENTE] Ciao sono Giada, ho bisogno di aiuto per l'aereo  [ASSISTENTE] Ciao Giada! Potresti spiegarmi meglio di cosa hai bisogno riguardo l'aereo? Ad esempio, hai bisogno di indicazioni per raggiu...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (193 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: Ecco i risultati della classificazione automatica della conversazione:\n\n| predicted_label       | co'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: Ecco i risultati della classificazione automatica della conversazione:

| predicted_label       | co
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: Ecco i risultati della classificazione automatica della conversazione:

| predicted_label       | co
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione bee5254d49937851ad262f5604b6953e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 382
   ğŸ“Š Token totali: 810
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 810 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 382
   ğŸ“Š Token conversazione finale: 382
   ğŸ“Š Token totali: 810
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1280 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Salve Giulia, se prenoto un volo, tramite le vostre convenzioni viaggiare insieme, Ã¨  prevista l'assistenza medica o solo una scontistica del prezzo del biglietto aereo? [ASSISTENTE] La convenzione "Viaggia insieme a noi" di Humanitas offre sconti sui biglietti aerei (50%-55% sulle tarif..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 382
   ğŸ“Š Token totali stimati: 810
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Salve Giulia, se prenoto un volo, tramite le vostre convenzioni viaggiare insieme, Ã¨  prevista l'assistenza medica o solo una scontistica del prezzo del biglietto aereo? [ASSISTENTE] La convenzione "Viaggia insieme a noi" di Humanitas offre sconti sui biglietti aerei (50%-55% sulle tarif..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted Label:** Prenotazione\n\n**Confidence:** 0.95\n\n**Motivation:** La conversazione verte prin'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:28.152621
====================================================================================================
ğŸ“‹ Session ID: classify_1756762588
â±ï¸  Processing Time: 1.540s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1280 chars):
   [UTENTE] Salve Giulia, se prenoto un volo, tramite le vostre convenzioni viaggiare insieme, Ã¨  prevista l'assistenza medica o solo una scontistica del prezzo del biglietto aereo? [ASSISTENTE] La co...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (195 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted Label:** Prenotazione\n\n**Confidence:** 0.95\n\n**Motivation:** La conversazione verte prin'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **Predicted Label:** Prenotazione

**Confidence:** 0.95

**Motivation:** La conversazione verte prin
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **Predicted Label:** Prenotazione

**Confidence:** 0.95

**Motivation:** La conversazione verte prin
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 862cbc707fa27a720eaf210b5785e8c0 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 127
   ğŸ“Š Token totali: 575
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 575 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 127
   ğŸ“Š Token conversazione finale: 127
   ğŸ“Š Token totali: 575
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 439 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Desidero sapere il costo di una prima visita proctologica  [ASSISTENTE] Non ho trovato informazioni specifiche sul costo di una prima visita proctologica nei documenti forniti. [...] it/visite-ed-esami/visita-proctologica)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2899 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 127
   ğŸ“Š Token totali stimati: 575
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Desidero sapere il costo di una prima visita proctologica  [ASSISTENTE] Non ho trovato informazioni specifiche sul costo di una prima visita proctologica nei documenti forniti. [...] it/visite-ed-esami/visita-proctologica)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:30.161438
====================================================================================================
ğŸ“‹ Session ID: classify_1756762590
â±ï¸  Processing Time: 1.923s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (439 chars):
   [UTENTE] Desidero sapere il costo di una prima visita proctologica  [ASSISTENTE] Non ho trovato informazioni specifiche sul costo di una prima visita proctologica nei documenti forniti. Ti consigli...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (97 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 2d9dea84af5815172145692f24da4d9f classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 201
   ğŸ“Š Token totali: 649
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 649 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 201
   ğŸ“Š Token conversazione finale: 201
   ğŸ“Š Token totali: 649
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 693 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei fare vaccino anti epatite A [ASSISTENTE] Per sapere se Ã¨ possibile effettuare il vaccino contro l'epatite A presso Humanitas, ti consiglio di contattare direttamente il centralino al numero 02 82241. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2955 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 201
   ğŸ“Š Token totali stimati: 649
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei fare vaccino anti epatite A [ASSISTENTE] Per sapere se Ã¨ possibile effettuare il vaccino contro l'epatite A presso Humanitas, ti consiglio di contattare direttamente il centralino al numero 02 82241. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': 'La conversazione verte sulla prenotazione del vaccino anti epatite A e sul metodo di prenotazione.', 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:31.751006
====================================================================================================
ğŸ“‹ Session ID: classify_1756762591
â±ï¸  Processing Time: 1.503s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (693 chars):
   [UTENTE] Vorrei fare vaccino anti epatite A [ASSISTENTE] Per sapere se Ã¨ possibile effettuare il vaccino contro l'epatite A presso Humanitas, ti consiglio di contattare direttamente il centralino a...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (171 chars):
   {'confidence': 0.95, 'motivation': 'La conversazione verte sulla prenotazione del vaccino anti epatite A e sul metodo di prenotazione.', 'predicted_label': 'Prenotazione'}

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.95
   motivation: La conversazione verte sulla prenotazione del vaccino anti epatite A e sul metodo di prenotazione.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sulla prenotazione del vaccino anti epatite A e sul metodo di prenotazione.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 02e11e22451ecbcf17ab24b847f35c84 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 358
   ğŸ“Š Token totali: 806
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 806 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 358
   ğŸ“Š Token conversazione finale: 358
   ğŸ“Š Token totali: 806
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1220 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao, devo fare il rinnovo del certificato DSA, volevo sapere cosa devo fare e quanto mi viene a costare e poi volevo chiedere se potevo farlo a pagamento?  [ASSISTENTE] Non ho trovato informazioni specifiche sul rinnovo del certificato DSA nei documenti caricati. Ti consiglio di contatt..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 358
   ğŸ“Š Token totali stimati: 806
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao, devo fare il rinnovo del certificato DSA, volevo sapere cosa devo fare e quanto mi viene a costare e poi volevo chiedere se potevo farlo a pagamento?  [ASSISTENTE] Non ho trovato informazioni specifiche sul rinnovo del certificato DSA nei documenti caricati. Ti consiglio di contatt..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla richiesta di informazioni sul rinnovo del certificato DSA e sulle email fornite dall'utente. Non ci son"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:34.433904
====================================================================================================
ğŸ“‹ Session ID: classify_1756762594
â±ï¸  Processing Time: 2.598s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1220 chars):
   [UTENTE] ciao, devo fare il rinnovo del certificato DSA, volevo sapere cosa devo fare e quanto mi viene a costare e poi volevo chiedere se potevo farlo a pagamento?  [ASSISTENTE] Non ho trovato inf...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla richiesta di informazioni sul rinnovo del certificato DSA e sulle email fornite dall'utente. Non ci son"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte principalmente sulla richiesta di informazioni sul rinnovo del certificato DSA e sulle email fornite dall'utente. Non ci son
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte principalmente sulla richiesta di informazioni sul rinnovo del certificato DSA e sulle email fornite dall'utente. Non ci son
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 73a8f5b60475b3bf2d598a246fc03d8f classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 142
   ğŸ“Š Token totali: 570
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 570 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 142
   ğŸ“Š Token conversazione finale: 142
   ğŸ“Š Token totali: 570
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 531 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei acquistare tramite welfare un checkup uomo personalizzato del valore di 1000euro, in cosa consiste il checkup personalizzato del valore di 1000euro?  [ASSISTENTE] Non ho trovato informazioni specifiche sul checkup uomo personalizzato del valore di 1000 euro nei documenti caricati...."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 142
   ğŸ“Š Token totali stimati: 570
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei acquistare tramite welfare un checkup uomo personalizzato del valore di 1000euro, in cosa consiste il checkup personalizzato del valore di 1000euro?  [ASSISTENTE] Non ho trovato informazioni specifiche sul checkup uomo personalizzato del valore di 1000 euro nei documenti caricati...."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” [DEBUG] GET review cases per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… [DEBUG] Tenant risolto: Humanitas (humanitas)
ğŸ” [DEBUG] Ottieni mongo reader per tenant: humanitas
ğŸ”§ Creazione MongoClassificationReader per cliente: humanitas
ğŸ” Risoluzione tenant da slug: humanitas
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto da slug (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da slug: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ“Š Calcolo statistiche per tenant: Humanitas
ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:35.872848
====================================================================================================
ğŸ“‹ Session ID: classify_1756762595
â±ï¸  Processing Time: 1.352s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (531 chars):
   [UTENTE] Vorrei acquistare tramite welfare un checkup uomo personalizzato del valore di 1000euro, in cosa consiste il checkup personalizzato del valore di 1000euro?  [ASSISTENTE] Non ho trovato inf...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (97 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 6a6b57073ece1a8ab3753fabc21f1e07 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 178
   ğŸ“Š Token totali: 626
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 626 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 178
   ğŸ“Š Token conversazione finale: 178
   ğŸ“Š Token totali: 626
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 543 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia, io devo venire in Humanitas domani. [...] )

Fammi sapere cosÃ¬ posso darti indicazioni precise! [UTENTE] Rozzano, mezzi pubblici [ASSISTENTE] Perfetto! Vuoi utilizzare l'autobus, la metro, il tram o il treno per raggiungere Humanitas Rozzano da Porta Venezia?"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2949 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 178
   ğŸ“Š Token totali stimati: 626
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia, io devo venire in Humanitas domani. [...] )

Fammi sapere cosÃ¬ posso darti indicazioni precise! [UTENTE] Rozzano, mezzi pubblici [ASSISTENTE] Perfetto! Vuoi utilizzare l'autobus, la metro, il tram o il treno per raggiungere Humanitas Rozzano da Porta Venezia?"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:37.523861
====================================================================================================
ğŸ“‹ Session ID: classify_1756762597
â±ï¸  Processing Time: 1.565s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (543 chars):
   [UTENTE] Ciao Giulia, io devo venire in Humanitas domani. Come posso arrivarci da Porta Venezia? [ASSISTENTE] Per aiutarti al meglio, ho bisogno di sapere:

1. In quale sede di Humanitas devi andar...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 9747f54127f9236d8274a4b7ea4303f0 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 85
   ğŸ“Š Token totali: 513
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 513 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 85
   ğŸ“Š Token conversazione finale: 85
   ğŸ“Š Token totali: 513
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 267 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] La linea 220 Ã¨ extraurbana? [ASSISTENTE] SÃ¬, la linea 220 Ã¨ una linea extraurbana che collega Humanitas con Pieve Emanuele, Opera e Locate, partendo da Rozzano, via della SolidarietÃ ã€6:0â€ scraped_https___www.humanitas.it_info_come-raggiungere-humanitas.jsonã€‘."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2863 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 85
   ğŸ“Š Token totali stimati: 513
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] La linea 220 Ã¨ extraurbana? [ASSISTENTE] SÃ¬, la linea 220 Ã¨ una linea extraurbana che collega Humanitas con Pieve Emanuele, Opera e Locate, partendo da Rozzano, via della SolidarietÃ ã€6:0â€ scraped_https___www.humanitas.it_info_come-raggiungere-humanitas.jsonã€‘."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ¯ [CLUSTERING CONFIG] Caricando parametri personalizzati per tenant 015007d9-d413-11ef-86a5-96000228e7fe
   allow_single_cluster: non_definito -> False
   alpha: non_definito -> 0.4
   cluster_selection_epsilon: non_definito -> 0.28
   cluster_selection_method: non_definito -> leaf
   max_cluster_size: non_definito -> 0
   metric: non_definito -> euclidean
   min_cluster_size: 5 -> 13
   min_samples: 3 -> 16
   only_user: non_definito -> False
   umap_metric: non_definito -> cosine
   umap_min_dist: non_definito -> 0
   umap_n_components: non_definito -> 17
   umap_n_neighbors: non_definito -> 30
   umap_random_state: non_definito -> 42
   use_umap: non_definito -> True
ğŸ“ˆ [API] Recuperato storico clustering: 41 versioni per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ¯ [CLUSTERING CONFIG] Caricando parametri personalizzati per tenant 015007d9-d413-11ef-86a5-96000228e7fe
   allow_single_cluster: non_definito -> False
   alpha: non_definito -> 0.4
   cluster_selection_epsilon: non_definito -> 0.28
   cluster_selection_method: non_definito -> leaf
   max_cluster_size: non_definito -> 0
   metric: non_definito -> euclidean
   min_cluster_size: 5 -> 13
   min_samples: 3 -> 16
   only_user: non_definito -> False
   umap_metric: non_definito -> cosine
   umap_min_dist: non_definito -> 0
   umap_n_components: non_definito -> 17
   umap_n_neighbors: non_definito -> 30
   umap_random_state: non_definito -> 42
   use_umap: non_definito -> True
ğŸ“ˆ [API] Recuperato storico clustering: 41 versioni per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“Š [API] Recuperata versione 41 per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': '| predicted_label         | confidenza | motivazione                      |'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:40.160339
====================================================================================================
ğŸ“‹ Session ID: classify_1756762600
â±ï¸  Processing Time: 2.550s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (267 chars):
   [UTENTE] La linea 220 Ã¨ extraurbana? [ASSISTENTE] SÃ¬, la linea 220 Ã¨ una linea extraurbana che collega Humanitas con Pieve Emanuele, Opera e Locate, partendo da Rozzano, via della SolidarietÃ ã€6:0â€ s...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (140 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': '| predicted_label         | confidenza | motivazione                      |'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: | predicted_label         | confidenza | motivazione                      |
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   | predicted_label         | confidenza | motivazione                      |
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 71e43c5465a693dafba71ffe1bc1c9ac classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 303
   ğŸ“Š Token totali: 731
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 731 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 303
   ğŸ“Š Token conversazione finale: 303
   ğŸ“Š Token totali: 731
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 903 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao giulia abito a lesmo come raggiungo la sede di rozzano in auto [ASSISTENTE] Per aiutarti a raggiungere la sede di Rozzano in auto da Lesmo, calcolo il percorso. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2842 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 303
   ğŸ“Š Token totali stimati: 731
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao giulia abito a lesmo come raggiungo la sede di rozzano in auto [ASSISTENTE] Per aiutarti a raggiungere la sede di Rozzano in auto da Lesmo, calcolo il percorso. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ”§ API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” API: Recupero prompt per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45)}
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
âœ… Recuperati 5 prompt per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
âœ… Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” API: Recupero prompt per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
âœ… Recuperati 5 prompt per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
âœ… Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
âœ… Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:42.074300
====================================================================================================
ğŸ“‹ Session ID: classify_1756762602
â±ï¸  Processing Time: 1.829s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (903 chars):
   [UTENTE] ciao giulia abito a lesmo come raggiungo la sede di rozzano in auto [ASSISTENTE] Per aiutarti a raggiungere la sede di Rozzano in auto da Lesmo, calcolo il percorso. Un attimo di pazienza....

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 427bce9101bac0b034ee5e42d93afb85 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 85
   ğŸ“Š Token totali: 533
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 533 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 85
   ğŸ“Š Token conversazione finale: 85
   ğŸ“Š Token totali: 533
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 277 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, vorrei capire come arrivare dallâ€™autostrada al centro di P Ricovero via Building 4 [ASSISTENTE] Per aiutarti al meglio, potresti specificare da quale autostrada stai arrivando? Inoltre, desideri sapere il percorso in auto o con un altro mezzo di trasporto?"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2945 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 85
   ğŸ“Š Token totali stimati: 533
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, vorrei capire come arrivare dallâ€™autostrada al centro di P Ricovero via Building 4 [ASSISTENTE] Per aiutarti al meglio, potresti specificare da quale autostrada stai arrivando? Inoltre, desideri sapere il percorso in auto o con un altro mezzo di trasporto?"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ­ EmbeddingEngineFactory inizializzata
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“‹ Caricamento parametri LLM globali per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ¯ Config LLM caricata per 015007d9-d413-11ef-86a5-96000228e7fe (fonte: global)
   ğŸ“ Max output tokens: 150
   ğŸ“Š Max input tokens: 8000
   ğŸŒ¡ï¸  Temperature: 0.1
   ğŸ”¢ Top K: 40, Top P: 0.9
ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ FORCE NO CACHE: Bypass cache per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”¥ FORCE NO CACHE: Bypasso cache e leggo DIRETTAMENTE dal database per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45)}
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ² DATABASE: Modello trovato per 015007d9-d413-11ef-86a5-96000228e7fe: mistral-nemo:latest
ğŸ¯ Uso modello dal DATABASE per 015007d9-d413-11ef-86a5-96000228e7fe: mistral-nemo:latest
ğŸ” LLM Debugger inizializzato e ATTIVO
   ğŸ“ Debug file: ./debug_logs/llm_debug.log
   ğŸ¨ Visual formatting: True
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
ğŸ—„ï¸ MongoClassificationReader inizializzato per tenant: Humanitas
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
Connessione al database TAG stabilita con successo
ğŸ“‹ Recuperati 29 tag dal database TAGS per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
âš ï¸  Fallback a config LEGACY per embedding
ğŸ”§ TokenizationManager inizializzato:
   ğŸ“Š Modello tokenizer: cl100k_base
   ğŸ”¢ Limite massimo token: 8000
   âœ‚ï¸  Strategia troncamento: start
ğŸ“‹ Caricamento parametri LLM globali per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“‹ [API] Parametri LLM per tenant 015007d9-d413-11ef-86a5-96000228e7fe (fonte: global)
ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'accesso alle strutture dell'ospedale e non riguarda specificamente un servizio clinico o di assistenza medica.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:43.802182
====================================================================================================
ğŸ“‹ Session ID: classify_1756762603
â±ï¸  Processing Time: 1.626s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (277 chars):
   [UTENTE] Buongiorno, vorrei capire come arrivare dallâ€™autostrada al centro di P Ricovero via Building 4 [ASSISTENTE] Per aiutarti al meglio, potresti specificare da quale autostrada stai arrivando?...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (216 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'accesso alle strutture dell'ospedale e non riguarda specificamente un servizio clinico o di assistenza medica.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.95
   motivation: La conversazione verte sull'accesso alle strutture dell'ospedale e non riguarda specificamente un servizio clinico o di assistenza medica.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'accesso alle strutture dell'ospedale e non riguarda specificamente un servizio clinico o di assistenza medica.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
ğŸ“‹ [LLMConfigService] Modelli ricaricati e cached: 4
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ“‹ [API] Info modello mistral-nemo:latest recuperate
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 85e71c3a117e15f731fc13721e6016f0 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“‹ Caricamento parametri LLM globali per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ¯ Config LLM caricata per 015007d9-d413-11ef-86a5-96000228e7fe (fonte: global)
   ğŸ“ Max output tokens: 150
   ğŸ“Š Max input tokens: 8000
   ğŸŒ¡ï¸  Temperature: 0.1
   ğŸ”¢ Top K: 40, Top P: 0.9
Connessione al database TAG stabilita con successo
ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
Connessione al database TAG chiusa
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ FORCE NO CACHE: Bypass cache per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”¥ FORCE NO CACHE: Bypasso cache e leggo DIRETTAMENTE dal database per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45)}
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ² DATABASE: Modello trovato per 015007d9-d413-11ef-86a5-96000228e7fe: mistral-nemo:latest
ğŸ¯ Uso modello dal DATABASE per 015007d9-d413-11ef-86a5-96000228e7fe: mistral-nemo:latest
ğŸ” LLM Debugger inizializzato e ATTIVO
   ğŸ“ Debug file: ./debug_logs/llm_debug.log
   ğŸ¨ Visual formatting: True
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
ğŸ—„ï¸ MongoClassificationReader inizializzato per tenant: Humanitas
ğŸ“‹ [LLMConfigService] Modelli ricaricati e cached: 4
ğŸ“‹ [API] Modelli disponibili per tenant 015007d9-d413-11ef-86a5-96000228e7fe: 4
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 0s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
Connessione al database TAG stabilita con successo
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 0s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 181
   ğŸ“Š Token totali: 629
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 629 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 181
   ğŸ“Š Token conversazione finale: 181
   ğŸ“Š Token totali: 629
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 692 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao,vorrei sapere se ci sono degli incontri gratuiti dove spiegano tutto il percorso di inseminazione assistita,con ginecologi,psicologi [ASSISTENTE] Per quanto riguarda il percorso di inseminazione assistita, Humanitas offre un Fertility Center specializzato in procreazione medicalment..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 181
   ğŸ“Š Token totali stimati: 629
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao,vorrei sapere se ci sono degli incontri gratuiti dove spiegano tutto il percorso di inseminazione assistita,con ginecologi,psicologi [ASSISTENTE] Per quanto riguarda il percorso di inseminazione assistita, Humanitas offre un Fertility Center specializzato in procreazione medicalment..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

Connessione al database TAG stabilita con successo
ğŸ“‹ Recuperati 29 tag dal database TAGS per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
âš ï¸  Fallback a config LEGACY per embedding
ğŸ”§ TokenizationManager inizializzato:
   ğŸ“Š Modello tokenizer: cl100k_base
   ğŸ”¢ Limite massimo token: 8000
   âœ‚ï¸  Strategia troncamento: start
ğŸ“‹ Caricamento parametri LLM globali per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“‹ [API] Parametri LLM per tenant 015007d9-d413-11ef-86a5-96000228e7fe (fonte: global)
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
training:
  extraction:
    full_clustering_required: true
    ignore_session_limits: true
    use_full_dataset: true
  human_review:
    confidence_threshold_priority: 0.7
    max_representatives_per_cluster: 5
    max_total_sessions: 500
    min_cluster_size_â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 0s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 0s)
ğŸ“‹ [API] Modelli disponibili per tenant 015007d9-d413-11ef-86a5-96000228e7fe: 4
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 0s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ“‹ [API] Info modello mistral-nemo:latest recuperate
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 0s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 0s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Visita Specialistica",\n  "confidence": 0.'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:45.907887
====================================================================================================
ğŸ“‹ Session ID: classify_1756762605
â±ï¸  Processing Time: 1.945s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (692 chars):
   [UTENTE] Ciao,vorrei sapere se ci sono degli incontri gratuiti dove spiegano tutto il percorso di inseminazione assistita,con ginecologi,psicologi [ASSISTENTE] Per quanto riguarda il percorso di in...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (196 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Visita Specialistica",\n  "confidence": 0.'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Visita Specialistica",
  "confidence": 0.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Visita Specialistica",
  "confidence": 0.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 55f3a35575bf4120300c03e1868aaaad classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 697
   ğŸ“Š Token totali: 1145
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1145 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 697
   ğŸ“Š Token conversazione finale: 697
   ğŸ“Š Token totali: 1145
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2276 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao! ho bisogno di informazioni sulla crioconservazione degli ovociti [ASSISTENTE] La crioconservazione degli ovociti Ã¨ una tecnica che consente di preservare la fertilitÃ  congelando gli ovociti in azoto liquido. [...] 

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2963 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 697
   ğŸ“Š Token totali stimati: 1145
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao! ho bisogno di informazioni sulla crioconservazione degli ovociti [ASSISTENTE] La crioconservazione degli ovociti Ã¨ una tecnica che consente di preservare la fertilitÃ  congelando gli ovociti in azoto liquido. [...] 

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: Ecco i risultati della classificazione:\n\n- predicted_label: "Analisi"\n- confidence: 0.9\n- motivation'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:47.706639
====================================================================================================
ğŸ“‹ Session ID: classify_1756762607
â±ï¸  Processing Time: 1.712s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2276 chars):
   [UTENTE] ciao! ho bisogno di informazioni sulla crioconservazione degli ovociti [ASSISTENTE] La crioconservazione degli ovociti Ã¨ una tecnica che consente di preservare la fertilitÃ  congelando gli ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (195 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: Ecco i risultati della classificazione:\n\n- predicted_label: "Analisi"\n- confidence: 0.9\n- motivation'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: Ecco i risultati della classificazione:

- predicted_label: "Analisi"
- confidence: 0.9
- motivation
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: Ecco i risultati della classificazione:

- predicted_label: "Analisi"
- confidence: 0.9
- motivation
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 49c4a8458c94cccbd226757980bda359 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 419
   ğŸ“Š Token totali: 868
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 868 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 419
   ğŸ“Š Token conversazione finale: 419
   ğŸ“Š Token totali: 868
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1470 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei avere informazioni su come accedere alla PMA [ASSISTENTE] Per accedere alla Procreazione Medicalmente Assistita (PMA) presso Humanitas, puoi seguire un percorso dedicato che include diverse tecniche, come l'inseminazione intrauterina (IUI) e la fecondazione in vitro (FIVET/ICSI). ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 419
   ğŸ“Š Token totali stimati: 868
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei avere informazioni su come accedere alla PMA [ASSISTENTE] Per accedere alla Procreazione Medicalmente Assistita (PMA) presso Humanitas, puoi seguire un percorso dedicato che include diverse tecniche, come l'inseminazione intrauterina (IUI) e la fecondazione in vitro (FIVET/ICSI). ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 6s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 6s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 6s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 6s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 6s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 6s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 6s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 6s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 6s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 6s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 6s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 6s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 6s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 6s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 6s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 6s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 6s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 6s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte sull'accesso alla Procreazione Medicalmente Assistita (PMA) presso Humanitas e sui requisiti per l'accesso tramite il Serviz"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:50.918929
====================================================================================================
ğŸ“‹ Session ID: classify_1756762610
â±ï¸  Processing Time: 3.126s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1470 chars):
   [UTENTE] Vorrei avere informazioni su come accedere alla PMA [ASSISTENTE] Per accedere alla Procreazione Medicalmente Assistita (PMA) presso Humanitas, puoi seguire un percorso dedicato che include...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte sull'accesso alla Procreazione Medicalmente Assistita (PMA) presso Humanitas e sui requisiti per l'accesso tramite il Serviz"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte sull'accesso alla Procreazione Medicalmente Assistita (PMA) presso Humanitas e sui requisiti per l'accesso tramite il Serviz
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte sull'accesso alla Procreazione Medicalmente Assistita (PMA) presso Humanitas e sui requisiti per l'accesso tramite il Serviz
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 5e376c8c57668ea4d2f41572a8ab8066 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 927
   ğŸ“Š Token totali: 1375
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1375 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 927
   ğŸ“Š Token conversazione finale: 927
   ğŸ“Š Token totali: 1375
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 3113 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] informazioni su p,a omologa [ASSISTENTE] Non ho trovato informazioni specifiche sulla "P. [...]  Se desideri ulteriori informazioni sui percorsi di PMA eterologa presso Humanitas, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2870 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 927
   ğŸ“Š Token totali stimati: 1375
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] informazioni su p,a omologa [ASSISTENTE] Non ho trovato informazioni specifiche sulla "P. [...]  Se desideri ulteriori informazioni sui percorsi di PMA eterologa presso Humanitas, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 7s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 8s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 8s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 8s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 8s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 8s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 8s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 8s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 8s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 8s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 8s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 8s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 8s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 8s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 8s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 8s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted Label:** PMA\n\n**Confidence:** 0.75\n\n**Motivation:** La conversazione verte principalment'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:53.247422
====================================================================================================
ğŸ“‹ Session ID: classify_1756762613
â±ï¸  Processing Time: 2.242s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (3113 chars):
   [UTENTE] informazioni su p,a omologa [ASSISTENTE] Non ho trovato informazioni specifiche sulla "P.A. omologa" nei documenti caricati. Potresti fornire ulteriori dettagli o chiarire la tua richiesta...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (195 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted Label:** PMA\n\n**Confidence:** 0.75\n\n**Motivation:** La conversazione verte principalment'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **Predicted Label:** PMA

**Confidence:** 0.75

**Motivation:** La conversazione verte principalment
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **Predicted Label:** PMA

**Confidence:** 0.75

**Motivation:** La conversazione verte principalment
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione fafd6e5d206ab18a697f88af3710780a classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 209
   ğŸ“Š Token totali: 657
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 657 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 209
   ğŸ“Š Token conversazione finale: 209
   ğŸ“Š Token totali: 657
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 642 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Dove parcheggiare  [ASSISTENTE] In quale building o sede Humanitas devi andare? CosÃ¬ posso indicarti il parcheggio piÃ¹ vicino. [...] it/info/come-raggiungere-humanitas/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2846 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 209
   ğŸ“Š Token totali stimati: 657
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Dove parcheggiare  [ASSISTENTE] In quale building o sede Humanitas devi andare? CosÃ¬ posso indicarti il parcheggio piÃ¹ vicino. [...] it/info/come-raggiungere-humanitas/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 10s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Visita Specialistica Oncologica",\n  "conf'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:54.988908
====================================================================================================
ğŸ“‹ Session ID: classify_1756762614
â±ï¸  Processing Time: 1.656s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (642 chars):
   [UTENTE] Dove parcheggiare  [ASSISTENTE] In quale building o sede Humanitas devi andare? CosÃ¬ posso indicarti il parcheggio piÃ¹ vicino. [UTENTE] Devo fare visita oncologica  [ASSISTENTE] Per una vi...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (196 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Visita Specialistica Oncologica",\n  "conf'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Visita Specialistica Oncologica",
  "conf
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Visita Specialistica Oncologica",
  "conf
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 8be704f169205e85923d0fad4d1263f5 classificata tramite LLM diretto (classificazione=unknown)
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 452
   ğŸ’¬ Token conversazione: 191
   ğŸ“Š Token totali: 643
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 643 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 452
   ğŸ“Š Token conversazione originale: 191
   ğŸ“Š Token conversazione finale: 191
   ğŸ“Š Token totali: 643
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 614 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] il parcheggio per 2 ore e 35 minuti mi Ã¨ stato fatto pagare 9,50 quando la tariffa massima risulta 8 euro [ASSISTENTE] Il costo massimo giornaliero per i parcheggi Humanitas (eccetto il Parcheggio 3) Ã¨ di 8 euro. [...]  Se hai bisogno di ulteriori dettagli, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2972 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 452
   ğŸ“Š Token conversazione: 191
   ğŸ“Š Token totali stimati: 643
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] il parcheggio per 2 ore e 35 minuti mi Ã¨ stato fatto pagare 9,50 quando la tariffa massima risulta 8 euro [ASSISTENTE] Il costo massimo giornaliero per i parcheggi Humanitas (eccetto il Parcheggio 3) Ã¨ di 8 euro. [...]  Se hai bisogno di ulteriori dettagli, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 12s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ’¾ [LLMConfigService] Backup creato: /home/ubuntu/classificatore/backup/config_20250901_213656.yaml
ğŸ’¾ [LLMConfigService] Parametri aggiornati per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:56.668502
====================================================================================================
ğŸ“‹ Session ID: classify_1756762616
â±ï¸  Processing Time: 1.594s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (614 chars):
   [UTENTE] il parcheggio per 2 ore e 35 minuti mi Ã¨ stato fatto pagare 9,50 quando la tariffa massima risulta 8 euro [ASSISTENTE] Il costo massimo giornaliero per i parcheggi Humanitas (eccetto il Pa...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione b288794dc81ad664cd5f1b21b8d998d8 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 244
   ğŸ“Š Token totali: 672
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 672 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 244
   ğŸ“Š Token conversazione finale: 244
   ğŸ“Š Token totali: 672
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 788 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] penso di avere perso il bancomat e la patente al Humanitas a Rozzano come posso fare [ASSISTENTE] Se hai perso il bancomat e la patente presso Humanitas a Rozzano, ti consiglio di recarti alla guardiania dell'ospedale...."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 244
   ğŸ“Š Token totali stimati: 672
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] penso di avere perso il bancomat e la patente al Humanitas a Rozzano come posso fare [ASSISTENTE] Se hai perso il bancomat e la patente presso Humanitas a Rozzano, ti consiglio di recarti alla guardiania dell'ospedale...."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n    "predicted_label": "Servizi aziendali",\n    "confidence": 0'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:36:58.464365
====================================================================================================
ğŸ“‹ Session ID: classify_1756762618
â±ï¸  Processing Time: 1.709s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (788 chars):
   [UTENTE] Ciao [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] penso di avere perso il bancomat e la patente al Humanitas a Rozzano come posso fare [ASSISTENTE] Se hai perso il banc...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (196 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n    "predicted_label": "Servizi aziendali",\n    "confidence": 0'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
    "predicted_label": "Servizi aziendali",
    "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
    "predicted_label": "Servizi aziendali",
    "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione a077f3a9f62e4fd34493e745ca3e17b3 classificata tramite LLM diretto (classificazione=unknown)
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 252
   ğŸ“Š Token totali: 700
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 700 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 252
   ğŸ“Š Token conversazione finale: 252
   ğŸ“Š Token totali: 700
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 826 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] P18 coperto [ASSISTENTE] Il parcheggio P18 Ã¨ parzialmente coperto. [...]  Se hai bisogno di ulteriori informazioni sui parcheggi o su come raggiungere la struttura, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2864 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 252
   ğŸ“Š Token totali stimati: 700
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] P18 coperto [ASSISTENTE] Il parcheggio P18 Ã¨ parzialmente coperto. [...]  Se hai bisogno di ulteriori informazioni sui parcheggi o su come raggiungere la struttura, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.75, 'motivation': "La conversazione verte sull'accesso e disponibilitÃ  dei parcheggi dell'ospedale, quindi Ã¨ correttamente classificata come 'Servizi aziendali'.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:00.377818
====================================================================================================
ğŸ“‹ Session ID: classify_1756762620
â±ï¸  Processing Time: 1.824s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (826 chars):
   [UTENTE] P18 coperto [ASSISTENTE] Il parcheggio P18 Ã¨ parzialmente coperto. Se hai bisogno di ulteriori informazioni sui parcheggi, puoi visitare la pagina [Indicazioni e Parcheggi](https://www.hum...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (220 chars):
   {'confidence': 0.75, 'motivation': "La conversazione verte sull'accesso e disponibilitÃ  dei parcheggi dell'ospedale, quindi Ã¨ correttamente classificata come 'Servizi aziendali'.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.75
   motivation: La conversazione verte sull'accesso e disponibilitÃ  dei parcheggi dell'ospedale, quindi Ã¨ correttamente classificata come 'Servizi aziendali'.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.750
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 75.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'accesso e disponibilitÃ  dei parcheggi dell'ospedale, quindi Ã¨ correttamente classificata come 'Servizi aziendali'.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 8f1544b92f14e847d55664ce25028df7 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 165
   ğŸ“Š Token totali: 593
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 593 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 165
   ğŸ“Š Token conversazione finale: 165
   ğŸ“Š Token totali: 593
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 595 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco a registrarmi tramite codice fiscale [ASSISTENTE] Se hai difficoltÃ  a registrarti utilizzando il codice fiscale, ti consiglio di verificare che i dati inseriti siano corretti. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2860 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 165
   ğŸ“Š Token totali stimati: 593
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco a registrarmi tramite codice fiscale [ASSISTENTE] Se hai difficoltÃ  a registrarti utilizzando il codice fiscale, ti consiglio di verificare che i dati inseriti siano corretti. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 20, 31, 45), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:02.050829
====================================================================================================
ğŸ“‹ Session ID: classify_1756762622
â±ï¸  Processing Time: 1.585s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (595 chars):
   [UTENTE] Non riesco a registrarmi tramite codice fiscale [ASSISTENTE] Se hai difficoltÃ  a registrarti utilizzando il codice fiscale, ti consiglio di verificare che i dati inseriti siano corretti. S...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 5c5da039860425c088801ac063f2012c classificata tramite LLM diretto (classificazione=unknown)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 98
   ğŸ“Š Token totali: 546
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 546 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 98
   ğŸ“Š Token conversazione finale: 98
   ğŸ“Š Token totali: 546
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 336 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] La mail non Ã¨ ancora arrivata puÃ² essere normale? [ASSISTENTE] Potrebbe essere normale che una mail impieghi un po' di tempo per arrivare, a seconda del sistema di posta elettronica utilizzato. [...]  Se hai bisogno di ulteriore assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2931 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 98
   ğŸ“Š Token totali stimati: 546
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] La mail non Ã¨ ancora arrivata puÃ² essere normale? [ASSISTENTE] Potrebbe essere normale che una mail impieghi un po' di tempo per arrivare, a seconda del sistema di posta elettronica utilizzato. [...]  Se hai bisogno di ulteriore assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'La conversazione riguarda una richiesta di informazioni su una mail che non Ã¨ stata ricevuta. Non vi sono riferimenti a problemi medici o a servizi sp'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:03.573286
====================================================================================================
ğŸ“‹ Session ID: classify_1756762623
â±ï¸  Processing Time: 1.434s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (336 chars):
   [UTENTE] La mail non Ã¨ ancora arrivata puÃ² essere normale? [ASSISTENTE] Potrebbe essere normale che una mail impieghi un po' di tempo per arrivare, a seconda del sistema di posta elettronica utiliz...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'La conversazione riguarda una richiesta di informazioni su una mail che non Ã¨ stata ricevuta. Non vi sono riferimenti a problemi medici o a servizi sp'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: La conversazione riguarda una richiesta di informazioni su una mail che non Ã¨ stata ricevuta. Non vi sono riferimenti a problemi medici o a servizi sp
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda una richiesta di informazioni su una mail che non Ã¨ stata ricevuta. Non vi sono riferimenti a problemi medici o a servizi sp
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 718f418665c5d70dca86439a5105ddf5 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 316
   ğŸ“Š Token totali: 765
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 765 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 316
   ğŸ“Š Token conversazione finale: 316
   ğŸ“Š Token totali: 765
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1118 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buona sera Giulia  [ASSISTENTE] Buona sera! Come posso esserti utile? ğŸ˜Š [UTENTE] Allora, devo entrare nella sezione referti, perÃ² non posso piÃ¹ entrare, perchÃ© non ho piÃ¹ il vecchio numero e non posso neppure cambiare il numero ti telefono dal vecchio a quello nuovo, perchÃ© giustamente m..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 316
   ğŸ“Š Token totali stimati: 765
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buona sera Giulia  [ASSISTENTE] Buona sera! Come posso esserti utile? ğŸ˜Š [UTENTE] Allora, devo entrare nella sezione referti, perÃ² non posso piÃ¹ entrare, perchÃ© non ho piÃ¹ il vecchio numero e non posso neppure cambiare il numero ti telefono dal vecchio a quello nuovo, perchÃ© giustamente m..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla difficoltÃ  dell'utente nel cambiare il proprio numero di telefono associato all'account di Humanitas co"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:06.724498
====================================================================================================
ğŸ“‹ Session ID: classify_1756762626
â±ï¸  Processing Time: 3.063s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1118 chars):
   [UTENTE] Buona sera Giulia  [ASSISTENTE] Buona sera! Come posso esserti utile? ğŸ˜Š [UTENTE] Allora, devo entrare nella sezione referti, perÃ² non posso piÃ¹ entrare, perchÃ© non ho piÃ¹ il vecchio numero...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla difficoltÃ  dell'utente nel cambiare il proprio numero di telefono associato all'account di Humanitas co"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte principalmente sulla difficoltÃ  dell'utente nel cambiare il proprio numero di telefono associato all'account di Humanitas co
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte principalmente sulla difficoltÃ  dell'utente nel cambiare il proprio numero di telefono associato all'account di Humanitas co
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione b22a99e98060e6bf0c13425201558065 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 278
   ğŸ“Š Token totali: 726
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 726 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 278
   ğŸ“Š Token conversazione finale: 278
   ğŸ“Š Token totali: 726
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 919 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] VENGONO INVIATE EMAIL PER CONFERMA INTERVENTO [ASSISTENTE] Puoi fornirmi maggiori dettagli? Intendi sapere se Humanitas invia email per confermare un intervento chirurgico? [UTENTE] si [ASSISTENTE] SÃ¬, Humanitas invia email per confermare gli interventi chirurgici. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2965 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 278
   ğŸ“Š Token totali stimati: 726
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] VENGONO INVIATE EMAIL PER CONFERMA INTERVENTO [ASSISTENTE] Puoi fornirmi maggiori dettagli? Intendi sapere se Humanitas invia email per confermare un intervento chirurgico? [UTENTE] si [ASSISTENTE] SÃ¬, Humanitas invia email per confermare gli interventi chirurgici. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted Label:** Prenotazione\n\n**Confidence:** 0.95\n\n**Motivation:** La conversazione verte prin'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:08.633487
====================================================================================================
ğŸ“‹ Session ID: classify_1756762628
â±ï¸  Processing Time: 1.823s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (919 chars):
   [UTENTE] VENGONO INVIATE EMAIL PER CONFERMA INTERVENTO [ASSISTENTE] Puoi fornirmi maggiori dettagli? Intendi sapere se Humanitas invia email per confermare un intervento chirurgico? [UTENTE] si [AS...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (195 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted Label:** Prenotazione\n\n**Confidence:** 0.95\n\n**Motivation:** La conversazione verte prin'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **Predicted Label:** Prenotazione

**Confidence:** 0.95

**Motivation:** La conversazione verte prin
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **Predicted Label:** Prenotazione

**Confidence:** 0.95

**Motivation:** La conversazione verte prin
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione eaccaf93db29cd246ac9381a1205837f classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 447
   ğŸ’¬ Token conversazione: 264
   ğŸ“Š Token totali: 711
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 711 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 447
   ğŸ“Š Token conversazione originale: 264
   ğŸ“Š Token conversazione finale: 264
   ğŸ“Š Token totali: 711
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 895 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, per errore ho cancellato una mail newletter ricevuta il 01/08/2025 che, fra gli altri link,  conteneva il link CARENZA DI VITAMINE: quali sono i sintomi ? Cortesemente posso riceverla di nuovo ? Grazie [ASSISTENTE] Non ho accesso diretto alle email o alle newsletter inviate d..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2960 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 447
   ğŸ“Š Token conversazione: 264
   ğŸ“Š Token totali stimati: 711
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, per errore ho cancellato una mail newletter ricevuta il 01/08/2025 che, fra gli altri link,  conteneva il link CARENZA DI VITAMINE: quali sono i sintomi ? Cortesemente posso riceverla di nuovo ? Grazie [ASSISTENTE] Non ho accesso diretto alle email o alle newsletter inviate d..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted Label:** altro\n\n**Confidence:** 0.95\n\n**Motivation:** La conversazione verte principalme'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:11.734122
====================================================================================================
ğŸ“‹ Session ID: classify_1756762631
â±ï¸  Processing Time: 3.014s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (895 chars):
   [UTENTE] Buongiorno, per errore ho cancellato una mail newletter ricevuta il 01/08/2025 che, fra gli altri link,  conteneva il link CARENZA DI VITAMINE: quali sono i sintomi ? Cortesemente posso ri...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (195 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted Label:** altro\n\n**Confidence:** 0.95\n\n**Motivation:** La conversazione verte principalme'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **Predicted Label:** altro

**Confidence:** 0.95

**Motivation:** La conversazione verte principalme
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **Predicted Label:** altro

**Confidence:** 0.95

**Motivation:** La conversazione verte principalme
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione d4643250e4b98b4e693e793560142d63 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 608
   ğŸ“Š Token totali: 1057
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1057 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 608
   ğŸ“Š Token conversazione finale: 608
   ğŸ“Š Token totali: 1057
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2063 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ho mal di pancia e sto cercando cosa fare [ASSISTENTE] Come assistente digitale di Humanitas, il mio scopo Ã¨ fornire informazioni di carattere generale e notizie inerenti lâ€™ospedale. Per il tuo mal di pancia, ti consiglio di rivolgerti al tuo medico di fiducia o al tuo medico di Medicina..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 608
   ğŸ“Š Token totali stimati: 1057
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ho mal di pancia e sto cercando cosa fare [ASSISTENTE] Come assistente digitale di Humanitas, il mio scopo Ã¨ fornire informazioni di carattere generale e notizie inerenti lâ€™ospedale. Per il tuo mal di pancia, ti consiglio di rivolgerti al tuo medico di fiducia o al tuo medico di Medicina..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:13.785507
====================================================================================================
ğŸ“‹ Session ID: classify_1756762633
â±ï¸  Processing Time: 1.964s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2063 chars):
   [UTENTE] Ho mal di pancia e sto cercando cosa fare [ASSISTENTE] Come assistente digitale di Humanitas, il mio scopo Ã¨ fornire informazioni di carattere generale e notizie inerenti lâ€™ospedale. Per i...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (97 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 9d277ad5d440ec8a541a2ef7d607846b classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 475
   ğŸ“Š Token totali: 903
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 903 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 475
   ğŸ“Š Token conversazione finale: 475
   ğŸ“Š Token totali: 903
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2111 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] hello [ASSISTENTE] Hello! How can I assist you today? [UTENTE] Do you provide alcoholism treatment? [ASSISTENTE] To determine if Humanitas provides treatment for alcoholism, I will need to check the available information. Please give me a moment.Humanitas provides treatment for condition..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 475
   ğŸ“Š Token totali stimati: 903
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] hello [ASSISTENTE] Hello! How can I assist you today? [UTENTE] Do you provide alcoholism treatment? [ASSISTENTE] To determine if Humanitas provides treatment for alcoholism, I will need to check the available information. Please give me a moment.Humanitas provides treatment for condition..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: #### Classificazione conversazione\n\nLa conversazione verte principalmente sulla prenotazione di un a'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:24.188595
====================================================================================================
ğŸ“‹ Session ID: classify_1756762644
â±ï¸  Processing Time: 10.315s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2111 chars):
   [UTENTE] hello [ASSISTENTE] Hello! How can I assist you today? [UTENTE] Do you provide alcoholism treatment? [ASSISTENTE] To determine if Humanitas provides treatment for alcoholism, I will need to...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (193 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: #### Classificazione conversazione\n\nLa conversazione verte principalmente sulla prenotazione di un a'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: #### Classificazione conversazione

La conversazione verte principalmente sulla prenotazione di un a
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: #### Classificazione conversazione

La conversazione verte principalmente sulla prenotazione di un a
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 46d4af0cf0bfd3c5b646797c96992b55 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 447
   ğŸ’¬ Token conversazione: 115
   ğŸ“Š Token totali: 562
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 562 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 447
   ğŸ“Š Token conversazione originale: 115
   ğŸ“Š Token conversazione finale: 115
   ğŸ“Š Token totali: 562
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 385 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia, cosa vuol dire ICE? [ASSISTENTE] "ICE" Ã¨ l'acronimo di "In Case of Emergency" (in caso di emergenza). [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2857 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 447
   ğŸ“Š Token conversazione: 115
   ğŸ“Š Token totali stimati: 562
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia, cosa vuol dire ICE? [ASSISTENTE] "ICE" Ã¨ l'acronimo di "In Case of Emergency" (in caso di emergenza). [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:26.445190
====================================================================================================
ğŸ“‹ Session ID: classify_1756762646
â±ï¸  Processing Time: 2.150s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (385 chars):
   [UTENTE] Ciao Giulia, cosa vuol dire ICE? [ASSISTENTE] "ICE" Ã¨ l'acronimo di "In Case of Emergency" (in caso di emergenza). Viene spesso utilizzato per indicare un contatto da chiamare in caso di e...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 068fcc4b039b0805227863134d255d81 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 980
   ğŸ“Š Token totali: 1428
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1428 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 980
   ğŸ“Š Token conversazione finale: 980
   ğŸ“Š Token totali: 1428
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 3337 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Che bello iniziare un percorso equilibrato di benessere e stile di vita [ASSISTENTE] Sono felice che tu voglia intraprendere un percorso di benessere e stile di vita equilibrato! Se hai bisogno di informazioni su servizi, visite o percorsi specifici offerti da Humanitas, sono qui per aiu..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 980
   ğŸ“Š Token totali stimati: 1428
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Che bello iniziare un percorso equilibrato di benessere e stile di vita [ASSISTENTE] Sono felice che tu voglia intraprendere un percorso di benessere e stile di vita equilibrato! Se hai bisogno di informazioni su servizi, visite o percorsi specifici offerti da Humanitas, sono qui per aiu..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'benessere', 'confidence': 0.75, 'motivation': "La conversazione verte principalmente sull'obiettivo di raggiungere uno stile di vita equilibrato e sano, con domande specifiche su obiettivi quotidiani e consigli per il benessere personale."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:28.648728
====================================================================================================
ğŸ“‹ Session ID: classify_1756762648
â±ï¸  Processing Time: 2.118s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (3337 chars):
   [UTENTE] Che bello iniziare un percorso equilibrato di benessere e stile di vita [ASSISTENTE] Sono felice che tu voglia intraprendere un percorso di benessere e stile di vita equilibrato! Se hai bi...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (261 chars):
   {'predicted_label': 'benessere', 'confidence': 0.75, 'motivation': "La conversazione verte principalmente sull'obiettivo di raggiungere uno stile di vita equilibrato e sano, con domande specifiche su obiettivi quotidiani e consigli per il benessere personale."}

ğŸ“Š Parsed Response:
   predicted_label: benessere
   confidence: 0.75
   motivation: La conversazione verte principalmente sull'obiettivo di raggiungere uno stile di vita equilibrato e sano, con domande specifiche su obiettivi quotidiani e consigli per il benessere personale.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.750
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 75.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte principalmente sull'obiettivo di raggiungere uno stile di vita equilibrato e sano, con domande specifiche su obiettivi quotidiani e consigli per il benessere personale.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 4a47c0d59d3c1eb836614b7cef7014f2 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  âœ… Nuovo tag 'benessere' aggiunto per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 124
   ğŸ“Š Token totali: 572
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 572 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 124
   ğŸ“Š Token conversazione finale: 124
   ğŸ“Š Token totali: 572
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 388 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno vorrei sapere se fate l'esame ANTICORPI ANTI PIASTRINE TEST DIRETTO [ASSISTENTE] Non ho trovato informazioni specifiche sull'esame "ANTICORPI ANTI PIASTRINE TEST DIRETTO" nei documenti forniti. [...]  Se hai bisogno di ulteriori dettagli o assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2953 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 124
   ğŸ“Š Token totali stimati: 572
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno vorrei sapere se fate l'esame ANTICORPI ANTI PIASTRINE TEST DIRETTO [ASSISTENTE] Non ho trovato informazioni specifiche sull'esame "ANTICORPI ANTI PIASTRINE TEST DIRETTO" nei documenti forniti. [...]  Se hai bisogno di ulteriori dettagli o assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.85, 'motivation': "La conversazione verte sull'esame ANTICORPI ANTI PIASTRINE TEST DIRETTO, che Ã¨ un'analisi medica.", 'predicted_label': 'Analisi'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:30.496163
====================================================================================================
ğŸ“‹ Session ID: classify_1756762650
â±ï¸  Processing Time: 1.751s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (388 chars):
   [UTENTE] Buongiorno vorrei sapere se fate l'esame ANTICORPI ANTI PIASTRINE TEST DIRETTO [ASSISTENTE] Non ho trovato informazioni specifiche sull'esame "ANTICORPI ANTI PIASTRINE TEST DIRETTO" nei do...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (165 chars):
   {'confidence': 0.85, 'motivation': "La conversazione verte sull'esame ANTICORPI ANTI PIASTRINE TEST DIRETTO, che Ã¨ un'analisi medica.", 'predicted_label': 'Analisi'}

ğŸ“Š Parsed Response:
   predicted_label: Analisi
   confidence: 0.85
   motivation: La conversazione verte sull'esame ANTICORPI ANTI PIASTRINE TEST DIRETTO, che Ã¨ un'analisi medica.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.850
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] 85.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'esame ANTICORPI ANTI PIASTRINE TEST DIRETTO, che Ã¨ un'analisi medica.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 3de313896771b6c6c601096d159d2f29 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Analisi' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 332
   ğŸ“Š Token totali: 760
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 760 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 332
   ğŸ“Š Token conversazione finale: 332
   ğŸ“Š Token totali: 760
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1136 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno eseguite esame del sangue per allergia nickel? [ASSISTENTE] Non ho trovato informazioni specifiche sull'esecuzione di un esame del sangue per l'allergia al nichel presso Humanitas. [...] it/malattie/allergia-al-nichel)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2834 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 332
   ğŸ“Š Token totali stimati: 760
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno eseguite esame del sangue per allergia nickel? [ASSISTENTE] Non ho trovato informazioni specifiche sull'esecuzione di un esame del sangue per l'allergia al nichel presso Humanitas. [...] it/malattie/allergia-al-nichel)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte sull'esecuzione di un esame del sangue per l'allergia al nichel presso Humanitas. Tuttavia, l'assistente non ha trovato info"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:33.622231
====================================================================================================
ğŸ“‹ Session ID: classify_1756762653
â±ï¸  Processing Time: 3.039s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1136 chars):
   [UTENTE] Buongiorno eseguite esame del sangue per allergia nickel? [ASSISTENTE] Non ho trovato informazioni specifiche sull'esecuzione di un esame del sangue per l'allergia al nichel presso Humanit...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte sull'esecuzione di un esame del sangue per l'allergia al nichel presso Humanitas. Tuttavia, l'assistente non ha trovato info"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte sull'esecuzione di un esame del sangue per l'allergia al nichel presso Humanitas. Tuttavia, l'assistente non ha trovato info
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte sull'esecuzione di un esame del sangue per l'allergia al nichel presso Humanitas. Tuttavia, l'assistente non ha trovato info
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 20687302bd052509933722acba343fe0 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 197
   ğŸ“Š Token totali: 645
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 645 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 197
   ğŸ“Š Token conversazione finale: 197
   ğŸ“Š Token totali: 645
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 608 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] cistiscopia [ASSISTENTE] Puoi chiarire meglio la tua richiesta? Intendi sapere:

1. [...]  

Se hai bisogno di ulteriori informazioni o assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2847 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 197
   ğŸ“Š Token totali stimati: 645
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] cistiscopia [ASSISTENTE] Puoi chiarire meglio la tua richiesta? Intendi sapere:

1. [...]  

Se hai bisogno di ulteriori informazioni o assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.75, 'motivation': "La conversazione verte sull'esecuzione di una cistoscopia e sulle informazioni relative ai medici che la eseguono, il che indica una richiesta di visita specialistica.", 'predicted_label': 'Visita Specialistica'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:35.451822
====================================================================================================
ğŸ“‹ Session ID: classify_1756762655
â±ï¸  Processing Time: 1.743s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (608 chars):
   [UTENTE] cistiscopia [ASSISTENTE] Puoi chiarire meglio la tua richiesta? Intendi sapere:

1. Se eseguiamo la cistoscopia presso Humanitas?
2. Come prepararti per una cistoscopia?
3. Altro?

Fammi s...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [77 more lines] ...
     Line 81: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (248 chars):
   {'confidence': 0.75, 'motivation': "La conversazione verte sull'esecuzione di una cistoscopia e sulle informazioni relative ai medici che la eseguono, il che indica una richiesta di visita specialistica.", 'predicted_label': 'Visita Specialistica'}

ğŸ“Š Parsed Response:
   predicted_label: Visita Specialistica
   confidence: 0.75
   motivation: La conversazione verte sull'esecuzione di una cistoscopia e sulle informazioni relative ai medici che la eseguono, il che indica una richiesta di visita specialistica.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.750
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 75.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'esecuzione di una cistoscopia e sulle informazioni relative ai medici che la eseguono, il che indica una richiesta di visita specialistica.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 72d2dd9215e7000983bd8e9f38aa3a0d classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Visita Specialistica' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 138
   ğŸ“Š Token totali: 566
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 566 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 138
   ğŸ“Š Token conversazione finale: 138
   ğŸ“Š Token totali: 566
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 430 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] humanitas effettua l'holter cardiaco di 20 giorni? [ASSISTENTE] Non ho trovato informazioni specifiche sull'Holter cardiaco di 20 giorni presso Humanitas. [...] it/pazienti/diagnosi/esami-del-cuore-e-vascolari/7952-elettrocardiogramma)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2840 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 138
   ğŸ“Š Token totali stimati: 566
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] humanitas effettua l'holter cardiaco di 20 giorni? [ASSISTENTE] Non ho trovato informazioni specifiche sull'Holter cardiaco di 20 giorni presso Humanitas. [...] it/pazienti/diagnosi/esami-del-cuore-e-vascolari/7952-elettrocardiogramma)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.8, 'motivation': "La conversazione riguarda un esame diagnostico specifico, l'Holter cardiaco di 20 giorni.", 'predicted_label': 'Analisi'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:36.959702
====================================================================================================
ğŸ“‹ Session ID: classify_1756762656
â±ï¸  Processing Time: 1.422s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (430 chars):
   [UTENTE] humanitas effettua l'holter cardiaco di 20 giorni? [ASSISTENTE] Non ho trovato informazioni specifiche sull'Holter cardiaco di 20 giorni presso Humanitas. Ti consiglio di contattare dirett...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (156 chars):
   {'confidence': 0.8, 'motivation': "La conversazione riguarda un esame diagnostico specifico, l'Holter cardiaco di 20 giorni.", 'predicted_label': 'Analisi'}

ğŸ“Š Parsed Response:
   predicted_label: Analisi
   confidence: 0.8
   motivation: La conversazione riguarda un esame diagnostico specifico, l'Holter cardiaco di 20 giorni.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.800
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘] 80.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda un esame diagnostico specifico, l'Holter cardiaco di 20 giorni.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 05a1984cee2b4cc64f5eae1d3e0c6fff classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Analisi' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 137
   ğŸ“Š Token totali: 585
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 585 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 137
   ğŸ“Š Token conversazione finale: 137
   ğŸ“Š Token totali: 585
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 466 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Oggi si possono fare esami del sangue all' Humanitas di Rozzano? [ASSISTENTE] Per sapere se oggi Ã¨ possibile effettuare esami del sangue presso l'Humanitas di Rozzano, ti consiglio di contattare direttamente il punto prelievi. Puoi trovare tutte le informazioni sui punti prelievi e gli o..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 137
   ğŸ“Š Token totali stimati: 585
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Oggi si possono fare esami del sangue all' Humanitas di Rozzano? [ASSISTENTE] Per sapere se oggi Ã¨ possibile effettuare esami del sangue presso l'Humanitas di Rozzano, ti consiglio di contattare direttamente il punto prelievi. Puoi trovare tutte le informazioni sui punti prelievi e gli o..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione riguarda la disponibilitÃ  di esami del sangue all'ospedale Humanitas di Rozzano.", 'predicted_label': 'Analisi'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:38.474156
====================================================================================================
ğŸ“‹ Session ID: classify_1756762658
â±ï¸  Processing Time: 1.426s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (466 chars):
   [UTENTE] Oggi si possono fare esami del sangue all' Humanitas di Rozzano? [ASSISTENTE] Per sapere se oggi Ã¨ possibile effettuare esami del sangue presso l'Humanitas di Rozzano, ti consiglio di cont...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (165 chars):
   {'confidence': 0.95, 'motivation': "La conversazione riguarda la disponibilitÃ  di esami del sangue all'ospedale Humanitas di Rozzano.", 'predicted_label': 'Analisi'}

ğŸ“Š Parsed Response:
   predicted_label: Analisi
   confidence: 0.95
   motivation: La conversazione riguarda la disponibilitÃ  di esami del sangue all'ospedale Humanitas di Rozzano.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la disponibilitÃ  di esami del sangue all'ospedale Humanitas di Rozzano.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 45d84637ecd854d453ce730a106e7829 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Analisi' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 750
   ğŸ“Š Token totali: 1199
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1199 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 750
   ğŸ“Š Token conversazione finale: 750
   ğŸ“Š Token totali: 1199
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2396 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] quali esami di laboratorio fate? [ASSISTENTE] Il Laboratorio Analisi dellâ€™IRCCS Istituto Clinico Humanitas offre una vasta gamma di esami di laboratorio, tra cui esami di base e specialistici per la promozione della salute, prevenzione, diagnosi e monitoraggio terapeutico. Gli esami incl..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 750
   ğŸ“Š Token totali stimati: 1199
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] quali esami di laboratorio fate? [ASSISTENTE] Il Laboratorio Analisi dellâ€™IRCCS Istituto Clinico Humanitas offre una vasta gamma di esami di laboratorio, tra cui esami di base e specialistici per la promozione della salute, prevenzione, diagnosi e monitoraggio terapeutico. Gli esami incl..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted label:** Analisi\n\n**Confidence:** 0.85\n\n**Motivation:** La conversazione verte principal'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:41.466059
====================================================================================================
ğŸ“‹ Session ID: classify_1756762661
â±ï¸  Processing Time: 2.906s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2396 chars):
   [UTENTE] quali esami di laboratorio fate? [ASSISTENTE] Il Laboratorio Analisi dellâ€™IRCCS Istituto Clinico Humanitas offre una vasta gamma di esami di laboratorio, tra cui esami di base e specialist...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (195 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted label:** Analisi\n\n**Confidence:** 0.85\n\n**Motivation:** La conversazione verte principal'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **Predicted label:** Analisi

**Confidence:** 0.85

**Motivation:** La conversazione verte principal
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **Predicted label:** Analisi

**Confidence:** 0.85

**Motivation:** La conversazione verte principal
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 6f887efb3b602d3e97c45dbe2178947d classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 211
   ğŸ“Š Token totali: 659
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 659 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 211
   ğŸ“Š Token conversazione finale: 211
   ğŸ“Š Token totali: 659
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 637 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno volevo sapere se eseguire il seguente esame  anticorpi anti cardiolipina (IGG,IGM,IGN) Grazie  [ASSISTENTE] SÃ¬, presso Humanitas Ã¨ possibile eseguire il test per gli anticorpi anti-cardiolipina (IgG, IgM, IgA). [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2910 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 211
   ğŸ“Š Token totali stimati: 659
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno volevo sapere se eseguire il seguente esame  anticorpi anti cardiolipina (IGG,IGM,IGN) Grazie  [ASSISTENTE] SÃ¬, presso Humanitas Ã¨ possibile eseguire il test per gli anticorpi anti-cardiolipina (IgG, IgM, IgA). [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': '| predicted_label       | confidenza | motivazione                                                                 |'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:44.533910
====================================================================================================
ğŸ“‹ Session ID: classify_1756762664
â±ï¸  Processing Time: 2.981s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (637 chars):
   [UTENTE] Buongiorno volevo sapere se eseguire il seguente esame  anticorpi anti cardiolipina (IGG,IGM,IGN) Grazie  [ASSISTENTE] SÃ¬, presso Humanitas Ã¨ possibile eseguire il test per gli anticorpi a...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (181 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': '| predicted_label       | confidenza | motivazione                                                                 |'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: | predicted_label       | confidenza | motivazione                                                                 |
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   | predicted_label       | confidenza | motivazione                                                                 |
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 7cfa00c1f68fd377129f5257270f972b classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 240
   ğŸ“Š Token totali: 689
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 689 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 240
   ğŸ“Š Token conversazione finale: 240
   ğŸ“Š Token totali: 689
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 728 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, vorrei prenotare un esame per la frammentazione del DNA spermatico [ASSISTENTE] Per prenotare un esame per la frammentazione del DNA spermatico, ti consiglio di contattare direttamente il Fertility Center di Humanitas. Questo esame, come il TUNEL, SCSA o HALO, Ã¨ utilizzato pe..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 240
   ğŸ“Š Token totali stimati: 689
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, vorrei prenotare un esame per la frammentazione del DNA spermatico [ASSISTENTE] Per prenotare un esame per la frammentazione del DNA spermatico, ti consiglio di contattare direttamente il Fertility Center di Humanitas. Questo esame, come il TUNEL, SCSA o HALO, Ã¨ utilizzato pe..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.9, 'motivation': "La conversazione verte sull'esecuzione di un esame specifico per la frammentazione del DNA spermatico, che rientra nella categoria delle analisi.", 'predicted_label': 'Analisi'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:46.282387
====================================================================================================
ğŸ“‹ Session ID: classify_1756762666
â±ï¸  Processing Time: 1.661s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (728 chars):
   [UTENTE] Buongiorno, vorrei prenotare un esame per la frammentazione del DNA spermatico [ASSISTENTE] Per prenotare un esame per la frammentazione del DNA spermatico, ti consiglio di contattare dire...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (212 chars):
   {'confidence': 0.9, 'motivation': "La conversazione verte sull'esecuzione di un esame specifico per la frammentazione del DNA spermatico, che rientra nella categoria delle analisi.", 'predicted_label': 'Analisi'}

ğŸ“Š Parsed Response:
   predicted_label: Analisi
   confidence: 0.9
   motivation: La conversazione verte sull'esecuzione di un esame specifico per la frammentazione del DNA spermatico, che rientra nella categoria delle analisi.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.900
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 90.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'esecuzione di un esame specifico per la frammentazione del DNA spermatico, che rientra nella categoria delle analisi.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 90c97c1546b791d02ded4c50a7678bcd classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Analisi' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 218
   ğŸ“Š Token totali: 646
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 646 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 218
   ğŸ“Š Token conversazione finale: 218
   ğŸ“Š Token totali: 646
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 739 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] buonasera, ho un'intervento prenotato ma vorrei maggiori informazioni [ASSISTENTE] Buonasera! Potresti specificare se il tuo intervento Ã¨ stato prenotato tramite il Servizio Sanitario Nazionale (SSN) o in regime privato? In questo modo potrÃ² fornirti le informazioni piÃ¹ appropriate. [UTE..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 218
   ğŸ“Š Token totali stimati: 646
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] buonasera, ho un'intervento prenotato ma vorrei maggiori informazioni [ASSISTENTE] Buonasera! Potresti specificare se il tuo intervento Ã¨ stato prenotato tramite il Servizio Sanitario Nazionale (SSN) o in regime privato? In questo modo potrÃ² fornirti le informazioni piÃ¹ appropriate. [UTE..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:48.055706
====================================================================================================
ğŸ“‹ Session ID: classify_1756762668
â±ï¸  Processing Time: 1.687s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (739 chars):
   [UTENTE] buonasera, ho un'intervento prenotato ma vorrei maggiori informazioni [ASSISTENTE] Buonasera! Potresti specificare se il tuo intervento Ã¨ stato prenotato tramite il Servizio Sanitario Nazi...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione ab28dfb1183e910c1701b9c56ad9b080 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 103
   ğŸ“Š Token totali: 552
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 552 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 103
   ğŸ“Š Token conversazione finale: 103
   ğŸ“Š Token totali: 552
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 333 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ã¨ obbligatorio portare la prescrizione del medico di base per effettuare i raggi x alla mano sinistra ? [ASSISTENTE] SÃ¬, Ã¨ obbligatorio avere la prescrizione del medico di base per effettuare i raggi X, sia per prenotare che per eseguire l'esame. Se hai bisogno di ulteriori informazioni o a..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2972 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 103
   ğŸ“Š Token totali stimati: 552
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ã¨ obbligatorio portare la prescrizione del medico di base per effettuare i raggi x alla mano sinistra ? [ASSISTENTE] SÃ¬, Ã¨ obbligatorio avere la prescrizione del medico di base per effettuare i raggi X, sia per prenotare che per eseguire l'esame. Se hai bisogno di ulteriori informazioni o a..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': 'La conversazione riguarda la necessitÃ  della prescrizione del medico di base per effettuare un esame a raggi X, che Ã¨ una procedura prenotabile.', 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:49.764116
====================================================================================================
ğŸ“‹ Session ID: classify_1756762669
â±ï¸  Processing Time: 1.622s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (333 chars):
   [UTENTE] Ã¨ obbligatorio portare la prescrizione del medico di base per effettuare i raggi x alla mano sinistra ? [ASSISTENTE] SÃ¬, Ã¨ obbligatorio avere la prescrizione del medico di base per effettu...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (217 chars):
   {'confidence': 0.95, 'motivation': 'La conversazione riguarda la necessitÃ  della prescrizione del medico di base per effettuare un esame a raggi X, che Ã¨ una procedura prenotabile.', 'predicted_label': 'Prenotazione'}

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.95
   motivation: La conversazione riguarda la necessitÃ  della prescrizione del medico di base per effettuare un esame a raggi X, che Ã¨ una procedura prenotabile.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la necessitÃ  della prescrizione del medico di base per effettuare un esame a raggi X, che Ã¨ una procedura prenotabile.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione ba7bcd308cfce6a26883fa5ce35530fb classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 276
   ğŸ“Š Token totali: 724
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 724 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 276
   ğŸ“Š Token conversazione finale: 276
   ğŸ“Š Token totali: 724
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 987 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Salve,

attraverso la mia assicurazione "Generali" ho inserito la pratica "Valutazione nutrizionistica/dietista (con relazione finale)" in prestazione diretta presso Medical Care De Angeli (Nr. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2940 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 276
   ğŸ“Š Token totali stimati: 724
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Salve,

attraverso la mia assicurazione "Generali" ho inserito la pratica "Valutazione nutrizionistica/dietista (con relazione finale)" in prestazione diretta presso Medical Care De Angeli (Nr. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione riguarda la prenotazione di una visita nutrizionistica/dietista con la dottoressa Martina Francia attraverso l'assicurazione Gener"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:52.856636
====================================================================================================
ğŸ“‹ Session ID: classify_1756762672
â±ï¸  Processing Time: 2.999s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (987 chars):
   [UTENTE] Salve,

attraverso la mia assicurazione "Generali" ho inserito la pratica "Valutazione nutrizionistica/dietista (con relazione finale)" in prestazione diretta presso Medical Care De Angeli...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione riguarda la prenotazione di una visita nutrizionistica/dietista con la dottoressa Martina Francia attraverso l'assicurazione Gener"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione riguarda la prenotazione di una visita nutrizionistica/dietista con la dottoressa Martina Francia attraverso l'assicurazione Gener
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione riguarda la prenotazione di una visita nutrizionistica/dietista con la dottoressa Martina Francia attraverso l'assicurazione Gener
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 34ed90e4d2748f327756b223074254fd classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
   ğŸ“ˆ Progresso LLM: 100/155
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 2755
   ğŸ“Š Token totali: 3203
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 3203 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 2755
   ğŸ“Š Token conversazione finale: 2755
   ğŸ“Š Token totali: 3203
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 9659 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Chiamando questo numero: 0282248224 come funziona la prenotazione di una visita per una rinosettoplastica? In una mail in cui ho scritto se fosse possibile aggiungere alla rinoplastica (A pagamento) anche la settoplastica (coprendola con ssn) mi  Ã¨ stato detto che prima di tutto devo far..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 2755
   ğŸ“Š Token totali stimati: 3203
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Chiamando questo numero: 0282248224 come funziona la prenotazione di una visita per una rinosettoplastica? In una mail in cui ho scritto se fosse possibile aggiungere alla rinoplastica (A pagamento) anche la settoplastica (coprendola con ssn) mi  Ã¨ stato detto che prima di tutto devo far..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: La conversazione Ã¨ incentrata sulla prenotazione di una visita per una rinosettoplastica e sulle rel'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:57.303485
====================================================================================================
ğŸ“‹ Session ID: classify_1756762677
â±ï¸  Processing Time: 4.361s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (9659 chars):
   [UTENTE] Chiamando questo numero: 0282248224 come funziona la prenotazione di una visita per una rinosettoplastica? In una mail in cui ho scritto se fosse possibile aggiungere alla rinoplastica (A ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: La conversazione Ã¨ incentrata sulla prenotazione di una visita per una rinosettoplastica e sulle rel'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: La conversazione Ã¨ incentrata sulla prenotazione di una visita per una rinosettoplastica e sulle rel
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: La conversazione Ã¨ incentrata sulla prenotazione di una visita per una rinosettoplastica e sulle rel
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 7ecde53cad00653c1176c0e3d724d446 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 158
   ğŸ“Š Token totali: 586
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 586 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 158
   ğŸ“Š Token conversazione finale: 158
   ğŸ“Š Token totali: 586
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 547 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] perchÃ¨ per il prericovero Ã¨ richiesta l'impegnativa per il ricovero? [ASSISTENTE] L'impegnativa per il ricovero Ã¨ necessaria per il prericovero in quanto rappresenta la prescrizione medica che autorizza e giustifica l'accesso alle prestazioni sanitarie previste dal Servizio Sanitario Naz..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 158
   ğŸ“Š Token totali stimati: 586
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] perchÃ¨ per il prericovero Ã¨ richiesta l'impegnativa per il ricovero? [ASSISTENTE] L'impegnativa per il ricovero Ã¨ necessaria per il prericovero in quanto rappresenta la prescrizione medica che autorizza e giustifica l'accesso alle prestazioni sanitarie previste dal Servizio Sanitario Naz..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.85, 'motivation': "La conversazione verte sull'impegnativa richiesta per il ricovero, che rientra nei servizi offerti dall'azienda.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:37:58.981026
====================================================================================================
ğŸ“‹ Session ID: classify_1756762678
â±ï¸  Processing Time: 1.590s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (547 chars):
   [UTENTE] perchÃ¨ per il prericovero Ã¨ richiesta l'impegnativa per il ricovero? [ASSISTENTE] L'impegnativa per il ricovero Ã¨ necessaria per il prericovero in quanto rappresenta la prescrizione medica...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (190 chars):
   {'confidence': 0.85, 'motivation': "La conversazione verte sull'impegnativa richiesta per il ricovero, che rientra nei servizi offerti dall'azienda.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.85
   motivation: La conversazione verte sull'impegnativa richiesta per il ricovero, che rientra nei servizi offerti dall'azienda.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.850
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] 85.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'impegnativa richiesta per il ricovero, che rientra nei servizi offerti dall'azienda.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 413956829dedb1f2fdeaaa0160a30ce8 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 326
   ğŸ“Š Token totali: 774
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 774 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 326
   ğŸ“Š Token conversazione finale: 326
   ğŸ“Š Token totali: 774
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1023 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, volevo sapere che esami devo fare per prepararmi all' angio tac coronaricaÃ¹ [ASSISTENTE] Per sapere quali esami o preparazioni sono necessari per un'angio TAC coronarica, ti consiglio di consultare il tuo medico di fiducia o il medico che ti ha prescritto l'esame. Non posso f..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 326
   ğŸ“Š Token totali stimati: 774
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, volevo sapere che esami devo fare per prepararmi all' angio tac coronaricaÃ¹ [ASSISTENTE] Per sapere quali esami o preparazioni sono necessari per un'angio TAC coronarica, ti consiglio di consultare il tuo medico di fiducia o il medico che ti ha prescritto l'esame. Non posso f..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sull'angio TAC coronarica e sugli esami da fare per prepararsi ad esso. L'assistente fornisce informazioni su"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:01.853054
====================================================================================================
ğŸ“‹ Session ID: classify_1756762681
â±ï¸  Processing Time: 2.779s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1023 chars):
   [UTENTE] Buongiorno, volevo sapere che esami devo fare per prepararmi all' angio tac coronaricaÃ¹ [ASSISTENTE] Per sapere quali esami o preparazioni sono necessari per un'angio TAC coronarica, ti co...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sull'angio TAC coronarica e sugli esami da fare per prepararsi ad esso. L'assistente fornisce informazioni su"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte principalmente sull'angio TAC coronarica e sugli esami da fare per prepararsi ad esso. L'assistente fornisce informazioni su
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte principalmente sull'angio TAC coronarica e sugli esami da fare per prepararsi ad esso. L'assistente fornisce informazioni su
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 7ee9cb6a2ece9beeacf740bd28963269 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 85
   ğŸ“Š Token totali: 513
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 513 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 85
   ğŸ“Š Token conversazione finale: 85
   ğŸ“Š Token totali: 513
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 278 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] zyclara [ASSISTENTE] Non ho trovato informazioni specifiche su "Zyclara" nei documenti forniti. Se hai bisogno di dettagli su un farmaco o un trattamento, ti consiglio di consultare il tuo medico o farmacista di fiducia. Se hai ulteriori domande, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2874 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 85
   ğŸ“Š Token totali stimati: 513
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] zyclara [ASSISTENTE] Non ho trovato informazioni specifiche su "Zyclara" nei documenti forniti. Se hai bisogno di dettagli su un farmaco o un trattamento, ti consiglio di consultare il tuo medico o farmacista di fiducia. Se hai ulteriori domande, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "altro", "confidence": 0.75, "m'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:03.445419
====================================================================================================
ğŸ“‹ Session ID: classify_1756762683
â±ï¸  Processing Time: 1.500s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (278 chars):
   [UTENTE] zyclara [ASSISTENTE] Non ho trovato informazioni specifiche su "Zyclara" nei documenti forniti. Se hai bisogno di dettagli su un farmaco o un trattamento, ti consiglio di consultare il tuo...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "altro", "confidence": 0.75, "m'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "altro", "confidence": 0.75, "m
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "altro", "confidence": 0.75, "m
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 4197958f03dfab27c10e27c233c347dd classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 101
   ğŸ“Š Token totali: 549
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 549 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 101
   ğŸ“Š Token conversazione finale: 101
   ğŸ“Š Token totali: 549
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 339 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Nervo pudendo  [ASSISTENTE] Non ho trovato informazioni specifiche sul nervo pudendo nei documenti caricati. [...]  Se posso esserti utile in altro, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2839 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 101
   ğŸ“Š Token totali stimati: 549
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Nervo pudendo  [ASSISTENTE] Non ho trovato informazioni specifiche sul nervo pudendo nei documenti caricati. [...]  Se posso esserti utile in altro, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.75, 'motivation': 'La conversazione riguarda una richiesta di informazioni su un nervo specifico e potrebbe richiedere una visita specializzata per essere approfondita.', 'predicted_label': 'Visita Specialistica'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:05.073828
====================================================================================================
ğŸ“‹ Session ID: classify_1756762685
â±ï¸  Processing Time: 1.542s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (339 chars):
   [UTENTE] Nervo pudendo  [ASSISTENTE] Non ho trovato informazioni specifiche sul nervo pudendo nei documenti caricati. Tuttavia, se hai bisogno di dettagli specifici o di un approfondimento, ti cons...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (230 chars):
   {'confidence': 0.75, 'motivation': 'La conversazione riguarda una richiesta di informazioni su un nervo specifico e potrebbe richiedere una visita specializzata per essere approfondita.', 'predicted_label': 'Visita Specialistica'}

ğŸ“Š Parsed Response:
   predicted_label: Visita Specialistica
   confidence: 0.75
   motivation: La conversazione riguarda una richiesta di informazioni su un nervo specifico e potrebbe richiedere una visita specializzata per essere approfondita.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.750
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 75.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda una richiesta di informazioni su un nervo specifico e potrebbe richiedere una visita specializzata per essere approfondita.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 79c68a302af726b72b69040fa9321fc9 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Visita Specialistica' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 126
   ğŸ“Š Token totali: 574
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 574 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 126
   ğŸ“Š Token conversazione finale: 126
   ğŸ“Š Token totali: 574
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 423 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] per l'impegnativa per per il prericovero Cosa bisogna scrivere come dicitura [ASSISTENTE] Per sapere cosa scrivere come dicitura sull'impegnativa per il prericovero, ti consiglio di consultare il tuo medico di base o lo specialista che ti ha prescritto il ricovero. Saranno loro a indicar..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 126
   ğŸ“Š Token totali stimati: 574
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] per l'impegnativa per per il prericovero Cosa bisogna scrivere come dicitura [ASSISTENTE] Per sapere cosa scrivere come dicitura sull'impegnativa per il prericovero, ti consiglio di consultare il tuo medico di base o lo specialista che ti ha prescritto il ricovero. Saranno loro a indicar..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': 'La conversazione riguarda la richiesta di informazioni su una dicitura da utilizzare in un documento per il ricovero.', 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:06.648570
====================================================================================================
ğŸ“‹ Session ID: classify_1756762686
â±ï¸  Processing Time: 1.487s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (423 chars):
   [UTENTE] per l'impegnativa per per il prericovero Cosa bisogna scrivere come dicitura [ASSISTENTE] Per sapere cosa scrivere come dicitura sull'impegnativa per il prericovero, ti consiglio di consul...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (195 chars):
   {'confidence': 0.95, 'motivation': 'La conversazione riguarda la richiesta di informazioni su una dicitura da utilizzare in un documento per il ricovero.', 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.95
   motivation: La conversazione riguarda la richiesta di informazioni su una dicitura da utilizzare in un documento per il ricovero.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la richiesta di informazioni su una dicitura da utilizzare in un documento per il ricovero.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 08c34af5c43793a03fe535267e0474a1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 82
   ğŸ“Š Token totali: 510
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 510 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 82
   ğŸ“Š Token conversazione finale: 82
   ğŸ“Š Token totali: 510
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 279 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ho bisogno di un oncologo [ASSISTENTE] Per avere informazioni specifiche sui medici oncologi di Humanitas, ti consiglio di visitare la pagina dedicata alla [Ricerca Medici](https://www.humanitas.it/medici/). Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2875 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 82
   ğŸ“Š Token totali stimati: 510
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ho bisogno di un oncologo [ASSISTENTE] Per avere informazioni specifiche sui medici oncologi di Humanitas, ti consiglio di visitare la pagina dedicata alla [Ricerca Medici](https://www.humanitas.it/medici/). Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica Oncologic'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:07.977333
====================================================================================================
ğŸ“‹ Session ID: classify_1756762687
â±ï¸  Processing Time: 1.243s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (279 chars):
   [UTENTE] Ho bisogno di un oncologo [ASSISTENTE] Per avere informazioni specifiche sui medici oncologi di Humanitas, ti consiglio di visitare la pagina dedicata alla [Ricerca Medici](https://www.hum...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica Oncologic'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica Oncologic
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica Oncologic
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 735dca331ea8fad5f21471dfe333e1c5 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 217
   ğŸ“Š Token totali: 645
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 645 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 217
   ğŸ“Š Token conversazione finale: 217
   ğŸ“Š Token totali: 645
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 722 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] NicolÃ² Maria buffi chi Ã¨? [ASSISTENTE] Il Professor NicolÃ² Maria Buffi Ã¨ un medico specializzato in Urologia presso l'UnitÃ  Operativa di Urologia dell'Istituto Clinico Humanitas. [...] it/unita-operative/urologia)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2818 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 217
   ğŸ“Š Token totali stimati: 645
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] NicolÃ² Maria buffi chi Ã¨? [ASSISTENTE] Il Professor NicolÃ² Maria Buffi Ã¨ un medico specializzato in Urologia presso l'UnitÃ  Operativa di Urologia dell'Istituto Clinico Humanitas. [...] it/unita-operative/urologia)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione si concentra sul Professor NicolÃ² Maria Buffi e sulle sue specializzazioni in urologia presso l'Istituto Clinico Humanitas. L'assi"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:11.042304
====================================================================================================
ğŸ“‹ Session ID: classify_1756762691
â±ï¸  Processing Time: 2.979s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (722 chars):
   [UTENTE] NicolÃ² Maria buffi chi Ã¨? [ASSISTENTE] Il Professor NicolÃ² Maria Buffi Ã¨ un medico specializzato in Urologia presso l'UnitÃ  Operativa di Urologia dell'Istituto Clinico Humanitas. Fa parte ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione si concentra sul Professor NicolÃ² Maria Buffi e sulle sue specializzazioni in urologia presso l'Istituto Clinico Humanitas. L'assi"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione si concentra sul Professor NicolÃ² Maria Buffi e sulle sue specializzazioni in urologia presso l'Istituto Clinico Humanitas. L'assi
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione si concentra sul Professor NicolÃ² Maria Buffi e sulle sue specializzazioni in urologia presso l'Istituto Clinico Humanitas. L'assi
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione b4e37a0daa63173343112528e82792ad classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 254
   ğŸ“Š Token totali: 702
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 702 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 254
   ğŸ“Š Token conversazione finale: 254
   ğŸ“Š Token totali: 702
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 773 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] vorrei sapere i nmi dei chirurghi di ortopedia traumatologica [ASSISTENTE] I chirurghi dell'UnitÃ  Operativa di Ortopedia Traumatologica di Humanitas includono:

- **Dottor Lorenzo Di Mento** (Responsabile);
- **Dottor Matteo Cavanna**;
- **Dottor Lorenzo Giordano**;
- **Dottor Paolo Gozz..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 254
   ğŸ“Š Token totali stimati: 702
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] vorrei sapere i nmi dei chirurghi di ortopedia traumatologica [ASSISTENTE] I chirurghi dell'UnitÃ  Operativa di Ortopedia Traumatologica di Humanitas includono:

- **Dottor Lorenzo Di Mento** (Responsabile);
- **Dottor Matteo Cavanna**;
- **Dottor Lorenzo Giordano**;
- **Dottor Paolo Gozz..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': 'La conversazione riguarda la ricerca di informazioni su chirurghi specializzati in una specifica area medica.', 'predicted_label': 'Visita Specialistica'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:12.623058
====================================================================================================
ğŸ“‹ Session ID: classify_1756762692
â±ï¸  Processing Time: 1.491s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (773 chars):
   [UTENTE] vorrei sapere i nmi dei chirurghi di ortopedia traumatologica [ASSISTENTE] I chirurghi dell'UnitÃ  Operativa di Ortopedia Traumatologica di Humanitas includono:

- **Dottor Lorenzo Di Mento...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [78 more lines] ...
     Line 82: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (190 chars):
   {'confidence': 0.95, 'motivation': 'La conversazione riguarda la ricerca di informazioni su chirurghi specializzati in una specifica area medica.', 'predicted_label': 'Visita Specialistica'}

ğŸ“Š Parsed Response:
   predicted_label: Visita Specialistica
   confidence: 0.95
   motivation: La conversazione riguarda la ricerca di informazioni su chirurghi specializzati in una specifica area medica.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la ricerca di informazioni su chirurghi specializzati in una specifica area medica.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione bc8d4282e8d2b5c5702a14e88d309fd0 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Visita Specialistica' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 105
   ğŸ“Š Token totali: 533
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 533 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 105
   ğŸ“Š Token conversazione finale: 105
   ğŸ“Š Token totali: 533
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 371 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] come posso contattare la struttura del Dottor Carlo Castoro per la conferma di un appuntamento ? [ASSISTENTE] Per ottenere informazioni specifiche sul Dottor Carlo Castoro e sulla struttura in cui opera, ti consiglio di consultare la pagina [Ricerca Medici](https://www.humanitas.it/medic..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 105
   ğŸ“Š Token totali stimati: 533
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] come posso contattare la struttura del Dottor Carlo Castoro per la conferma di un appuntamento ? [ASSISTENTE] Per ottenere informazioni specifiche sul Dottor Carlo Castoro e sulla struttura in cui opera, ti consiglio di consultare la pagina [Ricerca Medici](https://www.humanitas.it/medic..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.7, 'motivation': "La conversazione verte sull'appuntamento con uno specialista, il Dottor Carlo Castoro.", 'predicted_label': 'Visita Specialistica'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:14.089073
====================================================================================================
ğŸ“‹ Session ID: classify_1756762694
â±ï¸  Processing Time: 1.380s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (371 chars):
   [UTENTE] come posso contattare la struttura del Dottor Carlo Castoro per la conferma di un appuntamento ? [ASSISTENTE] Per ottenere informazioni specifiche sul Dottor Carlo Castoro e sulla struttur...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (166 chars):
   {'confidence': 0.7, 'motivation': "La conversazione verte sull'appuntamento con uno specialista, il Dottor Carlo Castoro.", 'predicted_label': 'Visita Specialistica'}

ğŸ“Š Parsed Response:
   predicted_label: Visita Specialistica
   confidence: 0.7
   motivation: La conversazione verte sull'appuntamento con uno specialista, il Dottor Carlo Castoro.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.700
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘] 70.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'appuntamento con uno specialista, il Dottor Carlo Castoro.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 3e589f798f61ef04aa7eae1d85ca4b6e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Visita Specialistica' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 168
   ğŸ“Š Token totali: 616
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 616 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 168
   ğŸ“Š Token conversazione finale: 168
   ğŸ“Š Token totali: 616
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 557 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Volevo sapere se a Rozzano effettuano la brachiterapia [ASSISTENTE] SÃ¬, presso l'Istituto Clinico Humanitas di Rozzano Ã¨ possibile effettuare trattamenti di radioterapia e radiochirurgia, che includono tecniche avanzate come la brachiterapia per specifiche patologie. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2956 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 168
   ğŸ“Š Token totali stimati: 616
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Volevo sapere se a Rozzano effettuano la brachiterapia [ASSISTENTE] SÃ¬, presso l'Istituto Clinico Humanitas di Rozzano Ã¨ possibile effettuare trattamenti di radioterapia e radiochirurgia, che includono tecniche avanzate come la brachiterapia per specifiche patologie. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.7, 'motivation': "La conversazione verte sull'accesso a una specifica tecnica di trattamento per patologie oncologiche, quindi la categoria piÃ¹ adatta Ã¨ Visita Specialistica Oncologica.", 'predicted_label': 'Visita Specialistica Oncologica'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:15.895179
====================================================================================================
ğŸ“‹ Session ID: classify_1756762695
â±ï¸  Processing Time: 1.720s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (557 chars):
   [UTENTE] Volevo sapere se a Rozzano effettuano la brachiterapia [ASSISTENTE] SÃ¬, presso l'Istituto Clinico Humanitas di Rozzano Ã¨ possibile effettuare trattamenti di radioterapia e radiochirurgia, ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (258 chars):
   {'confidence': 0.7, 'motivation': "La conversazione verte sull'accesso a una specifica tecnica di trattamento per patologie oncologiche, quindi la categoria piÃ¹ adatta Ã¨ Visita Specialistica Oncologica.", 'predicted_label': 'Visita Specialistica Oncologica'}

ğŸ“Š Parsed Response:
   predicted_label: Visita Specialistica Oncologica
   confidence: 0.7
   motivation: La conversazione verte sull'accesso a una specifica tecnica di trattamento per patologie oncologiche, quindi la categoria piÃ¹ adatta Ã¨ Visita Specialistica Oncologica.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.700
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘] 70.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'accesso a una specifica tecnica di trattamento per patologie oncologiche, quindi la categoria piÃ¹ adatta Ã¨ Visita Specialistica Oncologica.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 8d93820b4dcb276507961808e3a6363d classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Visita Specialistica Oncologica' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 295
   ğŸ“Š Token totali: 743
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 743 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 295
   ğŸ“Š Token conversazione finale: 295
   ğŸ“Š Token totali: 743
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1024 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Catarata  [ASSISTENTE] La cataratta Ã¨ una patologia oculare caratterizzata dall'opacizzazione del cristallino, la lente naturale dell'occhio, che porta a una progressiva riduzione della vista. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2898 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 295
   ğŸ“Š Token totali stimati: 743
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Catarata  [ASSISTENTE] La cataratta Ã¨ una patologia oculare caratterizzata dall'opacizzazione del cristallino, la lente naturale dell'occhio, che porta a una progressiva riduzione della vista. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': 'La conversazione verte sulla prenotazione di un intervento in regime SSN.', 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:17.386157
====================================================================================================
ğŸ“‹ Session ID: classify_1756762697
â±ï¸  Processing Time: 1.402s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1024 chars):
   [UTENTE] Catarata  [ASSISTENTE] La cataratta Ã¨ una patologia oculare caratterizzata dall'opacizzazione del cristallino, la lente naturale dell'occhio, che porta a una progressiva riduzione della vi...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (146 chars):
   {'confidence': 0.95, 'motivation': 'La conversazione verte sulla prenotazione di un intervento in regime SSN.', 'predicted_label': 'Prenotazione'}

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.95
   motivation: La conversazione verte sulla prenotazione di un intervento in regime SSN.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sulla prenotazione di un intervento in regime SSN.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 38399035ec99246a4430d40403a85a81 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 375
   ğŸ“Š Token totali: 803
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 803 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 375
   ğŸ“Š Token conversazione finale: 375
   ğŸ“Š Token totali: 803
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1248 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] termoablazione a radiofrequenza [ASSISTENTE] La termoablazione a radiofrequenza Ã¨ una tecnica utilizzata per trattare tumori in fase precoce o di piccole dimensioni, come quelli al fegato o ai reni. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2873 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 375
   ğŸ“Š Token totali stimati: 803
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] termoablazione a radiofrequenza [ASSISTENTE] La termoablazione a radiofrequenza Ã¨ una tecnica utilizzata per trattare tumori in fase precoce o di piccole dimensioni, come quelli al fegato o ai reni. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sulla termoablazione a radiofrequenza come trattamento per tumori, il che la rende pertinente alla categoria 'Visita Specialistica Oncologica'. La confidenza Ã¨ alta poichÃ© l'argomento di discussione Ã¨ specifico e chiaramente definito.", 'predicted_label': 'Visita Specialistica Oncologica'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:19.739529
====================================================================================================
ğŸ“‹ Session ID: classify_1756762699
â±ï¸  Processing Time: 2.266s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1248 chars):
   [UTENTE] termoablazione a radiofrequenza [ASSISTENTE] La termoablazione a radiofrequenza Ã¨ una tecnica utilizzata per trattare tumori in fase precoce o di piccole dimensioni, come quelli al fegato ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (349 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sulla termoablazione a radiofrequenza come trattamento per tumori, il che la rende pertinente alla categoria 'Visita Specialistica Oncologica'. La confidenza Ã¨ alta poichÃ© l'argomento di discussione Ã¨ specifico e chiaramente definito.", '...

ğŸ“Š Parsed Response:
   predicted_label: Visita Specialistica Oncologica
   confidence: 0.95
   motivation: La conversazione verte sulla termoablazione a radiofrequenza come trattamento per tumori, il che la rende pertinente alla categoria 'Visita Specialistica Oncologica'. La confidenza Ã¨ alta poichÃ© l'argomento di discussione Ã¨ specifico e chiaramente definito.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sulla termoablazione a radiofrequenza come trattamento per tumori, il che la rende pertinente alla categoria 'Visita Specialistica Oncologica'. La confidenza Ã¨ alta poichÃ© l'argomento di discussione Ã¨ specifico e chiaramente definito.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 24869a87a3dd6c751cfa9bbdb82ed6c8 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Visita Specialistica Oncologica' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 213
   ğŸ“Š Token totali: 641
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 641 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 213
   ğŸ“Š Token conversazione finale: 213
   ğŸ“Š Token totali: 641
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 777 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Screening tumore pancreas [ASSISTENTE] In Humanitas, il tumore del pancreas viene diagnosticato attraverso tecnologie avanzate come ecotomografia, TAC con mezzo di contrasto, risonanza magnetica e ecoendoscopia. Questi strumenti permettono una diagnosi accurata e una stadiazione dettagli..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 213
   ğŸ“Š Token totali stimati: 641
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Screening tumore pancreas [ASSISTENTE] In Humanitas, il tumore del pancreas viene diagnosticato attraverso tecnologie avanzate come ecotomografia, TAC con mezzo di contrasto, risonanza magnetica e ecoendoscopia. Questi strumenti permettono una diagnosi accurata e una stadiazione dettagli..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': '| predicted_label       | confidenza | motivazione                                                                 |'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:22.819189
====================================================================================================
ğŸ“‹ Session ID: classify_1756762702
â±ï¸  Processing Time: 2.990s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (777 chars):
   [UTENTE] Screening tumore pancreas [ASSISTENTE] In Humanitas, il tumore del pancreas viene diagnosticato attraverso tecnologie avanzate come ecotomografia, TAC con mezzo di contrasto, risonanza mag...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (181 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': '| predicted_label       | confidenza | motivazione                                                                 |'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: | predicted_label       | confidenza | motivazione                                                                 |
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   | predicted_label       | confidenza | motivazione                                                                 |
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 7e06b0c0cdef54e9ab92f58ac92d91c7 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 210
   ğŸ“Š Token totali: 658
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 658 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 210
   ğŸ“Š Token conversazione finale: 210
   ğŸ“Š Token totali: 658
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 723 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei sapere quando vengo operato  [ASSISTENTE] Non ho accesso diretto alle informazioni personali o alle tempistiche specifiche per gli interventi. [...]  Se hai bisogno di ulteriori dettagli o assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2907 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 210
   ğŸ“Š Token totali stimati: 658
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei sapere quando vengo operato  [ASSISTENTE] Non ho accesso diretto alle informazioni personali o alle tempistiche specifiche per gli interventi. [...]  Se hai bisogno di ulteriori dettagli o assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.75, 'motivation': "La conversazione verte sull'operazione dell'utente e sulla Neurochirurgia, quindi la categoria piÃ¹ adatta sembra essere Visita Specialistica Oncologica.", 'predicted_label': 'Visita Specialistica Oncologica'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:24.607434
====================================================================================================
ğŸ“‹ Session ID: classify_1756762704
â±ï¸  Processing Time: 1.701s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (723 chars):
   [UTENTE] Vorrei sapere quando vengo operato  [ASSISTENTE] Non ho accesso diretto alle informazioni personali o alle tempistiche specifiche per gli interventi. Ti consiglio di contattare direttament...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (244 chars):
   {'confidence': 0.75, 'motivation': "La conversazione verte sull'operazione dell'utente e sulla Neurochirurgia, quindi la categoria piÃ¹ adatta sembra essere Visita Specialistica Oncologica.", 'predicted_label': 'Visita Specialistica Oncologica'}

ğŸ“Š Parsed Response:
   predicted_label: Visita Specialistica Oncologica
   confidence: 0.75
   motivation: La conversazione verte sull'operazione dell'utente e sulla Neurochirurgia, quindi la categoria piÃ¹ adatta sembra essere Visita Specialistica Oncologica.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.750
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 75.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'operazione dell'utente e sulla Neurochirurgia, quindi la categoria piÃ¹ adatta sembra essere Visita Specialistica Oncologica.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 34f64c5c8a80677afa6322362400b4b5 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Visita Specialistica Oncologica' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 240
   ğŸ“Š Token totali: 668
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 668 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 240
   ğŸ“Š Token conversazione finale: 240
   ğŸ“Š Token totali: 668
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 809 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia noi a noi Ã¨ stato dato con le dimissioni protette di mio padre Fanara Giulio Ã¨ stato consegnato un letto con materasso antidecubito sedia a rotelle e un deambulatore non sappiamo a chi rivolgersi per poterli riconsegnare adesso che mio papÃ  Ã¨ s [ASSISTENTE] Mi dispiace per la..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 240
   ğŸ“Š Token totali stimati: 668
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia noi a noi Ã¨ stato dato con le dimissioni protette di mio padre Fanara Giulio Ã¨ stato consegnato un letto con materasso antidecubito sedia a rotelle e un deambulatore non sappiamo a chi rivolgersi per poterli riconsegnare adesso che mio papÃ  Ã¨ s [ASSISTENTE] Mi dispiace per la..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.75, 'motivation': "La conversazione verte sulla restituzione delle attrezzature mediche fornite dall'ospedale, quindi la categoria 'Servizi aziendali' Ã¨ appropriata.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:26.445341
====================================================================================================
ğŸ“‹ Session ID: classify_1756762706
â±ï¸  Processing Time: 1.751s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (809 chars):
   [UTENTE] Ciao Giulia noi a noi Ã¨ stato dato con le dimissioni protette di mio padre Fanara Giulio Ã¨ stato consegnato un letto con materasso antidecubito sedia a rotelle e un deambulatore non sappia...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (224 chars):
   {'confidence': 0.75, 'motivation': "La conversazione verte sulla restituzione delle attrezzature mediche fornite dall'ospedale, quindi la categoria 'Servizi aziendali' Ã¨ appropriata.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.75
   motivation: La conversazione verte sulla restituzione delle attrezzature mediche fornite dall'ospedale, quindi la categoria 'Servizi aziendali' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.750
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 75.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sulla restituzione delle attrezzature mediche fornite dall'ospedale, quindi la categoria 'Servizi aziendali' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 7c7aa2df9c52d64493180571ca5fecf6 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 310
   ğŸ“Š Token totali: 758
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 758 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 310
   ğŸ“Š Token conversazione finale: 310
   ğŸ“Š Token totali: 758
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1069 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, sono Barbara Capone di Napoli la nipote di un paziente ricoverato d'urgenza Giuseppe Capone, ora spostato nel reparto di Pneumologia in stato di elevata gravitÃ . [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2920 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 310
   ğŸ“Š Token totali stimati: 758
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, sono Barbara Capone di Napoli la nipote di un paziente ricoverato d'urgenza Giuseppe Capone, ora spostato nel reparto di Pneumologia in stato di elevata gravitÃ . [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Pneumologia",\n  "confidence": 0.9,\n  "mot'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:28.601414
====================================================================================================
ğŸ“‹ Session ID: classify_1756762708
â±ï¸  Processing Time: 2.070s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1069 chars):
   [UTENTE] Buongiorno, sono Barbara Capone di Napoli la nipote di un paziente ricoverato d'urgenza Giuseppe Capone, ora spostato nel reparto di Pneumologia in stato di elevata gravitÃ . Mi potrebbe co...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (197 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Pneumologia",\n  "confidence": 0.9,\n  "mot'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Pneumologia",
  "confidence": 0.9,
  "mot
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Pneumologia",
  "confidence": 0.9,
  "mot
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 7276e2fca5dc57243c3f825d158f4134 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 360
   ğŸ“Š Token totali: 808
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 808 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 360
   ğŸ“Š Token conversazione finale: 360
   ğŸ“Š Token totali: 808
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1182 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno Giulia mio padre ha fatto pre ricovero ieri e domani deve essere operato, quando ci contatteranno x convocazione? [ASSISTENTE] Se tuo padre ha giÃ  effettuato il prericovero e l'intervento Ã¨ programmato per domani, Humanitas vi contatterÃ  in tempi utili per confermare la convoc..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 360
   ğŸ“Š Token totali stimati: 808
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno Giulia mio padre ha fatto pre ricovero ieri e domani deve essere operato, quando ci contatteranno x convocazione? [ASSISTENTE] Se tuo padre ha giÃ  effettuato il prericovero e l'intervento Ã¨ programmato per domani, Humanitas vi contatterÃ  in tempi utili per confermare la convoc..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Prenotazione",\n  "confidence": 0.9,\n  "mo'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:30.375759
====================================================================================================
ğŸ“‹ Session ID: classify_1756762710
â±ï¸  Processing Time: 1.687s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1182 chars):
   [UTENTE] Buongiorno Giulia mio padre ha fatto pre ricovero ieri e domani deve essere operato, quando ci contatteranno x convocazione? [ASSISTENTE] Se tuo padre ha giÃ  effettuato il prericovero e l'...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (197 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Prenotazione",\n  "confidence": 0.9,\n  "mo'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Prenotazione",
  "confidence": 0.9,
  "mo
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Prenotazione",
  "confidence": 0.9,
  "mo
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione a8bc6a9330e4ad53183cb36fab8c92ba classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 254
   ğŸ“Š Token totali: 702
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 702 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 254
   ğŸ“Š Token conversazione finale: 254
   ğŸ“Š Token totali: 702
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 836 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia Ho saputo che ha l'umanitÃ  praticamente danno via Delle parrucche avete a disposizione delle parrucche Siccome io sto facendo la Ennio proprio lÃ¬ da voi e sto proprio perdendo i capelli Volevo alcune informazioni Se Ã¨ vero Oppure se se non Ã¨ ve [ASSISTENTE] In Humanitas Ã¨ dis..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 254
   ğŸ“Š Token totali stimati: 702
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia Ho saputo che ha l'umanitÃ  praticamente danno via Delle parrucche avete a disposizione delle parrucche Siccome io sto facendo la Ennio proprio lÃ¬ da voi e sto proprio perdendo i capelli Volevo alcune informazioni Se Ã¨ vero Oppure se se non Ã¨ ve [ASSISTENTE] In Humanitas Ã¨ dis..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte principalmente sull'accesso e la disponibilitÃ  di servizi di parrucchiere all'interno dell'ospedale Humanitas, inclusa l'offerta di parrucche per pazienti che stanno perdendo i capelli a causa della chemio.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:32.530850
====================================================================================================
ğŸ“‹ Session ID: classify_1756762712
â±ï¸  Processing Time: 2.069s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (836 chars):
   [UTENTE] Ciao Giulia Ho saputo che ha l'umanitÃ  praticamente danno via Delle parrucche avete a disposizione delle parrucche Siccome io sto facendo la Ennio proprio lÃ¬ da voi e sto proprio perdendo ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (307 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte principalmente sull'accesso e la disponibilitÃ  di servizi di parrucchiere all'interno dell'ospedale Humanitas, inclusa l'offerta di parrucche per pazienti che stanno perdendo i capelli a causa della chemio.", 'predicted_label': 'Servizi a...

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.95
   motivation: La conversazione verte principalmente sull'accesso e la disponibilitÃ  di servizi di parrucchiere all'interno dell'ospedale Humanitas, inclusa l'offerta di parrucche per pazienti che stanno perdendo i capelli a causa della chemio.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte principalmente sull'accesso e la disponibilitÃ  di servizi di parrucchiere all'interno dell'ospedale Humanitas, inclusa l'offerta di parrucche per pazienti che stanno perdendo i capelli a causa della chemio.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 4a3ed44d6635dc04538709c05f424129 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 146
   ğŸ“Š Token totali: 574
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 574 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 146
   ğŸ“Š Token conversazione finale: 146
   ğŸ“Š Token totali: 574
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 515 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, ho ricevuto la comunicazione che avrei ricevuto una chiamata per comunicazioni relative al mio appuntamento di domattina ma non ho ricevuto alcuna chiamata [ASSISTENTE] Mi dispiace per l'inconveniente. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2890 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 146
   ğŸ“Š Token totali stimati: 574
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, ho ricevuto la comunicazione che avrei ricevuto una chiamata per comunicazioni relative al mio appuntamento di domattina ma non ho ricevuto alcuna chiamata [ASSISTENTE] Mi dispiace per l'inconveniente. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:34.358844
====================================================================================================
ğŸ“‹ Session ID: classify_1756762714
â±ï¸  Processing Time: 1.742s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (515 chars):
   [UTENTE] Buongiorno, ho ricevuto la comunicazione che avrei ricevuto una chiamata per comunicazioni relative al mio appuntamento di domattina ma non ho ricevuto alcuna chiamata [ASSISTENTE] Mi disp...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 78d484c4aa242e1a29e48783182ff949 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 284
   ğŸ“Š Token totali: 712
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 712 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 284
   ğŸ“Š Token conversazione finale: 284
   ğŸ“Š Token totali: 712
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 988 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao ho fatto una prenotazione ma non ho pagato niente, se non mi presento mi in tale data mi viene la multa? [ASSISTENTE] Se hai effettuato una prenotazione tramite il Servizio Sanitario Nazionale (SSN) e non ti presenti senza aver disdetto l'appuntamento almeno 48 ore prima, potresti i..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 284
   ğŸ“Š Token totali stimati: 712
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao ho fatto una prenotazione ma non ho pagato niente, se non mi presento mi in tale data mi viene la multa? [ASSISTENTE] Se hai effettuato una prenotazione tramite il Servizio Sanitario Nazionale (SSN) e non ti presenti senza aver disdetto l'appuntamento almeno 48 ore prima, potresti i..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'assenza a un appuntamento prenotato in precedenza e sulle possibili conseguenze economiche.", 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:36.032269
====================================================================================================
ğŸ“‹ Session ID: classify_1756762716
â±ï¸  Processing Time: 1.585s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (988 chars):
   [UTENTE] ciao ho fatto una prenotazione ma non ho pagato niente, se non mi presento mi in tale data mi viene la multa? [ASSISTENTE] Se hai effettuato una prenotazione tramite il Servizio Sanitario ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (192 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'assenza a un appuntamento prenotato in precedenza e sulle possibili conseguenze economiche.", 'predicted_label': 'Prenotazione'}

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.95
   motivation: La conversazione verte sull'assenza a un appuntamento prenotato in precedenza e sulle possibili conseguenze economiche.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'assenza a un appuntamento prenotato in precedenza e sulle possibili conseguenze economiche.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione d316b6e35928fbfc44a664e990e599f2 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 185
   ğŸ“Š Token totali: 613
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 613 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 185
   ğŸ“Š Token conversazione finale: 185
   ğŸ“Š Token totali: 613
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 636 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ho prenotato una risonanza magnetica senza contrasto per il 20 corrente presso humanitas rozzano ma dalla app vedo che l appuntamento Ã¨ stato segnalato per il 27 corrente perchÃ© ?  [ASSISTENTE] Non ho accesso diretto ai dettagli degli appuntamenti personali. Ti consiglio di contattare il..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 185
   ğŸ“Š Token totali stimati: 613
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ho prenotato una risonanza magnetica senza contrasto per il 20 corrente presso humanitas rozzano ma dalla app vedo che l appuntamento Ã¨ stato segnalato per il 27 corrente perchÃ© ?  [ASSISTENTE] Non ho accesso diretto ai dettagli degli appuntamenti personali. Ti consiglio di contattare il..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'appuntamento prenotato per una risonanza magnetica presso Humanitas Rozzano e sul bisogno di chiarire la data dell'appuntamento.", 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:37.856484
====================================================================================================
ğŸ“‹ Session ID: classify_1756762717
â±ï¸  Processing Time: 1.738s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (636 chars):
   [UTENTE] ho prenotato una risonanza magnetica senza contrasto per il 20 corrente presso humanitas rozzano ma dalla app vedo che l appuntamento Ã¨ stato segnalato per il 27 corrente perchÃ© ?  [ASSIST...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (229 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'appuntamento prenotato per una risonanza magnetica presso Humanitas Rozzano e sul bisogno di chiarire la data dell'appuntamento.", 'predicted_label': 'Prenotazione'}

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.95
   motivation: La conversazione verte sull'appuntamento prenotato per una risonanza magnetica presso Humanitas Rozzano e sul bisogno di chiarire la data dell'appuntamento.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'appuntamento prenotato per una risonanza magnetica presso Humanitas Rozzano e sul bisogno di chiarire la data dell'appuntamento.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f7ab26643fb5d4177649be94ec39a65d classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 152
   ğŸ“Š Token totali: 580
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 580 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 152
   ğŸ“Š Token conversazione finale: 152
   ğŸ“Š Token totali: 580
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 509 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno Giulia, ho un appuntamento con il prof. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2678 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 152
   ğŸ“Š Token totali stimati: 580
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno Giulia, ho un appuntamento con il prof. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:39.640432
====================================================================================================
ğŸ“‹ Session ID: classify_1756762719
â±ï¸  Processing Time: 1.697s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (509 chars):
   [UTENTE] Buongiorno Giulia, ho un appuntamento con il prof.Tinteri il giorno 1settembre alle ore 12.30 [ASSISTENTE] Per informazioni o conferme relative al tuo appuntamento con il Professore Tinter...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 85a2223257029bdce39115167a1dc9b2 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 147
   ğŸ“Š Token totali: 575
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 575 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 147
   ğŸ“Š Token conversazione finale: 147
   ğŸ“Š Token totali: 575
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 462 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Mi serve il numero dello sportello pre ricoveri Humanitas orto center  [ASSISTENTE] Per il prericovero presso l'Ortho Center di Humanitas, ti consiglio di contattare il centralino al numero 02 82241. Il personale potrÃ  indirizzarti al reparto o allo sportello corretto. Se hai bisogno di ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 147
   ğŸ“Š Token totali stimati: 575
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Mi serve il numero dello sportello pre ricoveri Humanitas orto center  [ASSISTENTE] Per il prericovero presso l'Ortho Center di Humanitas, ti consiglio di contattare il centralino al numero 02 82241. Il personale potrÃ  indirizzarti al reparto o allo sportello corretto. Se hai bisogno di ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla richiesta di informazioni relative ai pre-ricoveri presso l'Ortho Center dell'ospedale Humanitas. L'ass"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:42.688041
====================================================================================================
ğŸ“‹ Session ID: classify_1756762722
â±ï¸  Processing Time: 2.959s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (462 chars):
   [UTENTE] Mi serve il numero dello sportello pre ricoveri Humanitas orto center  [ASSISTENTE] Per il prericovero presso l'Ortho Center di Humanitas, ti consiglio di contattare il centralino al numer...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla richiesta di informazioni relative ai pre-ricoveri presso l'Ortho Center dell'ospedale Humanitas. L'ass"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte principalmente sulla richiesta di informazioni relative ai pre-ricoveri presso l'Ortho Center dell'ospedale Humanitas. L'ass
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte principalmente sulla richiesta di informazioni relative ai pre-ricoveri presso l'Ortho Center dell'ospedale Humanitas. L'ass
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 6ccb555acc97e6fd5245612ea9630ee6 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 119
   ğŸ“Š Token totali: 547
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 547 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 119
   ğŸ“Š Token conversazione finale: 119
   ğŸ“Š Token totali: 547
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 378 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Cerco una mail del reparto urologia [ASSISTENTE] Non ho trovato un indirizzo email specifico per il reparto di Urologia. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2737 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 119
   ğŸ“Š Token totali stimati: 547
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Cerco una mail del reparto urologia [ASSISTENTE] Non ho trovato un indirizzo email specifico per il reparto di Urologia. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.8, 'motivation': "La conversazione riguarda la ricerca di informazioni su un reparto specifico dell'ospedale.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:44.159553
====================================================================================================
ğŸ“‹ Session ID: classify_1756762724
â±ï¸  Processing Time: 1.384s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (378 chars):
   [UTENTE] Cerco una mail del reparto urologia [ASSISTENTE] Non ho trovato un indirizzo email specifico per il reparto di Urologia. Ti consiglio di consultare la pagina dedicata all'UnitÃ  Operativa d...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (168 chars):
   {'confidence': 0.8, 'motivation': "La conversazione riguarda la ricerca di informazioni su un reparto specifico dell'ospedale.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.8
   motivation: La conversazione riguarda la ricerca di informazioni su un reparto specifico dell'ospedale.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.800
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘] 80.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la ricerca di informazioni su un reparto specifico dell'ospedale.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione efaf452920a142169d8154dd1c7bd28c classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 348
   ğŸ“Š Token totali: 796
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 796 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 348
   ğŸ“Š Token conversazione finale: 348
   ğŸ“Š Token totali: 796
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1120 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] salvo, ho mandato diverse mail alla mail di segreteria perchÃ¨ ho bisogno di un nuovo piano terapeutico visto che il mio Ã¨ scaduto [ASSISTENTE] Capisco la tua necessitÃ . [...] docxã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2857 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 348
   ğŸ“Š Token totali stimati: 796
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] salvo, ho mandato diverse mail alla mail di segreteria perchÃ¨ ho bisogno di un nuovo piano terapeutico visto che il mio Ã¨ scaduto [ASSISTENTE] Capisco la tua necessitÃ . [...] docxã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:45.921893
====================================================================================================
ğŸ“‹ Session ID: classify_1756762725
â±ï¸  Processing Time: 1.676s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1120 chars):
   [UTENTE] salvo, ho mandato diverse mail alla mail di segreteria perchÃ¨ ho bisogno di un nuovo piano terapeutico visto che il mio Ã¨ scaduto [ASSISTENTE] Capisco la tua necessitÃ . Potresti indicarmi ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 52dbd5ef955213bd0bc1e8b86baec644 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 130
   ğŸ“Š Token totali: 578
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 578 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 130
   ğŸ“Š Token conversazione finale: 130
   ğŸ“Š Token totali: 578
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 416 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno vorrei sapere i tempi di attesa x intervento TURP alla prostata [ASSISTENTE] I tempi di attesa per un intervento TURP alla prostata possono variare. [...] docxã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2848 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 130
   ğŸ“Š Token totali stimati: 578
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno vorrei sapere i tempi di attesa x intervento TURP alla prostata [ASSISTENTE] I tempi di attesa per un intervento TURP alla prostata possono variare. [...] docxã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.7, 'motivation': "La conversazione verte sull'intervento TURP alla prostata, che Ã¨ un tipo di visita specialistica.", 'predicted_label': 'Visita Specialistica'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:47.452650
====================================================================================================
ğŸ“‹ Session ID: classify_1756762727
â±ï¸  Processing Time: 1.443s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (416 chars):
   [UTENTE] Buongiorno vorrei sapere i tempi di attesa x intervento TURP alla prostata [ASSISTENTE] I tempi di attesa per un intervento TURP alla prostata possono variare. Ti consiglio di contattare d...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (177 chars):
   {'confidence': 0.7, 'motivation': "La conversazione verte sull'intervento TURP alla prostata, che Ã¨ un tipo di visita specialistica.", 'predicted_label': 'Visita Specialistica'}

ğŸ“Š Parsed Response:
   predicted_label: Visita Specialistica
   confidence: 0.7
   motivation: La conversazione verte sull'intervento TURP alla prostata, che Ã¨ un tipo di visita specialistica.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.700
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘] 70.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'intervento TURP alla prostata, che Ã¨ un tipo di visita specialistica.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione adefc297745c050475f472fcbeb8d63e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Visita Specialistica' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 206
   ğŸ“Š Token totali: 634
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 634 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 206
   ğŸ“Š Token conversazione finale: 206
   ğŸ“Š Token totali: 634
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 719 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Mi hanno contattato per eseguire una TAC con e senza mezzo di contrasto total body e encefalo e mi hanno detto di portare impegnativa del medico curante,ma essendo in Piemonte cambiano i codici delle prestazioni dell' Humanitas di Rozzano perchÃ© in Lombardia. A chi mi posso rivolgere per..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 206
   ğŸ“Š Token totali stimati: 634
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Mi hanno contattato per eseguire una TAC con e senza mezzo di contrasto total body e encefalo e mi hanno detto di portare impegnativa del medico curante,ma essendo in Piemonte cambiano i codici delle prestazioni dell' Humanitas di Rozzano perchÃ© in Lombardia. A chi mi posso rivolgere per..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Prenotazione', 'confidence': 0.6, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:49.711293
====================================================================================================
ğŸ“‹ Session ID: classify_1756762729
â±ï¸  Processing Time: 2.172s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (719 chars):
   [UTENTE] Mi hanno contattato per eseguire una TAC con e senza mezzo di contrasto total body e encefalo e mi hanno detto di portare impegnativa del medico curante,ma essendo in Piemonte cambiano i c...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (104 chars):
   {'predicted_label': 'Prenotazione', 'confidence': 0.6, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.6
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.600
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 60.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 1c9aa26f3b410c7654f467ce3e6013bf classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 261
   ğŸ“Š Token totali: 710
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 710 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 261
   ğŸ“Š Token conversazione finale: 261
   ğŸ“Š Token totali: 710
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 895 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Devo richiedere la mia cartella clinica  [ASSISTENTE] Puoi richiedere la tua cartella clinica in diversi modi:

1. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2862 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 261
   ğŸ“Š Token totali stimati: 710
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Devo richiedere la mia cartella clinica  [ASSISTENTE] Puoi richiedere la tua cartella clinica in diversi modi:

1. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name":"classify_conversation","arguments":{"predicted_label":"Referti e Cartelle Cliniche","conf'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:51.367724
====================================================================================================
ğŸ“‹ Session ID: classify_1756762731
â±ï¸  Processing Time: 1.570s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (895 chars):
   [UTENTE] Devo richiedere la mia cartella clinica  [ASSISTENTE] Puoi richiedere la tua cartella clinica in diversi modi:

1. **Online**: Puoi accedere all'area referti di [Humanitas con te](https://...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name":"classify_conversation","arguments":{"predicted_label":"Referti e Cartelle Cliniche","conf'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name":"classify_conversation","arguments":{"predicted_label":"Referti e Cartelle Cliniche","conf
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name":"classify_conversation","arguments":{"predicted_label":"Referti e Cartelle Cliniche","conf
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione c5f3a12638b54b4140e5ba2920888db7 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 509
   ğŸ“Š Token totali: 957
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 957 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 509
   ğŸ“Š Token conversazione finale: 509
   ğŸ“Š Token totali: 957
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1771 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Franco Dal Pont oporato anca destra con protesi nel febbraio 2016. [...]  Se hai bisogno di ulteriori informazioni, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2806 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 509
   ğŸ“Š Token totali stimati: 957
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Franco Dal Pont oporato anca destra con protesi nel febbraio 2016. [...]  Se hai bisogno di ulteriori informazioni, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'ottenimento di un documento che attesti la presenza della protesi per facilitare i controlli aeroportuali. La categoria 'Referti e Cartelle Cliniche' Ã¨ pertinente poichÃ© l'utente sta cercando informazioni su come ottenere una documentazione ufficiale riguardo alla sua condizione medica.", 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:53.989164
====================================================================================================
ğŸ“‹ Session ID: classify_1756762733
â±ï¸  Processing Time: 2.533s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1771 chars):
   [UTENTE] Franco Dal Pont oporato anca destra con protesi nel febbraio 2016. Recentemente il metaldetcor dell'aeroporto segnala la protesi ma non ho nulla per dimostrare che a cuasa di intervento or...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (403 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'ottenimento di un documento che attesti la presenza della protesi per facilitare i controlli aeroportuali. La categoria 'Referti e Cartelle Cliniche' Ã¨ pertinente poichÃ© l'utente sta cercando informazioni su come ottenere una documen...

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione verte sull'ottenimento di un documento che attesti la presenza della protesi per facilitare i controlli aeroportuali. La categoria 'Referti e Cartelle Cliniche' Ã¨ pertinente poichÃ© l'utente sta cercando informazioni su come ottenere una documentazione ufficiale riguardo alla sua condizione medica.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'ottenimento di un documento che attesti la presenza della protesi per facilitare i controlli aeroportuali. La categoria 'Referti e Cartelle Cliniche' Ã¨ pertinente poichÃ© l'utente sta cercando informazioni su come ottenere una documentazione ufficiale riguardo alla sua condizione medica.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 3892e75b27ac020c74338253e2e33983 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 764
   ğŸ“Š Token totali: 1212
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1212 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 764
   ğŸ“Š Token conversazione finale: 764
   ğŸ“Š Token totali: 1212
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2559 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Mi Ã¨ arrivato questo sms: La documentazione che ha richiesto Ã¨ pronta: gli autorizzati possono ritirarla presso l'Area Ricoveri SSN (lun-ven 10-16), portando i documenti necessari. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2880 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 764
   ğŸ“Š Token totali stimati: 1212
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Mi Ã¨ arrivato questo sms: La documentazione che ha richiesto Ã¨ pronta: gli autorizzati possono ritirarla presso l'Area Ricoveri SSN (lun-ven 10-16), portando i documenti necessari. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n    "predicted_label": "Referti e Cartelle Cliniche",\n    "conf'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:56.110879
====================================================================================================
ğŸ“‹ Session ID: classify_1756762736
â±ï¸  Processing Time: 2.033s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2559 chars):
   [UTENTE] Mi Ã¨ arrivato questo sms: La documentazione che ha richiesto Ã¨ pronta: gli autorizzati possono ritirarla presso l'Area Ricoveri SSN (lun-ven 10-16), portando i documenti necessari. Info: b...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (196 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n    "predicted_label": "Referti e Cartelle Cliniche",\n    "conf'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
    "predicted_label": "Referti e Cartelle Cliniche",
    "conf
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
    "predicted_label": "Referti e Cartelle Cliniche",
    "conf
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 1a98dbf428fe09e21abf2f87c7a3eac8 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 375
   ğŸ“Š Token totali: 824
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 824 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 375
   ğŸ“Š Token conversazione finale: 375
   ğŸ“Š Token totali: 824
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1296 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Come ritirare il referto di mia figlia minorenne? [ASSISTENTE] Per ritirare il referto di tua figlia minorenne, Ã¨ necessario seguire queste indicazioni:

1. [...]  

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2906 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 375
   ğŸ“Š Token totali stimati: 824
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Come ritirare il referto di mia figlia minorenne? [ASSISTENTE] Per ritirare il referto di tua figlia minorenne, Ã¨ necessario seguire queste indicazioni:

1. [...]  

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:38:57.918842
====================================================================================================
ğŸ“‹ Session ID: classify_1756762737
â±ï¸  Processing Time: 1.721s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1296 chars):
   [UTENTE] Come ritirare il referto di mia figlia minorenne? [ASSISTENTE] Per ritirare il referto di tua figlia minorenne, Ã¨ necessario seguire queste indicazioni:

1. **Ritiro da parte del genitore ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [77 more lines] ...
     Line 81: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (97 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 302276153f8be33cc5587281b1fe7376 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 262
   ğŸ“Š Token totali: 710
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 710 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 262
   ğŸ“Š Token conversazione finale: 262
   ğŸ“Š Token totali: 710
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 926 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Sono stata ricoverata dal 29 06 al 02 07 2025 ma la cartella clinica non Ã¨ ancora disponibile . [...] it/info/referti-cartelle-cliniche/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2814 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 262
   ğŸ“Š Token totali stimati: 710
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Sono stata ricoverata dal 29 06 al 02 07 2025 ma la cartella clinica non Ã¨ ancora disponibile . [...] it/info/referti-cartelle-cliniche/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:00.405587
====================================================================================================
ğŸ“‹ Session ID: classify_1756762740
â±ï¸  Processing Time: 2.398s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (926 chars):
   [UTENTE] Sono stata ricoverata dal 29 06 al 02 07 2025 ma la cartella clinica non Ã¨ ancora disponibile . Come.posso sapere quando potrÃ² scaricarla? [ASSISTENTE] La copia digitale della cartella cli...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (97 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 8325a056e6970ccfdf6575d83e79e87c classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 204
   ğŸ“Š Token totali: 632
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 632 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 204
   ğŸ“Š Token conversazione finale: 204
   ğŸ“Š Token totali: 632
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 646 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] vorrei disdire un appuntamento [ASSISTENTE] Per disdire un appuntamento presso Humanitas, puoi seguire queste indicazioni:

1. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2802 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 204
   ğŸ“Š Token totali stimati: 632
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] vorrei disdire un appuntamento [ASSISTENTE] Per disdire un appuntamento presso Humanitas, puoi seguire queste indicazioni:

1. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.8, 'motivation': "La conversazione verte sull'annullamento di un appuntamento, quindi la categoria 'Prenotazione' Ã¨ appropriata.", 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:02.033926
====================================================================================================
ğŸ“‹ Session ID: classify_1756762742
â±ï¸  Processing Time: 1.541s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (646 chars):
   [UTENTE] vorrei disdire un appuntamento [ASSISTENTE] Per disdire un appuntamento presso Humanitas, puoi seguire queste indicazioni:

1. **Prenotazioni private**: Puoi annullare tramite il portale [...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [76 more lines] ...
     Line 80: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (182 chars):
   {'confidence': 0.8, 'motivation': "La conversazione verte sull'annullamento di un appuntamento, quindi la categoria 'Prenotazione' Ã¨ appropriata.", 'predicted_label': 'Prenotazione'}

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.8
   motivation: La conversazione verte sull'annullamento di un appuntamento, quindi la categoria 'Prenotazione' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.800
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘] 80.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'annullamento di un appuntamento, quindi la categoria 'Prenotazione' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 8e88a9b6a973de964a1525f8fcb93464 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 283
   ğŸ“Š Token totali: 711
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 711 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 283
   ğŸ“Š Token conversazione finale: 283
   ğŸ“Š Token totali: 711
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 916 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno Giulia Mi chiamo Valentina 120 Ho prenotato una visita e il breath test al glucosio per mercoledÃ¬ in viale Premuda ma mi sono accorta Mi sono ricordata che ho mangiato yogurt Quindi vorrei spostarla a settembre mi puÃ² aiutare e possibilmente del [ASSISTENTE] Per spostare la tu..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 283
   ğŸ“Š Token totali stimati: 711
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno Giulia Mi chiamo Valentina 120 Ho prenotato una visita e il breath test al glucosio per mercoledÃ¬ in viale Premuda ma mi sono accorta Mi sono ricordata che ho mangiato yogurt Quindi vorrei spostarla a settembre mi puÃ² aiutare e possibilmente del [ASSISTENTE] Per spostare la tu..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione"}}**'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:02.935764
====================================================================================================
ğŸ“‹ Session ID: classify_1756762742
â±ï¸  Processing Time: 0.816s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (916 chars):
   [UTENTE] Buongiorno Giulia Mi chiamo Valentina 120 Ho prenotato una visita e il breath test al glucosio per mercoledÃ¬ in viale Premuda ma mi sono accorta Mi sono ricordata che ho mangiato yogurt Qu...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (178 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione"}}**'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione"}}**
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione"}}**
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f754a72a0518c1bd91d33d6d1010f5a4 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 166
   ğŸ“Š Token totali: 594
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 594 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 166
   ğŸ“Š Token conversazione finale: 166
   ğŸ“Š Token totali: 594
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 557 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] buongiorno ho fatto una prenotazione di visita oncologica con prof Santoro, ma siccome al sito mi sono iscritta a mio nome risulta a mio nome la prenr, ma sarebbe per mio babbo [ASSISTENTE] Per modificare i dati della prenotazione e associarla al nome corretto, ti consiglio di contattare..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 166
   ğŸ“Š Token totali stimati: 594
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] buongiorno ho fatto una prenotazione di visita oncologica con prof Santoro, ma siccome al sito mi sono iscritta a mio nome risulta a mio nome la prenr, ma sarebbe per mio babbo [ASSISTENTE] Per modificare i dati della prenotazione e associarla al nome corretto, ti consiglio di contattare..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'prenotazione', 'confidence': 0.6, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:05.972047
====================================================================================================
ğŸ“‹ Session ID: classify_1756762745
â±ï¸  Processing Time: 2.948s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (557 chars):
   [UTENTE] buongiorno ho fatto una prenotazione di visita oncologica con prof Santoro, ma siccome al sito mi sono iscritta a mio nome risulta a mio nome la prenr, ma sarebbe per mio babbo [ASSISTENTE...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (104 chars):
   {'predicted_label': 'prenotazione', 'confidence': 0.6, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: prenotazione
   confidence: 0.6
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.600
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 60.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 6eefc00ca8c879e040e10481d4c0fb44 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 425
   ğŸ“Š Token totali: 853
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 853 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 425
   ğŸ“Š Token conversazione finale: 425
   ğŸ“Š Token totali: 853
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1383 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ho prenotato un prelievo venoso tramite assicurazione per una data ma dovrei spostare l'appuntamento. [...]  Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2774 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 425
   ğŸ“Š Token totali stimati: 853
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ho prenotato un prelievo venoso tramite assicurazione per una data ma dovrei spostare l'appuntamento. [...]  Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'utente che desidera spostare un appuntamento di prelievo venoso precedentemente prenotato tramite assicurazione. L'assistente fornisce istruzioni su come modificare l'appuntamento e conferma che Ã¨ possibile farlo all'interno del periodo di validitÃ  dell'autorizzazione dell'assicurazione.", 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:08.568053
====================================================================================================
ğŸ“‹ Session ID: classify_1756762748
â±ï¸  Processing Time: 2.511s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1383 chars):
   [UTENTE] Ho prenotato un prelievo venoso tramite assicurazione per una data ma dovrei spostare l'appuntamento. E' possibile farlo visto che l'autorizzazione dell'assicurazione ha un determinato per...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (389 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'utente che desidera spostare un appuntamento di prelievo venoso precedentemente prenotato tramite assicurazione. L'assistente fornisce istruzioni su come modificare l'appuntamento e conferma che Ã¨ possibile farlo all'interno del peri...

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.95
   motivation: La conversazione verte sull'utente che desidera spostare un appuntamento di prelievo venoso precedentemente prenotato tramite assicurazione. L'assistente fornisce istruzioni su come modificare l'appuntamento e conferma che Ã¨ possibile farlo all'interno del periodo di validitÃ  dell'autorizzazione dell'assicurazione.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'utente che desidera spostare un appuntamento di prelievo venoso precedentemente prenotato tramite assicurazione. L'assistente fornisce istruzioni su come modificare l'appuntamento e conferma che Ã¨ possibile farlo all'interno del periodo di validitÃ  dell'autorizzazione dell'assicurazione.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 0afaca2ea462f837e7fab04c066d82a4 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 276
   ğŸ“Š Token totali: 724
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 724 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 276
   ğŸ“Š Token conversazione finale: 276
   ğŸ“Š Token totali: 724
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 889 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno  [ASSISTENTE] Buongiorno! Come posso esserti utile? [UTENTE] Volevo sapere se lâ€™appuntamento che mi avete dato per 14 agosto posso farlo il 13 agosto alle 15 [ASSISTENTE] Non ho accesso alle informazioni personali o agli appuntamenti specifici. Per modificare un appuntamento, ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 276
   ğŸ“Š Token totali stimati: 724
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno  [ASSISTENTE] Buongiorno! Come posso esserti utile? [UTENTE] Volevo sapere se lâ€™appuntamento che mi avete dato per 14 agosto posso farlo il 13 agosto alle 15 [ASSISTENTE] Non ho accesso alle informazioni personali o agli appuntamenti specifici. Per modificare un appuntamento, ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione ruota attorno alla modifica di un appuntamento precedentemente prenotato. L'utente chiede se Ã¨ possibile anticipare l'appuntamento"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:11.678996
====================================================================================================
ğŸ“‹ Session ID: classify_1756762751
â±ï¸  Processing Time: 3.025s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (889 chars):
   [UTENTE] Buongiorno  [ASSISTENTE] Buongiorno! Come posso esserti utile? [UTENTE] Volevo sapere se lâ€™appuntamento che mi avete dato per 14 agosto posso farlo il 13 agosto alle 15 [ASSISTENTE] Non ho...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione ruota attorno alla modifica di un appuntamento precedentemente prenotato. L'utente chiede se Ã¨ possibile anticipare l'appuntamento"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione ruota attorno alla modifica di un appuntamento precedentemente prenotato. L'utente chiede se Ã¨ possibile anticipare l'appuntamento
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione ruota attorno alla modifica di un appuntamento precedentemente prenotato. L'utente chiede se Ã¨ possibile anticipare l'appuntamento
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione e1acf69ed1fd63d67b4cfb4dbf8cff6e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 343
   ğŸ“Š Token totali: 792
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 792 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 343
   ğŸ“Š Token conversazione finale: 343
   ğŸ“Š Token totali: 792
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1170 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Devo richiedere la cartella clinica  [ASSISTENTE] Puoi richiedere il rilascio delle cartelle cliniche dei ricoveri svolti presso l'Istituto Clinico Humanitas online dallâ€™area referti di [Humanitas con te](https://www.humanitasconte.it). Se sei in struttura, puoi rivolgerti all'Ufficio Ri..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 343
   ğŸ“Š Token totali stimati: 792
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Devo richiedere la cartella clinica  [ASSISTENTE] Puoi richiedere il rilascio delle cartelle cliniche dei ricoveri svolti presso l'Istituto Clinico Humanitas online dallâ€™area referti di [Humanitas con te](https://www.humanitasconte.it). Se sei in struttura, puoi rivolgerti all'Ufficio Ri..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sul recupero delle cartelle cliniche dell'utente presso l'Istituto Clinico Humanitas.", 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:13.429808
====================================================================================================
ğŸ“‹ Session ID: classify_1756762753
â±ï¸  Processing Time: 1.653s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1170 chars):
   [UTENTE] Devo richiedere la cartella clinica  [ASSISTENTE] Puoi richiedere il rilascio delle cartelle cliniche dei ricoveri svolti presso l'Istituto Clinico Humanitas online dallâ€™area referti di [H...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (196 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sul recupero delle cartelle cliniche dell'utente presso l'Istituto Clinico Humanitas.", 'predicted_label': 'Referti e Cartelle Cliniche'}

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione verte sul recupero delle cartelle cliniche dell'utente presso l'Istituto Clinico Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sul recupero delle cartelle cliniche dell'utente presso l'Istituto Clinico Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione fdfe5346d217d2fea90071bce745ed2c classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 453
   ğŸ“Š Token totali: 901
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 901 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 453
   ğŸ“Š Token conversazione finale: 453
   ğŸ“Š Token totali: 901
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1507 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buon giorno Giulia. [...]  Buona giornata! ğŸŒŸ"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2721 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 453
   ğŸ“Š Token totali stimati: 901
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buon giorno Giulia. [...]  Buona giornata! ğŸŒŸ"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla richiesta dell'utente di ricevere la cartella clinica del suo intervento presso l'Humanitas San Pio X d"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:16.228496
====================================================================================================
ğŸ“‹ Session ID: classify_1756762756
â±ï¸  Processing Time: 2.712s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1507 chars):
   [UTENTE] Buon giorno Giulia. [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? ğŸ˜Š [UTENTE] Buon giorno vorrei ricevere a casa x via posta la cartella clinica del mio. Intervento eseguito il 19...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla richiesta dell'utente di ricevere la cartella clinica del suo intervento presso l'Humanitas San Pio X d"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte principalmente sulla richiesta dell'utente di ricevere la cartella clinica del suo intervento presso l'Humanitas San Pio X d
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte principalmente sulla richiesta dell'utente di ricevere la cartella clinica del suo intervento presso l'Humanitas San Pio X d
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione c0c714fbbc58870c1caa166fcedac14b classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 176
   ğŸ“Š Token totali: 604
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 604 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 176
   ğŸ“Š Token conversazione finale: 176
   ğŸ“Š Token totali: 604
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 610 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] quali sono i tempi per ritiro del cd e referto in caso di rx eos? [ASSISTENTE] Il referto e il CD relativi all'RX EOS possono essere ritirati a partire dalla prima data utile indicata sul tagliando di promemoria rilasciato al momento dell'accettazione. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2869 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 176
   ğŸ“Š Token totali stimati: 604
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] quali sono i tempi per ritiro del cd e referto in caso di rx eos? [ASSISTENTE] Il referto e il CD relativi all'RX EOS possono essere ritirati a partire dalla prima data utile indicata sul tagliando di promemoria rilasciato al momento dell'accettazione. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.9, 'motivation': "La conversazione verte sul ritiro del referto e del CD dell'esame RX EOS, pertanto la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.", 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:18.054961
====================================================================================================
ğŸ“‹ Session ID: classify_1756762758
â±ï¸  Processing Time: 1.740s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (610 chars):
   [UTENTE] quali sono i tempi per ritiro del cd e referto in caso di rx eos? [ASSISTENTE] Il referto e il CD relativi all'RX EOS possono essere ritirati a partire dalla prima data utile indicata sul ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (227 chars):
   {'confidence': 0.9, 'motivation': "La conversazione verte sul ritiro del referto e del CD dell'esame RX EOS, pertanto la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.", 'predicted_label': 'Referti e Cartelle Cliniche'}

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.9
   motivation: La conversazione verte sul ritiro del referto e del CD dell'esame RX EOS, pertanto la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.900
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 90.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sul ritiro del referto e del CD dell'esame RX EOS, pertanto la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 6a8c6d2e99eae81948634919cef4ef3e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 447
   ğŸ’¬ Token conversazione: 257
   ğŸ“Š Token totali: 704
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 704 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 447
   ğŸ“Š Token conversazione originale: 257
   ğŸ“Š Token conversazione finale: 257
   ğŸ“Š Token totali: 704
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 910 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ho subito un intervento il 23/7 ENON Vedo ancora la cartella clinica. [...]  Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2806 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 447
   ğŸ“Š Token conversazione: 257
   ğŸ“Š Token totali stimati: 704
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ho subito un intervento il 23/7 ENON Vedo ancora la cartella clinica. [...]  Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:19.818411
====================================================================================================
ğŸ“‹ Session ID: classify_1756762759
â±ï¸  Processing Time: 1.678s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (910 chars):
   [UTENTE] ho subito un intervento il 23/7 ENON Vedo ancora la cartella clinica. e' possibile che non sia ancora prnta? [ASSISTENTE] La cartella clinica digitale Ã¨ generalmente disponibile per la con...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 182ed227bea236c2ff50d2d46a08ce3d classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 327
   ğŸ“Š Token totali: 776
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 776 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 327
   ğŸ“Š Token conversazione finale: 327
   ğŸ“Š Token totali: 776
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1087 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] devo fare richiesta di una cartella clinica di un paziente che Ã¨ deceduto Lino Humanitas [ASSISTENTE] Per richiedere la cartella clinica di un paziente deceduto, Ã¨ necessario seguire le normative sulla privacy. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2957 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 327
   ğŸ“Š Token totali stimati: 776
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] devo fare richiesta di una cartella clinica di un paziente che Ã¨ deceduto Lino Humanitas [ASSISTENTE] Per richiedere la cartella clinica di un paziente deceduto, Ã¨ necessario seguire le normative sulla privacy. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:21.721903
====================================================================================================
ğŸ“‹ Session ID: classify_1756762761
â±ï¸  Processing Time: 1.812s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1087 chars):
   [UTENTE] devo fare richiesta di una cartella clinica di un paziente che Ã¨ deceduto Lino Humanitas [ASSISTENTE] Per richiedere la cartella clinica di un paziente deceduto, Ã¨ necessario seguire le no...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 845105cb3506c744c100f07be3e3efac classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 176
   ğŸ“Š Token totali: 625
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 625 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 176
   ğŸ“Š Token conversazione finale: 176
   ğŸ“Š Token totali: 625
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 644 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Devo modificare il numero di cellulare  [ASSISTENTE] Per modificare il numero di cellulare associato al tuo account o ai tuoi dati presso Humanitas, ti consiglio di accedere al portale [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 176
   ğŸ“Š Token totali stimati: 625
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Devo modificare il numero di cellulare  [ASSISTENTE] Per modificare il numero di cellulare associato al tuo account o ai tuoi dati presso Humanitas, ti consiglio di accedere al portale [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sulla modifica del numero di cellulare associato all'account dell'utente su Humanitas con te.", 'predicted_label': 'Humanitas con te - Registrazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:23.388431
====================================================================================================
ğŸ“‹ Session ID: classify_1756762763
â±ï¸  Processing Time: 1.581s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (644 chars):
   [UTENTE] Devo modificare il numero di cellulare  [ASSISTENTE] Per modificare il numero di cellulare associato al tuo account o ai tuoi dati presso Humanitas, ti consiglio di accedere al portale [Hu...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (209 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sulla modifica del numero di cellulare associato all'account dell'utente su Humanitas con te.", 'predicted_label': 'Humanitas con te - Registrazione'}

ğŸ“Š Parsed Response:
   predicted_label: Humanitas con te - Registrazione
   confidence: 0.95
   motivation: La conversazione verte sulla modifica del numero di cellulare associato all'account dell'utente su Humanitas con te.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sulla modifica del numero di cellulare associato all'account dell'utente su Humanitas con te.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione e5561797c1f19fec35e2c85552d57da6 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Humanitas con te - Registrazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 454
   ğŸ’¬ Token conversazione: 384
   ğŸ“Š Token totali: 838
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 838 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione originale: 384
   ğŸ“Š Token conversazione finale: 384
   ğŸ“Š Token totali: 838
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1305 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco a impostare la ricezione di notifiche sullâ€™area referti  [ASSISTENTE] Per impostare la ricezione di notifiche sullâ€™area referti di [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2951 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione: 384
   ğŸ“Š Token totali stimati: 838
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco a impostare la ricezione di notifiche sullâ€™area referti  [ASSISTENTE] Per impostare la ricezione di notifiche sullâ€™area referti di [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Classification of conversation:**\n\n- predicted_label: "Humanitas con te - Registrazione"\n- confide'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:25.293291
====================================================================================================
ğŸ“‹ Session ID: classify_1756762765
â±ï¸  Processing Time: 1.818s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1305 chars):
   [UTENTE] Non riesco a impostare la ricezione di notifiche sullâ€™area referti  [ASSISTENTE] Per impostare la ricezione di notifiche sullâ€™area referti di [Humanitas con te](https://www.humanitasconte....

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (194 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Classification of conversation:**\n\n- predicted_label: "Humanitas con te - Registrazione"\n- confide'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **Classification of conversation:**

- predicted_label: "Humanitas con te - Registrazione"
- confide
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **Classification of conversation:**

- predicted_label: "Humanitas con te - Registrazione"
- confide
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 20199d190fa2a7f6ae57f1b304b594dc classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 452
   ğŸ’¬ Token conversazione: 93
   ğŸ“Š Token totali: 545
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 545 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 452
   ğŸ“Š Token conversazione originale: 93
   ğŸ“Š Token conversazione finale: 93
   ğŸ“Š Token totali: 545
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 322 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Hanno sbagliato il mio numero di telefono  [ASSISTENTE] Se il tuo numero di telefono Ã¨ stato registrato in modo errato, ti consiglio di contattare direttamente il servizio di assistenza o il reparto con cui hai avuto contatti per correggere l'errore. Se hai bisogno di ulteriori dettagli o s..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2986 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 452
   ğŸ“Š Token conversazione: 93
   ğŸ“Š Token totali stimati: 545
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Hanno sbagliato il mio numero di telefono  [ASSISTENTE] Se il tuo numero di telefono Ã¨ stato registrato in modo errato, ti consiglio di contattare direttamente il servizio di assistenza o il reparto con cui hai avuto contatti per correggere l'errore. Se hai bisogno di ulteriori dettagli o s..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'errore nel numero di telefono dell'utente e sul suggerimento di contattare il servizio di assistenza per correggerlo.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:27.054832
====================================================================================================
ğŸ“‹ Session ID: classify_1756762767
â±ï¸  Processing Time: 1.673s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (322 chars):
   [UTENTE] Hanno sbagliato il mio numero di telefono  [ASSISTENTE] Se il tuo numero di telefono Ã¨ stato registrato in modo errato, ti consiglio di contattare direttamente il servizio di assistenza o ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (223 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'errore nel numero di telefono dell'utente e sul suggerimento di contattare il servizio di assistenza per correggerlo.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.95
   motivation: La conversazione verte sull'errore nel numero di telefono dell'utente e sul suggerimento di contattare il servizio di assistenza per correggerlo.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'errore nel numero di telefono dell'utente e sul suggerimento di contattare il servizio di assistenza per correggerlo.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione a7bd13ed44a98dcdc7e1806cebbe1e50 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 149
   ğŸ“Š Token totali: 577
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 577 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 149
   ğŸ“Š Token conversazione finale: 149
   ğŸ“Š Token totali: 577
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 530 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Come faccio a modificare il mio numero di cellulare sul App area personale  [ASSISTENTE] Per modificare il numero di cellulare nell'App "Humanitas con te", accedi alla tua area personale. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2804 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 149
   ğŸ“Š Token totali stimati: 577
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Come faccio a modificare il mio numero di cellulare sul App area personale  [ASSISTENTE] Per modificare il numero di cellulare nell'App "Humanitas con te", accedi alla tua area personale. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.9, 'motivation': "La conversazione verte sull'accesso e la modifica delle informazioni personali nell'app Humanitas con te.", 'predicted_label': 'Humanitas con te - Registrazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:28.622079
====================================================================================================
ğŸ“‹ Session ID: classify_1756762768
â±ï¸  Processing Time: 1.481s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (530 chars):
   [UTENTE] Come faccio a modificare il mio numero di cellulare sul App area personale  [ASSISTENTE] Per modificare il numero di cellulare nell'App "Humanitas con te", accedi alla tua area personale. ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (197 chars):
   {'confidence': 0.9, 'motivation': "La conversazione verte sull'accesso e la modifica delle informazioni personali nell'app Humanitas con te.", 'predicted_label': 'Humanitas con te - Registrazione'}

ğŸ“Š Parsed Response:
   predicted_label: Humanitas con te - Registrazione
   confidence: 0.9
   motivation: La conversazione verte sull'accesso e la modifica delle informazioni personali nell'app Humanitas con te.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.900
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 90.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'accesso e la modifica delle informazioni personali nell'app Humanitas con te.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione e225b9c55a9f51d3276cd0e78133d5b5 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Humanitas con te - Registrazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 454
   ğŸ’¬ Token conversazione: 260
   ğŸ“Š Token totali: 714
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 714 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione originale: 260
   ğŸ“Š Token conversazione finale: 260
   ğŸ“Š Token totali: 714
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 824 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco a registrami su Humanitas con te [ASSISTENTE] Per registrarti su [Humanitas con te](https://www. [...] docxã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2827 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione: 260
   ğŸ“Š Token totali stimati: 714
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco a registrami su Humanitas con te [ASSISTENTE] Per registrarti su [Humanitas con te](https://www. [...] docxã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.9, 'motivation': "La conversazione verte sulla difficoltÃ  dell'utente nel registrarsi su Humanitas con te e l'assistenza fornisce istruzioni dettagliate per completare la procedura di registrazione.", 'predicted_label': 'Humanitas con te - Registrazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:30.622419
====================================================================================================
ğŸ“‹ Session ID: classify_1756762770
â±ï¸  Processing Time: 1.912s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (824 chars):
   [UTENTE] Non riesco a registrami su Humanitas con te [ASSISTENTE] Per registrarti su [Humanitas con te](https://www.humanitasconte.it), segui questi passaggi:

1. Collegati al sito [Humanitas con t...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (272 chars):
   {'confidence': 0.9, 'motivation': "La conversazione verte sulla difficoltÃ  dell'utente nel registrarsi su Humanitas con te e l'assistenza fornisce istruzioni dettagliate per completare la procedura di registrazione.", 'predicted_label': 'Humanitas con te - Registrazione'}

ğŸ“Š Parsed Response:
   predicted_label: Humanitas con te - Registrazione
   confidence: 0.9
   motivation: La conversazione verte sulla difficoltÃ  dell'utente nel registrarsi su Humanitas con te e l'assistenza fornisce istruzioni dettagliate per completare la procedura di registrazione.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.900
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 90.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sulla difficoltÃ  dell'utente nel registrarsi su Humanitas con te e l'assistenza fornisce istruzioni dettagliate per completare la procedura di registrazione.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 2b2cbfdcb43401d084b6cedce71d6d46 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Humanitas con te - Registrazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 430
   ğŸ“Š Token totali: 878
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 878 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 430
   ğŸ“Š Token conversazione finale: 430
   ğŸ“Š Token totali: 878
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1423 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia, come posso registrarmi al vostro portale? [ASSISTENTE] Per registrarti al portale [Humanitas con te](https://www. [...]  Buona giornata! ğŸ˜Š"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2828 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 430
   ğŸ“Š Token totali stimati: 878
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia, come posso registrarmi al vostro portale? [ASSISTENTE] Per registrarti al portale [Humanitas con te](https://www. [...]  Buona giornata! ğŸ˜Š"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione inizia con l'utente che chiede come registrarsi al portale Humanitas con te e l'assistente fornisce le istruzioni necessarie. Succ"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:33.428160
====================================================================================================
ğŸ“‹ Session ID: classify_1756762773
â±ï¸  Processing Time: 2.720s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1423 chars):
   [UTENTE] Ciao Giulia, come posso registrarmi al vostro portale? [ASSISTENTE] Per registrarti al portale [Humanitas con te](https://www.humanitasconte.it), devi essere maggiorenne e avere a disposiz...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione inizia con l'utente che chiede come registrarsi al portale Humanitas con te e l'assistente fornisce le istruzioni necessarie. Succ"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione inizia con l'utente che chiede come registrarsi al portale Humanitas con te e l'assistente fornisce le istruzioni necessarie. Succ
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione inizia con l'utente che chiede come registrarsi al portale Humanitas con te e l'assistente fornisce le istruzioni necessarie. Succ
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 372b6105e5fbbba3c32ce5493b5db0c1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 454
   ğŸ’¬ Token conversazione: 368
   ğŸ“Š Token totali: 822
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 822 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione originale: 368
   ğŸ“Š Token conversazione finale: 368
   ğŸ“Š Token totali: 822
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1178 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco ad accedere ne registrarmi al servizio  [ASSISTENTE] Se riscontri problemi con la registrazione o l'accesso al portale [Humanitas con te](https://www. [...] it/info/humanitas-con-te)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2901 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione: 368
   ğŸ“Š Token totali stimati: 822
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco ad accedere ne registrarmi al servizio  [ASSISTENTE] Se riscontri problemi con la registrazione o l'accesso al portale [Humanitas con te](https://www. [...] it/info/humanitas-con-te)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Humanitas con te - Registrazione",\n  "con'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:35.401427
====================================================================================================
ğŸ“‹ Session ID: classify_1756762775
â±ï¸  Processing Time: 1.886s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1178 chars):
   [UTENTE] Non riesco ad accedere ne registrarmi al servizio  [ASSISTENTE] Se riscontri problemi con la registrazione o l'accesso al portale [Humanitas con te](https://www.humanitasconte.it), ti cons...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (196 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Humanitas con te - Registrazione",\n  "con'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Humanitas con te - Registrazione",
  "con
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Humanitas con te - Registrazione",
  "con
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 0c5778e466178615ba13e8f0bea44f4e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
   ğŸ“ˆ Progresso LLM: 150/155
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 231
   ğŸ“Š Token totali: 680
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 680 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 231
   ğŸ“Š Token conversazione finale: 231
   ğŸ“Š Token totali: 680
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 775 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao dovrei fare la registrazione per poi scaricare i referti delle visite che ho fatto come devo fare [ASSISTENTE] Per registrarti al portale [Humanitas con te](https://www. [...] docxã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2864 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 231
   ğŸ“Š Token totali stimati: 680
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao dovrei fare la registrazione per poi scaricare i referti delle visite che ho fatto come devo fare [ASSISTENTE] Per registrarti al portale [Humanitas con te](https://www. [...] docxã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.9, 'motivation': "La conversazione verte sulla registrazione all'area riservata del portale Humanitas con te per scaricare i referti delle visite mediche.", 'predicted_label': 'Humanitas con te - Registrazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:37.156827
====================================================================================================
ğŸ“‹ Session ID: classify_1756762777
â±ï¸  Processing Time: 1.667s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (775 chars):
   [UTENTE] Ciao dovrei fare la registrazione per poi scaricare i referti delle visite che ho fatto come devo fare [ASSISTENTE] Per registrarti al portale [Humanitas con te](https://www.humanitasconte...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (228 chars):
   {'confidence': 0.9, 'motivation': "La conversazione verte sulla registrazione all'area riservata del portale Humanitas con te per scaricare i referti delle visite mediche.", 'predicted_label': 'Humanitas con te - Registrazione'}

ğŸ“Š Parsed Response:
   predicted_label: Humanitas con te - Registrazione
   confidence: 0.9
   motivation: La conversazione verte sulla registrazione all'area riservata del portale Humanitas con te per scaricare i referti delle visite mediche.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.900
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 90.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sulla registrazione all'area riservata del portale Humanitas con te per scaricare i referti delle visite mediche.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 36358ea4a8088d57dfb6c88727d3bb81 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Humanitas con te - Registrazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 243
   ğŸ“Š Token totali: 691
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 691 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 243
   ğŸ“Š Token conversazione finale: 243
   ğŸ“Š Token totali: 691
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 877 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao, volevo sapere dopo quanti giorni Ã¨ pronto il referto di una risonanza magnetica addome inferiore [ASSISTENTE] Il referto della risonanza magnetica sarÃ  disponibile a partire dalla data e dall'orario specificati sul promemoria di ritiro del referto o sul ticket di accettazione rilas..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 243
   ğŸ“Š Token totali stimati: 691
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao, volevo sapere dopo quanti giorni Ã¨ pronto il referto di una risonanza magnetica addome inferiore [ASSISTENTE] Il referto della risonanza magnetica sarÃ  disponibile a partire dalla data e dall'orario specificati sul promemoria di ritiro del referto o sul ticket di accettazione rilas..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:39.021945
====================================================================================================
ğŸ“‹ Session ID: classify_1756762779
â±ï¸  Processing Time: 1.776s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (877 chars):
   [UTENTE] Ciao, volevo sapere dopo quanti giorni Ã¨ pronto il referto di una risonanza magnetica addome inferiore [ASSISTENTE] Il referto della risonanza magnetica sarÃ  disponibile a partire dalla da...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 74b85f308de5becd01e60dfa9ef67f1b classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 219
   ğŸ“Š Token totali: 647
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 647 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 219
   ğŸ“Š Token conversazione finale: 219
   ğŸ“Š Token totali: 647
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 789 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ho fatto una risonanza magnetica venerdÃ¬ 11 luglio e sul foglio dell'accettazione c'era scritto che il referto sarebbe arrivato oggi ma ancora non ho ricevuto niente. [...] it/Help)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2786 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 219
   ğŸ“Š Token totali stimati: 647
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ho fatto una risonanza magnetica venerdÃ¬ 11 luglio e sul foglio dell'accettazione c'era scritto che il referto sarebbe arrivato oggi ma ancora non ho ricevuto niente. [...] it/Help)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'assenza del referto di una risonanza magnetica eseguita dall'utente e l'assistente spiega quando il referto sarÃ  disponibile.", 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:40.944791
====================================================================================================
ğŸ“‹ Session ID: classify_1756762780
â±ï¸  Processing Time: 1.837s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (789 chars):
   [UTENTE] Ho fatto una risonanza magnetica venerdÃ¬ 11 luglio e sul foglio dell'accettazione c'era scritto che il referto sarebbe arrivato oggi ma ancora non ho ricevuto niente. E' possibile che arri...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (241 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'assenza del referto di una risonanza magnetica eseguita dall'utente e l'assistente spiega quando il referto sarÃ  disponibile.", 'predicted_label': 'Referti e Cartelle Cliniche'}

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione verte sull'assenza del referto di una risonanza magnetica eseguita dall'utente e l'assistente spiega quando il referto sarÃ  disponibile.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'assenza del referto di una risonanza magnetica eseguita dall'utente e l'assistente spiega quando il referto sarÃ  disponibile.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione c85e550cd477497cf0b91a80518b6075 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 322
   ğŸ“Š Token totali: 770
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 770 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 322
   ğŸ“Š Token conversazione finale: 322
   ğŸ“Š Token totali: 770
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1067 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, 

Ieri ho fatto le analisi del sangue per la GONADOTROPINA CORIONICA (SUBUNITA' BETA, FRAZIONE LIBERA). [...]  Se posso aiutarti in altro, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2841 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 322
   ğŸ“Š Token totali stimati: 770
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, 

Ieri ho fatto le analisi del sangue per la GONADOTROPINA CORIONICA (SUBUNITA' BETA, FRAZIONE LIBERA). [...]  Se posso aiutarti in altro, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Classification of medical conversation**\n\n- predicted_label: "Analisi"\n- confidence: 0.9\n- motivat'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:42.701241
====================================================================================================
ğŸ“‹ Session ID: classify_1756762782
â±ï¸  Processing Time: 1.670s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1067 chars):
   [UTENTE] Buongiorno, 

Ieri ho fatto le analisi del sangue per la GONADOTROPINA CORIONICA (SUBUNITA' BETA, FRAZIONE LIBERA). 

Ãˆ un esame che tutti i centri analisi effettuano e refertano in giorna...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (195 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Classification of medical conversation**\n\n- predicted_label: "Analisi"\n- confidence: 0.9\n- motivat'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **Classification of medical conversation**

- predicted_label: "Analisi"
- confidence: 0.9
- motivat
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **Classification of medical conversation**

- predicted_label: "Analisi"
- confidence: 0.9
- motivat
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f2531d5ac34b6a6de71a890ec26ba542 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 163
   ğŸ“Š Token totali: 591
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 591 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 163
   ğŸ“Š Token conversazione finale: 163
   ğŸ“Š Token totali: 591
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 579 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buon Giorno Giulia ho effettuato una radiografia in data 1/8 ed il referto doveva essere disponibile il 4/8 ma non Ã¨ ancora presente [ASSISTENTE] Il referto dovrebbe essere disponibile a partire dalla data e dall'orario specificati sul promemoria di ritiro del referto o sul ticket di acc..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 163
   ğŸ“Š Token totali stimati: 591
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buon Giorno Giulia ho effettuato una radiografia in data 1/8 ed il referto doveva essere disponibile il 4/8 ma non Ã¨ ancora presente [ASSISTENTE] Il referto dovrebbe essere disponibile a partire dalla data e dall'orario specificati sul promemoria di ritiro del referto o sul ticket di acc..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione ruota attorno alla richiesta di informazioni sul referto di una radiografia effettuata dall'utente. L'assistente fornisce istruzio"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:45.753582
====================================================================================================
ğŸ“‹ Session ID: classify_1756762785
â±ï¸  Processing Time: 2.964s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (579 chars):
   [UTENTE] Buon Giorno Giulia ho effettuato una radiografia in data 1/8 ed il referto doveva essere disponibile il 4/8 ma non Ã¨ ancora presente [ASSISTENTE] Il referto dovrebbe essere disponibile a p...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione ruota attorno alla richiesta di informazioni sul referto di una radiografia effettuata dall'utente. L'assistente fornisce istruzio"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione ruota attorno alla richiesta di informazioni sul referto di una radiografia effettuata dall'utente. L'assistente fornisce istruzio
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione ruota attorno alla richiesta di informazioni sul referto di una radiografia effettuata dall'utente. L'assistente fornisce istruzio
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 5aa576fac40c7144910aaf7f408de055 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
   ğŸ“ˆ Progresso LLM: 155/155
ğŸ”„ Fase 4: Analisi consenso e propagazione etichette...
   âœ… Cluster 0: 'altro' (38 sessioni, 4 reps, conf: 0.825, consenso: 1.00)
   âœ… Cluster 1: 'altro' (46 sessioni, 4 reps, conf: 0.300, consenso: 0.75)
   âœ… Cluster 2: 'Prenotazione' (19 sessioni, 4 reps, conf: 0.760, consenso: 0.50)
   âœ… Cluster 3: 'altro' (98 sessioni, 5 reps, conf: 0.300, consenso: 0.80)
   âœ… Cluster 4: 'Analisi' (97 sessioni, 5 reps, conf: 0.717, consenso: 0.60)
   âœ… Cluster 5: 'altro' (202 sessioni, 5 reps, conf: 0.300, consenso: 1.00)
   âœ… Cluster 6: 'altro' (302 sessioni, 5 reps, conf: 0.300, consenso: 0.80)
   âœ… Cluster 7: 'altro' (97 sessioni, 5 reps, conf: 0.300, consenso: 0.80)
   âœ… Cluster 8: 'altro' (152 sessioni, 5 reps, conf: 0.300, consenso: 0.60)
   âœ… Cluster 9: 'Servizi aziendali' (35 sessioni, 4 reps, conf: 0.760, consenso: 0.50)
   âœ… Cluster 10: 'altro' (52 sessioni, 5 reps, conf: 0.300, consenso: 0.60)
   âœ… Cluster 11: 'altro' (313 sessioni, 5 reps, conf: 0.300, consenso: 0.80)
   âœ… Cluster 12: 'Servizi aziendali' (34 sessioni, 4 reps, conf: 0.760, consenso: 0.50)
   âœ… Cluster 13: 'altro' (47 sessioni, 4 reps, conf: 0.300, consenso: 1.00)
   âœ… Cluster 14: 'altro' (17 sessioni, 4 reps, conf: 0.338, consenso: 0.75)
   âœ… Cluster 15: 'altro' (30 sessioni, 4 reps, conf: 0.300, consenso: 0.75)
   âœ… Cluster 16: 'altro' (24 sessioni, 4 reps, conf: 0.325, consenso: 1.00)
   âœ… Cluster 17: 'altro' (42 sessioni, 4 reps, conf: 0.300, consenso: 0.75)
   âœ… Cluster 18: 'altro' (241 sessioni, 5 reps, conf: 0.340, consenso: 1.00)
   âœ… Cluster 19: 'altro' (46 sessioni, 4 reps, conf: 0.300, consenso: 0.75)
   âœ… Cluster 20: 'Analisi' (19 sessioni, 4 reps, conf: 0.680, consenso: 0.50)
   âœ… Cluster 21: 'Analisi' (26 sessioni, 4 reps, conf: 0.760, consenso: 0.50)
   âœ… Cluster 22: 'altro' (74 sessioni, 5 reps, conf: 0.300, consenso: 0.60)
   âœ… Cluster 23: 'Servizi aziendali' (29 sessioni, 4 reps, conf: 0.760, consenso: 0.50)
   âœ… Cluster 24: 'Visita Specialistica' (50 sessioni, 4 reps, conf: 0.760, consenso: 0.50)
   âœ… Cluster 25: 'Prenotazione' (32 sessioni, 4 reps, conf: 0.760, consenso: 0.50)
   âœ… Cluster 26: 'Servizi aziendali' (51 sessioni, 5 reps, conf: 0.760, consenso: 0.40)
   âœ… Cluster 27: 'Prenotazione' (36 sessioni, 4 reps, conf: 0.760, consenso: 0.50)
   âœ… Cluster 28: 'Servizi aziendali' (200 sessioni, 5 reps, conf: 0.640, consenso: 0.40)
   âœ… Cluster 29: 'altro' (91 sessioni, 5 reps, conf: 0.300, consenso: 0.80)
   âœ… Cluster 30: 'Prenotazione' (164 sessioni, 5 reps, conf: 0.760, consenso: 0.40)
   âœ… Cluster 31: 'altro' (81 sessioni, 5 reps, conf: 0.300, consenso: 0.60)
   âœ… Cluster 32: 'Humanitas con te - Registrazione' (36 sessioni, 4 reps, conf: 0.760, consenso: 0.50)
   âœ… Cluster 33: 'Humanitas con te - Registrazione' (42 sessioni, 4 reps, conf: 0.720, consenso: 0.50)
   âœ… Cluster 34: 'altro' (22 sessioni, 4 reps, conf: 0.300, consenso: 0.75)
ğŸ” Fase 5: Analisi individuale di 624 outliers...
ğŸ¤– Analisi LLM di 624 conversazioni...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 344
   ğŸ“Š Token totali: 792
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 792 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 344
   ğŸ“Š Token conversazione finale: 344
   ğŸ“Š Token totali: 792
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1133 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ho bisogno degli esITI di esami ESEGUITi IN fase di prericovero come ottenerli ? [ASSISTENTE] Per ottenere i risultati degli esami eseguiti in fase di prericovero, puoi accedere alla pagina [Referti e Cartelle Cliniche - Humanitas](https://www.humanitas.it/info/referti-cartelle-cliniche/..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 344
   ğŸ“Š Token totali stimati: 792
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ho bisogno degli esITI di esami ESEGUITi IN fase di prericovero come ottenerli ? [ASSISTENTE] Per ottenere i risultati degli esami eseguiti in fase di prericovero, puoi accedere alla pagina [Referti e Cartelle Cliniche - Humanitas](https://www.humanitas.it/info/referti-cartelle-cliniche/..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'ottenimento dei risultati degli esami eseguiti in fase di prericovero, quindi la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.", 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:47.772893
====================================================================================================
ğŸ“‹ Session ID: classify_1756762787
â±ï¸  Processing Time: 1.918s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1133 chars):
   [UTENTE] ho bisogno degli esITI di esami ESEGUITi IN fase di prericovero come ottenerli ? [ASSISTENTE] Per ottenere i risultati degli esami eseguiti in fase di prericovero, puoi accedere alla pagin...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (251 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'ottenimento dei risultati degli esami eseguiti in fase di prericovero, quindi la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.", 'predicted_label': 'Referti e Cartelle Cliniche'}

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione verte sull'ottenimento dei risultati degli esami eseguiti in fase di prericovero, quindi la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'ottenimento dei risultati degli esami eseguiti in fase di prericovero, quindi la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 37fbb553dbc13049ebd4c4aa5aff320f classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 145
   ğŸ“Š Token totali: 594
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 594 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 145
   ğŸ“Š Token conversazione finale: 145
   ğŸ“Š Token totali: 594
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 517 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Voglio cancella l account  [ASSISTENTE] Per cancellare il tuo account e richiedere la rimozione dei tuoi dati personali, puoi utilizzare il modulo dedicato disponibile alla pagina [Form per lâ€™esercizio dei diritti in materia di protezione dei dati personali - Humanitas](https://www.human..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 145
   ğŸ“Š Token totali stimati: 594
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Voglio cancella l account  [ASSISTENTE] Per cancellare il tuo account e richiedere la rimozione dei tuoi dati personali, puoi utilizzare il modulo dedicato disponibile alla pagina [Form per lâ€™esercizio dei diritti in materia di protezione dei dati personali - Humanitas](https://www.human..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.8, 'motivation': "La conversazione riguarda la cancellazione dell'account e la richiesta di rimozione dei dati personali, che sono entrambi servizi offerti dall'azienda.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:49.513837
====================================================================================================
ğŸ“‹ Session ID: classify_1756762789
â±ï¸  Processing Time: 1.655s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (517 chars):
   [UTENTE] Voglio cancella l account  [ASSISTENTE] Per cancellare il tuo account e richiedere la rimozione dei tuoi dati personali, puoi utilizzare il modulo dedicato disponibile alla pagina [Form pe...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (228 chars):
   {'confidence': 0.8, 'motivation': "La conversazione riguarda la cancellazione dell'account e la richiesta di rimozione dei dati personali, che sono entrambi servizi offerti dall'azienda.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.8
   motivation: La conversazione riguarda la cancellazione dell'account e la richiesta di rimozione dei dati personali, che sono entrambi servizi offerti dall'azienda.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.800
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘] 80.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la cancellazione dell'account e la richiesta di rimozione dei dati personali, che sono entrambi servizi offerti dall'azienda.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 00289078e4bdce068dd3599fc7a66e08 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 374
   ğŸ“Š Token totali: 823
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 823 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 374
   ğŸ“Š Token conversazione finale: 374
   ğŸ“Š Token totali: 823
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1237 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao [ASSISTENTE] Ciao! Come posso esserti utile? ğŸ˜Š [UTENTE] Ho prenotato una visita dermatologica presso Medical care di Lainate con forma indiretta Metasalute, che documenti devo presentare? [ASSISTENTE] Per la visita dermatologica presso Humanitas Medical Care di Lainate con forma ind..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 374
   ğŸ“Š Token totali stimati: 823
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao [ASSISTENTE] Ciao! Come posso esserti utile? ğŸ˜Š [UTENTE] Ho prenotato una visita dermatologica presso Medical care di Lainate con forma indiretta Metasalute, che documenti devo presentare? [ASSISTENTE] Per la visita dermatologica presso Humanitas Medical Care di Lainate con forma ind..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica"}}'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:50.449233
====================================================================================================
ğŸ“‹ Session ID: classify_1756762790
â±ï¸  Processing Time: 0.849s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1237 chars):
   [UTENTE] Ciao [ASSISTENTE] Ciao! Come posso esserti utile? ğŸ˜Š [UTENTE] Ho prenotato una visita dermatologica presso Medical care di Lainate con forma indiretta Metasalute, che documenti devo present...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (184 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica"}}'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica"}}
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica"}}
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 9dbdae042767b6e0fc6fc01eb56e92c7 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 221
   ğŸ“Š Token totali: 649
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 649 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 221
   ğŸ“Š Token conversazione finale: 221
   ğŸ“Š Token totali: 649
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 710 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] la risonanza magnetica di rozzano Ã¨ una rispnanza aperta? [ASSISTENTE] SÃ¬, presso Humanitas Rozzano Ã¨ disponibile una risonanza magnetica aperta, particolarmente indicata per pazienti claustrofobici, bambini, anziani e persone in sovrappeso. Questo tipo di apparecchiatura offre maggiore ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 221
   ğŸ“Š Token totali stimati: 649
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] la risonanza magnetica di rozzano Ã¨ una rispnanza aperta? [ASSISTENTE] SÃ¬, presso Humanitas Rozzano Ã¨ disponibile una risonanza magnetica aperta, particolarmente indicata per pazienti claustrofobici, bambini, anziani e persone in sovrappeso. Questo tipo di apparecchiatura offre maggiore ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.1, 'motivation': "Errore API: Function call incompleta: mancano campi richiesti ['confidence', 'motivation'] in {'predicted_label'"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:51.391757
====================================================================================================
ğŸ“‹ Session ID: classify_1756762791
â±ï¸  Processing Time: 0.850s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (710 chars):
   [UTENTE] la risonanza magnetica di rozzano Ã¨ una rispnanza aperta? [ASSISTENTE] SÃ¬, presso Humanitas Rozzano Ã¨ disponibile una risonanza magnetica aperta, particolarmente indicata per pazienti clau...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (177 chars):
   {'predicted_label': 'altro', 'confidence': 0.1, 'motivation': "Errore API: Function call incompleta: mancano campi richiesti ['confidence', 'motivation'] in {'predicted_label'"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.1
   motivation: Errore API: Function call incompleta: mancano campi richiesti ['confidence', 'motivation'] in {'predicted_label'
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.100
   [â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 10.0%

ğŸ§  Reasoning/Motivation:
   Errore API: Function call incompleta: mancano campi richiesti ['confidence', 'motivation'] in {'predicted_label'
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 36f3cfe68a0138ca77646420f4466bb0 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 346
   ğŸ“Š Token totali: 794
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 794 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 346
   ğŸ“Š Token conversazione finale: 346
   ğŸ“Š Token totali: 794
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1130 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] help [ASSISTENTE] Posso aiutarti con informazioni relative allâ€™Istituto Clinico Humanitas, come:

- Prenotazioni di visite ed esami;
- Norme di preparazione per esami;
- Indicazioni stradali per raggiungere le sedi Humanitas;
- Informazioni su referti, cartelle cliniche e ricoveri;
- Det..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 346
   ğŸ“Š Token totali stimati: 794
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] help [ASSISTENTE] Posso aiutarti con informazioni relative allâ€™Istituto Clinico Humanitas, come:

- Prenotazioni di visite ed esami;
- Norme di preparazione per esami;
- Indicazioni stradali per raggiungere le sedi Humanitas;
- Informazioni su referti, cartelle cliniche e ricoveri;
- Det..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'accesso ai servizi online dell'ospedale Humanitas, che rientra nella categoria dei Servizi aziendali.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:53.231046
====================================================================================================
ğŸ“‹ Session ID: classify_1756762793
â±ï¸  Processing Time: 1.754s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1130 chars):
   [UTENTE] help [ASSISTENTE] Posso aiutarti con informazioni relative allâ€™Istituto Clinico Humanitas, come:

- Prenotazioni di visite ed esami;
- Norme di preparazione per esami;
- Indicazioni strada...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [79 more lines] ...
     Line 83: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (207 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'accesso ai servizi online dell'ospedale Humanitas, che rientra nella categoria dei Servizi aziendali.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.95
   motivation: La conversazione verte sull'accesso ai servizi online dell'ospedale Humanitas, che rientra nella categoria dei Servizi aziendali.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'accesso ai servizi online dell'ospedale Humanitas, che rientra nella categoria dei Servizi aziendali.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione a77dafafd9ff2a36a6c0ba434c60a6bc classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 145
   ğŸ“Š Token totali: 593
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 593 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 145
   ğŸ“Š Token conversazione finale: 145
   ğŸ“Š Token totali: 593
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 452 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno volevo sapere se facevate amniocentesi in regime privato? [ASSISTENTE] SÃ¬, Humanitas offre l'amniocentesi in regime privato. [...]  Se hai bisogno di ulteriori dettagli, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2880 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 145
   ğŸ“Š Token totali stimati: 593
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno volevo sapere se facevate amniocentesi in regime privato? [ASSISTENTE] SÃ¬, Humanitas offre l'amniocentesi in regime privato. [...]  Se hai bisogno di ulteriori dettagli, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Analisi",\n  "confidence": 0.95,\n  "motiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:54.710645
====================================================================================================
ğŸ“‹ Session ID: classify_1756762794
â±ï¸  Processing Time: 1.391s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (452 chars):
   [UTENTE] Buongiorno volevo sapere se facevate amniocentesi in regime privato? [ASSISTENTE] SÃ¬, Humanitas offre l'amniocentesi in regime privato. Per maggiori informazioni, puoi consultare le norme ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (197 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Analisi",\n  "confidence": 0.95,\n  "motiva'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Analisi",
  "confidence": 0.95,
  "motiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Analisi",
  "confidence": 0.95,
  "motiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 88552c59f7184164210f42063bff4aad classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 83
   ğŸ“Š Token totali: 511
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 511 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 83
   ğŸ“Š Token conversazione finale: 83
   ğŸ“Š Token totali: 511
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 275 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Il pronto soccorso Humanitas, una volta aperta la pratica di infortuni  [ASSISTENTE] Puoi spiegarmi meglio cosa intendi? Ti riferisci a come funziona l'apertura di una pratica di infortunio al Pronto Soccorso Humanitas o hai bisogno di altre informazioni specifiche?"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2871 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 83
   ğŸ“Š Token totali stimati: 511
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Il pronto soccorso Humanitas, una volta aperta la pratica di infortuni  [ASSISTENTE] Puoi spiegarmi meglio cosa intendi? Ti riferisci a come funziona l'apertura di una pratica di infortunio al Pronto Soccorso Humanitas o hai bisogno di altre informazioni specifiche?"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.9, 'motivation': "La conversazione verte sull'apertura di una pratica di infortunio al Pronto Soccorso Humanitas.", 'predicted_label': 'Pronto Soccorso'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:56.245287
====================================================================================================
ğŸ“‹ Session ID: classify_1756762796
â±ï¸  Processing Time: 1.448s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (275 chars):
   [UTENTE] Il pronto soccorso Humanitas, una volta aperta la pratica di infortuni  [ASSISTENTE] Puoi spiegarmi meglio cosa intendi? Ti riferisci a come funziona l'apertura di una pratica di infortuni...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (170 chars):
   {'confidence': 0.9, 'motivation': "La conversazione verte sull'apertura di una pratica di infortunio al Pronto Soccorso Humanitas.", 'predicted_label': 'Pronto Soccorso'}

ğŸ“Š Parsed Response:
   predicted_label: Pronto Soccorso
   confidence: 0.9
   motivation: La conversazione verte sull'apertura di una pratica di infortunio al Pronto Soccorso Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.900
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 90.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'apertura di una pratica di infortunio al Pronto Soccorso Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 6965077a8a2cd31ee1d3fcb383ab9eb8 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Pronto Soccorso' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 243
   ğŸ“Š Token totali: 691
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 691 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 243
   ğŸ“Š Token conversazione finale: 243
   ğŸ“Š Token totali: 691
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 850 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao, quanto Ã¨ possibile fare ritardo all appuntamento al fertility ? [ASSISTENTE] Non ho informazioni specifiche sui tempi di tolleranza per il ritardo agli appuntamenti presso il Fertility Center. Ti consiglio di contattare direttamente il Fertility Center per ottenere indicazioni prec..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 243
   ğŸ“Š Token totali stimati: 691
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao, quanto Ã¨ possibile fare ritardo all appuntamento al fertility ? [ASSISTENTE] Non ho informazioni specifiche sui tempi di tolleranza per il ritardo agli appuntamenti presso il Fertility Center. Ti consiglio di contattare direttamente il Fertility Center per ottenere indicazioni prec..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.9, 'motivation': "La conversazione verte sull'appuntamento al Fertility Center e sul numero di telefono dello stesso.", 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:57.742816
====================================================================================================
ğŸ“‹ Session ID: classify_1756762797
â±ï¸  Processing Time: 1.410s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (850 chars):
   [UTENTE] Ciao, quanto Ã¨ possibile fare ritardo all appuntamento al fertility ? [ASSISTENTE] Non ho informazioni specifiche sui tempi di tolleranza per il ritardo agli appuntamenti presso il Fertili...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (171 chars):
   {'confidence': 0.9, 'motivation': "La conversazione verte sull'appuntamento al Fertility Center e sul numero di telefono dello stesso.", 'predicted_label': 'Prenotazione'}

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.9
   motivation: La conversazione verte sull'appuntamento al Fertility Center e sul numero di telefono dello stesso.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.900
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 90.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'appuntamento al Fertility Center e sul numero di telefono dello stesso.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 507e9cdd46325b5717abbda777233294 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 230
   ğŸ“Š Token totali: 679
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 679 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 230
   ğŸ“Š Token conversazione finale: 230
   ğŸ“Š Token totali: 679
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 768 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ho bisogno del numero di ricovero del paziente Di Giulio Felice Antonio che dovrÃ  subire un intervento all anca il 10 /09/2025 questo numero serve per la scontista per il treno come si fa? [ASSISTENTE] Non ho accesso a informazioni personali o specifiche sui pazienti. Ti consiglio di con..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 230
   ğŸ“Š Token totali stimati: 679
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ho bisogno del numero di ricovero del paziente Di Giulio Felice Antonio che dovrÃ  subire un intervento all anca il 10 /09/2025 questo numero serve per la scontista per il treno come si fa? [ASSISTENTE] Non ho accesso a informazioni personali o specifiche sui pazienti. Ti consiglio di con..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.75, 'motivation': "La conversazione verte sull'ottenere il numero di ricovero per un paziente e informazioni su come ottenere sconti per i viaggi in treno, quindi Ã¨ classificata come 'Servizi aziendali'.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:39:59.750275
====================================================================================================
ğŸ“‹ Session ID: classify_1756762799
â±ï¸  Processing Time: 1.920s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (768 chars):
   [UTENTE] Ho bisogno del numero di ricovero del paziente Di Giulio Felice Antonio che dovrÃ  subire un intervento all anca il 10 /09/2025 questo numero serve per la scontista per il treno come si fa?...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (262 chars):
   {'confidence': 0.75, 'motivation': "La conversazione verte sull'ottenere il numero di ricovero per un paziente e informazioni su come ottenere sconti per i viaggi in treno, quindi Ã¨ classificata come 'Servizi aziendali'.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.75
   motivation: La conversazione verte sull'ottenere il numero di ricovero per un paziente e informazioni su come ottenere sconti per i viaggi in treno, quindi Ã¨ classificata come 'Servizi aziendali'.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.750
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 75.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'ottenere il numero di ricovero per un paziente e informazioni su come ottenere sconti per i viaggi in treno, quindi Ã¨ classificata come 'Servizi aziendali'.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 6874e36c5623db4008047427f8fe6f5b classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 756
   ğŸ“Š Token totali: 1184
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1184 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 756
   ğŸ“Š Token conversazione finale: 756
   ğŸ“Š Token totali: 1184
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 3282 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Parli inglese? [ASSISTENTE] Yes, I can assist you in English. [...] 

If you do not receive a response from the email you used, I suggest resending your inquiry to one of the official addresses mentioned above"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2814 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 756
   ğŸ“Š Token totali stimati: 1184
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Parli inglese? [ASSISTENTE] Yes, I can assist you in English. [...] 

If you do not receive a response from the email you used, I suggest resending your inquiry to one of the official addresses mentioned above"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: #### Classificazione conversazione\n\nEcco la classificazione della conversazione:\n\n- predicted_label:'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:02.180556
====================================================================================================
ğŸ“‹ Session ID: classify_1756762802
â±ï¸  Processing Time: 2.343s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (3282 chars):
   [UTENTE] Parli inglese? [ASSISTENTE] Yes, I can assist you in English. How can I help you today? [UTENTE] My father's case was transferred to Humanitas from the doctors at ICS Maugeri Pavia last mo...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (195 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: #### Classificazione conversazione\n\nEcco la classificazione della conversazione:\n\n- predicted_label:'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: #### Classificazione conversazione

Ecco la classificazione della conversazione:

- predicted_label:
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: #### Classificazione conversazione

Ecco la classificazione della conversazione:

- predicted_label:
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 0f1ff5d443c11cd5a3eb63a9d70e82d9 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 113
   ğŸ“Š Token totali: 561
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 561 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 113
   ğŸ“Š Token conversazione finale: 113
   ğŸ“Š Token totali: 561
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 375 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno solo una paziente del professor Aloisio Potrei sapere se Ã¨ rientrato dalle ferie [ASSISTENTE] Per informazioni specifiche sul rientro del Professore Aloisio, ti consiglio di contattare direttamente il centralino di Humanitas al numero 02 822 41. [...] it/medici/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2951 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 113
   ğŸ“Š Token totali stimati: 561
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno solo una paziente del professor Aloisio Potrei sapere se Ã¨ rientrato dalle ferie [ASSISTENTE] Per informazioni specifiche sul rientro del Professore Aloisio, ti consiglio di contattare direttamente il centralino di Humanitas al numero 02 822 41. [...] it/medici/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n    "predicted_label": "Visita Specialistica",\n    "confidence"'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:03.523459
====================================================================================================
ğŸ“‹ Session ID: classify_1756762803
â±ï¸  Processing Time: 1.257s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (375 chars):
   [UTENTE] Buongiorno solo una paziente del professor Aloisio Potrei sapere se Ã¨ rientrato dalle ferie [ASSISTENTE] Per informazioni specifiche sul rientro del Professore Aloisio, ti consiglio di con...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (196 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n    "predicted_label": "Visita Specialistica",\n    "confidence"'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
    "predicted_label": "Visita Specialistica",
    "confidence"
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
    "predicted_label": "Visita Specialistica",
    "confidence"
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 31c829f2129edaf3e819bae78f46f8d0 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 380
   ğŸ“Š Token totali: 808
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 808 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 380
   ğŸ“Š Token conversazione finale: 380
   ğŸ“Š Token totali: 808
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 976 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Elenco strutture convenzionate per dormire [ASSISTENTE] Ecco un elenco di strutture convenzionate per il soggiorno vicino all'ospedale Humanitas:

1. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2766 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 380
   ğŸ“Š Token totali stimati: 808
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Elenco strutture convenzionate per dormire [ASSISTENTE] Ecco un elenco di strutture convenzionate per il soggiorno vicino all'ospedale Humanitas:

1. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': "Risposta non strutturata: **predicted_label:** alloggio\n\n**confidence:** 1.0\n\n**motivation:** La conversazione verte sull'elen"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:05.163424
====================================================================================================
ğŸ“‹ Session ID: classify_1756762805
â±ï¸  Processing Time: 1.552s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (976 chars):
   [UTENTE] Elenco strutture convenzionate per dormire [ASSISTENTE] Ecco un elenco di strutture convenzionate per il soggiorno vicino all'ospedale Humanitas:

1. **Hotel Elyâ€™s Group** - Via Liguria, 5...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (195 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': "Risposta non strutturata: **predicted_label:** alloggio\n\n**confidence:** 1.0\n\n**motivation:** La conversazione verte sull'elen"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **predicted_label:** alloggio

**confidence:** 1.0

**motivation:** La conversazione verte sull'elen
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **predicted_label:** alloggio

**confidence:** 1.0

**motivation:** La conversazione verte sull'elen
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 44b7662fc2e623e97e37085126a0b7c1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 348
   ğŸ“Š Token totali: 796
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 796 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 348
   ğŸ“Š Token conversazione finale: 348
   ğŸ“Š Token totali: 796
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1176 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] indirizzo email  [ASSISTENTE] Potresti specificare per quale reparto, servizio o area desideri l'indirizzo email? CosÃ¬ posso aiutarti meglio! [UTENTE] servizio clienti [ASSISTENTE] Per contattare il servizio clienti di Humanitas, puoi utilizzare i seguenti canali:

- **Email**: humanitas..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 348
   ğŸ“Š Token totali stimati: 796
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] indirizzo email  [ASSISTENTE] Potresti specificare per quale reparto, servizio o area desideri l'indirizzo email? CosÃ¬ posso aiutarti meglio! [UTENTE] servizio clienti [ASSISTENTE] Per contattare il servizio clienti di Humanitas, puoi utilizzare i seguenti canali:

- **Email**: humanitas..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n    "predicted_label": "Servizi aziendali",\n    "confidence": 0'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:06.957448
====================================================================================================
ğŸ“‹ Session ID: classify_1756762806
â±ï¸  Processing Time: 1.707s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1176 chars):
   [UTENTE] indirizzo email  [ASSISTENTE] Potresti specificare per quale reparto, servizio o area desideri l'indirizzo email? CosÃ¬ posso aiutarti meglio! [UTENTE] servizio clienti [ASSISTENTE] Per con...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (196 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n    "predicted_label": "Servizi aziendali",\n    "confidence": 0'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
    "predicted_label": "Servizi aziendali",
    "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
    "predicted_label": "Servizi aziendali",
    "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione b83b9b668ebb67685ed24b65343c072f classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 234
   ğŸ“Š Token totali: 662
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 662 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 234
   ğŸ“Š Token conversazione finale: 234
   ğŸ“Š Token totali: 662
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 778 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Come richiedere il dischetto della Tac eseguita in pronto soccorso? [ASSISTENTE] Non ho trovato informazioni specifiche su come richiedere il dischetto della TAC eseguita in pronto soccorso. [...]  Da lÃ¬, potranno indirizzarti al reparto o servizio specifico di cui hai bisogno"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2882 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 234
   ğŸ“Š Token totali stimati: 662
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Come richiedere il dischetto della Tac eseguita in pronto soccorso? [ASSISTENTE] Non ho trovato informazioni specifiche su come richiedere il dischetto della TAC eseguita in pronto soccorso. [...]  Da lÃ¬, potranno indirizzarti al reparto o servizio specifico di cui hai bisogno"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'ottenimento del dischetto della TAC eseguita in pronto soccorso, quindi la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.", 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:08.883614
====================================================================================================
ğŸ“‹ Session ID: classify_1756762808
â±ï¸  Processing Time: 1.839s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (778 chars):
   [UTENTE] Come richiedere il dischetto della Tac eseguita in pronto soccorso? [ASSISTENTE] Non ho trovato informazioni specifiche su come richiedere il dischetto della TAC eseguita in pronto soccors...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (245 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'ottenimento del dischetto della TAC eseguita in pronto soccorso, quindi la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.", 'predicted_label': 'Referti e Cartelle Cliniche'}

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione verte sull'ottenimento del dischetto della TAC eseguita in pronto soccorso, quindi la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'ottenimento del dischetto della TAC eseguita in pronto soccorso, quindi la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione a1e94fa1d719e80114827287bd4c1d14 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 454
   ğŸ’¬ Token conversazione: 598
   ğŸ“Š Token totali: 1052
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1052 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione originale: 598
   ğŸ“Š Token conversazione finale: 598
   ğŸ“Š Token totali: 1052
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2158 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] non scarico l'allegato della mail inviatami per [ASSISTENTE] Potresti fornirmi maggiori dettagli? Ad esempio, l'allegato riguarda un referto, una cartella clinica o altro? Inoltre, hai riscontrato un errore specifico durante il download? Sono qui per aiutarti! [UTENTE] non ho il programm..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2999 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione: 598
   ğŸ“Š Token totali stimati: 1052
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] non scarico l'allegato della mail inviatami per [ASSISTENTE] Potresti fornirmi maggiori dettagli? Ad esempio, l'allegato riguarda un referto, una cartella clinica o altro? Inoltre, hai riscontrato un errore specifico durante il download? Sono qui per aiutarti! [UTENTE] non ho il programm..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'accesso ai referti e alle cartelle cliniche tramite mail o portale online.", 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:10.739491
====================================================================================================
ğŸ“‹ Session ID: classify_1756762810
â±ï¸  Processing Time: 1.767s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2158 chars):
   [UTENTE] non scarico l'allegato della mail inviatami per [ASSISTENTE] Potresti fornirmi maggiori dettagli? Ad esempio, l'allegato riguarda un referto, una cartella clinica o altro? Inoltre, hai ris...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (190 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'accesso ai referti e alle cartelle cliniche tramite mail o portale online.", 'predicted_label': 'Referti e Cartelle Cliniche'}

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione verte sull'accesso ai referti e alle cartelle cliniche tramite mail o portale online.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'accesso ai referti e alle cartelle cliniche tramite mail o portale online.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione b3b7c636e6013b2c3b136f47c688acab classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 396
   ğŸ“Š Token totali: 824
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 824 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 396
   ğŸ“Š Token conversazione finale: 396
   ğŸ“Š Token totali: 824
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1212 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] PMA quali prestazioni? [ASSISTENTE] Le prestazioni di Procreazione Medicalmente Assistita (PMA) offerte presso Humanitas includono:

1. [...] it/centri/fertility-center)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2774 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 396
   ğŸ“Š Token totali stimati: 824
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] PMA quali prestazioni? [ASSISTENTE] Le prestazioni di Procreazione Medicalmente Assistita (PMA) offerte presso Humanitas includono:

1. [...] it/centri/fertility-center)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **predicted_label**: "Analisi"\n**confidence**: 0.9\n**motivation**: La conversazione verte sulle dive'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:12.124068
====================================================================================================
ğŸ“‹ Session ID: classify_1756762812
â±ï¸  Processing Time: 1.297s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1212 chars):
   [UTENTE] PMA quali prestazioni? [ASSISTENTE] Le prestazioni di Procreazione Medicalmente Assistita (PMA) offerte presso Humanitas includono:

1. **Tecniche di primo livello**: Inseminazione intraut...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (193 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **predicted_label**: "Analisi"\n**confidence**: 0.9\n**motivation**: La conversazione verte sulle dive'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **predicted_label**: "Analisi"
**confidence**: 0.9
**motivation**: La conversazione verte sulle dive
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **predicted_label**: "Analisi"
**confidence**: 0.9
**motivation**: La conversazione verte sulle dive
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 1da2c05234a56858c6581d50c6fd7d99 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 205
   ğŸ“Š Token totali: 633
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 633 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 205
   ğŸ“Š Token conversazione finale: 205
   ğŸ“Š Token totali: 633
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 716 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, ho eseguito un prelievo il 21 luglio 2025 per due diversi esami. [...] it/Help)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2696 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 205
   ğŸ“Š Token totali stimati: 633
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, ho eseguito un prelievo il 21 luglio 2025 per due diversi esami. [...] it/Help)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:13.945138
====================================================================================================
ğŸ“‹ Session ID: classify_1756762813
â±ï¸  Processing Time: 1.734s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (716 chars):
   [UTENTE] Buongiorno, ho eseguito un prelievo il 21 luglio 2025 per due diversi esami. Al momento vedo il referto legato ad un solo esame nella mia pagina. E' corretto che arrivino separati? [ASSIST...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione eeb359950d6a65c1fac342f0fa36ce86 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 130
   ğŸ“Š Token totali: 579
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 579 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 130
   ğŸ“Š Token conversazione finale: 130
   ğŸ“Š Token totali: 579
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 473 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] voglio un contatto telefonico per assistenza on line al portale Humanitas. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2822 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 130
   ğŸ“Š Token totali stimati: 579
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] voglio un contatto telefonico per assistenza on line al portale Humanitas. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:15.723009
====================================================================================================
ğŸ“‹ Session ID: classify_1756762815
â±ï¸  Processing Time: 1.690s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (473 chars):
   [UTENTE] voglio un contatto telefonico per assistenza on line al portale Humanitas. [ASSISTENTE] Non esiste un canale telefonico di assistenza dedicato al portale [Humanitas con te](https://www.hum...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione d82c4b0147855fcba637b44e188a71f2 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 452
   ğŸ’¬ Token conversazione: 333
   ğŸ“Š Token totali: 785
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 785 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 452
   ğŸ“Š Token conversazione originale: 333
   ğŸ“Š Token conversazione finale: 333
   ğŸ“Š Token totali: 785
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1088 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Mi serve un oculista che cura la preferite da problemi di Kendall samobor [ASSISTENTE] Non ho trovato informazioni specifiche su "Kendall Samobor" o su una condizione correlata. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2943 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 452
   ğŸ“Š Token conversazione: 333
   ğŸ“Š Token totali stimati: 785
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Mi serve un oculista che cura la preferite da problemi di Kendall samobor [ASSISTENTE] Non ho trovato informazioni specifiche su "Kendall Samobor" o su una condizione correlata. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n    "predicted_label": "Prenotazione",\n    "confidence": 0.7,\n '}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:17.686145
====================================================================================================
ğŸ“‹ Session ID: classify_1756762817
â±ï¸  Processing Time: 1.875s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1088 chars):
   [UTENTE] Mi serve un oculista che cura la preferite da problemi di Kendall samobor [ASSISTENTE] Non ho trovato informazioni specifiche su "Kendall Samobor" o su una condizione correlata. Potresti v...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (197 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n    "predicted_label": "Prenotazione",\n    "confidence": 0.7,\n '}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
    "predicted_label": "Prenotazione",
    "confidence": 0.7,
 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
    "predicted_label": "Prenotazione",
    "confidence": 0.7,
 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione a3c639261fc1aca4f530b1d4d1fab396 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 832
   ğŸ“Š Token totali: 1280
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1280 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 832
   ğŸ“Š Token conversazione finale: 832
   ğŸ“Š Token totali: 1280
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2799 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Cosa siete [ASSISTENTE] Humanitas Ã¨ un gruppo di ospedali e centri medici che offre servizi sanitari di alta qualitÃ . [...] it) e, in caso di selezione, potrai discutere i dettagli contrattuali direttamente con il team delle risorse umane"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2915 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 832
   ğŸ“Š Token totali stimati: 1280
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Cosa siete [ASSISTENTE] Humanitas Ã¨ un gruppo di ospedali e centri medici che offre servizi sanitari di alta qualitÃ . [...] it) e, in caso di selezione, potrai discutere i dettagli contrattuali direttamente con il team delle risorse umane"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted_label**: "altro"\n**Confidence**: 0.7\n**Motivation**: La conversazione verte principalmen'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:20.009450
====================================================================================================
ğŸ“‹ Session ID: classify_1756762820
â±ï¸  Processing Time: 2.236s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2799 chars):
   [UTENTE] Cosa siete [ASSISTENTE] Humanitas Ã¨ un gruppo di ospedali e centri medici che offre servizi sanitari di alta qualitÃ . Comprende diverse strutture in Italia, tra cui ospedali, centri di ric...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (193 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted_label**: "altro"\n**Confidence**: 0.7\n**Motivation**: La conversazione verte principalmen'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **Predicted_label**: "altro"
**Confidence**: 0.7
**Motivation**: La conversazione verte principalmen
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **Predicted_label**: "altro"
**Confidence**: 0.7
**Motivation**: La conversazione verte principalmen
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione b5884ab5b238a98ad2d6849b9f1fcc31 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 155
   ğŸ“Š Token totali: 583
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 583 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 155
   ğŸ“Š Token conversazione finale: 155
   ğŸ“Š Token totali: 583
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 540 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Indirizzo e-mail webmaster sito web www. [...] it/info/ufficio-relazioni-pubblico)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2687 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 155
   ğŸ“Š Token totali stimati: 583
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Indirizzo e-mail webmaster sito web www. [...] it/info/ufficio-relazioni-pubblico)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:21.719846
====================================================================================================
ğŸ“‹ Session ID: classify_1756762821
â±ï¸  Processing Time: 1.625s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (540 chars):
   [UTENTE] Indirizzo e-mail webmaster sito web www.humanitas.it [ASSISTENTE] Non ho trovato informazioni specifiche sull'indirizzo email del webmaster del sito www.humanitas.it nei documenti forniti....

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 73a87238529661eeedbbee5add3e903b classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 563
   ğŸ“Š Token totali: 1011
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1011 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 563
   ğŸ“Š Token conversazione finale: 563
   ğŸ“Š Token totali: 1011
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1943 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] come richiedo una copia di una cartella clinica di un intervento chirurgico del 2015? [ASSISTENTE] Per richiedere una copia della cartella clinica di un intervento chirurgico del 2015, Ã¨ necessario sapere che:

1. [...]  Se hai bisogno di ulteriore supporto, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2949 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 563
   ğŸ“Š Token totali stimati: 1011
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] come richiedo una copia di una cartella clinica di un intervento chirurgico del 2015? [ASSISTENTE] Per richiedere una copia della cartella clinica di un intervento chirurgico del 2015, Ã¨ necessario sapere che:

1. [...]  Se hai bisogno di ulteriore supporto, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Referti e Cartelle Cliniche', 'confidence': 0.95, 'motivation': "La conversazione verte sulla richiesta di una copia cartacea della cartella clinica di un intervento chirurgico del 2015, quindi la categoria piÃ¹ adatta Ã¨ 'Referti e Cartelle Cliniche'."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:23.919195
====================================================================================================
ğŸ“‹ Session ID: classify_1756762823
â±ï¸  Processing Time: 2.111s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1943 chars):
   [UTENTE] come richiedo una copia di una cartella clinica di un intervento chirurgico del 2015? [ASSISTENTE] Per richiedere una copia della cartella clinica di un intervento chirurgico del 2015, Ã¨ n...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (273 chars):
   {'predicted_label': 'Referti e Cartelle Cliniche', 'confidence': 0.95, 'motivation': "La conversazione verte sulla richiesta di una copia cartacea della cartella clinica di un intervento chirurgico del 2015, quindi la categoria piÃ¹ adatta Ã¨ 'Referti e Cartelle Cliniche'."}

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione verte sulla richiesta di una copia cartacea della cartella clinica di un intervento chirurgico del 2015, quindi la categoria piÃ¹ adatta Ã¨ 'Referti e Cartelle Cliniche'.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sulla richiesta di una copia cartacea della cartella clinica di un intervento chirurgico del 2015, quindi la categoria piÃ¹ adatta Ã¨ 'Referti e Cartelle Cliniche'.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione a5535b7deb627771503d036bb1d540aa classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 255
   ğŸ“Š Token totali: 703
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 703 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 255
   ğŸ“Š Token conversazione finale: 255
   ğŸ“Š Token totali: 703
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 894 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia Volevo sapere se all' Humanitas di Rozzano fanno e il certificato di interruzione volontaria di gravidanza perchÃ© facendo il test Ã¨ risultato che sono incinta perÃ² io voglio appunto a fare il trattamento farmacologico perchÃ© ho un lavoro a temp [ASSISTENTE] Per quanto riguard..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 255
   ğŸ“Š Token totali stimati: 703
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia Volevo sapere se all' Humanitas di Rozzano fanno e il certificato di interruzione volontaria di gravidanza perchÃ© facendo il test Ã¨ risultato che sono incinta perÃ² io voglio appunto a fare il trattamento farmacologico perchÃ© ho un lavoro a temp [ASSISTENTE] Per quanto riguard..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.75, 'motivation': "La conversazione verte sull'IVG e il trattamento farmacologico, quindi la categoria piÃ¹ adatta Ã¨ Prenotazione.", 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:25.579946
====================================================================================================
ğŸ“‹ Session ID: classify_1756762825
â±ï¸  Processing Time: 1.573s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (894 chars):
   [UTENTE] Ciao Giulia Volevo sapere se all' Humanitas di Rozzano fanno e il certificato di interruzione volontaria di gravidanza perchÃ© facendo il test Ã¨ risultato che sono incinta perÃ² io voglio ap...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (183 chars):
   {'confidence': 0.75, 'motivation': "La conversazione verte sull'IVG e il trattamento farmacologico, quindi la categoria piÃ¹ adatta Ã¨ Prenotazione.", 'predicted_label': 'Prenotazione'}

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.75
   motivation: La conversazione verte sull'IVG e il trattamento farmacologico, quindi la categoria piÃ¹ adatta Ã¨ Prenotazione.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.750
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 75.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'IVG e il trattamento farmacologico, quindi la categoria piÃ¹ adatta Ã¨ Prenotazione.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 730228dd023230221504d33665ce42b9 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 271
   ğŸ“Š Token totali: 719
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 719 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 271
   ğŸ“Š Token conversazione finale: 271
   ğŸ“Š Token totali: 719
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 924 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Annullare appuntamento  [ASSISTENTE] Per annullare un appuntamento presso Humanitas, ti consiglio di contattare direttamente il numero di prenotazione che hai utilizzato per fissare l'appuntamento. [...]  

Fammi sapere se hai bisogno di ulteriore supporto!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2934 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 271
   ğŸ“Š Token totali stimati: 719
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Annullare appuntamento  [ASSISTENTE] Per annullare un appuntamento presso Humanitas, ti consiglio di contattare direttamente il numero di prenotazione che hai utilizzato per fissare l'appuntamento. [...]  

Fammi sapere se hai bisogno di ulteriore supporto!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'annullamento di un appuntamento, quindi la categoria 'Prenotazione' Ã¨ appropriata.", 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:27.260908
====================================================================================================
ğŸ“‹ Session ID: classify_1756762827
â±ï¸  Processing Time: 1.595s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (924 chars):
   [UTENTE] Annullare appuntamento  [ASSISTENTE] Per annullare un appuntamento presso Humanitas, ti consiglio di contattare direttamente il numero di prenotazione che hai utilizzato per fissare l'appu...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (183 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'annullamento di un appuntamento, quindi la categoria 'Prenotazione' Ã¨ appropriata.", 'predicted_label': 'Prenotazione'}

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.95
   motivation: La conversazione verte sull'annullamento di un appuntamento, quindi la categoria 'Prenotazione' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'annullamento di un appuntamento, quindi la categoria 'Prenotazione' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione ea231d43f2a8010e7409a09b59f63b39 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 769
   ğŸ“Š Token totali: 1197
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1197 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 769
   ğŸ“Š Token conversazione finale: 769
   ğŸ“Š Token totali: 1197
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 3499 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Dear 

I hope this message finds you well. [...]  [UTENTE] Then [ASSISTENTE] If you need further assistance or have additional questions, feel free to ask! I'm here to help"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2777 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 769
   ğŸ“Š Token totali stimati: 1197
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Dear 

I hope this message finds you well. [...]  [UTENTE] Then [ASSISTENTE] If you need further assistance or have additional questions, feel free to ask! I'm here to help"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': "Risposta non strutturata: #### Classificazione conversazione\n\nLa conversazione fornita verte principalmente sull'ottenere una "}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:30.697976
====================================================================================================
ğŸ“‹ Session ID: classify_1756762830
â±ï¸  Processing Time: 3.348s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (3499 chars):
   [UTENTE] Dear 

I hope this message finds you well.

My name is AKTER HOSEN APEL , and I am a resident of Bangladesh. I have been experiencing significant vision problems for some time and currentl...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (193 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': "Risposta non strutturata: #### Classificazione conversazione\n\nLa conversazione fornita verte principalmente sull'ottenere una "}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: #### Classificazione conversazione

La conversazione fornita verte principalmente sull'ottenere una 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: #### Classificazione conversazione

La conversazione fornita verte principalmente sull'ottenere una 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione c1a29f9587164b711318f67ef47950e8 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 159
   ğŸ“Š Token totali: 607
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 607 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 159
   ğŸ“Š Token conversazione finale: 159
   ğŸ“Š Token totali: 607
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 520 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Chiedo contatto mail dottor Filippo confalonieri  [ASSISTENTE] Per informazioni sui medici, ti consiglio di consultare la pagina [Ricerca Medici](https://www. [...]  Il personale potrÃ  indirizzarti verso il reparto o il medico richiesto"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2913 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 159
   ğŸ“Š Token totali stimati: 607
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Chiedo contatto mail dottor Filippo confalonieri  [ASSISTENTE] Per informazioni sui medici, ti consiglio di consultare la pagina [Ricerca Medici](https://www. [...]  Il personale potrÃ  indirizzarti verso il reparto o il medico richiesto"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'ottenere informazioni su un medico specifico e contattarlo, il che si riferisce ai servizi aziendali dell'ospedale.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:32.481378
====================================================================================================
ğŸ“‹ Session ID: classify_1756762832
â±ï¸  Processing Time: 1.695s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (520 chars):
   [UTENTE] Chiedo contatto mail dottor Filippo confalonieri  [ASSISTENTE] Per informazioni sui medici, ti consiglio di consultare la pagina [Ricerca Medici](https://www.humanitas.it/medici/). Se hai ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (221 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'ottenere informazioni su un medico specifico e contattarlo, il che si riferisce ai servizi aziendali dell'ospedale.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.95
   motivation: La conversazione verte sull'ottenere informazioni su un medico specifico e contattarlo, il che si riferisce ai servizi aziendali dell'ospedale.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'ottenere informazioni su un medico specifico e contattarlo, il che si riferisce ai servizi aziendali dell'ospedale.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 3f66dc18aa04cd63737cc89cb85d9a36 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 447
   ğŸ’¬ Token conversazione: 547
   ğŸ“Š Token totali: 994
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 994 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 447
   ğŸ“Š Token conversazione originale: 547
   ğŸ“Š Token conversazione finale: 547
   ğŸ“Š Token totali: 994
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1842 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buon giorno. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2755 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 447
   ğŸ“Š Token conversazione: 547
   ğŸ“Š Token totali stimati: 994
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buon giorno. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla richiesta del referto della TAC eseguita presso la struttura Humanitas e sul problema riscontrato dall'"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:35.732099
====================================================================================================
ğŸ“‹ Session ID: classify_1756762835
â±ï¸  Processing Time: 3.163s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1842 chars):
   [UTENTE] Buon giorno. Ho effettuato presso di voi privatamente una TAC il10.06.2025 e il referto avrebbe dovuto essermi inviato online il 17.06.2025. Ad oggi non ho ancora ricevuto nulla e domani h...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla richiesta del referto della TAC eseguita presso la struttura Humanitas e sul problema riscontrato dall'"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte principalmente sulla richiesta del referto della TAC eseguita presso la struttura Humanitas e sul problema riscontrato dall'
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte principalmente sulla richiesta del referto della TAC eseguita presso la struttura Humanitas e sul problema riscontrato dall'
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione caf451b22dfa03a2542a2a11f0901e8d classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 173
   ğŸ“Š Token totali: 621
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 621 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 173
   ğŸ“Š Token conversazione finale: 173
   ğŸ“Š Token totali: 621
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 572 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno , posso sapere costo TAC addome completo con mdc utilizzando polizza Unisalute indiretta? [ASSISTENTE] Per conoscere il costo di una TAC all'addome completo con mezzo di contrasto utilizzando una polizza Unisalute indiretta, ti consiglio di contattare direttamente il numero di..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 173
   ğŸ“Š Token totali stimati: 621
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno , posso sapere costo TAC addome completo con mdc utilizzando polizza Unisalute indiretta? [ASSISTENTE] Per conoscere il costo di una TAC all'addome completo con mezzo di contrasto utilizzando una polizza Unisalute indiretta, ti consiglio di contattare direttamente il numero di..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name":"classify_conversation","arguments":{"predicted_label":"Prenotazione","confidence":0.95,"m'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:38.118687
====================================================================================================
ğŸ“‹ Session ID: classify_1756762838
â±ï¸  Processing Time: 2.300s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (572 chars):
   [UTENTE] Buongiorno , posso sapere costo TAC addome completo con mdc utilizzando polizza Unisalute indiretta? [ASSISTENTE] Per conoscere il costo di una TAC all'addome completo con mezzo di contras...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name":"classify_conversation","arguments":{"predicted_label":"Prenotazione","confidence":0.95,"m'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name":"classify_conversation","arguments":{"predicted_label":"Prenotazione","confidence":0.95,"m
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name":"classify_conversation","arguments":{"predicted_label":"Prenotazione","confidence":0.95,"m
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 98cafc62f85367df2291e3fc0ff1e1dc classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 177
   ğŸ“Š Token totali: 625
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 625 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 177
   ğŸ“Š Token conversazione finale: 177
   ğŸ“Š Token totali: 625
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 593 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno avrei bisogno di sapere se nella Vs sede di Rozzano o di Castellanza effettuate qs esame [ASSISTENTE] Per verificare se l'esame richiesto Ã¨ disponibile presso le sedi di Rozzano o Castellanza, ti consiglio di contattare direttamente le strutture. Puoi trovare informazioni sui ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 177
   ğŸ“Š Token totali stimati: 625
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno avrei bisogno di sapere se nella Vs sede di Rozzano o di Castellanza effettuate qs esame [ASSISTENTE] Per verificare se l'esame richiesto Ã¨ disponibile presso le sedi di Rozzano o Castellanza, ti consiglio di contattare direttamente le strutture. Puoi trovare informazioni sui ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:40.049019
====================================================================================================
ğŸ“‹ Session ID: classify_1756762840
â±ï¸  Processing Time: 1.843s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (593 chars):
   [UTENTE] Buongiorno avrei bisogno di sapere se nella Vs sede di Rozzano o di Castellanza effettuate qs esame [ASSISTENTE] Per verificare se l'esame richiesto Ã¨ disponibile presso le sedi di Rozzano...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione b909eba5f3bd2127adf542042a8ebe5c classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 132
   ğŸ“Š Token totali: 560
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 560 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 132
   ğŸ“Š Token conversazione finale: 132
   ğŸ“Š Token totali: 560
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 388 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] a che ore Ã¨ aperto urp? [ASSISTENTE] L'Ufficio Relazioni con il Pubblico (URP) di Humanitas Ã¨ attivo dal lunedÃ¬ al venerdÃ¬, dalle 9:00 alle 12:00. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2763 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 132
   ğŸ“Š Token totali stimati: 560
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] a che ore Ã¨ aperto urp? [ASSISTENTE] L'Ufficio Relazioni con il Pubblico (URP) di Humanitas Ã¨ attivo dal lunedÃ¬ al venerdÃ¬, dalle 9:00 alle 12:00. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.8, 'motivation': "La conversazione riguarda l'orario di apertura dell'Ufficio Relazioni con il Pubblico (URP), che Ã¨ un servizio aziendale.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:41.806365
====================================================================================================
ğŸ“‹ Session ID: classify_1756762841
â±ï¸  Processing Time: 1.669s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (388 chars):
   [UTENTE] a che ore Ã¨ aperto urp? [ASSISTENTE] L'Ufficio Relazioni con il Pubblico (URP) di Humanitas Ã¨ attivo dal lunedÃ¬ al venerdÃ¬, dalle 9:00 alle 12:00. Per maggiori informazioni, puoi visitare ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (198 chars):
   {'confidence': 0.8, 'motivation': "La conversazione riguarda l'orario di apertura dell'Ufficio Relazioni con il Pubblico (URP), che Ã¨ un servizio aziendale.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.8
   motivation: La conversazione riguarda l'orario di apertura dell'Ufficio Relazioni con il Pubblico (URP), che Ã¨ un servizio aziendale.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.800
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘] 80.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda l'orario di apertura dell'Ufficio Relazioni con il Pubblico (URP), che Ã¨ un servizio aziendale.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione d7b85fb88a8eb80271ba164999d203b8 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 191
   ğŸ“Š Token totali: 639
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 639 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 191
   ğŸ“Š Token conversazione finale: 191
   ğŸ“Š Token totali: 639
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 615 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Come faccio a raggiungere la palazzina8 passando dalla 4 [ASSISTENTE] Puoi trovare le informazioni necessarie per orientarti all'interno della struttura Humanitas consultando questa [MAPPA](https://www. [...]  Buona giornata! ğŸ˜Š"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2904 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 191
   ğŸ“Š Token totali stimati: 639
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Come faccio a raggiungere la palazzina8 passando dalla 4 [ASSISTENTE] Puoi trovare le informazioni necessarie per orientarti all'interno della struttura Humanitas consultando questa [MAPPA](https://www. [...]  Buona giornata! ğŸ˜Š"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'orientamento all'interno della struttura dell'ospedale e su come raggiungere una specifica palazzina, il che indica chiaramente la categoria 'Servizi aziendali'. La confidenza Ã¨ alta poichÃ© l'intento dell'utente Ã¨ chiaro e la risposta dell'assistente si adatta perfettamente alla domanda.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:44.295138
====================================================================================================
ğŸ“‹ Session ID: classify_1756762844
â±ï¸  Processing Time: 2.402s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (615 chars):
   [UTENTE] Come faccio a raggiungere la palazzina8 passando dalla 4 [ASSISTENTE] Puoi trovare le informazioni necessarie per orientarti all'interno della struttura Humanitas consultando questa [MAPPA...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (394 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'orientamento all'interno della struttura dell'ospedale e su come raggiungere una specifica palazzina, il che indica chiaramente la categoria 'Servizi aziendali'. La confidenza Ã¨ alta poichÃ© l'intento dell'utente Ã¨ chiaro e la rispost...

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.95
   motivation: La conversazione verte sull'orientamento all'interno della struttura dell'ospedale e su come raggiungere una specifica palazzina, il che indica chiaramente la categoria 'Servizi aziendali'. La confidenza Ã¨ alta poichÃ© l'intento dell'utente Ã¨ chiaro e la risposta dell'assistente si adatta perfettamente alla domanda.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'orientamento all'interno della struttura dell'ospedale e su come raggiungere una specifica palazzina, il che indica chiaramente la categoria 'Servizi aziendali'. La confidenza Ã¨ alta poichÃ© l'intento dell'utente Ã¨ chiaro e la risposta dell'assistente si adatta perfettamente alla domanda.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 3cc8448367dadc6452705a344e11d7d4 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 362
   ğŸ“Š Token totali: 810
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 810 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 362
   ğŸ“Š Token conversazione finale: 362
   ğŸ“Š Token totali: 810
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1240 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao, dove si trova gastroenterologia? Come la si raggiunge? [ASSISTENTE] Per raggiungere il reparto di gastroenterologia, ti consiglio di consultare la [MAPPA](https://www. [...]  

Se hai bisogno di ulteriori informazioni su come raggiungere il reparto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2955 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 362
   ğŸ“Š Token totali stimati: 810
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao, dove si trova gastroenterologia? Come la si raggiunge? [ASSISTENTE] Per raggiungere il reparto di gastroenterologia, ti consiglio di consultare la [MAPPA](https://www. [...]  

Se hai bisogno di ulteriori informazioni su come raggiungere il reparto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:46.162801
====================================================================================================
ğŸ“‹ Session ID: classify_1756762846
â±ï¸  Processing Time: 1.779s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1240 chars):
   [UTENTE] Ciao, dove si trova gastroenterologia? Come la si raggiunge? [ASSISTENTE] Per raggiungere il reparto di gastroenterologia, ti consiglio di consultare la [MAPPA](https://www.humanitas.it/wp...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 278c042be32152fc562a0c3e171c1ca1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 215
   ğŸ“Š Token totali: 643
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 643 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 215
   ğŸ“Š Token conversazione finale: 215
   ğŸ“Š Token totali: 643
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 684 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Posso richiedere il duplicato di un CD della risonanza magnetica fatta 2 mesi fa? [ASSISTENTE] SÃ¬, Ã¨ possibile richiedere un duplicato del CD della risonanza magnetica. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2843 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 215
   ğŸ“Š Token totali stimati: 643
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Posso richiedere il duplicato di un CD della risonanza magnetica fatta 2 mesi fa? [ASSISTENTE] SÃ¬, Ã¨ possibile richiedere un duplicato del CD della risonanza magnetica. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione riguarda la richiesta di un duplicato del CD della risonanza magnetica eseguita due mesi fa. L'assistente fornisce informazioni su"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:48.421066
====================================================================================================
ğŸ“‹ Session ID: classify_1756762848
â±ï¸  Processing Time: 2.168s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (684 chars):
   [UTENTE] Posso richiedere il duplicato di un CD della risonanza magnetica fatta 2 mesi fa? [ASSISTENTE] SÃ¬, Ã¨ possibile richiedere un duplicato del CD della risonanza magnetica. Ti consiglio di con...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione riguarda la richiesta di un duplicato del CD della risonanza magnetica eseguita due mesi fa. L'assistente fornisce informazioni su"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione riguarda la richiesta di un duplicato del CD della risonanza magnetica eseguita due mesi fa. L'assistente fornisce informazioni su
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione riguarda la richiesta di un duplicato del CD della risonanza magnetica eseguita due mesi fa. L'assistente fornisce informazioni su
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 55aaf474273f0b81e2b46119386923f8 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 454
   ğŸ’¬ Token conversazione: 292
   ğŸ“Š Token totali: 746
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 746 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione originale: 292
   ğŸ“Š Token conversazione finale: 292
   ğŸ“Š Token totali: 746
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1014 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno Giulia  [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? ğŸ˜Š [UTENTE] Mi chiamo Lega Filiberto e non riesco ad avere nel Vs. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2917 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione: 292
   ğŸ“Š Token totali stimati: 746
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno Giulia  [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? ğŸ˜Š [UTENTE] Mi chiamo Lega Filiberto e non riesco ad avere nel Vs. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte sull'accesso alla cartella clinica tramite il sito o l'app dell'ospedale. L'assistente fornisce istruzioni su come accedere "}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:51.548755
====================================================================================================
ğŸ“‹ Session ID: classify_1756762851
â±ï¸  Processing Time: 3.041s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1014 chars):
   [UTENTE] Buongiorno Giulia  [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? ğŸ˜Š [UTENTE] Mi chiamo Lega Filiberto e non riesco ad avere nel Vs. Sito e app la mia cartella clinica  [ASSISTENTE...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte sull'accesso alla cartella clinica tramite il sito o l'app dell'ospedale. L'assistente fornisce istruzioni su come accedere "}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte sull'accesso alla cartella clinica tramite il sito o l'app dell'ospedale. L'assistente fornisce istruzioni su come accedere 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte sull'accesso alla cartella clinica tramite il sito o l'app dell'ospedale. L'assistente fornisce istruzioni su come accedere 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 3a7dba33b2f4fdd2ac8effab058a0b8c classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 331
   ğŸ“Š Token totali: 780
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 780 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 331
   ğŸ“Š Token conversazione finale: 331
   ğŸ“Š Token totali: 780
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1176 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non mo arriva ancora il referto della tac [ASSISTENTE] Per i risultati del tuo esame, puoi visitare la pagina [Referti e Cartelle Cliniche - Humanitas](https://www. [...] it, indicando nome, cognome, codice fiscale e motivo della richiesta di assistenza"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2931 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 331
   ğŸ“Š Token totali stimati: 780
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non mo arriva ancora il referto della tac [ASSISTENTE] Per i risultati del tuo esame, puoi visitare la pagina [Referti e Cartelle Cliniche - Humanitas](https://www. [...] it, indicando nome, cognome, codice fiscale e motivo della richiesta di assistenza"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sull'accesso ai referti online e sui tempi di disponibilitÃ  del referto della TAC. L'assistente fornisce info"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:53.844513
====================================================================================================
ğŸ“‹ Session ID: classify_1756762853
â±ï¸  Processing Time: 2.206s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1176 chars):
   [UTENTE] Non mo arriva ancora il referto della tac [ASSISTENTE] Per i risultati del tuo esame, puoi visitare la pagina [Referti e Cartelle Cliniche - Humanitas](https://www.humanitas.it/info/refert...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sull'accesso ai referti online e sui tempi di disponibilitÃ  del referto della TAC. L'assistente fornisce info"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte principalmente sull'accesso ai referti online e sui tempi di disponibilitÃ  del referto della TAC. L'assistente fornisce info
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte principalmente sull'accesso ai referti online e sui tempi di disponibilitÃ  del referto della TAC. L'assistente fornisce info
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 5544f032108bba6c3e3b79504840cb51 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 324
   ğŸ“Š Token totali: 772
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 772 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 324
   ğŸ“Š Token conversazione finale: 324
   ğŸ“Š Token totali: 772
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1014 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Salve servirebbe un foglio giustificativo per lavoro [ASSISTENTE] Per quale motivo ti serve il giustificativo del lavoro? Ãˆ per una visita, un esame ambulatoriale o per un ricovero? [UTENTE] Una visita effettuata il 27 e il 28 agosto [ASSISTENTE] Sei in Humanitas o sei a casa? [UTENTE] A..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 324
   ğŸ“Š Token totali stimati: 772
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Salve servirebbe un foglio giustificativo per lavoro [ASSISTENTE] Per quale motivo ti serve il giustificativo del lavoro? Ãˆ per una visita, un esame ambulatoriale o per un ricovero? [UTENTE] Una visita effettuata il 27 e il 28 agosto [ASSISTENTE] Sei in Humanitas o sei a casa? [UTENTE] A..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.75, 'motivation': "La conversazione verte sull'ottenimento di un giustificativo per il lavoro e sul supporto fornito dal centralino e dall'Ufficio Relazioni con il Pubblico (URP) dell'ospedale.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:55.939423
====================================================================================================
ğŸ“‹ Session ID: classify_1756762855
â±ï¸  Processing Time: 2.008s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1014 chars):
   [UTENTE] Salve servirebbe un foglio giustificativo per lavoro [ASSISTENTE] Per quale motivo ti serve il giustificativo del lavoro? Ãˆ per una visita, un esame ambulatoriale o per un ricovero? [UTENT...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (252 chars):
   {'confidence': 0.75, 'motivation': "La conversazione verte sull'ottenimento di un giustificativo per il lavoro e sul supporto fornito dal centralino e dall'Ufficio Relazioni con il Pubblico (URP) dell'ospedale.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.75
   motivation: La conversazione verte sull'ottenimento di un giustificativo per il lavoro e sul supporto fornito dal centralino e dall'Ufficio Relazioni con il Pubblico (URP) dell'ospedale.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.750
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 75.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'ottenimento di un giustificativo per il lavoro e sul supporto fornito dal centralino e dall'Ufficio Relazioni con il Pubblico (URP) dell'ospedale.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 528cea117a2830649b6521ba8beafac0 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 169
   ğŸ“Š Token totali: 597
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 597 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 169
   ğŸ“Š Token conversazione finale: 169
   ğŸ“Š Token totali: 597
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 615 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesci ad entrare nell app [ASSISTENTE] Se hai difficoltÃ  ad accedere all'app [Humanitas con te](https://www. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2787 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 169
   ğŸ“Š Token totali stimati: 597
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesci ad entrare nell app [ASSISTENTE] Se hai difficoltÃ  ad accedere all'app [Humanitas con te](https://www. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:57.364455
====================================================================================================
ğŸ“‹ Session ID: classify_1756762857
â±ï¸  Processing Time: 1.339s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (615 chars):
   [UTENTE] Non riesci ad entrare nell app [ASSISTENTE] Se hai difficoltÃ  ad accedere all'app [Humanitas con te](https://www.humanitasconte.it), ti consiglio di verificare di aver inserito correttamen...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (97 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f4802a7b4b400e9b0344552bb2222a0f classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 248
   ğŸ“Š Token totali: 676
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 676 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 248
   ğŸ“Š Token conversazione finale: 248
   ğŸ“Š Token totali: 676
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 835 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buingiorno sono Ceccarelli Angela, [ASSISTENTE] Buongiorno Angela Ceccarelli, come posso esserti utile oggi? [UTENTE] CCCNGL75H52F592C, ho fatto un esame di densiometria ossea il 21 luglio,ma non riesco a vederlo on line [ASSISTENTE] Per visualizzare i referti online, Ã¨ necessario essere..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 248
   ğŸ“Š Token totali stimati: 676
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buingiorno sono Ceccarelli Angela, [ASSISTENTE] Buongiorno Angela Ceccarelli, come posso esserti utile oggi? [UTENTE] CCCNGL75H52F592C, ho fatto un esame di densiometria ossea il 21 luglio,ma non riesco a vederlo on line [ASSISTENTE] Per visualizzare i referti online, Ã¨ necessario essere..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n    "predicted_label": "Referti e Cartelle Cliniche",\n    "conf'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:40:59.413426
====================================================================================================
ğŸ“‹ Session ID: classify_1756762859
â±ï¸  Processing Time: 1.962s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (835 chars):
   [UTENTE] Buingiorno sono Ceccarelli Angela, [ASSISTENTE] Buongiorno Angela Ceccarelli, come posso esserti utile oggi? [UTENTE] CCCNGL75H52F592C, ho fatto un esame di densiometria ossea il 21 luglio...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (196 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n    "predicted_label": "Referti e Cartelle Cliniche",\n    "conf'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
    "predicted_label": "Referti e Cartelle Cliniche",
    "conf
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
    "predicted_label": "Referti e Cartelle Cliniche",
    "conf
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 38242fc56f18057275c4919af1b90241 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 179
   ğŸ“Š Token totali: 627
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 627 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 179
   ğŸ“Š Token conversazione finale: 179
   ğŸ“Š Token totali: 627
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 606 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2760 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 179
   ğŸ“Š Token totali stimati: 627
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n    "predicted_label": "Servizi aziendali",\n    "confidence": 0'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:01.286033
====================================================================================================
ğŸ“‹ Session ID: classify_1756762861
â±ï¸  Processing Time: 1.785s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (606 chars):
   [UTENTE] Buongiorno. Stiamo facendo una PMA ma non abbiamo ancora ricevuto la fattura. PuÃ² verificare? [ASSISTENTE] Non ho accesso ai dati personali o alle fatture dei pazienti. Ti consiglio di con...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (196 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n    "predicted_label": "Servizi aziendali",\n    "confidence": 0'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
    "predicted_label": "Servizi aziendali",
    "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
    "predicted_label": "Servizi aziendali",
    "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 6022d9c4aa7d69d5b3b1761f384aba41 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 189
   ğŸ“Š Token totali: 638
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 638 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 189
   ğŸ“Š Token conversazione finale: 189
   ğŸ“Š Token totali: 638
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 565 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao giulia [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] Puoi dirmi se oggi pomeriggio Ã¨ possibile ritirare un referto [ASSISTENTE] L'ufficio ritiro referti di Humanitas Ã¨ situato in Via Sardegna 5, Fizzonasco di Pieve Emanuele. Ãˆ aperto dal lunedÃ¬ al venerdÃ¬, dalle 1..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 189
   ğŸ“Š Token totali stimati: 638
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao giulia [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] Puoi dirmi se oggi pomeriggio Ã¨ possibile ritirare un referto [ASSISTENTE] L'ufficio ritiro referti di Humanitas Ã¨ situato in Via Sardegna 5, Fizzonasco di Pieve Emanuele. Ãˆ aperto dal lunedÃ¬ al venerdÃ¬, dalle 1..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:02.968315
====================================================================================================
ğŸ“‹ Session ID: classify_1756762862
â±ï¸  Processing Time: 1.596s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (565 chars):
   [UTENTE] Ciao giulia [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] Puoi dirmi se oggi pomeriggio Ã¨ possibile ritirare un referto [ASSISTENTE] L'ufficio ritiro referti di Humanita...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione d3009d030cd54e810e38626ffea5b011 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 255
   ğŸ“Š Token totali: 703
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 703 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 255
   ğŸ“Š Token conversazione finale: 255
   ğŸ“Š Token totali: 703
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 882 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Oggi alle 14 devo essere in ospedale per operazione di ablazione. [...]  

Se hai bisogno di ulteriore assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2805 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 255
   ğŸ“Š Token totali stimati: 703
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Oggi alle 14 devo essere in ospedale per operazione di ablazione. [...]  

Se hai bisogno di ulteriore assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'operazione di ablazione e sul fatto che l'utente non sa se deve presentarsi a digiuno o meno. L'assistente consiglia all'utente di fare riferimento alle istruzioni fornite durante la prenotazione o il prericovero, suggerendo anche di contattare direttamente il reparto competente per ulteriori informazioni.", 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:05.523749
====================================================================================================
ğŸ“‹ Session ID: classify_1756762865
â±ï¸  Processing Time: 2.466s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (882 chars):
   [UTENTE] Oggi alle 14 devo essere in ospedale per operazione di ablazione. Volevo capire se devo venire a digiuno o cosa [ASSISTENTE] Per sapere se devi essere a digiuno o seguire altre indicazioni...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (408 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'operazione di ablazione e sul fatto che l'utente non sa se deve presentarsi a digiuno o meno. L'assistente consiglia all'utente di fare riferimento alle istruzioni fornite durante la prenotazione o il prericovero, suggerendo anche di...

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.95
   motivation: La conversazione verte sull'operazione di ablazione e sul fatto che l'utente non sa se deve presentarsi a digiuno o meno. L'assistente consiglia all'utente di fare riferimento alle istruzioni fornite durante la prenotazione o il prericovero, suggerendo anche di contattare direttamente il reparto competente per ulteriori informazioni.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'operazione di ablazione e sul fatto che l'utente non sa se deve presentarsi a digiuno o meno. L'assistente consiglia all'utente di fare riferimento alle istruzioni fornite durante la prenotazione o il prericovero, suggerendo anche di contattare direttamente il reparto competente per ulteriori informazioni.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione a132ff17e4b9fe84f9b524179714dd3e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 129
   ğŸ“Š Token totali: 578
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 578 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 129
   ğŸ“Š Token conversazione finale: 129
   ğŸ“Š Token totali: 578
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 373 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Voglio contattare reparto BARIATRICO  [ASSISTENTE] Puoi contattare il Centro ObesitÃ , che include l'UnitÃ  Operativa di Chirurgia Bariatrica, al numero 02 8224 6970. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2854 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 129
   ğŸ“Š Token totali stimati: 578
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Voglio contattare reparto BARIATRICO  [ASSISTENTE] Puoi contattare il Centro ObesitÃ , che include l'UnitÃ  Operativa di Chirurgia Bariatrica, al numero 02 8224 6970. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione riguarda il reparto bariatrico, che Ã¨ parte del Centro ObesitÃ . Pertanto, la categoria piÃ¹ adatta Ã¨ 'Centro Malattie del Metbolismo e della Nutrizione'.", 'predicted_label': 'Centro Malattie del Metabolismo e della Nutrizione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:07.580646
====================================================================================================
ğŸ“‹ Session ID: classify_1756762867
â±ï¸  Processing Time: 1.969s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (373 chars):
   [UTENTE] Voglio contattare reparto BARIATRICO  [ASSISTENTE] Puoi contattare il Centro ObesitÃ , che include l'UnitÃ  Operativa di Chirurgia Bariatrica, al numero 02 8224 6970. Per maggiori dettagli, ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (280 chars):
   {'confidence': 0.95, 'motivation': "La conversazione riguarda il reparto bariatrico, che Ã¨ parte del Centro ObesitÃ . Pertanto, la categoria piÃ¹ adatta Ã¨ 'Centro Malattie del Metbolismo e della Nutrizione'.", 'predicted_label': 'Centro Malattie del Metabolismo e della Nutrizione'}

ğŸ“Š Parsed Response:
   predicted_label: Centro Malattie del Metabolismo e della Nutrizione
   confidence: 0.95
   motivation: La conversazione riguarda il reparto bariatrico, che Ã¨ parte del Centro ObesitÃ . Pertanto, la categoria piÃ¹ adatta Ã¨ 'Centro Malattie del Metbolismo e della Nutrizione'.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda il reparto bariatrico, che Ã¨ parte del Centro ObesitÃ . Pertanto, la categoria piÃ¹ adatta Ã¨ 'Centro Malattie del Metbolismo e della Nutrizione'.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f94112222739ebab7d376e00633aaf01 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Centro Malattie del Metabolismo e della Nutrizione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 496
   ğŸ“Š Token totali: 944
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 944 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 496
   ğŸ“Š Token conversazione finale: 496
   ğŸ“Š Token totali: 944
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1474 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ECOGRAFIA MUSCOLOTENDINEA ECO ARTICOLARE MANI POLSI SPALLE CON DETERMINAZIONE POWER DOPPLER [ASSISTENTE] Per l'ecografia muscolotendinea eco articolare mani, polsi, spalle con determinazione Power Doppler, ti consiglio di verificare se Ã¨ necessaria una preparazione specifica. Se hai biso..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 496
   ğŸ“Š Token totali stimati: 944
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ECOGRAFIA MUSCOLOTENDINEA ECO ARTICOLARE MANI POLSI SPALLE CON DETERMINAZIONE POWER DOPPLER [ASSISTENTE] Per l'ecografia muscolotendinea eco articolare mani, polsi, spalle con determinazione Power Doppler, ti consiglio di verificare se Ã¨ necessaria una preparazione specifica. Se hai biso..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte principalmente sulla prenotazione di un esame ecografico presso l'Istituto Clinico Humanitas.", 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:09.354493
====================================================================================================
ğŸ“‹ Session ID: classify_1756762869
â±ï¸  Processing Time: 1.686s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1474 chars):
   [UTENTE] ECOGRAFIA MUSCOLOTENDINEA ECO ARTICOLARE MANI POLSI SPALLE CON DETERMINAZIONE POWER DOPPLER [ASSISTENTE] Per l'ecografia muscolotendinea eco articolare mani, polsi, spalle con determinazio...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (189 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte principalmente sulla prenotazione di un esame ecografico presso l'Istituto Clinico Humanitas.", 'predicted_label': 'Prenotazione'}

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.95
   motivation: La conversazione verte principalmente sulla prenotazione di un esame ecografico presso l'Istituto Clinico Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte principalmente sulla prenotazione di un esame ecografico presso l'Istituto Clinico Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 53f617542d76fc465db0acd0f9d4a583 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 172
   ğŸ“Š Token totali: 620
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 620 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 172
   ğŸ“Š Token conversazione finale: 172
   ğŸ“Š Token totali: 620
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 583 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno,  vorrei sapere se fate la mammografia in 3d [ASSISTENTE] SÃ¬, presso Humanitas Ã¨ possibile effettuare la mammografia in Tomosintesi, una tecnica avanzata che consente una valutazione piÃ¹ accurata della mammella scomponendone lo spessore in multipli strati. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2956 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 172
   ğŸ“Š Token totali stimati: 620
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno,  vorrei sapere se fate la mammografia in 3d [ASSISTENTE] SÃ¬, presso Humanitas Ã¨ possibile effettuare la mammografia in Tomosintesi, una tecnica avanzata che consente una valutazione piÃ¹ accurata della mammella scomponendone lo spessore in multipli strati. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.9, 'motivation': "La conversazione verte sull'esecuzione di una mammografia in Humanitas, che rientra nella categoria 'Analisi'. La conversazione Ã¨ chiara e specifica.", 'predicted_label': 'Analisi'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:11.093862
====================================================================================================
ğŸ“‹ Session ID: classify_1756762871
â±ï¸  Processing Time: 1.652s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (583 chars):
   [UTENTE] Buongiorno,  vorrei sapere se fate la mammografia in 3d [ASSISTENTE] SÃ¬, presso Humanitas Ã¨ possibile effettuare la mammografia in Tomosintesi, una tecnica avanzata che consente una valuta...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (216 chars):
   {'confidence': 0.9, 'motivation': "La conversazione verte sull'esecuzione di una mammografia in Humanitas, che rientra nella categoria 'Analisi'. La conversazione Ã¨ chiara e specifica.", 'predicted_label': 'Analisi'}

ğŸ“Š Parsed Response:
   predicted_label: Analisi
   confidence: 0.9
   motivation: La conversazione verte sull'esecuzione di una mammografia in Humanitas, che rientra nella categoria 'Analisi'. La conversazione Ã¨ chiara e specifica.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.900
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 90.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'esecuzione di una mammografia in Humanitas, che rientra nella categoria 'Analisi'. La conversazione Ã¨ chiara e specifica.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 1c9c2a1f5de1f3c1d4cb154fb285e755 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Analisi' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 77
   ğŸ“Š Token totali: 505
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 505 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 77
   ğŸ“Š Token conversazione finale: 77
   ğŸ“Š Token totali: 505
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 256 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei consegnare domani un campione di urine  [ASSISTENTE] Per consegnare un campione di urine, ti consiglio di contattare il numero 0282248230 per ottenere informazioni dettagliate. Se hai bisogno di ulteriori indicazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2852 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 77
   ğŸ“Š Token totali stimati: 505
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei consegnare domani un campione di urine  [ASSISTENTE] Per consegnare un campione di urine, ti consiglio di contattare il numero 0282248230 per ottenere informazioni dettagliate. Se hai bisogno di ulteriori indicazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'analisi delle urine dell'utente.", 'predicted_label': 'Analisi'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:12.446585
====================================================================================================
ğŸ“‹ Session ID: classify_1756762872
â±ï¸  Processing Time: 1.266s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (256 chars):
   [UTENTE] Vorrei consegnare domani un campione di urine  [ASSISTENTE] Per consegnare un campione di urine, ti consiglio di contattare il numero 0282248230 per ottenere informazioni dettagliate. Se h...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (128 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'analisi delle urine dell'utente.", 'predicted_label': 'Analisi'}

ğŸ“Š Parsed Response:
   predicted_label: Analisi
   confidence: 0.95
   motivation: La conversazione verte sull'analisi delle urine dell'utente.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'analisi delle urine dell'utente.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 1004de257329e860884fbe701cbc1676 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Analisi' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 97
   ğŸ“Š Token totali: 525
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 525 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 97
   ğŸ“Š Token conversazione finale: 97
   ğŸ“Š Token totali: 525
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 354 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Per inviare un curriculum? [ASSISTENTE] Puoi consultare le posizioni aperte per tutte le strutture del gruppo Humanitas e candidarti collegandoti alla pagina [jobs. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2843 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 97
   ğŸ“Š Token totali stimati: 525
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Per inviare un curriculum? [ASSISTENTE] Puoi consultare le posizioni aperte per tutte le strutture del gruppo Humanitas e candidarti collegandoti alla pagina [jobs. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'invio di un curriculum e sulle posizioni aperte presso Humanitas, pertanto la categoria 'Servizi aziendali' Ã¨ appropriata.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:14.250361
====================================================================================================
ğŸ“‹ Session ID: classify_1756762874
â±ï¸  Processing Time: 1.717s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (354 chars):
   [UTENTE] Per inviare un curriculum? [ASSISTENTE] Puoi consultare le posizioni aperte per tutte le strutture del gruppo Humanitas e candidarti collegandoti alla pagina [jobs.humanitas.it](https://jo...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (228 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'invio di un curriculum e sulle posizioni aperte presso Humanitas, pertanto la categoria 'Servizi aziendali' Ã¨ appropriata.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.95
   motivation: La conversazione verte sull'invio di un curriculum e sulle posizioni aperte presso Humanitas, pertanto la categoria 'Servizi aziendali' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'invio di un curriculum e sulle posizioni aperte presso Humanitas, pertanto la categoria 'Servizi aziendali' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 582ab044c6b489492e9dd3d9563db080 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 874
   ğŸ“Š Token totali: 1322
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1322 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 874
   ğŸ“Š Token conversazione finale: 874
   ğŸ“Š Token totali: 1322
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2981 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao, ho fatto pre ricovero martedÃ¬, perÃ² ho deciso di non operarmi, mi Ã¨ stato detto che dovrei pagare un ticket; come devo fare ? [ASSISTENTE] Se hai deciso di non procedere con l'intervento dopo il prericovero, Ã¨ possibile che tu debba pagare un ticket. Ti consiglio di contattare dire..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 874
   ğŸ“Š Token totali stimati: 1322
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao, ho fatto pre ricovero martedÃ¬, perÃ² ho deciso di non operarmi, mi Ã¨ stato detto che dovrei pagare un ticket; come devo fare ? [ASSISTENTE] Se hai deciso di non procedere con l'intervento dopo il prericovero, Ã¨ possibile che tu debba pagare un ticket. Ti consiglio di contattare dire..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.75, 'motivation': "La conversazione verte principalmente sull'assistenza per il pagamento di un ticket dopo il prericovero e la difficoltÃ  dell'utente nel trovare informazioni chiare su come procedere. L'etichetta 'Servizi aziendali' Ã¨ appropriata poichÃ© l'utente cerca supporto per una questione amministrativa relativa all'ospedale.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:17.109740
====================================================================================================
ğŸ“‹ Session ID: classify_1756762877
â±ï¸  Processing Time: 2.771s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2981 chars):
   [UTENTE] ciao, ho fatto pre ricovero martedÃ¬, perÃ² ho deciso di non operarmi, mi Ã¨ stato detto che dovrei pagare un ticket; come devo fare ? [ASSISTENTE] Se hai deciso di non procedere con l'interv...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (393 chars):
   {'confidence': 0.75, 'motivation': "La conversazione verte principalmente sull'assistenza per il pagamento di un ticket dopo il prericovero e la difficoltÃ  dell'utente nel trovare informazioni chiare su come procedere. L'etichetta 'Servizi aziendali' Ã¨ appropriata poichÃ© l'utente cerca supporto p...

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.75
   motivation: La conversazione verte principalmente sull'assistenza per il pagamento di un ticket dopo il prericovero e la difficoltÃ  dell'utente nel trovare informazioni chiare su come procedere. L'etichetta 'Servizi aziendali' Ã¨ appropriata poichÃ© l'utente cerca supporto per una questione amministrativa relativa all'ospedale.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.750
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 75.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte principalmente sull'assistenza per il pagamento di un ticket dopo il prericovero e la difficoltÃ  dell'utente nel trovare informazioni chiare su come procedere. L'etichetta 'Servizi aziendali' Ã¨ appropriata poichÃ© l'utente cerca supporto per una questione amministrativa relativa all'ospedale.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione cfc2176354ef6eccc188b2e2e56e612d classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 165
   ğŸ“Š Token totali: 613
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 613 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 165
   ğŸ“Š Token conversazione finale: 165
   ğŸ“Š Token totali: 613
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 547 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Come posso contattare il dottor Massimo Tritto che mi ha visitato ieri sera a Rozzano? [ASSISTENTE] Per motivi di privacy, non posso fornire informazioni specifiche sui medici o sui loro contatti. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 165
   ğŸ“Š Token totali stimati: 613
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Come posso contattare il dottor Massimo Tritto che mi ha visitato ieri sera a Rozzano? [ASSISTENTE] Per motivi di privacy, non posso fornire informazioni specifiche sui medici o sui loro contatti. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.75, 'motivation': "La conversazione verte sull'ottenere informazioni su un medico specifico e contattarlo, quindi rientra nella categoria 'Servizi aziendali'. La confidenza Ã¨ del 75% poichÃ© la conversazione Ã¨ chiara ma non fornisce molte informazioni specifiche sul motivo per cui l'utente vuole contattare il medico.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:19.574702
====================================================================================================
ğŸ“‹ Session ID: classify_1756762879
â±ï¸  Processing Time: 2.379s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (547 chars):
   [UTENTE] Come posso contattare il dottor Massimo Tritto che mi ha visitato ieri sera a Rozzano? [ASSISTENTE] Per motivi di privacy, non posso fornire informazioni specifiche sui medici o sui loro c...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (376 chars):
   {'confidence': 0.75, 'motivation': "La conversazione verte sull'ottenere informazioni su un medico specifico e contattarlo, quindi rientra nella categoria 'Servizi aziendali'. La confidenza Ã¨ del 75% poichÃ© la conversazione Ã¨ chiara ma non fornisce molte informazioni specifiche sul motivo per cui...

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.75
   motivation: La conversazione verte sull'ottenere informazioni su un medico specifico e contattarlo, quindi rientra nella categoria 'Servizi aziendali'. La confidenza Ã¨ del 75% poichÃ© la conversazione Ã¨ chiara ma non fornisce molte informazioni specifiche sul motivo per cui l'utente vuole contattare il medico.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.750
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 75.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'ottenere informazioni su un medico specifico e contattarlo, quindi rientra nella categoria 'Servizi aziendali'. La confidenza Ã¨ del 75% poichÃ© la conversazione Ã¨ chiara ma non fornisce molte informazioni specifiche sul motivo per cui l'utente vuole contattare il medico.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 978479b0b0fd3d728cce296930fde631 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 303
   ğŸ“Š Token totali: 751
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 751 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 303
   ğŸ“Š Token conversazione finale: 303
   ğŸ“Š Token totali: 751
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 914 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao Vorrei sapere se l'ufficio ritiro referti di via sardegna Ã¨ aperto il 14 agosto nel pomeriggio  [UTENTE] riesci a rispondere ?  [ASSISTENTE] Ciao! Sono Giulia, lâ€™assistente digitale dellâ€™Istituto Clinico Humanitas. [...] 
Puoi riprovare piÃ¹ tardi? Grazie"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2936 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 303
   ğŸ“Š Token totali stimati: 751
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao Vorrei sapere se l'ufficio ritiro referti di via sardegna Ã¨ aperto il 14 agosto nel pomeriggio  [UTENTE] riesci a rispondere ?  [ASSISTENTE] Ciao! Sono Giulia, lâ€™assistente digitale dellâ€™Istituto Clinico Humanitas. [...] 
Puoi riprovare piÃ¹ tardi? Grazie"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sul ritiro dei referti e l'orario di apertura dell'ufficio competente.", 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:21.259374
====================================================================================================
ğŸ“‹ Session ID: classify_1756762881
â±ï¸  Processing Time: 1.597s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (914 chars):
   [UTENTE] ciao Vorrei sapere se l'ufficio ritiro referti di via sardegna Ã¨ aperto il 14 agosto nel pomeriggio  [UTENTE] riesci a rispondere ?  [ASSISTENTE] Ciao! Sono Giulia, lâ€™assistente digitale d...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (181 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sul ritiro dei referti e l'orario di apertura dell'ufficio competente.", 'predicted_label': 'Referti e Cartelle Cliniche'}

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione verte sul ritiro dei referti e l'orario di apertura dell'ufficio competente.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sul ritiro dei referti e l'orario di apertura dell'ufficio competente.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione e0d7701bd37c7d56e784570667dc62a1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 286
   ğŸ“Š Token totali: 734
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 734 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 286
   ğŸ“Š Token conversazione finale: 286
   ğŸ“Š Token totali: 734
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 925 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] CIAI  [ASSISTENTE] Se hai bisogno di assistenza o informazioni, sono qui per aiutarti. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2786 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 286
   ğŸ“Š Token totali stimati: 734
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] CIAI  [ASSISTENTE] Se hai bisogno di assistenza o informazioni, sono qui per aiutarti. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte principalmente sulla necessitÃ  dell'utente di contattare il professor Della Rocca per avere informazioni sulla sua visita. Questa Ã¨ una richiesta tipica di assistenza per una visita specialistica.", 'predicted_label': 'Visita Specialistica'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:23.229523
====================================================================================================
ğŸ“‹ Session ID: classify_1756762883
â±ï¸  Processing Time: 1.883s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (925 chars):
   [UTENTE] CIAI  [ASSISTENTE] Se hai bisogno di assistenza o informazioni, sono qui per aiutarti. Puoi spiegarmi meglio la tua richiesta? [UTENTE] Ciao Giulia Ho fatto una visita ho effettuato una vi...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (300 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte principalmente sulla necessitÃ  dell'utente di contattare il professor Della Rocca per avere informazioni sulla sua visita. Questa Ã¨ una richiesta tipica di assistenza per una visita specialistica.", 'predicted_label': 'Visita Specialistica'}

ğŸ“Š Parsed Response:
   predicted_label: Visita Specialistica
   confidence: 0.95
   motivation: La conversazione verte principalmente sulla necessitÃ  dell'utente di contattare il professor Della Rocca per avere informazioni sulla sua visita. Questa Ã¨ una richiesta tipica di assistenza per una visita specialistica.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte principalmente sulla necessitÃ  dell'utente di contattare il professor Della Rocca per avere informazioni sulla sua visita. Questa Ã¨ una richiesta tipica di assistenza per una visita specialistica.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 7420b90a5fd17f5ee55f1d42a5f21cb9 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Visita Specialistica' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
   ğŸ“ˆ Progresso LLM: 50/624
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 157
   ğŸ“Š Token totali: 605
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 605 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 157
   ğŸ“Š Token conversazione finale: 157
   ğŸ“Š Token totali: 605
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 476 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Avrei bisogno dell'indirizzo PEC vostro della clinica Humanitas di Rozzano Grazie [ASSISTENTE] L'indirizzo PEC dell'Istituto Clinico Humanitas di Rozzano Ã¨: **privacy. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2916 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 157
   ğŸ“Š Token totali stimati: 605
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Avrei bisogno dell'indirizzo PEC vostro della clinica Humanitas di Rozzano Grazie [ASSISTENTE] L'indirizzo PEC dell'Istituto Clinico Humanitas di Rozzano Ã¨: **privacy. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name":"classify_conversation","arguments":{"predicted_label":"Servizi aziendali","confidence":0.'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:25.054335
====================================================================================================
ğŸ“‹ Session ID: classify_1756762885
â±ï¸  Processing Time: 1.737s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (476 chars):
   [UTENTE] Avrei bisogno dell'indirizzo PEC vostro della clinica Humanitas di Rozzano Grazie [ASSISTENTE] L'indirizzo PEC dell'Istituto Clinico Humanitas di Rozzano Ã¨: **privacy.humanitas@pec.it**ã€6:...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name":"classify_conversation","arguments":{"predicted_label":"Servizi aziendali","confidence":0.'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name":"classify_conversation","arguments":{"predicted_label":"Servizi aziendali","confidence":0.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name":"classify_conversation","arguments":{"predicted_label":"Servizi aziendali","confidence":0.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione dc271d225ffe4e1383423835e6ff472a classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 366
   ğŸ“Š Token totali: 815
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 815 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 366
   ğŸ“Š Token conversazione finale: 366
   ğŸ“Š Token totali: 815
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1198 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buonasera Giulia sono la signora peracchia e chiamo da fuori regione io Volevo avere informazioni per fare una prenotazione per una linfoscintigrafia se viene fatta lÃ¬ da voi [ASSISTENTE] SÃ¬, presso Humanitas Ã¨ possibile effettuare la linfoscintigrafia, un esame diagnostico non invasivo ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 366
   ğŸ“Š Token totali stimati: 815
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buonasera Giulia sono la signora peracchia e chiamo da fuori regione io Volevo avere informazioni per fare una prenotazione per una linfoscintigrafia se viene fatta lÃ¬ da voi [ASSISTENTE] SÃ¬, presso Humanitas Ã¨ possibile effettuare la linfoscintigrafia, un esame diagnostico non invasivo ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sull'esame della linfoscintigrafia e sulle modalitÃ  per effettuarlo presso la struttura. L'utente chiede info"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:27.174986
====================================================================================================
ğŸ“‹ Session ID: classify_1756762887
â±ï¸  Processing Time: 2.032s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1198 chars):
   [UTENTE] Buonasera Giulia sono la signora peracchia e chiamo da fuori regione io Volevo avere informazioni per fare una prenotazione per una linfoscintigrafia se viene fatta lÃ¬ da voi [ASSISTENTE] ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sull'esame della linfoscintigrafia e sulle modalitÃ  per effettuarlo presso la struttura. L'utente chiede info"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte principalmente sull'esame della linfoscintigrafia e sulle modalitÃ  per effettuarlo presso la struttura. L'utente chiede info
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte principalmente sull'esame della linfoscintigrafia e sulle modalitÃ  per effettuarlo presso la struttura. L'utente chiede info
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione d14f7e5ac405521623043f73007bef54 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 123
   ğŸ“Š Token totali: 551
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 551 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 123
   ğŸ“Š Token conversazione finale: 123
   ğŸ“Š Token totali: 551
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 404 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno ho bisogno di verificare dove ho appuntamento con il dott Sacrini alle 1015 di venerdÃ¬ 25 luglio 2025 [ASSISTENTE] Non ho accesso a informazioni personali o agli appuntamenti specifici dei pazienti. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2886 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 123
   ğŸ“Š Token totali stimati: 551
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno ho bisogno di verificare dove ho appuntamento con il dott Sacrini alle 1015 di venerdÃ¬ 25 luglio 2025 [ASSISTENTE] Non ho accesso a informazioni personali o agli appuntamenti specifici dei pazienti. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione riguarda una richiesta di informazioni su un appuntamento con uno specialista presso l'ospedale Humanitas. L'intenzione dell'utent"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:29.791155
====================================================================================================
ğŸ“‹ Session ID: classify_1756762889
â±ï¸  Processing Time: 2.528s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (404 chars):
   [UTENTE] Buongiorno ho bisogno di verificare dove ho appuntamento con il dott Sacrini alle 1015 di venerdÃ¬ 25 luglio 2025 [ASSISTENTE] Non ho accesso a informazioni personali o agli appuntamenti sp...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione riguarda una richiesta di informazioni su un appuntamento con uno specialista presso l'ospedale Humanitas. L'intenzione dell'utent"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione riguarda una richiesta di informazioni su un appuntamento con uno specialista presso l'ospedale Humanitas. L'intenzione dell'utent
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione riguarda una richiesta di informazioni su un appuntamento con uno specialista presso l'ospedale Humanitas. L'intenzione dell'utent
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione cf03fb050666919136bbcf16dd80a539 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 340
   ğŸ“Š Token totali: 788
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 788 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 340
   ğŸ“Š Token conversazione finale: 340
   ğŸ“Š Token totali: 788
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1124 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Dovrei fare una tac, che documentazione mi serve? [ASSISTENTE] Per effettuare una TAC, Ã¨ necessario avere con sÃ© la seguente documentazione:

1. [...] 

Se hai bisogno di ulteriori dettagli o assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2903 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 340
   ğŸ“Š Token totali stimati: 788
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Dovrei fare una tac, che documentazione mi serve? [ASSISTENTE] Per effettuare una TAC, Ã¨ necessario avere con sÃ© la seguente documentazione:

1. [...] 

Se hai bisogno di ulteriori dettagli o assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Risonanza magnetica"}}'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:30.720528
====================================================================================================
ğŸ“‹ Session ID: classify_1756762890
â±ï¸  Processing Time: 0.843s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1124 chars):
   [UTENTE] Dovrei fare una tac, che documentazione mi serve? [ASSISTENTE] Per effettuare una TAC, Ã¨ necessario avere con sÃ© la seguente documentazione:

1. **Impegnativa del medico curante** (se la p...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [77 more lines] ...
     Line 81: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (183 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Risonanza magnetica"}}'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Risonanza magnetica"}}
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Risonanza magnetica"}}
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 01008efcf4439427f40ab1ba6018767f classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 605
   ğŸ“Š Token totali: 1053
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1053 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 605
   ğŸ“Š Token conversazione finale: 605
   ğŸ“Š Token totali: 1053
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1978 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei sapere se Ã¨ possibile fare RM addome inferiore con studio dinamico del pavimento pelvico  [ASSISTENTE] Non ho trovato informazioni specifiche sulla possibilitÃ  di effettuare una Risonanza Magnetica (RM) dell'addome inferiore con studio dinamico del pavimento pelvico nei documenti ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 605
   ğŸ“Š Token totali stimati: 1053
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei sapere se Ã¨ possibile fare RM addome inferiore con studio dinamico del pavimento pelvico  [ASSISTENTE] Non ho trovato informazioni specifiche sulla possibilitÃ  di effettuare una Risonanza Magnetica (RM) dell'addome inferiore con studio dinamico del pavimento pelvico nei documenti ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted label:** "Risonanza magnetica"\n\n**Confidence:** 0.7\n\n**Motivation:** La conversazione ve'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:33.234048
====================================================================================================
ğŸ“‹ Session ID: classify_1756762893
â±ï¸  Processing Time: 2.427s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1978 chars):
   [UTENTE] Vorrei sapere se Ã¨ possibile fare RM addome inferiore con studio dinamico del pavimento pelvico  [ASSISTENTE] Non ho trovato informazioni specifiche sulla possibilitÃ  di effettuare una Ris...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (195 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted label:** "Risonanza magnetica"\n\n**Confidence:** 0.7\n\n**Motivation:** La conversazione ve'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **Predicted label:** "Risonanza magnetica"

**Confidence:** 0.7

**Motivation:** La conversazione ve
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **Predicted label:** "Risonanza magnetica"

**Confidence:** 0.7

**Motivation:** La conversazione ve
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 3dcf98d243ab6f8ea9aed0b56631df81 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 447
   ğŸ’¬ Token conversazione: 257
   ğŸ“Š Token totali: 704
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 704 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 447
   ğŸ“Š Token conversazione originale: 257
   ğŸ“Š Token conversazione finale: 257
   ğŸ“Š Token totali: 704
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 868 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] che operazioni puoi fare? [ASSISTENTE] Posso fornire informazioni di carattere generale relative allâ€™ospedale Humanitas. [...]  

Se hai bisogno di aiuto con le modalitÃ  di prenotazione, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2869 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 447
   ğŸ“Š Token conversazione: 257
   ğŸ“Š Token totali stimati: 704
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] che operazioni puoi fare? [ASSISTENTE] Posso fornire informazioni di carattere generale relative allâ€™ospedale Humanitas. [...]  

Se hai bisogno di aiuto con le modalitÃ  di prenotazione, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:36.188443
====================================================================================================
ğŸ“‹ Session ID: classify_1756762896
â±ï¸  Processing Time: 2.866s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (868 chars):
   [UTENTE] che operazioni puoi fare? [ASSISTENTE] Posso fornire informazioni di carattere generale relative allâ€™ospedale Humanitas. Ad esempio, posso aiutarti con:

- Informazioni sui medici e sulle ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 7763f65f7893ecea14ebeb07aadea979 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 358
   ğŸ“Š Token totali: 806
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 806 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 358
   ğŸ“Š Token conversazione finale: 358
   ğŸ“Š Token totali: 806
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1162 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] buongiorno mi puo' dare un recapito telefonico dove poter avere info riguardo il test di aggregazione piastrinica attivatore adp [ASSISTENTE] Per informazioni riguardo il test di aggregazione piastrinica con attivatore ADP, ti consiglio di contattare il Centro Trombosi di Humanitas. Puoi..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 358
   ğŸ“Š Token totali stimati: 806
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] buongiorno mi puo' dare un recapito telefonico dove poter avere info riguardo il test di aggregazione piastrinica attivatore adp [ASSISTENTE] Per informazioni riguardo il test di aggregazione piastrinica con attivatore ADP, ti consiglio di contattare il Centro Trombosi di Humanitas. Puoi..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte principalmente sulla prenotazione di un test di aggregazione piastrinica con attivatore ADP e sul tentativo dell'utente di ottenere informazioni su come effettuare la prenotazione.", 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:38.190400
====================================================================================================
ğŸ“‹ Session ID: classify_1756762898
â±ï¸  Processing Time: 1.916s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1162 chars):
   [UTENTE] buongiorno mi puo' dare un recapito telefonico dove poter avere info riguardo il test di aggregazione piastrinica attivatore adp [ASSISTENTE] Per informazioni riguardo il test di aggregazi...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (276 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte principalmente sulla prenotazione di un test di aggregazione piastrinica con attivatore ADP e sul tentativo dell'utente di ottenere informazioni su come effettuare la prenotazione.", 'predicted_label': 'Prenotazione'}

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.95
   motivation: La conversazione verte principalmente sulla prenotazione di un test di aggregazione piastrinica con attivatore ADP e sul tentativo dell'utente di ottenere informazioni su come effettuare la prenotazione.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte principalmente sulla prenotazione di un test di aggregazione piastrinica con attivatore ADP e sul tentativo dell'utente di ottenere informazioni su come effettuare la prenotazione.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 08d529b8410ab5fb0b4a0ed943b0448e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 313
   ğŸ“Š Token totali: 761
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 761 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 313
   ğŸ“Š Token conversazione finale: 313
   ğŸ“Š Token totali: 761
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1090 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, sono Davide Surano e in data 30/05 ho effettuato una visita con la Dott. [...]  Se hai bisogno di ulteriori dettagli, fammi sapere e cercherÃ² di aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2843 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 313
   ğŸ“Š Token totali stimati: 761
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, sono Davide Surano e in data 30/05 ho effettuato una visita con la Dott. [...]  Se hai bisogno di ulteriori dettagli, fammi sapere e cercherÃ² di aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Classification of conversation:**\n\n- predicted_label: "Referti e Cartelle Cliniche"\n- confidence: '}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:39.982818
====================================================================================================
ğŸ“‹ Session ID: classify_1756762899
â±ï¸  Processing Time: 1.704s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1090 chars):
   [UTENTE] Buongiorno, sono Davide Surano e in data 30/05 ho effettuato una visita con la Dott.ssa Vanessa Rossi nel centro Humanitas di Rozzano. In accordo con la dottoressa dovrei inviare i referti...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (194 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Classification of conversation:**\n\n- predicted_label: "Referti e Cartelle Cliniche"\n- confidence: '}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **Classification of conversation:**

- predicted_label: "Referti e Cartelle Cliniche"
- confidence: 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **Classification of conversation:**

- predicted_label: "Referti e Cartelle Cliniche"
- confidence: 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 5a1e4a97e58e7324945179a972b87fcc classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 210
   ğŸ“Š Token totali: 659
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 659 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 210
   ğŸ“Š Token conversazione finale: 210
   ğŸ“Š Token totali: 659
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 721 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei parlare con un operatore per le prenotazioni  [ASSISTENTE] Puoi contattare il servizio centralino di Humanitas al numero 02 822 41 per parlare con un operatore. [...]  

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2917 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 210
   ğŸ“Š Token totali stimati: 659
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei parlare con un operatore per le prenotazioni  [ASSISTENTE] Puoi contattare il servizio centralino di Humanitas al numero 02 822 41 per parlare con un operatore. [...]  

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'prenotazione', 'confidence': 0.6, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:43.038628
====================================================================================================
ğŸ“‹ Session ID: classify_1756762903
â±ï¸  Processing Time: 2.967s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (721 chars):
   [UTENTE] Vorrei parlare con un operatore per le prenotazioni  [ASSISTENTE] Puoi contattare il servizio centralino di Humanitas al numero 02 822 41 per parlare con un operatore. Se hai bisogno di ul...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (104 chars):
   {'predicted_label': 'prenotazione', 'confidence': 0.6, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: prenotazione
   confidence: 0.6
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.600
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 60.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 62c9b6929ac6bb9f52740ce063fde598 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 232
   ğŸ“Š Token totali: 660
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 660 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 232
   ğŸ“Š Token conversazione finale: 232
   ğŸ“Š Token totali: 660
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 801 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] codice prestazione isteroscopia [ASSISTENTE] Non ho trovato informazioni specifiche sul codice della prestazione per l'isteroscopia nei documenti forniti. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2829 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 232
   ğŸ“Š Token totali stimati: 660
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] codice prestazione isteroscopia [ASSISTENTE] Non ho trovato informazioni specifiche sul codice della prestazione per l'isteroscopia nei documenti forniti. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n    "predicted_label": "Prenotazione",\n    "confidence": 0.9,\n '}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:44.681560
====================================================================================================
ğŸ“‹ Session ID: classify_1756762904
â±ï¸  Processing Time: 1.557s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (801 chars):
   [UTENTE] codice prestazione isteroscopia [ASSISTENTE] Non ho trovato informazioni specifiche sul codice della prestazione per l'isteroscopia nei documenti forniti. Ti consiglio di contattare dirett...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (197 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n    "predicted_label": "Prenotazione",\n    "confidence": 0.9,\n '}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
    "predicted_label": "Prenotazione",
    "confidence": 0.9,
 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
    "predicted_label": "Prenotazione",
    "confidence": 0.9,
 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 66fa8a1e04debe2b807406f42aaebd8c classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 377
   ğŸ“Š Token totali: 825
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 825 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 377
   ğŸ“Š Token conversazione finale: 377
   ğŸ“Š Token totali: 825
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1202 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Salve , sono Blasi Claudio, devo effettuare un prericovero per un intervento allâ€™orecchio il 18 c. [...]  

Fammi sapere se hai bisogno di ulteriore supporto!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2835 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 377
   ğŸ“Š Token totali stimati: 825
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Salve , sono Blasi Claudio, devo effettuare un prericovero per un intervento allâ€™orecchio il 18 c. [...]  

Fammi sapere se hai bisogno di ulteriore supporto!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'interruzione della prenotazione per un ricovero in ospedale.", 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:46.270589
====================================================================================================
ğŸ“‹ Session ID: classify_1756762906
â±ï¸  Processing Time: 1.502s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1202 chars):
   [UTENTE] Salve , sono Blasi Claudio, devo effettuare un prericovero per un intervento allâ€™orecchio il 18 c.m., devo disdire, non riesco a contattare nessuno per poter disdire, cosa posso e? [ASSIST...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (161 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'interruzione della prenotazione per un ricovero in ospedale.", 'predicted_label': 'Prenotazione'}

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.95
   motivation: La conversazione verte sull'interruzione della prenotazione per un ricovero in ospedale.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'interruzione della prenotazione per un ricovero in ospedale.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione c37a04182da7793aec200bf44a7785cd classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 4383
   ğŸ“Š Token totali: 4831
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 4831 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 4383
   ğŸ“Š Token conversazione finale: 4383
   ğŸ“Š Token totali: 4831
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 15143 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] mi servirebbero informazioni di come funziona un percorso di riabilitazione post ricostruzione lca [ASSISTENTE] Per quanto riguarda i percorsi di riabilitazione post ricostruzione del legamento crociato anteriore (LCA), ti consiglio di consultare il tuo medico curante o il fisioterapista..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 4383
   ğŸ“Š Token totali stimati: 4831
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] mi servirebbero informazioni di come funziona un percorso di riabilitazione post ricostruzione lca [ASSISTENTE] Per quanto riguarda i percorsi di riabilitazione post ricostruzione del legamento crociato anteriore (LCA), ti consiglio di consultare il tuo medico curante o il fisioterapista..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': "Risposta non strutturata: Questa conversazione verte principalmente sull'assistenza fornita da Humanitas per il recupero funzi"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:50.903659
====================================================================================================
ğŸ“‹ Session ID: classify_1756762910
â±ï¸  Processing Time: 4.545s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (15143 chars):
   [UTENTE] mi servirebbero informazioni di come funziona un percorso di riabilitazione post ricostruzione lca [ASSISTENTE] Per quanto riguarda i percorsi di riabilitazione post ricostruzione del lega...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': "Risposta non strutturata: Questa conversazione verte principalmente sull'assistenza fornita da Humanitas per il recupero funzi"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: Questa conversazione verte principalmente sull'assistenza fornita da Humanitas per il recupero funzi
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: Questa conversazione verte principalmente sull'assistenza fornita da Humanitas per il recupero funzi
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione c690cb03628eaebb2e23315d7cf65789 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 89
   ğŸ“Š Token totali: 537
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 537 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 89
   ğŸ“Š Token conversazione finale: 89
   ğŸ“Š Token totali: 537
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 309 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Contatti telefonici risorse umane  [ASSISTENTE] Per contattare le Risorse Umane di Humanitas, ti consiglio di visitare la pagina dedicata alle opportunitÃ  di lavoro e alle candidature spontanee su [jobs. [...]  Se hai bisogno di ulteriori informazioni, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2943 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 89
   ğŸ“Š Token totali stimati: 537
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Contatti telefonici risorse umane  [ASSISTENTE] Per contattare le Risorse Umane di Humanitas, ti consiglio di visitare la pagina dedicata alle opportunitÃ  di lavoro e alle candidature spontanee su [jobs. [...]  Se hai bisogno di ulteriori informazioni, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:54.219715
====================================================================================================
ğŸ“‹ Session ID: classify_1756762914
â±ï¸  Processing Time: 3.228s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (309 chars):
   [UTENTE] Contatti telefonici risorse umane  [ASSISTENTE] Per contattare le Risorse Umane di Humanitas, ti consiglio di visitare la pagina dedicata alle opportunitÃ  di lavoro e alle candidature spon...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (97 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione c72f9224acd4de774d74f1871c7e4443 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 91
   ğŸ“Š Token totali: 539
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 539 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 91
   ğŸ“Š Token conversazione finale: 91
   ğŸ“Š Token totali: 539
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 312 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Fate il microbiota? [ASSISTENTE] SÃ¬, in Humanitas Ã¨ possibile effettuare esami relativi al microbiota. [...]  Se hai bisogno di ulteriori informazioni o assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2855 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 91
   ğŸ“Š Token totali stimati: 539
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Fate il microbiota? [ASSISTENTE] SÃ¬, in Humanitas Ã¨ possibile effettuare esami relativi al microbiota. [...]  Se hai bisogno di ulteriori informazioni o assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'esistenza e la disponibilitÃ  dell'ospedale Humanitas di effettuare esami relativi al microbiota.", 'predicted_label': 'Analisi'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:55.757329
====================================================================================================
ğŸ“‹ Session ID: classify_1756762915
â±ï¸  Processing Time: 1.449s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (312 chars):
   [UTENTE] Fate il microbiota? [ASSISTENTE] SÃ¬, in Humanitas Ã¨ possibile effettuare esami relativi al microbiota. Per maggiori dettagli, ti consiglio di contattare direttamente l'ospedale o consultar...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (192 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'esistenza e la disponibilitÃ  dell'ospedale Humanitas di effettuare esami relativi al microbiota.", 'predicted_label': 'Analisi'}

ğŸ“Š Parsed Response:
   predicted_label: Analisi
   confidence: 0.95
   motivation: La conversazione verte sull'esistenza e la disponibilitÃ  dell'ospedale Humanitas di effettuare esami relativi al microbiota.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'esistenza e la disponibilitÃ  dell'ospedale Humanitas di effettuare esami relativi al microbiota.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 5dad80abea9f615e47c8fb0bd68d625c classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Analisi' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 234
   ğŸ“Š Token totali: 662
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 662 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 234
   ğŸ“Š Token conversazione finale: 234
   ğŸ“Š Token totali: 662
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 741 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Contatti pancreas center [ASSISTENTE] Il Centro per le Malattie del Pancreas e del Duodeno si trova presso l'Istituto Clinico Humanitas, in Via Manzoni 56, 20089 Rozzano (Milano). Per maggiori informazioni, puoi visitare la pagina dedicata al [Centro per le Malattie del Pancreas e del Du..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 234
   ğŸ“Š Token totali stimati: 662
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Contatti pancreas center [ASSISTENTE] Il Centro per le Malattie del Pancreas e del Duodeno si trova presso l'Istituto Clinico Humanitas, in Via Manzoni 56, 20089 Rozzano (Milano). Per maggiori informazioni, puoi visitare la pagina dedicata al [Centro per le Malattie del Pancreas e del Du..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.9, 'motivation': 'La conversazione verte sul Centro per le Malattie del Pancreas e del Duodeno, che rientra nella categoria delle Malattie del Metabolismo e della Nutrizione.', 'predicted_label': 'Centro Malattie del Metabolismo e della Nutrizione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:41:57.737577
====================================================================================================
ğŸ“‹ Session ID: classify_1756762917
â±ï¸  Processing Time: 1.882s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (741 chars):
   [UTENTE] Contatti pancreas center [ASSISTENTE] Il Centro per le Malattie del Pancreas e del Duodeno si trova presso l'Istituto Clinico Humanitas, in Via Manzoni 56, 20089 Rozzano (Milano). Per magg...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (266 chars):
   {'confidence': 0.9, 'motivation': 'La conversazione verte sul Centro per le Malattie del Pancreas e del Duodeno, che rientra nella categoria delle Malattie del Metabolismo e della Nutrizione.', 'predicted_label': 'Centro Malattie del Metabolismo e della Nutrizione'}

ğŸ“Š Parsed Response:
   predicted_label: Centro Malattie del Metabolismo e della Nutrizione
   confidence: 0.9
   motivation: La conversazione verte sul Centro per le Malattie del Pancreas e del Duodeno, che rientra nella categoria delle Malattie del Metabolismo e della Nutrizione.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.900
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 90.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sul Centro per le Malattie del Pancreas e del Duodeno, che rientra nella categoria delle Malattie del Metabolismo e della Nutrizione.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 317fabc782e0d47980e4e1df74499b7a classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Centro Malattie del Metabolismo e della Nutrizione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 475
   ğŸ“Š Token totali: 923
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 923 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 475
   ğŸ“Š Token conversazione finale: 475
   ğŸ“Š Token totali: 923
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1618 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] informazione su riabilitazione post intervento protesi anca [ASSISTENTE] La riabilitazione post-intervento di protesi d'anca Ã¨ un processo fondamentale per il recupero ottimale. [...] it/unita-operative/ortopedia-protesica-mininvasiva-anca-ginocchio)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2927 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 475
   ğŸ“Š Token totali stimati: 923
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] informazione su riabilitazione post intervento protesi anca [ASSISTENTE] La riabilitazione post-intervento di protesi d'anca Ã¨ un processo fondamentale per il recupero ottimale. [...] it/unita-operative/ortopedia-protesica-mininvasiva-anca-ginocchio)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Analisi', 'confidence': 0.6, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:00.228176
====================================================================================================
ğŸ“‹ Session ID: classify_1756762920
â±ï¸  Processing Time: 2.398s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1618 chars):
   [UTENTE] informazione su riabilitazione post intervento protesi anca [ASSISTENTE] La riabilitazione post-intervento di protesi d'anca Ã¨ un processo fondamentale per il recupero ottimale. In Humanit...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (99 chars):
   {'predicted_label': 'Analisi', 'confidence': 0.6, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: Analisi
   confidence: 0.6
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.600
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 60.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 1de6e585b0ff63a5faa65acd27d9effd classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Analisi' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 137
   ğŸ“Š Token totali: 565
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 565 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 137
   ğŸ“Š Token conversazione finale: 137
   ğŸ“Š Token totali: 565
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 436 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Il centro prelievi a fiordaliso Ã¨ aperto? [ASSISTENTE] Il centro prelievi di Humanitas Medical Care Fiordaliso si trova in Via Eugenio Curiel, 25, 20089 - Rozzano (MI). [...]  Se hai bisogno di ulteriori dettagli, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2841 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 137
   ğŸ“Š Token totali stimati: 565
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Il centro prelievi a fiordaliso Ã¨ aperto? [ASSISTENTE] Il centro prelievi di Humanitas Medical Care Fiordaliso si trova in Via Eugenio Curiel, 25, 20089 - Rozzano (MI). [...]  Se hai bisogno di ulteriori dettagli, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{\n  "name": "classify_conversation",\n  "arguments": {\n    "predicted_label": "Servizi aziendali",\n'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:02.138583
====================================================================================================
ğŸ“‹ Session ID: classify_1756762922
â±ï¸  Processing Time: 1.819s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (436 chars):
   [UTENTE] Il centro prelievi a fiordaliso Ã¨ aperto? [ASSISTENTE] Il centro prelievi di Humanitas Medical Care Fiordaliso si trova in Via Eugenio Curiel, 25, 20089 - Rozzano (MI). Per informazioni su...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (195 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{\n  "name": "classify_conversation",\n  "arguments": {\n    "predicted_label": "Servizi aziendali",\n'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{
  "name": "classify_conversation",
  "arguments": {
    "predicted_label": "Servizi aziendali",

----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{
  "name": "classify_conversation",
  "arguments": {
    "predicted_label": "Servizi aziendali",

----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 7073e30ce3134e5e69f0a5dc4951fc7a classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 213
   ğŸ“Š Token totali: 641
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 641 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 213
   ğŸ“Š Token conversazione finale: 213
   ğŸ“Š Token totali: 641
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 718 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, stamattina ho fatto un monitoraggio presso l'humanitas fertility center ma mi sono dimenticata di richiedere il certificato giustificativo per il lavoro. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2844 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 213
   ğŸ“Š Token totali stimati: 641
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, stamattina ho fatto un monitoraggio presso l'humanitas fertility center ma mi sono dimenticata di richiedere il certificato giustificativo per il lavoro. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:05.100974
====================================================================================================
ğŸ“‹ Session ID: classify_1756762925
â±ï¸  Processing Time: 2.874s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (718 chars):
   [UTENTE] Buongiorno, stamattina ho fatto un monitoraggio presso l'humanitas fertility center ma mi sono dimenticata di richiedere il certificato giustificativo per il lavoro. Come posso fare? [ASSI...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (97 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 70e56fb277344c11c3bdfc0082ff6b6c classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 364
   ğŸ“Š Token totali: 792
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 792 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 364
   ğŸ“Š Token conversazione finale: 364
   ğŸ“Š Token totali: 792
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1166 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non ho ricevuto il rimborso per una visita non effettuata  [ASSISTENTE] Se non hai ricevuto il rimborso per una visita non effettuata, posso aiutarti a capire come procedere. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2808 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 364
   ğŸ“Š Token totali stimati: 792
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non ho ricevuto il rimborso per una visita non effettuata  [ASSISTENTE] Se non hai ricevuto il rimborso per una visita non effettuata, posso aiutarti a capire come procedere. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla richiesta di rimborso per una visita non effettuata e sul modo per ottenerlo. L'assistente fornisce inf"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:07.409464
====================================================================================================
ğŸ“‹ Session ID: classify_1756762927
â±ï¸  Processing Time: 2.215s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1166 chars):
   [UTENTE] Non ho ricevuto il rimborso per una visita non effettuata  [ASSISTENTE] Se non hai ricevuto il rimborso per una visita non effettuata, posso aiutarti a capire come procedere. Sei attualmen...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla richiesta di rimborso per una visita non effettuata e sul modo per ottenerlo. L'assistente fornisce inf"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte principalmente sulla richiesta di rimborso per una visita non effettuata e sul modo per ottenerlo. L'assistente fornisce inf
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte principalmente sulla richiesta di rimborso per una visita non effettuata e sul modo per ottenerlo. L'assistente fornisce inf
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione debff910c9c22c0459630108a927f219 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 279
   ğŸ“Š Token totali: 727
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 727 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 279
   ğŸ“Š Token conversazione finale: 279
   ğŸ“Š Token totali: 727
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 902 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao! Fate il [ASSISTENTE] Potresti specificare meglio la tua domanda? CosÃ¬ posso aiutarti nel modo migliore! [UTENTE] fate il percorso microbiota? [ASSISTENTE] SÃ¬, in Humanitas Ã¨ possibile effettuare il percorso per la valutazione del microbiota. Per maggiori dettagli, puoi visitare la ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 279
   ğŸ“Š Token totali stimati: 727
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao! Fate il [ASSISTENTE] Potresti specificare meglio la tua domanda? CosÃ¬ posso aiutarti nel modo migliore! [UTENTE] fate il percorso microbiota? [ASSISTENTE] SÃ¬, in Humanitas Ã¨ possibile effettuare il percorso per la valutazione del microbiota. Per maggiori dettagli, puoi visitare la ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sull'informativa relativa al percorso microbiota offerto da Humanitas. L'utente richiede e riceve un link all"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:09.162539
====================================================================================================
ğŸ“‹ Session ID: classify_1756762929
â±ï¸  Processing Time: 1.659s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (902 chars):
   [UTENTE] Ciao! Fate il [ASSISTENTE] Potresti specificare meglio la tua domanda? CosÃ¬ posso aiutarti nel modo migliore! [UTENTE] fate il percorso microbiota? [ASSISTENTE] SÃ¬, in Humanitas Ã¨ possibil...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sull'informativa relativa al percorso microbiota offerto da Humanitas. L'utente richiede e riceve un link all"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte principalmente sull'informativa relativa al percorso microbiota offerto da Humanitas. L'utente richiede e riceve un link all
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte principalmente sull'informativa relativa al percorso microbiota offerto da Humanitas. L'utente richiede e riceve un link all
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 8f819b18b1d6f7d3f6638796e801988f classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 187
   ğŸ“Š Token totali: 615
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 615 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 187
   ğŸ“Š Token conversazione finale: 187
   ğŸ“Š Token totali: 615
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 553 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] E' possibile fare presso di voi scintigrafia total body  [ASSISTENTE] SÃ¬, presso Humanitas Ã¨ possibile effettuare la scintigrafia ossea globale corporea, che Ã¨ una metodica di diagnostica per immagini utilizzata per studiare l'apparato scheletrico. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2865 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 187
   ğŸ“Š Token totali stimati: 615
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] E' possibile fare presso di voi scintigrafia total body  [ASSISTENTE] SÃ¬, presso Humanitas Ã¨ possibile effettuare la scintigrafia ossea globale corporea, che Ã¨ una metodica di diagnostica per immagini utilizzata per studiare l'apparato scheletrico. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:11.121768
====================================================================================================
ğŸ“‹ Session ID: classify_1756762931
â±ï¸  Processing Time: 1.868s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (553 chars):
   [UTENTE] E' possibile fare presso di voi scintigrafia total body  [ASSISTENTE] SÃ¬, presso Humanitas Ã¨ possibile effettuare la scintigrafia ossea globale corporea, che Ã¨ una metodica di diagnostica ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (97 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 23e8069cd4d378c7662de7c8fd9b407f classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 213
   ğŸ“Š Token totali: 661
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 661 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 213
   ğŸ“Š Token conversazione finale: 213
   ğŸ“Š Token totali: 661
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 768 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei sapere il nome di questa relazione per l'ecografia per fare Vicenza Venosa agli arti inferiori [ASSISTENTE] Non ho trovato informazioni specifiche per l'ecografia venosa agli arti inferiori nei documenti caricati. Se hai bisogno di ulteriori dettagli o di un documento specifico, f..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 213
   ğŸ“Š Token totali stimati: 661
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei sapere il nome di questa relazione per l'ecografia per fare Vicenza Venosa agli arti inferiori [ASSISTENTE] Non ho trovato informazioni specifiche per l'ecografia venosa agli arti inferiori nei documenti caricati. Se hai bisogno di ulteriori dettagli o di un documento specifico, f..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Analisi', 'confidence': 0.95, 'motivation': "La conversazione verte sull'ottenere informazioni su una specifica ecografia e sulle sue preparazioni, il che indica chiaramente la categoria 'Analisi'. La confidenza Ã¨ alta poichÃ© l'intento dell'utente Ã¨ molto chiaro."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:13.107478
====================================================================================================
ğŸ“‹ Session ID: classify_1756762933
â±ï¸  Processing Time: 1.896s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (768 chars):
   [UTENTE] Vorrei sapere il nome di questa relazione per l'ecografia per fare Vicenza Venosa agli arti inferiori [ASSISTENTE] Non ho trovato informazioni specifiche per l'ecografia venosa agli arti i...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (286 chars):
   {'predicted_label': 'Analisi', 'confidence': 0.95, 'motivation': "La conversazione verte sull'ottenere informazioni su una specifica ecografia e sulle sue preparazioni, il che indica chiaramente la categoria 'Analisi'. La confidenza Ã¨ alta poichÃ© l'intento dell'utente Ã¨ molto chiaro."}

ğŸ“Š Parsed Response:
   predicted_label: Analisi
   confidence: 0.95
   motivation: La conversazione verte sull'ottenere informazioni su una specifica ecografia e sulle sue preparazioni, il che indica chiaramente la categoria 'Analisi'. La confidenza Ã¨ alta poichÃ© l'intento dell'utente Ã¨ molto chiaro.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'ottenere informazioni su una specifica ecografia e sulle sue preparazioni, il che indica chiaramente la categoria 'Analisi'. La confidenza Ã¨ alta poichÃ© l'intento dell'utente Ã¨ molto chiaro.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione e3163386f017938857bce8630bef2523 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Analisi' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 180
   ğŸ“Š Token totali: 628
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 628 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 180
   ğŸ“Š Token conversazione finale: 180
   ğŸ“Š Token totali: 628
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 607 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] mi serve sapere solo devo fare scrivere sull impegnativa per iniziare a fare radioterapia con il servizio sanitario nazionale [ASSISTENTE] Non ho trovato informazioni specifiche su cosa scrivere sull'impegnativa per iniziare la radioterapia con il Servizio Sanitario Nazionale. Ti consigl..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 180
   ğŸ“Š Token totali stimati: 628
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] mi serve sapere solo devo fare scrivere sull impegnativa per iniziare a fare radioterapia con il servizio sanitario nazionale [ASSISTENTE] Non ho trovato informazioni specifiche su cosa scrivere sull'impegnativa per iniziare la radioterapia con il Servizio Sanitario Nazionale. Ti consigl..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name":"classify_conversation","arguments": {"predicted_label": "Servizi aziendali", "confidence"'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:15.213929
====================================================================================================
ğŸ“‹ Session ID: classify_1756762935
â±ï¸  Processing Time: 2.020s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (607 chars):
   [UTENTE] mi serve sapere solo devo fare scrivere sull impegnativa per iniziare a fare radioterapia con il servizio sanitario nazionale [ASSISTENTE] Non ho trovato informazioni specifiche su cosa sc...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name":"classify_conversation","arguments": {"predicted_label": "Servizi aziendali", "confidence"'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name":"classify_conversation","arguments": {"predicted_label": "Servizi aziendali", "confidence"
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name":"classify_conversation","arguments": {"predicted_label": "Servizi aziendali", "confidence"
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione d5eee37f505376d9fa500eb48faac701 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 195
   ğŸ“Š Token totali: 623
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 623 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 195
   ğŸ“Š Token conversazione finale: 195
   ğŸ“Š Token totali: 623
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 632 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, durante la visita proctologica viene eseguita anche l'anoscopia? [ASSISTENTE] Durante la visita proctologica, il medico puÃ² decidere di eseguire un'anoscopia se lo ritiene opportuno per una piÃ¹ accurata esplorazione rettale interna. [...] it/visite-ed-esami/visita-proctologica)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2895 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 195
   ğŸ“Š Token totali stimati: 623
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, durante la visita proctologica viene eseguita anche l'anoscopia? [ASSISTENTE] Durante la visita proctologica, il medico puÃ² decidere di eseguire un'anoscopia se lo ritiene opportuno per una piÃ¹ accurata esplorazione rettale interna. [...] it/visite-ed-esami/visita-proctologica)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.7, 'motivation': "La conversazione verte sulla visita proctologica e sull'esecuzione dell'anoscopia durante la stessa, il che indica una discussione su una visita specialistica.", 'predicted_label': 'Visita Specialistica'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:16.984401
====================================================================================================
ğŸ“‹ Session ID: classify_1756762936
â±ï¸  Processing Time: 1.683s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (632 chars):
   [UTENTE] Buongiorno, durante la visita proctologica viene eseguita anche l'anoscopia? [ASSISTENTE] Durante la visita proctologica, il medico puÃ² decidere di eseguire un'anoscopia se lo ritiene oppo...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (239 chars):
   {'confidence': 0.7, 'motivation': "La conversazione verte sulla visita proctologica e sull'esecuzione dell'anoscopia durante la stessa, il che indica una discussione su una visita specialistica.", 'predicted_label': 'Visita Specialistica'}

ğŸ“Š Parsed Response:
   predicted_label: Visita Specialistica
   confidence: 0.7
   motivation: La conversazione verte sulla visita proctologica e sull'esecuzione dell'anoscopia durante la stessa, il che indica una discussione su una visita specialistica.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.700
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘] 70.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sulla visita proctologica e sull'esecuzione dell'anoscopia durante la stessa, il che indica una discussione su una visita specialistica.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 971f3a0289d41be4a0e9ee02c7bffbdb classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Visita Specialistica' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 482
   ğŸ“Š Token totali: 910
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 910 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 482
   ğŸ“Š Token conversazione finale: 482
   ğŸ“Š Token totali: 910
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1654 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Quanto costa la rinoplastica in questo ospedale? [ASSISTENTE] Non ho informazioni specifiche sui costi delle procedure come la rinoplastica. [...]  Se hai altre domande, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2797 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 482
   ğŸ“Š Token totali stimati: 910
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Quanto costa la rinoplastica in questo ospedale? [ASSISTENTE] Non ho informazioni specifiche sui costi delle procedure come la rinoplastica. [...]  Se hai altre domande, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.85, 'motivation': 'La conversazione verte principalmente sulla prenotazione di un intervento di rinoplastica e sul costo associato a tale procedura.', 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:18.772544
====================================================================================================
ğŸ“‹ Session ID: classify_1756762938
â±ï¸  Processing Time: 1.701s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1654 chars):
   [UTENTE] Quanto costa la rinoplastica in questo ospedale? [ASSISTENTE] Non ho informazioni specifiche sui costi delle procedure come la rinoplastica. Ti consiglio di contattare direttamente l'osped...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (202 chars):
   {'confidence': 0.85, 'motivation': 'La conversazione verte principalmente sulla prenotazione di un intervento di rinoplastica e sul costo associato a tale procedura.', 'predicted_label': 'Prenotazione'}

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.85
   motivation: La conversazione verte principalmente sulla prenotazione di un intervento di rinoplastica e sul costo associato a tale procedura.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.850
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] 85.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte principalmente sulla prenotazione di un intervento di rinoplastica e sul costo associato a tale procedura.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione e6c2087fd16d2ad26350a1ea6b9c3001 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 454
   ğŸ’¬ Token conversazione: 405
   ğŸ“Š Token totali: 859
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 859 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione originale: 405
   ğŸ“Š Token conversazione finale: 405
   ğŸ“Š Token totali: 859
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1372 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ho registrato mio figlio minorenne francesco scaccia, il sito e' PESSIMO [UTENTE] non riesco a scaricare il suo refertto [ASSISTENTE] Mi dispiace che abbia avuto un'esperienza negativa con il sito. [...]  Come posso aiutarti oggi?"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2938 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione: 405
   ğŸ“Š Token totali stimati: 859
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ho registrato mio figlio minorenne francesco scaccia, il sito e' PESSIMO [UTENTE] non riesco a scaricare il suo refertto [ASSISTENTE] Mi dispiace che abbia avuto un'esperienza negativa con il sito. [...]  Come posso aiutarti oggi?"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Referti e Cartelle Cliniche', 'confidence': 0.95, 'motivation': "La conversazione verte principalmente sulla difficoltÃ  dell'utente nel recuperare il referto del figlio minorenne, quindi la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:20.722510
====================================================================================================
ğŸ“‹ Session ID: classify_1756762940
â±ï¸  Processing Time: 1.864s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1372 chars):
   [UTENTE] ho registrato mio figlio minorenne francesco scaccia, il sito e' PESSIMO [UTENTE] non riesco a scaricare il suo refertto [ASSISTENTE] Mi dispiace che abbia avuto un'esperienza negativa con...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (267 chars):
   {'predicted_label': 'Referti e Cartelle Cliniche', 'confidence': 0.95, 'motivation': "La conversazione verte principalmente sulla difficoltÃ  dell'utente nel recuperare il referto del figlio minorenne, quindi la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata."}

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione verte principalmente sulla difficoltÃ  dell'utente nel recuperare il referto del figlio minorenne, quindi la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte principalmente sulla difficoltÃ  dell'utente nel recuperare il referto del figlio minorenne, quindi la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 7621fa85861839cfbb8c78b2af9e5a02 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 371
   ğŸ“Š Token totali: 819
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 819 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 371
   ğŸ“Š Token conversazione finale: 371
   ğŸ“Š Token totali: 819
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1214 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno vi contatto seguito visita effettuata nella quale mi hanno informato che ho un tumore al seno. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2851 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 371
   ğŸ“Š Token totali stimati: 819
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno vi contatto seguito visita effettuata nella quale mi hanno informato che ho un tumore al seno. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Classification of conversation:**\n\n```json\n{\n  "function": "classify_conversation",\n  "arguments":'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:22.970468
====================================================================================================
ğŸ“‹ Session ID: classify_1756762942
â±ï¸  Processing Time: 2.162s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1214 chars):
   [UTENTE] Buongiorno vi contatto seguito visita effettuata nella quale mi hanno informato che ho un tumore al seno. Vorrei quindi chiedere tempistica per vedere specialista attraverso servizio sanit...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (196 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Classification of conversation:**\n\n```json\n{\n  "function": "classify_conversation",\n  "arguments":'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **Classification of conversation:**

```json
{
  "function": "classify_conversation",
  "arguments":
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **Classification of conversation:**

```json
{
  "function": "classify_conversation",
  "arguments":
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione d9d30181e039a4c2d01200713e450e4d classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 175
   ğŸ“Š Token totali: 624
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 624 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 175
   ğŸ“Š Token conversazione finale: 175
   ğŸ“Š Token totali: 624
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 619 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Volevo prenotare la visita del programma di prevenzione infarto che voi avete Proposto iscrivendovi al sito [ASSISTENTE] Per quanto riguarda la prenotazione di visite o programmi specifici, ti consiglio di fornirmi maggiori dettagli sul programma di prevenzione infarto a cui ti riferisci..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 175
   ğŸ“Š Token totali stimati: 624
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Volevo prenotare la visita del programma di prevenzione infarto che voi avete Proposto iscrivendovi al sito [ASSISTENTE] Per quanto riguarda la prenotazione di visite o programmi specifici, ti consiglio di fornirmi maggiori dettagli sul programma di prevenzione infarto a cui ti riferisci..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': '** La conversazione principale Ã¨ incentrata sulla prenotazione della visita del programma di prevenzione infarto offerto da Humanitas, il che giust'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:26.016937
====================================================================================================
ğŸ“‹ Session ID: classify_1756762946
â±ï¸  Processing Time: 2.959s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (619 chars):
   [UTENTE] Volevo prenotare la visita del programma di prevenzione infarto che voi avete Proposto iscrivendovi al sito [ASSISTENTE] Per quanto riguarda la prenotazione di visite o programmi specifici...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (212 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': '** La conversazione principale Ã¨ incentrata sulla prenotazione della visita del programma di prevenzione infarto offerto da Humanitas, il che giust'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione principale Ã¨ incentrata sulla prenotazione della visita del programma di prevenzione infarto offerto da Humanitas, il che giust
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione principale Ã¨ incentrata sulla prenotazione della visita del programma di prevenzione infarto offerto da Humanitas, il che giust
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione c091e0a37408f57713fa2bdec51b0feb classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 324
   ğŸ“Š Token totali: 752
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 752 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 324
   ğŸ“Š Token conversazione finale: 324
   ğŸ“Š Token totali: 752
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1126 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2687 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 324
   ğŸ“Š Token totali stimati: 752
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'accesso ai referti degli esami del sangue attraverso la piattaforma 'Humanitas con te', pertanto la categoria piÃ¹ adatta Ã¨ 'Referti e Cartelle Cliniche'. La confidenza Ã¨ alta poichÃ© l'argomento trattato Ã¨ molto specifico e ben definito.", 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:28.454854
====================================================================================================
ğŸ“‹ Session ID: classify_1756762948
â±ï¸  Processing Time: 2.351s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1126 chars):
   [UTENTE] Ciao Giulia. [ASSISTENTE] Ciao! Come posso esserti utile oggi? ğŸ˜Š [UTENTE] Ãˆ possibile che su â€œhumanitas con teâ€ io abbia potuto scaricare un referto parziali degli esami del sangue che ho ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (352 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'accesso ai referti degli esami del sangue attraverso la piattaforma 'Humanitas con te', pertanto la categoria piÃ¹ adatta Ã¨ 'Referti e Cartelle Cliniche'. La confidenza Ã¨ alta poichÃ© l'argomento trattato Ã¨ molto specifico e ben defini...

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione verte sull'accesso ai referti degli esami del sangue attraverso la piattaforma 'Humanitas con te', pertanto la categoria piÃ¹ adatta Ã¨ 'Referti e Cartelle Cliniche'. La confidenza Ã¨ alta poichÃ© l'argomento trattato Ã¨ molto specifico e ben definito.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'accesso ai referti degli esami del sangue attraverso la piattaforma 'Humanitas con te', pertanto la categoria piÃ¹ adatta Ã¨ 'Referti e Cartelle Cliniche'. La confidenza Ã¨ alta poichÃ© l'argomento trattato Ã¨ molto specifico e ben definito.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione cb47a1a5360c7352dff05db8a4e532ed classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 215
   ğŸ“Š Token totali: 664
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 664 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 215
   ğŸ“Š Token conversazione finale: 215
   ğŸ“Š Token totali: 664
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 789 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] devo manmdare una ricetta a voi unita operativa dermatologica come faccio [ASSISTENTE] Per inviare una ricetta all'unitÃ  operativa dermatologica, ti consiglio di verificare se ci sono indicazioni specifiche nei documenti che hai caricato. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2928 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 215
   ğŸ“Š Token totali stimati: 664
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] devo manmdare una ricetta a voi unita operativa dermatologica come faccio [ASSISTENTE] Per inviare una ricetta all'unitÃ  operativa dermatologica, ti consiglio di verificare se ci sono indicazioni specifiche nei documenti che hai caricato. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione riguarda l'invio di una ricetta all'unitÃ  operativa dermatologica dell'ospedale Humanitas, che rientra nella categoria dei servizi aziendali.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:30.313620
====================================================================================================
ğŸ“‹ Session ID: classify_1756762950
â±ï¸  Processing Time: 1.773s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (789 chars):
   [UTENTE] devo manmdare una ricetta a voi unita operativa dermatologica come faccio [ASSISTENTE] Per inviare una ricetta all'unitÃ  operativa dermatologica, ti consiglio di verificare se ci sono indi...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (236 chars):
   {'confidence': 0.95, 'motivation': "La conversazione riguarda l'invio di una ricetta all'unitÃ  operativa dermatologica dell'ospedale Humanitas, che rientra nella categoria dei servizi aziendali.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.95
   motivation: La conversazione riguarda l'invio di una ricetta all'unitÃ  operativa dermatologica dell'ospedale Humanitas, che rientra nella categoria dei servizi aziendali.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda l'invio di una ricetta all'unitÃ  operativa dermatologica dell'ospedale Humanitas, che rientra nella categoria dei servizi aziendali.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 4ca9f74a061bd8f47b2523f4044a6b00 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 439
   ğŸ“Š Token totali: 887
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 887 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 439
   ğŸ“Š Token conversazione finale: 439
   ğŸ“Š Token totali: 887
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1473 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buonasera,  [ASSISTENTE] Buonasera! Come posso esserti utile? [UTENTE] ho scritto alla mail della dottoressa Trotta Manuela ma non Ã¨ attiva  [ASSISTENTE] Per ottenere informazioni sulla dottoressa Manuela Trotta o per contattarla, ti consiglio di visitare la pagina [Ricerca Medici](https..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 439
   ğŸ“Š Token totali stimati: 887
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buonasera,  [ASSISTENTE] Buonasera! Come posso esserti utile? [UTENTE] ho scritto alla mail della dottoressa Trotta Manuela ma non Ã¨ attiva  [ASSISTENTE] Per ottenere informazioni sulla dottoressa Manuela Trotta o per contattarla, ti consiglio di visitare la pagina [Ricerca Medici](https..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': '** La conversazione verte principalmente sulla ricerca di informazioni relative al centro bariatrico di Rozzano, inclusi gli orari di contatto. Non ci'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:33.210160
====================================================================================================
ğŸ“‹ Session ID: classify_1756762953
â±ï¸  Processing Time: 2.810s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1473 chars):
   [UTENTE] Buonasera,  [ASSISTENTE] Buonasera! Come posso esserti utile? [UTENTE] ho scritto alla mail della dottoressa Trotta Manuela ma non Ã¨ attiva  [ASSISTENTE] Per ottenere informazioni sulla do...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': '** La conversazione verte principalmente sulla ricerca di informazioni relative al centro bariatrico di Rozzano, inclusi gli orari di contatto. Non ci'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte principalmente sulla ricerca di informazioni relative al centro bariatrico di Rozzano, inclusi gli orari di contatto. Non ci
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte principalmente sulla ricerca di informazioni relative al centro bariatrico di Rozzano, inclusi gli orari di contatto. Non ci
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione fa76dbf0c73fc9313d6f49ea436ad523 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 331
   ğŸ“Š Token totali: 779
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 779 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 331
   ğŸ“Š Token conversazione finale: 331
   ğŸ“Š Token totali: 779
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1062 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] buonasera, vorrei poter consultare la cartella clinica di ADAMI MARIA, nata a Calci (PI) il 28/11/1943, operata presso il centro ortopedico il 22 luglio scorso e poi sottoposta ad un intervento d'urgenza all'intestino, dimessa il 7 agosto scorso. grazie [UTENTE] daniela Pugi, nuora della..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 331
   ğŸ“Š Token totali stimati: 779
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] buonasera, vorrei poter consultare la cartella clinica di ADAMI MARIA, nata a Calci (PI) il 28/11/1943, operata presso il centro ortopedico il 22 luglio scorso e poi sottoposta ad un intervento d'urgenza all'intestino, dimessa il 7 agosto scorso. grazie [UTENTE] daniela Pugi, nuora della..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': '** La conversazione verte principalmente sulla richiesta di accesso alla cartella clinica della signora Adami Maria. La richiesta Ã¨ stata inoltrata da'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:36.353486
====================================================================================================
ğŸ“‹ Session ID: classify_1756762956
â±ï¸  Processing Time: 3.057s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1062 chars):
   [UTENTE] buonasera, vorrei poter consultare la cartella clinica di ADAMI MARIA, nata a Calci (PI) il 28/11/1943, operata presso il centro ortopedico il 22 luglio scorso e poi sottoposta ad un inter...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': '** La conversazione verte principalmente sulla richiesta di accesso alla cartella clinica della signora Adami Maria. La richiesta Ã¨ stata inoltrata da'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte principalmente sulla richiesta di accesso alla cartella clinica della signora Adami Maria. La richiesta Ã¨ stata inoltrata da
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte principalmente sulla richiesta di accesso alla cartella clinica della signora Adami Maria. La richiesta Ã¨ stata inoltrata da
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione d2da45e267dce199c28ffab0e0d4a27d classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 379
   ğŸ“Š Token totali: 827
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 827 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 379
   ğŸ“Š Token conversazione finale: 379
   ğŸ“Š Token totali: 827
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1310 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] sono stata operata in Humanitas per untumore al seno, il 17 dicembre 2024 e ho anche fatto le radioterapie  fino al 4 marzo. [...] 

Se hai bisogno di ulteriori informazioni, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2865 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 379
   ğŸ“Š Token totali stimati: 827
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] sono stata operata in Humanitas per untumore al seno, il 17 dicembre 2024 e ho anche fatto le radioterapie  fino al 4 marzo. [...] 

Se hai bisogno di ulteriori informazioni, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione riguarda un appuntamento per una visita specialistica oncologica in Humanitas dopo che l'utente ha subito un intervento e terapie per un tumore al seno.", 'predicted_label': 'Visita Specialistica Oncologica'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:38.318967
====================================================================================================
ğŸ“‹ Session ID: classify_1756762958
â±ï¸  Processing Time: 1.878s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1310 chars):
   [UTENTE] sono stata operata in Humanitas per untumore al seno, il 17 dicembre 2024 e ho anche fatto le radioterapie  fino al 4 marzo. ieri mi Ã¨ arrivato un promemoria per unappuntamento per domani ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (261 chars):
   {'confidence': 0.95, 'motivation': "La conversazione riguarda un appuntamento per una visita specialistica oncologica in Humanitas dopo che l'utente ha subito un intervento e terapie per un tumore al seno.", 'predicted_label': 'Visita Specialistica Oncologica'}

ğŸ“Š Parsed Response:
   predicted_label: Visita Specialistica Oncologica
   confidence: 0.95
   motivation: La conversazione riguarda un appuntamento per una visita specialistica oncologica in Humanitas dopo che l'utente ha subito un intervento e terapie per un tumore al seno.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda un appuntamento per una visita specialistica oncologica in Humanitas dopo che l'utente ha subito un intervento e terapie per un tumore al seno.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 01638e4506811fcf0337d5f1a75db9e1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Visita Specialistica Oncologica' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 194
   ğŸ“Š Token totali: 643
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 643 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 194
   ğŸ“Š Token conversazione finale: 194
   ğŸ“Š Token totali: 643
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 557 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] buongiorno, devo ritirare un farmaco presso la farmacia dell'ospedale e volevo sapeere gli oraridella farmacua [ASSISTENTE] La Farmacia dellâ€™Istituto Clinico Humanitas Ã¨ aperta dal lunedÃ¬ al venerdÃ¬ (esclusi i festivi) nei seguenti orari:  
- Mattina: dalle 8:30 alle 13:00;  
- Pomeriggi..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 194
   ğŸ“Š Token totali stimati: 643
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] buongiorno, devo ritirare un farmaco presso la farmacia dell'ospedale e volevo sapeere gli oraridella farmacua [ASSISTENTE] La Farmacia dellâ€™Istituto Clinico Humanitas Ã¨ aperta dal lunedÃ¬ al venerdÃ¬ (esclusi i festivi) nei seguenti orari:  
- Mattina: dalle 8:30 alle 13:00;  
- Pomeriggi..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': '| Etichetta predetta | Confidenza | Motivazione |'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:41.386135
====================================================================================================
ğŸ“‹ Session ID: classify_1756762961
â±ï¸  Processing Time: 2.980s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (557 chars):
   [UTENTE] buongiorno, devo ritirare un farmaco presso la farmacia dell'ospedale e volevo sapeere gli oraridella farmacua [ASSISTENTE] La Farmacia dellâ€™Istituto Clinico Humanitas Ã¨ aperta dal lunedÃ¬ ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (114 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': '| Etichetta predetta | Confidenza | Motivazione |'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: | Etichetta predetta | Confidenza | Motivazione |
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   | Etichetta predetta | Confidenza | Motivazione |
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione c58654edd048a0b171a27dfb0bdece8a classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 161
   ğŸ“Š Token totali: 610
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 610 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 161
   ğŸ“Š Token conversazione finale: 161
   ğŸ“Š Token totali: 610
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 569 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei mandare dei referti per mi ha madre che ha un tumore al pancreas per un consulto, devo prendere appuntamento o li posso inviare tramite email? [ASSISTENTE] Per richiedere un consulto o una "second opinion" presso Humanitas, Ã¨ necessario seguire una procedura specifica. Ti consigli..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 161
   ğŸ“Š Token totali stimati: 610
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei mandare dei referti per mi ha madre che ha un tumore al pancreas per un consulto, devo prendere appuntamento o li posso inviare tramite email? [ASSISTENTE] Per richiedere un consulto o una "second opinion" presso Humanitas, Ã¨ necessario seguire una procedura specifica. Ti consigli..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:42.926012
====================================================================================================
ğŸ“‹ Session ID: classify_1756762962
â±ï¸  Processing Time: 1.451s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (569 chars):
   [UTENTE] Vorrei mandare dei referti per mi ha madre che ha un tumore al pancreas per un consulto, devo prendere appuntamento o li posso inviare tramite email? [ASSISTENTE] Per richiedere un consult...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", '}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche", 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 3e301031034ea430e630918a143f11e9 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 169
   ğŸ“Š Token totali: 617
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 617 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 169
   ğŸ“Š Token conversazione finale: 169
   ğŸ“Š Token totali: 617
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 541 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Programmare un viaggio [ASSISTENTE] Posso aiutarti a calcolare il percorso per raggiungere una delle sedi Humanitas. [...]  Fammi sapere come posso esserti utile!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2839 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 169
   ğŸ“Š Token totali stimati: 617
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Programmare un viaggio [ASSISTENTE] Posso aiutarti a calcolare il percorso per raggiungere una delle sedi Humanitas. [...]  Fammi sapere come posso esserti utile!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "alloggio", "confidence": 0.95,'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:44.710968
====================================================================================================
ğŸ“‹ Session ID: classify_1756762964
â±ï¸  Processing Time: 1.699s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (541 chars):
   [UTENTE] Programmare un viaggio [ASSISTENTE] Posso aiutarti a calcolare il percorso per raggiungere una delle sedi Humanitas. Da dove parti e quale sede desideri raggiungere? Inoltre, preferisci vi...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "alloggio", "confidence": 0.95,'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "alloggio", "confidence": 0.95,
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "alloggio", "confidence": 0.95,
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione bc9144424e42297a5cc897ebc2908688 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 245
   ğŸ“Š Token totali: 673
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 673 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 245
   ğŸ“Š Token conversazione finale: 245
   ğŸ“Š Token totali: 673
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 863 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] non riesco a vedere i miei esami e la mia cartella clinica [UTENTE] mi dice non disponibili [ASSISTENTE] Ciao! Sono Giulia, lâ€™assistente digitale dellâ€™Istituto Clinico Humanitas. [...] 

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2856 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 245
   ğŸ“Š Token totali stimati: 673
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] non riesco a vedere i miei esami e la mia cartella clinica [UTENTE] mi dice non disponibili [ASSISTENTE] Ciao! Sono Giulia, lâ€™assistente digitale dellâ€™Istituto Clinico Humanitas. [...] 

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'accesso ai referti e alle cartelle cliniche dell'utente.", 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:46.346193
====================================================================================================
ğŸ“‹ Session ID: classify_1756762966
â±ï¸  Processing Time: 1.548s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (863 chars):
   [UTENTE] non riesco a vedere i miei esami e la mia cartella clinica [UTENTE] mi dice non disponibili [ASSISTENTE] Ciao! Sono Giulia, lâ€™assistente digitale dellâ€™Istituto Clinico Humanitas. Come poss...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (172 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'accesso ai referti e alle cartelle cliniche dell'utente.", 'predicted_label': 'Referti e Cartelle Cliniche'}

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione verte sull'accesso ai referti e alle cartelle cliniche dell'utente.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'accesso ai referti e alle cartelle cliniche dell'utente.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 00955212a46b980820fc515f0fb437fa classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 256
   ğŸ“Š Token totali: 704
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 704 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 256
   ğŸ“Š Token conversazione finale: 256
   ğŸ“Š Token totali: 704
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 813 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao Giulia devo fare un intervento di tenolisi dei flessori con il SSN come devo fare per prenotare [ASSISTENTE] Per effettuare un intervento con un'impegnativa del Servizio Sanitario Nazionale (SSN), ti consiglio di contattare direttamente Humanitas. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2958 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 256
   ğŸ“Š Token totali stimati: 704
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao Giulia devo fare un intervento di tenolisi dei flessori con il SSN come devo fare per prenotare [ASSISTENTE] Per effettuare un intervento con un'impegnativa del Servizio Sanitario Nazionale (SSN), ti consiglio di contattare direttamente Humanitas. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:48.207720
====================================================================================================
ğŸ“‹ Session ID: classify_1756762968
â±ï¸  Processing Time: 1.775s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (813 chars):
   [UTENTE] ciao Giulia devo fare un intervento di tenolisi dei flessori con il SSN come devo fare per prenotare [ASSISTENTE] Per effettuare un intervento con un'impegnativa del Servizio Sanitario Naz...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f633ed7080f5b5695a4da6a523c822d0 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 142
   ğŸ“Š Token totali: 591
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 591 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 142
   ğŸ“Š Token conversazione finale: 142
   ğŸ“Š Token totali: 591
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 457 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, vorrei prenotare con il servizio sanitario nazionale di persona presso l'ospedale, dove devo andare?  [ASSISTENTE] Per prenotare una visita o un esame tramite il Servizio Sanitario Nazionale (SSN) di persona presso l'Istituto Clinico Humanitas, puoi recarti al **Building 4**,..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 142
   ğŸ“Š Token totali stimati: 591
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, vorrei prenotare con il servizio sanitario nazionale di persona presso l'ospedale, dove devo andare?  [ASSISTENTE] Per prenotare una visita o un esame tramite il Servizio Sanitario Nazionale (SSN) di persona presso l'Istituto Clinico Humanitas, puoi recarti al **Building 4**,..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte chiaramente sulla prenotazione di una visita o esame tramite il Servizio Sanitario Nazionale (SSN) di persona presso l'Istituto Clinico Humanitas.", 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:50.040148
====================================================================================================
ğŸ“‹ Session ID: classify_1756762970
â±ï¸  Processing Time: 1.745s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (457 chars):
   [UTENTE] Buongiorno, vorrei prenotare con il servizio sanitario nazionale di persona presso l'ospedale, dove devo andare?  [ASSISTENTE] Per prenotare una visita o un esame tramite il Servizio Sanit...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (242 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte chiaramente sulla prenotazione di una visita o esame tramite il Servizio Sanitario Nazionale (SSN) di persona presso l'Istituto Clinico Humanitas.", 'predicted_label': 'Prenotazione'}

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.95
   motivation: La conversazione verte chiaramente sulla prenotazione di una visita o esame tramite il Servizio Sanitario Nazionale (SSN) di persona presso l'Istituto Clinico Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte chiaramente sulla prenotazione di una visita o esame tramite il Servizio Sanitario Nazionale (SSN) di persona presso l'Istituto Clinico Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione ccca60736fc7c2053c15618c3611bbba classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 175
   ğŸ“Š Token totali: 603
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 603 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 175
   ğŸ“Š Token conversazione finale: 175
   ğŸ“Š Token totali: 603
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 640 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao mi sono accorta che nell' app Humanitas Ã¨ rimasto registrato il mio vecchio recapito telefonico e quindi non ricevo il codice OTP. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2809 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 175
   ğŸ“Š Token totali stimati: 603
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao mi sono accorta che nell' app Humanitas Ã¨ rimasto registrato il mio vecchio recapito telefonico e quindi non ricevo il codice OTP. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:51.844545
====================================================================================================
ğŸ“‹ Session ID: classify_1756762971
â±ï¸  Processing Time: 1.719s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (640 chars):
   [UTENTE] Ciao mi sono accorta che nell' app Humanitas Ã¨ rimasto registrato il mio vecchio recapito telefonico e quindi non ricevo il codice OTP. [ASSISTENTE] Per aggiornare il tuo recapito telefoni...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [74 more lines] ...
     Line 78: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Servizi aziendali", "confidenc
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 969f7e7726de935d576cefe5aa90f575 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 207
   ğŸ“Š Token totali: 655
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 655 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 207
   ğŸ“Š Token conversazione finale: 207
   ğŸ“Š Token totali: 655
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 674 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] posso sapere il listini prezzi ? [ASSISTENTE] Potresti specificare a quale tipo di listino prezzi ti riferisci? Ad esempio, stai cercando informazioni sui costi di:

- Parcheggi;
- Ricoveri;
- Visite ed esami ambulatoriali;
- Cartelle cliniche.

Fammi sapere cosÃ¬ posso aiutarti al meglio..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 207
   ğŸ“Š Token totali stimati: 655
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] posso sapere il listini prezzi ? [ASSISTENTE] Potresti specificare a quale tipo di listino prezzi ti riferisci? Ad esempio, stai cercando informazioni sui costi di:

- Parcheggi;
- Ricoveri;
- Visite ed esami ambulatoriali;
- Cartelle cliniche.

Fammi sapere cosÃ¬ posso aiutarti al meglio..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.75, 'motivation': "La conversazione verte sull'asportazione di condilomi e la richiesta di informazioni sui costi dell'intervento, che Ã¨ una visita specialistica oncologica.", 'predicted_label': 'Visita Specialistica Oncologica'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:53.598724
====================================================================================================
ğŸ“‹ Session ID: classify_1756762973
â±ï¸  Processing Time: 1.667s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (674 chars):
   [UTENTE] posso sapere il listini prezzi ? [ASSISTENTE] Potresti specificare a quale tipo di listino prezzi ti riferisci? Ad esempio, stai cercando informazioni sui costi di:

- Parcheggi;
- Ricover...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [80 more lines] ...
     Line 84: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (246 chars):
   {'confidence': 0.75, 'motivation': "La conversazione verte sull'asportazione di condilomi e la richiesta di informazioni sui costi dell'intervento, che Ã¨ una visita specialistica oncologica.", 'predicted_label': 'Visita Specialistica Oncologica'}

ğŸ“Š Parsed Response:
   predicted_label: Visita Specialistica Oncologica
   confidence: 0.75
   motivation: La conversazione verte sull'asportazione di condilomi e la richiesta di informazioni sui costi dell'intervento, che Ã¨ una visita specialistica oncologica.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.750
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 75.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'asportazione di condilomi e la richiesta di informazioni sui costi dell'intervento, che Ã¨ una visita specialistica oncologica.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 34640bdbc253c19dd3a6e3888c5d6c7d classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Visita Specialistica Oncologica' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 472
   ğŸ“Š Token totali: 920
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 920 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 472
   ğŸ“Š Token conversazione finale: 472
   ğŸ“Š Token totali: 920
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1447 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Voglio prenotare in Torino  [ASSISTENTE] A Torino, Humanitas Ã¨ presente con diverse strutture. [...]  

Se hai bisogno di ulteriori informazioni, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2836 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 472
   ğŸ“Š Token totali stimati: 920
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Voglio prenotare in Torino  [ASSISTENTE] A Torino, Humanitas Ã¨ presente con diverse strutture. [...]  

Se hai bisogno di ulteriori informazioni, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Prenotazione",\n  "confidence": 0.9,\n  "mo'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:55.412140
====================================================================================================
ğŸ“‹ Session ID: classify_1756762975
â±ï¸  Processing Time: 1.727s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1447 chars):
   [UTENTE] Voglio prenotare in Torino  [ASSISTENTE] A Torino, Humanitas Ã¨ presente con diverse strutture. Potresti specificare se desideri prenotare presso una di queste sedi? Ecco le opzioni disponi...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (197 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n  "predicted_label": "Prenotazione",\n  "confidence": 0.9,\n  "mo'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Prenotazione",
  "confidence": 0.9,
  "mo
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
  "predicted_label": "Prenotazione",
  "confidence": 0.9,
  "mo
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 283bce83513fcacad6afd5d4e902cd5e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 285
   ğŸ“Š Token totali: 713
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 713 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 285
   ğŸ“Š Token conversazione finale: 285
   ğŸ“Š Token totali: 713
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 936 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] infusione di ferro per via endovenosa [ASSISTENTE] L'infusione di ferro per via endovenosa Ã¨ una modalitÃ  di trattamento utilizzata per correggere l'anemia da carenza di ferro, specialmente nei casi in cui l'assorbimento orale Ã¨ insufficiente o non praticabile. Tra i farmaci utilizzati p..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 285
   ğŸ“Š Token totali stimati: 713
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] infusione di ferro per via endovenosa [ASSISTENTE] L'infusione di ferro per via endovenosa Ã¨ una modalitÃ  di trattamento utilizzata per correggere l'anemia da carenza di ferro, specialmente nei casi in cui l'assorbimento orale Ã¨ insufficiente o non praticabile. Tra i farmaci utilizzati p..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Analisi"}}'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:56.272238
====================================================================================================
ğŸ“‹ Session ID: classify_1756762976
â±ï¸  Processing Time: 0.774s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (936 chars):
   [UTENTE] infusione di ferro per via endovenosa [ASSISTENTE] L'infusione di ferro per via endovenosa Ã¨ una modalitÃ  di trattamento utilizzata per correggere l'anemia da carenza di ferro, specialment...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (171 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Analisi"}}'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Analisi"}}
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Analisi"}}
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione e26ea7d487729cfee28090b0035a482b classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 272
   ğŸ“Š Token totali: 721
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 721 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 272
   ğŸ“Š Token conversazione finale: 272
   ğŸ“Š Token totali: 721
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 930 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Dopo quanto tempo scade una visita? [ASSISTENTE] Le ricette emesse prima del 30 dicembre 2024 hanno una validitÃ  di 180 giorni dalla data di prescrizione per effettuare la prenotazione. Le prestazioni possono essere erogabili e rendicontabili solo fino al 31 dicembre 2025ã€6:17â€ scraped_ht..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 272
   ğŸ“Š Token totali stimati: 721
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Dopo quanto tempo scade una visita? [ASSISTENTE] Le ricette emesse prima del 30 dicembre 2024 hanno una validitÃ  di 180 giorni dalla data di prescrizione per effettuare la prenotazione. Le prestazioni possono essere erogabili e rendicontabili solo fino al 31 dicembre 2025ã€6:17â€ scraped_ht..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sulla durata di validitÃ  delle ricette mediche e la possibilitÃ  di utilizzare una visita precedente per prenotare un'operazione.", 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:58.053530
====================================================================================================
ğŸ“‹ Session ID: classify_1756762978
â±ï¸  Processing Time: 1.695s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (930 chars):
   [UTENTE] Dopo quanto tempo scade una visita? [ASSISTENTE] Le ricette emesse prima del 30 dicembre 2024 hanno una validitÃ  di 180 giorni dalla data di prescrizione per effettuare la prenotazione. Le...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (224 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sulla durata di validitÃ  delle ricette mediche e la possibilitÃ  di utilizzare una visita precedente per prenotare un'operazione.", 'predicted_label': 'Prenotazione'}

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.95
   motivation: La conversazione verte sulla durata di validitÃ  delle ricette mediche e la possibilitÃ  di utilizzare una visita precedente per prenotare un'operazione.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sulla durata di validitÃ  delle ricette mediche e la possibilitÃ  di utilizzare una visita precedente per prenotare un'operazione.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione b067c4bcdc83e045fbea133686fc0996 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 167
   ğŸ“Š Token totali: 616
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 616 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 167
   ğŸ“Š Token conversazione finale: 167
   ğŸ“Š Token totali: 616
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 576 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] devo prenotare esami del sangue e urine quale prestazione devo selezionare [ASSISTENTE] Per prenotare esami del sangue e delle urine, Ã¨ necessario selezionare le prestazioni specifiche indicate dal medico nella prescrizione. [...] it/visite-ed-esami/esame-delle-urine-completo)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2955 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 167
   ğŸ“Š Token totali stimati: 616
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] devo prenotare esami del sangue e urine quale prestazione devo selezionare [ASSISTENTE] Per prenotare esami del sangue e delle urine, Ã¨ necessario selezionare le prestazioni specifiche indicate dal medico nella prescrizione. [...] it/visite-ed-esami/esame-delle-urine-completo)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Analisi", "confidence": 0.9, "'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:42:59.636679
====================================================================================================
ğŸ“‹ Session ID: classify_1756762979
â±ï¸  Processing Time: 1.497s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (576 chars):
   [UTENTE] devo prenotare esami del sangue e urine quale prestazione devo selezionare [ASSISTENTE] Per prenotare esami del sangue e delle urine, Ã¨ necessario selezionare le prestazioni specifiche ind...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Analisi", "confidence": 0.9, "'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Analisi", "confidence": 0.9, "
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Analisi", "confidence": 0.9, "
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione a27d4ae15d32ea5b16c21c408c4687b3 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 158
   ğŸ“Š Token totali: 607
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 607 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 158
   ğŸ“Š Token conversazione finale: 158
   ğŸ“Š Token totali: 607
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 484 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Voglio fare una lamentela  [ASSISTENTE] Puoi inoltrare la tua lamentela all'Ufficio Relazioni con il Pubblico (URP) di Humanitas. [...]  

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2879 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 158
   ğŸ“Š Token totali stimati: 607
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Voglio fare una lamentela  [ASSISTENTE] Puoi inoltrare la tua lamentela all'Ufficio Relazioni con il Pubblico (URP) di Humanitas. [...]  

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'inoltro di una lamentela attraverso il servizio URP dell'ospedale Humanitas, pertanto la categoria 'Servizi aziendali' Ã¨ appropriata.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:01.544474
====================================================================================================
ğŸ“‹ Session ID: classify_1756762981
â±ï¸  Processing Time: 1.821s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (484 chars):
   [UTENTE] Voglio fare una lamentela  [ASSISTENTE] Puoi inoltrare la tua lamentela all'Ufficio Relazioni con il Pubblico (URP) di Humanitas. Puoi inviare una segnalazione tramite il form dedicato che...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (239 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'inoltro di una lamentela attraverso il servizio URP dell'ospedale Humanitas, pertanto la categoria 'Servizi aziendali' Ã¨ appropriata.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.95
   motivation: La conversazione verte sull'inoltro di una lamentela attraverso il servizio URP dell'ospedale Humanitas, pertanto la categoria 'Servizi aziendali' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'inoltro di una lamentela attraverso il servizio URP dell'ospedale Humanitas, pertanto la categoria 'Servizi aziendali' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 7f71a919d94a45b4908da083d3fa4bc1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 260
   ğŸ“Š Token totali: 709
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 709 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 260
   ğŸ“Š Token conversazione finale: 260
   ğŸ“Š Token totali: 709
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 924 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco a pre otarw una visita. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2781 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 260
   ğŸ“Š Token totali stimati: 709
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco a pre otarw una visita. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sul problema riscontrato durante la prenotazione di una visita e l'assistente fornisce istruzioni su come risolvere il problema.", 'predicted_label': 'Prenotazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:03.352855
====================================================================================================
ğŸ“‹ Session ID: classify_1756762983
â±ï¸  Processing Time: 1.720s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (924 chars):
   [UTENTE] Non riesco a pre otarw una visita. Inserisco il cf pee [UTENTE] non riesco a prenotare una visita inserisco il codice fiscale ma non mi fa andare avanti con la password e mi dice di rivolg...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (224 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sul problema riscontrato durante la prenotazione di una visita e l'assistente fornisce istruzioni su come risolvere il problema.", 'predicted_label': 'Prenotazione'}

ğŸ“Š Parsed Response:
   predicted_label: Prenotazione
   confidence: 0.95
   motivation: La conversazione verte sul problema riscontrato durante la prenotazione di una visita e l'assistente fornisce istruzioni su come risolvere il problema.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sul problema riscontrato durante la prenotazione di una visita e l'assistente fornisce istruzioni su come risolvere il problema.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione db1308122280aba989b3b1eb70de529d classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Prenotazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 617
   ğŸ“Š Token totali: 1065
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1065 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 617
   ğŸ“Š Token conversazione finale: 617
   ğŸ“Š Token totali: 1065
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1989 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, avrei bisogno di ritirare le immagini della mia tac con contrasto fatta il 28 Giugno. [...] it/info/referti-cartelle-cliniche/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2816 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 617
   ğŸ“Š Token totali stimati: 1065
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, avrei bisogno di ritirare le immagini della mia tac con contrasto fatta il 28 Giugno. [...] it/info/referti-cartelle-cliniche/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte principalmente sull'ottenimento del referto della TAC con contrasto eseguita dall'utente il 28 giugno. L'assistente fornisce informazioni dettagliate su dove e come ritirare il referto, inclusi gli orari di apertura dell'Ufficio Ritiro Referti.", 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:06.023573
====================================================================================================
ğŸ“‹ Session ID: classify_1756762986
â±ï¸  Processing Time: 2.583s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1989 chars):
   [UTENTE] Buongiorno, avrei bisogno di ritirare le immagini della mia tac con contrasto fatta il 28 Giugno. [ASSISTENTE] Per ritirare le immagini della tua TAC con contrasto, puoi seguire queste ind...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (355 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte principalmente sull'ottenimento del referto della TAC con contrasto eseguita dall'utente il 28 giugno. L'assistente fornisce informazioni dettagliate su dove e come ritirare il referto, inclusi gli orari di apertura dell'Ufficio Ritiro Re...

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione verte principalmente sull'ottenimento del referto della TAC con contrasto eseguita dall'utente il 28 giugno. L'assistente fornisce informazioni dettagliate su dove e come ritirare il referto, inclusi gli orari di apertura dell'Ufficio Ritiro Referti.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte principalmente sull'ottenimento del referto della TAC con contrasto eseguita dall'utente il 28 giugno. L'assistente fornisce informazioni dettagliate su dove e come ritirare il referto, inclusi gli orari di apertura dell'Ufficio Ritiro Referti.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 22608ba4b75c9e8e1c699de82e2d68b4 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 1026
   ğŸ“Š Token totali: 1474
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1474 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 1026
   ğŸ“Š Token conversazione finale: 1026
   ğŸ“Š Token totali: 1474
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 3369 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno  [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE]  vorrei prenotare una visita per valutare una rinosettoplastica combinata. [...]  

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2898 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 1026
   ğŸ“Š Token totali stimati: 1474
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno  [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE]  vorrei prenotare una visita per valutare una rinosettoplastica combinata. [...]  

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: Ecco i risultati della classificazione automatica della conversazione:\n\n| predicted_label       | co'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:09.195044
====================================================================================================
ğŸ“‹ Session ID: classify_1756762989
â±ï¸  Processing Time: 3.085s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (3369 chars):
   [UTENTE] Buongiorno  [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE]  vorrei prenotare una visita per valutare una rinosettoplastica combinata.

Ho giÃ  effettuato visite e una TAC ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (193 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: Ecco i risultati della classificazione automatica della conversazione:\n\n| predicted_label       | co'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: Ecco i risultati della classificazione automatica della conversazione:

| predicted_label       | co
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: Ecco i risultati della classificazione automatica della conversazione:

| predicted_label       | co
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 5381d4c9da2317608c710047ffb8c1ea classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 329
   ğŸ“Š Token totali: 777
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 777 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 329
   ğŸ“Š Token conversazione finale: 329
   ğŸ“Š Token totali: 777
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1102 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ieri sono stata contattata da questo numero 0282248506 perchÃ© tramite il dottor Toschi Ã¨ stata prenotata una sacca Ã¨ total body con senza mezzo di contrasto e una TAC in cefalo il problema che mi sono dimenticata di chiedere i codici esatti perchÃ© mi hanno detto di far fare l'impegnativa..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 329
   ğŸ“Š Token totali stimati: 777
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ieri sono stata contattata da questo numero 0282248506 perchÃ© tramite il dottor Toschi Ã¨ stata prenotata una sacca Ã¨ total body con senza mezzo di contrasto e una TAC in cefalo il problema che mi sono dimenticata di chiedere i codici esatti perchÃ© mi hanno detto di far fare l'impegnativa..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:10.960875
====================================================================================================
ğŸ“‹ Session ID: classify_1756762990
â±ï¸  Processing Time: 1.679s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1102 chars):
   [UTENTE] Ieri sono stata contattata da questo numero 0282248506 perchÃ© tramite il dottor Toschi Ã¨ stata prenotata una sacca Ã¨ total body con senza mezzo di contrasto e una TAC in cefalo il problema...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione d9a9e67f1a3d3a4f348a05f5ece09f22 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
   ğŸ“ˆ Progresso LLM: 100/624
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 109
   ğŸ“Š Token totali: 557
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 557 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 109
   ğŸ“Š Token conversazione finale: 109
   ğŸ“Š Token totali: 557
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 366 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia dopo il mio intervento c'Ã¨ qualche servizio di trasporto a pagamento  [ASSISTENTE] SÃ¬, Humanitas offre un servizio di trasporto a pagamento per i pazienti. [...]  Se hai bisogno di ulteriori informazioni o di assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2923 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 109
   ğŸ“Š Token totali stimati: 557
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia dopo il mio intervento c'Ã¨ qualche servizio di trasporto a pagamento  [ASSISTENTE] SÃ¬, Humanitas offre un servizio di trasporto a pagamento per i pazienti. [...]  Se hai bisogno di ulteriori informazioni o di assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sul servizio di trasporto a pagamento offerto dall'ospedale Humanitas per i pazienti.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:12.551242
====================================================================================================
ğŸ“‹ Session ID: classify_1756762992
â±ï¸  Processing Time: 1.503s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (366 chars):
   [UTENTE] Ciao Giulia dopo il mio intervento c'Ã¨ qualche servizio di trasporto a pagamento  [ASSISTENTE] SÃ¬, Humanitas offre un servizio di trasporto a pagamento per i pazienti. Per maggiori dettagl...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (186 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sul servizio di trasporto a pagamento offerto dall'ospedale Humanitas per i pazienti.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.95
   motivation: La conversazione verte sul servizio di trasporto a pagamento offerto dall'ospedale Humanitas per i pazienti.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sul servizio di trasporto a pagamento offerto dall'ospedale Humanitas per i pazienti.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 0b58a364c5dabf3c9b7b0da0c9ffcbd0 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 273
   ğŸ“Š Token totali: 722
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 722 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 273
   ğŸ“Š Token conversazione finale: 273
   ğŸ“Š Token totali: 722
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 995 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Giulia Devo scaricare on-line dei dei referti diagnostici con immagini ma sono due mesi che non riesco a farlo Come posso avere questi referti [ASSISTENTE] Per i risultati del tuo esame, puoi visitare la pagina [Referti e Cartelle Cliniche - Humanitas](https://www.humanitas.it/info/refer..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 273
   ğŸ“Š Token totali stimati: 722
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Giulia Devo scaricare on-line dei dei referti diagnostici con immagini ma sono due mesi che non riesco a farlo Come posso avere questi referti [ASSISTENTE] Per i risultati del tuo esame, puoi visitare la pagina [Referti e Cartelle Cliniche - Humanitas](https://www.humanitas.it/info/refer..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche"}}'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:13.491197
====================================================================================================
ğŸ“‹ Session ID: classify_1756762993
â±ï¸  Processing Time: 0.853s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (995 chars):
   [UTENTE] Giulia Devo scaricare on-line dei dei referti diagnostici con immagini ma sono due mesi che non riesco a farlo Come posso avere questi referti [ASSISTENTE] Per i risultati del tuo esame, p...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche"}}'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche"}}
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Referti e Cartelle Cliniche"}}
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 8c44f78210bb5b54dc9af8d0f89977be classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 247
   ğŸ“Š Token totali: 695
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 695 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 247
   ğŸ“Š Token conversazione finale: 247
   ğŸ“Š Token totali: 695
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 891 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei avere notizie sullâ€™utilizzo del chondro filler nellâ€™ artrosi del ginocchio, grazie  [ASSISTENTE] Non ho trovato informazioni specifiche sull'utilizzo del chondro filler nell'artrosi del ginocchio nei documenti forniti. [...] it/info/contatti/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2927 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 247
   ğŸ“Š Token totali stimati: 695
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei avere notizie sullâ€™utilizzo del chondro filler nellâ€™ artrosi del ginocchio, grazie  [ASSISTENTE] Non ho trovato informazioni specifiche sull'utilizzo del chondro filler nell'artrosi del ginocchio nei documenti forniti. [...] it/info/contatti/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica"}}'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:14.345748
====================================================================================================
ğŸ“‹ Session ID: classify_1756762994
â±ï¸  Processing Time: 0.768s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (891 chars):
   [UTENTE] Vorrei avere notizie sullâ€™utilizzo del chondro filler nellâ€™ artrosi del ginocchio, grazie  [ASSISTENTE] Non ho trovato informazioni specifiche sull'utilizzo del chondro filler nell'artrosi...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (184 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica"}}'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica"}}
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica"}}
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 3fdd406bc33afa73ed86ed62b917bd91 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 322
   ğŸ“Š Token totali: 770
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 770 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 322
   ğŸ“Š Token conversazione finale: 322
   ğŸ“Š Token totali: 770
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 991 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] buongiorno, in quale area trovo le convenzioni con alloggi vicino all'ospedale di rossno? [ASSISTENTE] Puoi trovare informazioni sulle convenzioni con alloggi vicino all'ospedale di Rozzano alla pagina dedicata. [...] it/info/viaggi/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2911 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 322
   ğŸ“Š Token totali stimati: 770
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] buongiorno, in quale area trovo le convenzioni con alloggi vicino all'ospedale di rossno? [ASSISTENTE] Puoi trovare informazioni sulle convenzioni con alloggi vicino all'ospedale di Rozzano alla pagina dedicata. [...] it/info/viaggi/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "alloggio", "confidence": 0.9, '}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:15.985067
====================================================================================================
ğŸ“‹ Session ID: classify_1756762995
â±ï¸  Processing Time: 1.553s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (991 chars):
   [UTENTE] buongiorno, in quale area trovo le convenzioni con alloggi vicino all'ospedale di rossno? [ASSISTENTE] Puoi trovare informazioni sulle convenzioni con alloggi vicino all'ospedale di Rozzan...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "alloggio", "confidence": 0.9, '}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "alloggio", "confidence": 0.9, 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "alloggio", "confidence": 0.9, 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f78fbef4fac060d2e3503db1386fe29e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 392
   ğŸ“Š Token totali: 820
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 820 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 392
   ğŸ“Š Token conversazione finale: 392
   ğŸ“Š Token totali: 820
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1379 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao ho fatto una tac sabto 12/07/25 non vedo ancora i referti on line [ASSISTENTE] Per i risultati del tuo esame, puoi visitare la pagina [Referti e Cartelle Cliniche - Humanitas](https://www. [...] it, indicando nome, cognome, codice fiscale e motivo della richiesta di assistenza"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2887 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 392
   ğŸ“Š Token totali stimati: 820
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao ho fatto una tac sabto 12/07/25 non vedo ancora i referti on line [ASSISTENTE] Per i risultati del tuo esame, puoi visitare la pagina [Referti e Cartelle Cliniche - Humanitas](https://www. [...] it, indicando nome, cognome, codice fiscale e motivo della richiesta di assistenza"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'accesso ai referti online della TAC eseguita dall'utente il 12/07/25. L'assistente fornisce informazioni su come accedere alla sezione 'Referti e Cartelle Cliniche' del sito Humanitas e suggerisce di verificare la corretta procedura di accesso in caso di problemi.", 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:18.701495
====================================================================================================
ğŸ“‹ Session ID: classify_1756762998
â±ï¸  Processing Time: 2.630s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1379 chars):
   [UTENTE] ciao ho fatto una tac sabto 12/07/25 non vedo ancora i referti on line [ASSISTENTE] Per i risultati del tuo esame, puoi visitare la pagina [Referti e Cartelle Cliniche - Humanitas](https:/...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (380 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'accesso ai referti online della TAC eseguita dall'utente il 12/07/25. L'assistente fornisce informazioni su come accedere alla sezione 'Referti e Cartelle Cliniche' del sito Humanitas e suggerisce di verificare la corretta procedura ...

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione verte sull'accesso ai referti online della TAC eseguita dall'utente il 12/07/25. L'assistente fornisce informazioni su come accedere alla sezione 'Referti e Cartelle Cliniche' del sito Humanitas e suggerisce di verificare la corretta procedura di accesso in caso di problemi.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'accesso ai referti online della TAC eseguita dall'utente il 12/07/25. L'assistente fornisce informazioni su come accedere alla sezione 'Referti e Cartelle Cliniche' del sito Humanitas e suggerisce di verificare la corretta procedura di accesso in caso di problemi.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 63b3bf9ff2ba73412d147434d52d3d64 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 225
   ğŸ“Š Token totali: 673
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 673 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 225
   ğŸ“Š Token conversazione finale: 225
   ğŸ“Š Token totali: 673
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 781 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, avrei necessitÃ  di sapere se il vostro macchinario aperto per un risonanza magnetica rachide lombosacrale supporta un circonferenza di cm 140 [ASSISTENTE] Non ho trovato informazioni specifiche sulla capacitÃ  del macchinario per la risonanza magnetica aperta in termini di sup..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 225
   ğŸ“Š Token totali stimati: 673
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, avrei necessitÃ  di sapere se il vostro macchinario aperto per un risonanza magnetica rachide lombosacrale supporta un circonferenza di cm 140 [ASSISTENTE] Non ho trovato informazioni specifiche sulla capacitÃ  del macchinario per la risonanza magnetica aperta in termini di sup..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.9, 'motivation': "La conversazione verte sull'ottenere informazioni specifiche sulla capacitÃ  del macchinario per la risonanza magnetica aperta in termini di supporto per una circonferenza di 140 cm.", 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:20.692540
====================================================================================================
ğŸ“‹ Session ID: classify_1756763000
â±ï¸  Processing Time: 1.904s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (781 chars):
   [UTENTE] Buongiorno, avrei necessitÃ  di sapere se il vostro macchinario aperto per un risonanza magnetica rachide lombosacrale supporta un circonferenza di cm 140 [ASSISTENTE] Non ho trovato inform...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (268 chars):
   {'confidence': 0.9, 'motivation': "La conversazione verte sull'ottenere informazioni specifiche sulla capacitÃ  del macchinario per la risonanza magnetica aperta in termini di supporto per una circonferenza di 140 cm.", 'predicted_label': 'Referti e Cartelle Cliniche'}

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.9
   motivation: La conversazione verte sull'ottenere informazioni specifiche sulla capacitÃ  del macchinario per la risonanza magnetica aperta in termini di supporto per una circonferenza di 140 cm.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.900
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 90.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'ottenere informazioni specifiche sulla capacitÃ  del macchinario per la risonanza magnetica aperta in termini di supporto per una circonferenza di 140 cm.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f132859c25781292baa67a202e10ceb0 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 674
   ğŸ“Š Token totali: 1122
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1122 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 674
   ğŸ“Š Token conversazione finale: 674
   ğŸ“Š Token totali: 1122
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2237 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, volevo sapere se la dottoressa nutrizionista puÃ² prepararmi la dieta del sistema immunitario e come posso contattarla per metterla al corrente dei mie problemi di salute. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2882 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 674
   ğŸ“Š Token totali stimati: 1122
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, volevo sapere se la dottoressa nutrizionista puÃ² prepararmi la dieta del sistema immunitario e come posso contattarla per metterla al corrente dei mie problemi di salute. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted label:** Prenotazione\n\n**Confidence:** 0.75\n\n**Motivation:** La conversazione verte prin'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:22.920761
====================================================================================================
ğŸ“‹ Session ID: classify_1756763002
â±ï¸  Processing Time: 2.142s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2237 chars):
   [UTENTE] Buongiorno, volevo sapere se la dottoressa nutrizionista puÃ² prepararmi la dieta del sistema immunitario e come posso contattarla per metterla al corrente dei mie problemi di salute. Ovvia...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (195 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted label:** Prenotazione\n\n**Confidence:** 0.75\n\n**Motivation:** La conversazione verte prin'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **Predicted label:** Prenotazione

**Confidence:** 0.75

**Motivation:** La conversazione verte prin
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **Predicted label:** Prenotazione

**Confidence:** 0.75

**Motivation:** La conversazione verte prin
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 8429ea9319ce353dd858957a654505f1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 427
   ğŸ“Š Token totali: 875
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 875 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 427
   ğŸ“Š Token conversazione finale: 427
   ğŸ“Š Token totali: 875
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1419 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao Giulia, mi puoi raccontare di piÃ¹ sul percorso del microbiota [ASSISTENTE] Il microbiota intestinale Ã¨ un insieme di microrganismi che vivono nel nostro intestino e svolgono funzioni essenziali per la salute, come la regolazione dell'assorbimento dei nutrienti, la produzione di vita..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 427
   ğŸ“Š Token totali stimati: 875
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao Giulia, mi puoi raccontare di piÃ¹ sul percorso del microbiota [ASSISTENTE] Il microbiota intestinale Ã¨ un insieme di microrganismi che vivono nel nostro intestino e svolgono funzioni essenziali per la salute, come la regolazione dell'assorbimento dei nutrienti, la produzione di vita..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Analisi', 'confidence': 0.6, 'motivation': '| predicted_label       | confidenza | motivazione                                                                 |'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:26.128042
====================================================================================================
ğŸ“‹ Session ID: classify_1756763006
â±ï¸  Processing Time: 3.120s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1419 chars):
   [UTENTE] ciao Giulia, mi puoi raccontare di piÃ¹ sul percorso del microbiota [ASSISTENTE] Il microbiota intestinale Ã¨ un insieme di microrganismi che vivono nel nostro intestino e svolgono funzioni ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (183 chars):
   {'predicted_label': 'Analisi', 'confidence': 0.6, 'motivation': '| predicted_label       | confidenza | motivazione                                                                 |'}

ğŸ“Š Parsed Response:
   predicted_label: Analisi
   confidence: 0.6
   motivation: | predicted_label       | confidenza | motivazione                                                                 |
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.600
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 60.0%

ğŸ§  Reasoning/Motivation:
   | predicted_label       | confidenza | motivazione                                                                 |
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 5326f31e302b1429bc00f4667690502d classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Analisi' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 86
   ğŸ“Š Token totali: 514
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 514 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 86
   ğŸ“Š Token conversazione finale: 86
   ğŸ“Š Token totali: 514
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 272 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Un e-mail de contact al spitalului  [ASSISTENTE] Pentru a contacta spitalul Humanitas din strÄƒinÄƒtate, vÄƒ recomand sÄƒ utilizaÈ›i pagina [Contact US](https://www.humanitas.net/contact/). Acolo veÈ›i gÄƒsi toate informaÈ›iile necesare pentru a lua legÄƒtura cu spitalul."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2868 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 86
   ğŸ“Š Token totali stimati: 514
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Un e-mail de contact al spitalului  [ASSISTENTE] Pentru a contacta spitalul Humanitas din strÄƒinÄƒtate, vÄƒ recomand sÄƒ utilizaÈ›i pagina [Contact US](https://www.humanitas.net/contact/). Acolo veÈ›i gÄƒsi toate informaÈ›iile necesare pentru a lua legÄƒtura cu spitalul."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:29.151439
====================================================================================================
ğŸ“‹ Session ID: classify_1756763009
â±ï¸  Processing Time: 2.936s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (272 chars):
   [UTENTE] Un e-mail de contact al spitalului  [ASSISTENTE] Pentru a contacta spitalul Humanitas din strÄƒinÄƒtate, vÄƒ recomand sÄƒ utilizaÈ›i pagina [Contact US](https://www.humanitas.net/contact/). Aco...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (97 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 1ab2665ea4d71cfb1f75b8fd1def1dbd classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 366
   ğŸ“Š Token totali: 814
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 814 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 366
   ğŸ“Š Token conversazione finale: 366
   ğŸ“Š Token totali: 814
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1240 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Devo ritirare il referto di una tac con contrasto di Parodi Damiano Mario Ã¨  [ASSISTENTE] Per il ritiro del referto di una TAC con contrasto, ti consiglio di verificare se il referto Ã¨ disponibile online tramite [Humanitas con te](https://www.humanitasconte.it). Se non fosse consultabile..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 366
   ğŸ“Š Token totali stimati: 814
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Devo ritirare il referto di una tac con contrasto di Parodi Damiano Mario Ã¨  [ASSISTENTE] Per il ritiro del referto di una TAC con contrasto, ti consiglio di verificare se il referto Ã¨ disponibile online tramite [Humanitas con te](https://www.humanitasconte.it). Se non fosse consultabile..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: '}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:32.306990
====================================================================================================
ğŸ“‹ Session ID: classify_1756763012
â±ï¸  Processing Time: 3.068s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1240 chars):
   [UTENTE] Devo ritirare il referto di una tac con contrasto di Parodi Damiano Mario Ã¨  [ASSISTENTE] Per il ritiro del referto di una TAC con contrasto, ti consiglio di verificare se il referto Ã¨ dis...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (91 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: '}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: 
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: 
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 41c484fc21ba0817f2bd3dee7a6033fd classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 245
   ğŸ“Š Token totali: 693
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 693 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 245
   ğŸ“Š Token conversazione finale: 245
   ğŸ“Š Token totali: 693
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 827 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei sapere come si svolge la visita cardiologica e se c'Ã¨ una preparazione da fare [ASSISTENTE] La visita cardiologica Ã¨ fondamentale per diagnosticare o monitorare disturbi cardiologici. [...] it/visite-ed-esami/visita-cardiologica)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2913 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 245
   ğŸ“Š Token totali stimati: 693
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei sapere come si svolge la visita cardiologica e se c'Ã¨ una preparazione da fare [ASSISTENTE] La visita cardiologica Ã¨ fondamentale per diagnosticare o monitorare disturbi cardiologici. [...] it/visite-ed-esami/visita-cardiologica)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.9, 'motivation': "La conversazione verte sulla visita cardiologica e sulle sue procedure, il che la rende pertinente alla categoria 'Visita Specialistica'.", 'predicted_label': 'Visita Specialistica'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:33.948534
====================================================================================================
ğŸ“‹ Session ID: classify_1756763013
â±ï¸  Processing Time: 1.555s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (827 chars):
   [UTENTE] Vorrei sapere come si svolge la visita cardiologica e se c'Ã¨ una preparazione da fare [ASSISTENTE] La visita cardiologica Ã¨ fondamentale per diagnosticare o monitorare disturbi cardiologic...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (217 chars):
   {'confidence': 0.9, 'motivation': "La conversazione verte sulla visita cardiologica e sulle sue procedure, il che la rende pertinente alla categoria 'Visita Specialistica'.", 'predicted_label': 'Visita Specialistica'}

ğŸ“Š Parsed Response:
   predicted_label: Visita Specialistica
   confidence: 0.9
   motivation: La conversazione verte sulla visita cardiologica e sulle sue procedure, il che la rende pertinente alla categoria 'Visita Specialistica'.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.900
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 90.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sulla visita cardiologica e sulle sue procedure, il che la rende pertinente alla categoria 'Visita Specialistica'.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 989bac7812bf5fd5921ba4e691b8ff38 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Visita Specialistica' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 206
   ğŸ“Š Token totali: 634
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 634 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 206
   ğŸ“Š Token conversazione finale: 206
   ğŸ“Š Token totali: 634
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 732 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno avrei bisogno del prezzo per l'esame fatto privatamente del testosterone totale [ASSISTENTE] Non ho trovato informazioni specifiche sul costo dell'esame del testosterone totale nei documenti forniti. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2887 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 206
   ğŸ“Š Token totali stimati: 634
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno avrei bisogno del prezzo per l'esame fatto privatamente del testosterone totale [ASSISTENTE] Non ho trovato informazioni specifiche sul costo dell'esame del testosterone totale nei documenti forniti. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sull'esame del testosterone totale e sul costo associato a tale esame. L'utente cerca informazioni specifiche"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:36.159940
====================================================================================================
ğŸ“‹ Session ID: classify_1756763016
â±ï¸  Processing Time: 2.124s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (732 chars):
   [UTENTE] Buongiorno avrei bisogno del prezzo per l'esame fatto privatamente del testosterone totale [ASSISTENTE] Non ho trovato informazioni specifiche sul costo dell'esame del testosterone totale ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sull'esame del testosterone totale e sul costo associato a tale esame. L'utente cerca informazioni specifiche"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte principalmente sull'esame del testosterone totale e sul costo associato a tale esame. L'utente cerca informazioni specifiche
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte principalmente sull'esame del testosterone totale e sul costo associato a tale esame. L'utente cerca informazioni specifiche
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 63341102c69d7a04607744951982457d classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 93
   ğŸ“Š Token totali: 541
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 541 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 93
   ğŸ“Š Token conversazione finale: 93
   ğŸ“Š Token totali: 541
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 333 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] chi Ã¨ il direttore generale  [ASSISTENTE] Non ho trovato informazioni specifiche sul direttore generale di Humanitas nei documenti forniti. [...] it/info/contatti/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2841 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 93
   ğŸ“Š Token totali stimati: 541
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] chi Ã¨ il direttore generale  [ASSISTENTE] Non ho trovato informazioni specifiche sul direttore generale di Humanitas nei documenti forniti. [...] it/info/contatti/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione riguarda informazioni generali sull'ospedale Humanitas e non ha un contesto specifico per una categoria medica.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:37.800276
====================================================================================================
ğŸ“‹ Session ID: classify_1756763017
â±ï¸  Processing Time: 1.551s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (333 chars):
   [UTENTE] chi Ã¨ il direttore generale  [ASSISTENTE] Non ho trovato informazioni specifiche sul direttore generale di Humanitas nei documenti forniti. Ti consiglio di contattare direttamente l'ospeda...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (206 chars):
   {'confidence': 0.95, 'motivation': "La conversazione riguarda informazioni generali sull'ospedale Humanitas e non ha un contesto specifico per una categoria medica.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.95
   motivation: La conversazione riguarda informazioni generali sull'ospedale Humanitas e non ha un contesto specifico per una categoria medica.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda informazioni generali sull'ospedale Humanitas e non ha un contesto specifico per una categoria medica.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 0dc863356f5f9483002d15fc6763fb43 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 281
   ğŸ“Š Token totali: 729
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 729 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 281
   ğŸ“Š Token conversazione finale: 281
   ğŸ“Š Token totali: 729
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 912 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno  [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] fa TAC abdome vompleto senza e con mdc? [ASSISTENTE] Per sapere se Humanitas esegue una TAC addome completo senza e con mezzo di contrasto, devo verificare nella base di conoscenza. Un momento, per favore.SÃ¬, Hu..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 281
   ğŸ“Š Token totali stimati: 729
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno  [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] fa TAC abdome vompleto senza e con mdc? [ASSISTENTE] Per sapere se Humanitas esegue una TAC addome completo senza e con mezzo di contrasto, devo verificare nella base di conoscenza. Un momento, per favore.SÃ¬, Hu..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Analisi', 'confidence': 0.6, 'motivation': 'Estratto da risposta descrittiva'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:39.259399
====================================================================================================
ğŸ“‹ Session ID: classify_1756763019
â±ï¸  Processing Time: 1.371s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (912 chars):
   [UTENTE] Buongiorno  [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] fa TAC abdome vompleto senza e con mdc? [ASSISTENTE] Per sapere se Humanitas esegue una TAC addome completo sen...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (99 chars):
   {'predicted_label': 'Analisi', 'confidence': 0.6, 'motivation': 'Estratto da risposta descrittiva'}

ğŸ“Š Parsed Response:
   predicted_label: Analisi
   confidence: 0.6
   motivation: Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.600
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 60.0%

ğŸ§  Reasoning/Motivation:
   Estratto da risposta descrittiva
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 2e7ad7ae52baed67dda9b09d382bf76f classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Analisi' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 229
   ğŸ“Š Token totali: 677
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 677 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 229
   ğŸ“Š Token conversazione finale: 229
   ğŸ“Š Token totali: 677
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 700 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ho un problema con una prenotazione [ASSISTENTE] Capisco, potresti dirmi di che tipo di prenotazione si tratta? Ãˆ per una visita, un esame, un ricovero o altro? Inoltre, Ã¨ stata effettuata tramite il Servizio Sanitario Nazionale (SSN) o privatamente? [UTENTE] privatamente [ASSISTENTE] Se..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 229
   ğŸ“Š Token totali stimati: 677
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ho un problema con una prenotazione [ASSISTENTE] Capisco, potresti dirmi di che tipo di prenotazione si tratta? Ãˆ per una visita, un esame, un ricovero o altro? Inoltre, Ã¨ stata effettuata tramite il Servizio Sanitario Nazionale (SSN) o privatamente? [UTENTE] privatamente [ASSISTENTE] Se..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla prenotazione di un appuntamento privato presso Humanitas. L'assistente fornisce informazioni su come ac"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:42.341128
====================================================================================================
ğŸ“‹ Session ID: classify_1756763022
â±ï¸  Processing Time: 2.993s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (700 chars):
   [UTENTE] ho un problema con una prenotazione [ASSISTENTE] Capisco, potresti dirmi di che tipo di prenotazione si tratta? Ãˆ per una visita, un esame, un ricovero o altro? Inoltre, Ã¨ stata effettuata...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla prenotazione di un appuntamento privato presso Humanitas. L'assistente fornisce informazioni su come ac"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte principalmente sulla prenotazione di un appuntamento privato presso Humanitas. L'assistente fornisce informazioni su come ac
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte principalmente sulla prenotazione di un appuntamento privato presso Humanitas. L'assistente fornisce informazioni su come ac
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 303228343216069eef41503b759584c7 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 179
   ğŸ“Š Token totali: 607
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 607 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 179
   ğŸ“Š Token conversazione finale: 179
   ğŸ“Š Token totali: 607
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 620 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] buongiorno. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2686 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 179
   ğŸ“Š Token totali stimati: 607
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] buongiorno. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica"}}'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:43.165085
====================================================================================================
ğŸ“‹ Session ID: classify_1756763023
â±ï¸  Processing Time: 0.738s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (620 chars):
   [UTENTE] buongiorno. [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] ho la sindrome di Good...ho bisogno di capire se ci sono medici nel vostro centro dove poter venire a fare una ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (184 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica"}}'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica"}}
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Visita Specialistica"}}
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 6ff7a7c4846810dd3495846c1ff77715 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 276
   ğŸ“Š Token totali: 724
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 724 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 276
   ğŸ“Š Token conversazione finale: 276
   ğŸ“Š Token totali: 724
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 895 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno. [...]  Da lÃ¬, potranno indirizzarti al reparto specifico"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2745 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 276
   ğŸ“Š Token totali stimati: 724
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno. [...]  Da lÃ¬, potranno indirizzarti al reparto specifico"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla necessitÃ  dell'utente di contattare il reparto di oculistica presso l'Istituto Clinico Humanitas di Roz"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:46.283473
====================================================================================================
ğŸ“‹ Session ID: classify_1756763026
â±ï¸  Processing Time: 3.032s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (895 chars):
   [UTENTE] Buongiorno. Volevo capire come si chiama il dottore che mi deve visitare lunedÃ¬ 11/08/2025 alle 14:00 [ASSISTENTE] Mi dispiace, ma non ho accesso a informazioni personali o specifiche sugl...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sulla necessitÃ  dell'utente di contattare il reparto di oculistica presso l'Istituto Clinico Humanitas di Roz"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte principalmente sulla necessitÃ  dell'utente di contattare il reparto di oculistica presso l'Istituto Clinico Humanitas di Roz
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte principalmente sulla necessitÃ  dell'utente di contattare il reparto di oculistica presso l'Istituto Clinico Humanitas di Roz
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione ba45801a4cf33e7b29e7f37f2949a4e5 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 315
   ğŸ“Š Token totali: 763
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 763 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 315
   ğŸ“Š Token conversazione finale: 315
   ğŸ“Š Token totali: 763
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1083 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno  [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] Volevo chiedere un'informazione la risonanza magnetica aperta Ãˆ solo a regime privato o anche a regime convenzionato con regime sanitario nazionale [ASSISTENTE] Non ho trovato informazioni specifiche sul fatto c..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 315
   ğŸ“Š Token totali stimati: 763
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno  [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] Volevo chiedere un'informazione la risonanza magnetica aperta Ãˆ solo a regime privato o anche a regime convenzionato con regime sanitario nazionale [ASSISTENTE] Non ho trovato informazioni specifiche sul fatto c..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sull'accessibilitÃ  della risonanza magnetica aperta sia in regime privato che convenzionato con il Servizio S"}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:50.672033
====================================================================================================
ğŸ“‹ Session ID: classify_1756763030
â±ï¸  Processing Time: 4.299s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1083 chars):
   [UTENTE] Buongiorno  [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] Volevo chiedere un'informazione la risonanza magnetica aperta Ãˆ solo a regime privato o anche a regime convenzi...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (215 chars):
   {'predicted_label': 'altro', 'confidence': 0.3, 'motivation': "** La conversazione verte principalmente sull'accessibilitÃ  della risonanza magnetica aperta sia in regime privato che convenzionato con il Servizio S"}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.3
   motivation: ** La conversazione verte principalmente sull'accessibilitÃ  della risonanza magnetica aperta sia in regime privato che convenzionato con il Servizio S
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.300
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30.0%

ğŸ§  Reasoning/Motivation:
   ** La conversazione verte principalmente sull'accessibilitÃ  della risonanza magnetica aperta sia in regime privato che convenzionato con il Servizio S
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione b0734819b315cb885de7557e08ca7b2f classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 613
   ğŸ“Š Token totali: 1061
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1061 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 613
   ğŸ“Š Token conversazione finale: 613
   ğŸ“Š Token totali: 1061
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1914 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] cosa puoi fare?  [ASSISTENTE] Posso fornire informazioni di carattere generale relative allâ€™ospedale Humanitas. [...]  Fammi sapere come posso esserti utile! ğŸ˜Š"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2836 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 613
   ğŸ“Š Token totali stimati: 1061
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] cosa puoi fare?  [ASSISTENTE] Posso fornire informazioni di carattere generale relative allâ€™ospedale Humanitas. [...]  Fammi sapere come posso esserti utile! ğŸ˜Š"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted label:** Prenotazione\n\n**Confidence:** 0.75\n\n**Motivation:** La conversazione verte prin'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:53.956875
====================================================================================================
ğŸ“‹ Session ID: classify_1756763033
â±ï¸  Processing Time: 3.197s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1914 chars):
   [UTENTE] cosa puoi fare?  [ASSISTENTE] Posso fornire informazioni di carattere generale relative allâ€™ospedale Humanitas. Puoi farmi domande, ad esempio, sui nomi dei professionisti sanitari di Huma...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (195 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **Predicted label:** Prenotazione\n\n**Confidence:** 0.75\n\n**Motivation:** La conversazione verte prin'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **Predicted label:** Prenotazione

**Confidence:** 0.75

**Motivation:** La conversazione verte prin
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **Predicted label:** Prenotazione

**Confidence:** 0.75

**Motivation:** La conversazione verte prin
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 97c80b96d9a8f043f5fe70afe6a5d5ad classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 130
   ğŸ“Š Token totali: 578
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 578 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 130
   ğŸ“Š Token conversazione finale: 130
   ğŸ“Š Token totali: 578
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 427 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ho due spese a 730 che risultano pagate da me e poi rimborsate ma che non riconosco  [ASSISTENTE] Per questioni relative a spese sanitarie e rimborsi, ti consiglio di contattare direttamente l'ufficio amministrativo o il servizio clienti di Humanitas. Puoi anche verificare eventuali dett..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2968 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 130
   ğŸ“Š Token totali stimati: 578
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ho due spese a 730 che risultano pagate da me e poi rimborsate ma che non riconosco  [ASSISTENTE] Per questioni relative a spese sanitarie e rimborsi, ti consiglio di contattare direttamente l'ufficio amministrativo o il servizio clienti di Humanitas. Puoi anche verificare eventuali dett..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'assistenza per spese sanitarie e rimborsi, che rientra nei servizi amministrativi dell'ospedale.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:55.676995
====================================================================================================
ğŸ“‹ Session ID: classify_1756763035
â±ï¸  Processing Time: 1.634s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (427 chars):
   [UTENTE] Ho due spese a 730 che risultano pagate da me e poi rimborsate ma che non riconosco  [ASSISTENTE] Per questioni relative a spese sanitarie e rimborsi, ti consiglio di contattare direttamen...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (202 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'assistenza per spese sanitarie e rimborsi, che rientra nei servizi amministrativi dell'ospedale.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.95
   motivation: La conversazione verte sull'assistenza per spese sanitarie e rimborsi, che rientra nei servizi amministrativi dell'ospedale.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'assistenza per spese sanitarie e rimborsi, che rientra nei servizi amministrativi dell'ospedale.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 993051e5add9047d93ec5894bd115023 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 260
   ğŸ“Š Token totali: 688
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 688 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 260
   ğŸ“Š Token conversazione finale: 260
   ğŸ“Š Token totali: 688
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 845 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao ho un problema non mi Ã¨' arrivato il promemoria di una prenotazione di una visita ortopedica  [ASSISTENTE] Se non hai ricevuto il promemoria per una prenotazione di una visita ortopedica, ti consiglio di verificare direttamente con il servizio prenotazioni di Humanitas. Puoi contatt..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 260
   ğŸ“Š Token totali stimati: 688
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao ho un problema non mi Ã¨' arrivato il promemoria di una prenotazione di una visita ortopedica  [ASSISTENTE] Se non hai ricevuto il promemoria per una prenotazione di una visita ortopedica, ti consiglio di verificare direttamente con il servizio prenotazioni di Humanitas. Puoi contatt..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione"}}'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:56.544855
====================================================================================================
ğŸ“‹ Session ID: classify_1756763036
â±ï¸  Processing Time: 0.780s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (845 chars):
   [UTENTE] Ciao ho un problema non mi Ã¨' arrivato il promemoria di una prenotazione di una visita ortopedica  [ASSISTENTE] Se non hai ricevuto il promemoria per una prenotazione di una visita ortoped...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (176 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione"}}'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione"}}
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione"}}
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione edc32f0f43166cef0ee9d1a7f9f5d649 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 491
   ğŸ“Š Token totali: 939
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 939 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 491
   ğŸ“Š Token conversazione finale: 491
   ğŸ“Š Token totali: 939
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1475 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Urologia  [ASSISTENTE] Per maggiori informazioni sul reparto di Urologia, ti consiglio di visitare la pagina dedicata sul sito di Humanitas. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2846 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 491
   ğŸ“Š Token totali stimati: 939
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Urologia  [ASSISTENTE] Per maggiori informazioni sul reparto di Urologia, ti consiglio di visitare la pagina dedicata sul sito di Humanitas. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.75, 'motivation': "La conversazione verte principalmente sulla prenotazione di una visita specialistica presso l'Istituto Clinico Humanitas.", 'predicted_label': 'Visita Specialistica'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:58.269627
====================================================================================================
ğŸ“‹ Session ID: classify_1756763038
â±ï¸  Processing Time: 1.638s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1475 chars):
   [UTENTE] Urologia  [ASSISTENTE] Per maggiori informazioni sul reparto di Urologia, ti consiglio di visitare la pagina dedicata sul sito di Humanitas. Se hai bisogno di dettagli specifici o di assis...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (202 chars):
   {'confidence': 0.75, 'motivation': "La conversazione verte principalmente sulla prenotazione di una visita specialistica presso l'Istituto Clinico Humanitas.", 'predicted_label': 'Visita Specialistica'}

ğŸ“Š Parsed Response:
   predicted_label: Visita Specialistica
   confidence: 0.75
   motivation: La conversazione verte principalmente sulla prenotazione di una visita specialistica presso l'Istituto Clinico Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.750
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 75.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte principalmente sulla prenotazione di una visita specialistica presso l'Istituto Clinico Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 87a40c6cef45719d0e2ba8392c6c5949 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Visita Specialistica' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 172
   ğŸ“Š Token totali: 600
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 600 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 172
   ğŸ“Š Token conversazione finale: 172
   ğŸ“Š Token totali: 600
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 582 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Il nome sul contenitore dell' urina viene applicato dal personale? [ASSISTENTE] Il nome sul contenitore dell'urina non viene applicato dal personale. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2766 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 172
   ğŸ“Š Token totali stimati: 600
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Il nome sul contenitore dell' urina viene applicato dal personale? [ASSISTENTE] Il nome sul contenitore dell'urina non viene applicato dal personale. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.9, 'motivation': "La conversazione verte sull'esame delle urine completo e sul modo corretto di utilizzare il contenitore per l'urina.", 'predicted_label': 'Analisi'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:43:59.823748
====================================================================================================
ğŸ“‹ Session ID: classify_1756763039
â±ï¸  Processing Time: 1.467s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (582 chars):
   [UTENTE] Il nome sul contenitore dell' urina viene applicato dal personale? [ASSISTENTE] Il nome sul contenitore dell'urina non viene applicato dal personale. Ãˆ necessario che il paziente utilizzi ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (183 chars):
   {'confidence': 0.9, 'motivation': "La conversazione verte sull'esame delle urine completo e sul modo corretto di utilizzare il contenitore per l'urina.", 'predicted_label': 'Analisi'}

ğŸ“Š Parsed Response:
   predicted_label: Analisi
   confidence: 0.9
   motivation: La conversazione verte sull'esame delle urine completo e sul modo corretto di utilizzare il contenitore per l'urina.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.900
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 90.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'esame delle urine completo e sul modo corretto di utilizzare il contenitore per l'urina.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione e25587617d60f31879bdd4c4771a6b18 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Analisi' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 100
   ğŸ“Š Token totali: 548
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 548 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 100
   ğŸ“Š Token conversazione finale: 100
   ğŸ“Š Token totali: 548
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 360 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Contatto ufficio selezioni del personale  [ASSISTENTE] Puoi consultare le posizioni aperte per tutte le strutture del gruppo Humanitas e candidarti collegandoti alla pagina [jobs. [...]  

Se hai bisogno di ulteriori informazioni, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2921 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 100
   ğŸ“Š Token totali stimati: 548
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Contatto ufficio selezioni del personale  [ASSISTENTE] Puoi consultare le posizioni aperte per tutte le strutture del gruppo Humanitas e candidarti collegandoti alla pagina [jobs. [...]  

Se hai bisogno di ulteriori informazioni, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'accesso alle posizioni lavorative all'interno dell'ospedale Humanitas.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:44:01.377445
====================================================================================================
ğŸ“‹ Session ID: classify_1756763041
â±ï¸  Processing Time: 1.467s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (360 chars):
   [UTENTE] Contatto ufficio selezioni del personale  [ASSISTENTE] Puoi consultare le posizioni aperte per tutte le strutture del gruppo Humanitas e candidarti collegandoti alla pagina [jobs.humanitas...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (176 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'accesso alle posizioni lavorative all'interno dell'ospedale Humanitas.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.95
   motivation: La conversazione verte sull'accesso alle posizioni lavorative all'interno dell'ospedale Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'accesso alle posizioni lavorative all'interno dell'ospedale Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f4a0210525d59c7596a9db4f911e8b04 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 289
   ğŸ“Š Token totali: 738
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 738 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 289
   ğŸ“Š Token conversazione finale: 289
   ğŸ“Š Token totali: 738
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 923 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao, in quale palazzina si fa l'esame istologico [ASSISTENTE] Gli esami istologici non sono consultabili online e devono essere ritirati presso lo sportello dell'ufficio referti. [...] it/info/come-raggiungere-humanitas/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2900 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 289
   ğŸ“Š Token totali stimati: 738
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao, in quale palazzina si fa l'esame istologico [ASSISTENTE] Gli esami istologici non sono consultabili online e devono essere ritirati presso lo sportello dell'ufficio referti. [...] it/info/come-raggiungere-humanitas/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'esame istologico e sul luogo dove ritirarlo, pertanto la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.", 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:44:03.209069
====================================================================================================
ğŸ“‹ Session ID: classify_1756763043
â±ï¸  Processing Time: 1.744s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (923 chars):
   [UTENTE] ciao, in quale palazzina si fa l'esame istologico [ASSISTENTE] Gli esami istologici non sono consultabili online e devono essere ritirati presso lo sportello dell'ufficio referti. Per quan...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (227 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'esame istologico e sul luogo dove ritirarlo, pertanto la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.", 'predicted_label': 'Referti e Cartelle Cliniche'}

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione verte sull'esame istologico e sul luogo dove ritirarlo, pertanto la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'esame istologico e sul luogo dove ritirarlo, pertanto la categoria 'Referti e Cartelle Cliniche' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione a7a03ccda5ab18b468d9a5c7eb1458b1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 454
   ğŸ’¬ Token conversazione: 183
   ğŸ“Š Token totali: 637
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 637 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione originale: 183
   ğŸ“Š Token conversazione finale: 183
   ğŸ“Š Token totali: 637
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 584 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ho una visita cardiologica prenotata per mio papÃ  l'11 di agosto, ma fece la stessa visita giÃ  una settimana fa, volevo capire se non fosse un errore o va rifatta? [ASSISTENTE] Non ho accesso ai dettagli delle prenotazioni personali o alla gestione degli appuntamenti. Ti consiglio di con..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2999 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 454
   ğŸ“Š Token conversazione: 183
   ğŸ“Š Token totali stimati: 637
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ho una visita cardiologica prenotata per mio papÃ  l'11 di agosto, ma fece la stessa visita giÃ  una settimana fa, volevo capire se non fosse un errore o va rifatta? [ASSISTENTE] Non ho accesso ai dettagli delle prenotazioni personali o alla gestione degli appuntamenti. Ti consiglio di con..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n    "predicted_label": "Visita Specialistica",\n    "confidence"'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:44:04.905157
====================================================================================================
ğŸ“‹ Session ID: classify_1756763044
â±ï¸  Processing Time: 1.610s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (584 chars):
   [UTENTE] Ho una visita cardiologica prenotata per mio papÃ  l'11 di agosto, ma fece la stessa visita giÃ  una settimana fa, volevo capire se non fosse un errore o va rifatta? [ASSISTENTE] Non ho acce...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (196 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **classify_conversation**\n\n```json\n{\n    "predicted_label": "Visita Specialistica",\n    "confidence"'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **classify_conversation**

```json
{
    "predicted_label": "Visita Specialistica",
    "confidence"
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **classify_conversation**

```json
{
    "predicted_label": "Visita Specialistica",
    "confidence"
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 777c4d864142550245571066b0198e55 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 97
   ğŸ“Š Token totali: 546
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 546 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 97
   ğŸ“Š Token conversazione finale: 97
   ğŸ“Š Token totali: 546
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 342 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] che ricetta mi serve prenotare il pacchetto cornea? [ASSISTENTE] Non ho trovato informazioni specifiche sulla ricetta necessaria per prenotare il pacchetto cornea. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2913 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 97
   ğŸ“Š Token totali stimati: 546
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] che ricetta mi serve prenotare il pacchetto cornea? [ASSISTENTE] Non ho trovato informazioni specifiche sulla ricetta necessaria per prenotare il pacchetto cornea. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:44:06.448426
====================================================================================================
ğŸ“‹ Session ID: classify_1756763046
â±ï¸  Processing Time: 1.457s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (342 chars):
   [UTENTE] che ricetta mi serve prenotare il pacchetto cornea? [ASSISTENTE] Non ho trovato informazioni specifiche sulla ricetta necessaria per prenotare il pacchetto cornea. Ti consiglio di contatta...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "Prenotazione", "confidence": 0
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 439eb6398a9d306e636ee67cd0f0e601 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 167
   ğŸ“Š Token totali: 595
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 595 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 167
   ğŸ“Š Token conversazione finale: 167
   ğŸ“Š Token totali: 595
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 554 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] cosa include il pacchettp p [ASSISTENTE] Non ho trovato informazioni specifiche sul "pacchetto p" nei documenti caricati. [...]  Potresti fornirmi ulteriori dettagli o chiarire a cosa ti riferisci? SarÃ² felice di aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2827 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 167
   ğŸ“Š Token totali stimati: 595
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] cosa include il pacchettp p [ASSISTENTE] Non ho trovato informazioni specifiche sul "pacchetto p" nei documenti caricati. [...]  Potresti fornirmi ulteriori dettagli o chiarire a cosa ti riferisci? SarÃ² felice di aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "altro", "confidence": 0.9, "mo'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:44:08.125966
====================================================================================================
ğŸ“‹ Session ID: classify_1756763048
â±ï¸  Processing Time: 1.583s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (554 chars):
   [UTENTE] cosa include il pacchettp p [ASSISTENTE] Non ho trovato informazioni specifiche sul "pacchetto p" nei documenti caricati. Potresti fornirmi maggiori dettagli o chiarire a cosa ti riferisci...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (191 chars):
   {'predicted_label': 'altro', 'confidence': 0.2, 'motivation': 'Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "altro", "confidence": 0.9, "mo'}

ğŸ“Š Parsed Response:
   predicted_label: altro
   confidence: 0.2
   motivation: Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "altro", "confidence": 0.9, "mo
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.200
   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20.0%

ğŸ§  Reasoning/Motivation:
   Risposta non strutturata: **{"name": "classify_conversation", "arguments": {"predicted_label": "altro", "confidence": 0.9, "mo
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione ccf605d826c1597bbd0bab07e98349a7 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'altro' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 183
   ğŸ“Š Token totali: 631
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 631 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 183
   ğŸ“Š Token conversazione finale: 183
   ğŸ“Š Token totali: 631
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 634 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Salve, sto provando a mettermi in contatto con il dott. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2806 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 183
   ğŸ“Š Token totali stimati: 631
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Salve, sto provando a mettermi in contatto con il dott. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.75, 'motivation': "La conversazione verte sull'ottenere informazioni su come contattare un medico dell'ospedale Humanitas per una consulenza medica, quindi la categoria 'Servizi aziendali' Ã¨ appropriata.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:44:10.107871
====================================================================================================
ğŸ“‹ Session ID: classify_1756763050
â±ï¸  Processing Time: 1.896s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (634 chars):
   [UTENTE] Salve, sto provando a mettermi in contatto con il dott. Alessio D'Addona per mia madre che vive in Sicilia . Cosa posso fare per avere un suo parere medico? A quale numero o indirizzo mail...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (262 chars):
   {'confidence': 0.75, 'motivation': "La conversazione verte sull'ottenere informazioni su come contattare un medico dell'ospedale Humanitas per una consulenza medica, quindi la categoria 'Servizi aziendali' Ã¨ appropriata.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.75
   motivation: La conversazione verte sull'ottenere informazioni su come contattare un medico dell'ospedale Humanitas per una consulenza medica, quindi la categoria 'Servizi aziendali' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.750
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 75.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'ottenere informazioni su come contattare un medico dell'ospedale Humanitas per una consulenza medica, quindi la categoria 'Servizi aziendali' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 951ccc5caea77a23e36bc702b207137b classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 659
   ğŸ“Š Token totali: 1108
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1108 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 659
   ğŸ“Š Token conversazione finale: 659
   ğŸ“Š Token totali: 1108
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2194 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao lâ€™esito della tac era previsto per il 6/8, ma non ho ricevuto lâ€™sms che conferma la disponibilitÃ   [ASSISTENTE] Per i risultati del tuo esame, puoi visitare la pagina [Referti e Cartelle Cliniche - Humanitas](https://www.humanitas.it/info/referti-cartelle-cliniche/). Se hai bisogno ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 659
   ğŸ“Š Token totali stimati: 1108
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao lâ€™esito della tac era previsto per il 6/8, ma non ho ricevuto lâ€™sms che conferma la disponibilitÃ   [ASSISTENTE] Per i risultati del tuo esame, puoi visitare la pagina [Referti e Cartelle Cliniche - Humanitas](https://www.humanitas.it/info/referti-cartelle-cliniche/). Se hai bisogno ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'accesso ai referti delle analisi mediche, in particolare della TAC Total Body.", 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:44:12.010652
====================================================================================================
ğŸ“‹ Session ID: classify_1756763052
â±ï¸  Processing Time: 1.812s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2194 chars):
   [UTENTE] Ciao lâ€™esito della tac era previsto per il 6/8, ma non ho ricevuto lâ€™sms che conferma la disponibilitÃ   [ASSISTENTE] Per i risultati del tuo esame, puoi visitare la pagina [Referti e Carte...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (194 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'accesso ai referti delle analisi mediche, in particolare della TAC Total Body.", 'predicted_label': 'Referti e Cartelle Cliniche'}

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione verte sull'accesso ai referti delle analisi mediche, in particolare della TAC Total Body.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'accesso ai referti delle analisi mediche, in particolare della TAC Total Body.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 9e946e3fada5facef0175b5a16299824 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 241
   ğŸ“Š Token totali: 669
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 669 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 241
   ğŸ“Š Token conversazione finale: 241
   ğŸ“Š Token totali: 669
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 828 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] mi sono resa conto di avere dato un email sbagliata [ASSISTENTE] Capisco, potresti dirmi in quale contesto hai fornito l'email sbagliata? Ad esempio, Ã¨ per una prenotazione, un referto o un altro servizio? CosÃ¬ posso aiutarti al meglio. [UTENTE] durante la visita medica per un check up h..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 241
   ğŸ“Š Token totali stimati: 669
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] mi sono resa conto di avere dato un email sbagliata [ASSISTENTE] Capisco, potresti dirmi in quale contesto hai fornito l'email sbagliata? Ad esempio, Ã¨ per una prenotazione, un referto o un altro servizio? CosÃ¬ posso aiutarti al meglio. [UTENTE] durante la visita medica per un check up h..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione ruota attorno alla difficoltÃ  dell'utente nel recuperare i referti a causa di un'indirizzo email fornito in modo errato durante una visita medica per un check-up.", 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:44:13.993099
====================================================================================================
ğŸ“‹ Session ID: classify_1756763053
â±ï¸  Processing Time: 1.896s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (828 chars):
   [UTENTE] mi sono resa conto di avere dato un email sbagliata [ASSISTENTE] Capisco, potresti dirmi in quale contesto hai fornito l'email sbagliata? Ad esempio, Ã¨ per una prenotazione, un referto o u...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (267 chars):
   {'confidence': 0.95, 'motivation': "La conversazione ruota attorno alla difficoltÃ  dell'utente nel recuperare i referti a causa di un'indirizzo email fornito in modo errato durante una visita medica per un check-up.", 'predicted_label': 'Referti e Cartelle Cliniche'}

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione ruota attorno alla difficoltÃ  dell'utente nel recuperare i referti a causa di un'indirizzo email fornito in modo errato durante una visita medica per un check-up.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione ruota attorno alla difficoltÃ  dell'utente nel recuperare i referti a causa di un'indirizzo email fornito in modo errato durante una visita medica per un check-up.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f02d6532aa4af88efbaa8651d35afc07 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 178
   ğŸ“Š Token totali: 627
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 627 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 178
   ğŸ“Š Token conversazione finale: 178
   ğŸ“Š Token totali: 627
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 604 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non Ã¨ chiaro a chi devo fare la richiesta di ristampa del referto â€œTrascorsi 30 giorni dalla prima data utile di ritiro segnalata il referto potrÃ  essere ritirato in struttura previa richiesta di ristampa del documento.â€ [ASSISTENTE] Per richiedere la ristampa di un referto trascorsi 30 ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 178
   ğŸ“Š Token totali stimati: 627
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non Ã¨ chiaro a chi devo fare la richiesta di ristampa del referto â€œTrascorsi 30 giorni dalla prima data utile di ritiro segnalata il referto potrÃ  essere ritirato in struttura previa richiesta di ristampa del documento.â€ [ASSISTENTE] Per richiedere la ristampa di un referto trascorsi 30 ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': 'La conversazione verte sulla richiesta di ristampa del referto dopo i primi 30 giorni dalla data utile di ritiro.', 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:44:15.664604
====================================================================================================
ğŸ“‹ Session ID: classify_1756763055
â±ï¸  Processing Time: 1.581s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (604 chars):
   [UTENTE] Non Ã¨ chiaro a chi devo fare la richiesta di ristampa del referto â€œTrascorsi 30 giorni dalla prima data utile di ritiro segnalata il referto potrÃ  essere ritirato in struttura previa richi...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (201 chars):
   {'confidence': 0.95, 'motivation': 'La conversazione verte sulla richiesta di ristampa del referto dopo i primi 30 giorni dalla data utile di ritiro.', 'predicted_label': 'Referti e Cartelle Cliniche'}

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione verte sulla richiesta di ristampa del referto dopo i primi 30 giorni dalla data utile di ritiro.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sulla richiesta di ristampa del referto dopo i primi 30 giorni dalla data utile di ritiro.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione e302dfe2cbc01d2690863d3c98e1bd55 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 341
   ğŸ“Š Token totali: 789
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 789 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 341
   ğŸ“Š Token conversazione finale: 341
   ğŸ“Š Token totali: 789
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1134 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao effettuare unâ€™analisi del Microbiota giusto? [ASSISTENTE] SÃ¬, in Humanitas Ã¨ possibile effettuare l'analisi del microbiota. [...]  Posso aiutarti in altro?"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2837 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 341
   ğŸ“Š Token totali stimati: 789
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao effettuare unâ€™analisi del Microbiota giusto? [ASSISTENTE] SÃ¬, in Humanitas Ã¨ possibile effettuare l'analisi del microbiota. [...]  Posso aiutarti in altro?"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte principalmente sull'analisi del microbiota e sui relativi costi, pertanto la categoria 'Analisi' Ã¨ appropriata.", 'predicted_label': 'Analisi'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:44:17.396062
====================================================================================================
ğŸ“‹ Session ID: classify_1756763057
â±ï¸  Processing Time: 1.643s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1134 chars):
   [UTENTE] Ciao effettuare unâ€™analisi del Microbiota giusto? [ASSISTENTE] SÃ¬, in Humanitas Ã¨ possibile effettuare l'analisi del microbiota. Se hai bisogno di ulteriori informazioni o desideri sapere ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (202 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte principalmente sull'analisi del microbiota e sui relativi costi, pertanto la categoria 'Analisi' Ã¨ appropriata.", 'predicted_label': 'Analisi'}

ğŸ“Š Parsed Response:
   predicted_label: Analisi
   confidence: 0.95
   motivation: La conversazione verte principalmente sull'analisi del microbiota e sui relativi costi, pertanto la categoria 'Analisi' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte principalmente sull'analisi del microbiota e sui relativi costi, pertanto la categoria 'Analisi' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 50353d82f48f4c5ef464ef97647e8da7 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Analisi' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 357
   ğŸ“Š Token totali: 805
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 805 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 357
   ğŸ“Š Token conversazione finale: 357
   ğŸ“Š Token totali: 805
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1194 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] buongiorno non mi fa regiestrare al portale [ASSISTENTE] Se riscontri problemi con la registrazione al portale [Humanitas con te](https://www. [...]  Se hai bisogno di ulteriore assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2880 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 357
   ğŸ“Š Token totali stimati: 805
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] buongiorno non mi fa regiestrare al portale [ASSISTENTE] Se riscontri problemi con la registrazione al portale [Humanitas con te](https://www. [...]  Se hai bisogno di ulteriore assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte principalmente sulla difficoltÃ  dell'utente nel registrarsi al portale Humanitas con te e la richiesta di supporto per risolvere il problema.", 'predicted_label': 'Humanitas con te - Registrazione'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:44:19.320954
====================================================================================================
ğŸ“‹ Session ID: classify_1756763059
â±ï¸  Processing Time: 1.838s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1194 chars):
   [UTENTE] buongiorno non mi fa regiestrare al portale [ASSISTENTE] Se riscontri problemi con la registrazione al portale [Humanitas con te](https://www.humanitasconte.it), ti consiglio di verificare...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [73 more lines] ...
     Line 77: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (257 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte principalmente sulla difficoltÃ  dell'utente nel registrarsi al portale Humanitas con te e la richiesta di supporto per risolvere il problema.", 'predicted_label': 'Humanitas con te - Registrazione'}

ğŸ“Š Parsed Response:
   predicted_label: Humanitas con te - Registrazione
   confidence: 0.95
   motivation: La conversazione verte principalmente sulla difficoltÃ  dell'utente nel registrarsi al portale Humanitas con te e la richiesta di supporto per risolvere il problema.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte principalmente sulla difficoltÃ  dell'utente nel registrarsi al portale Humanitas con te e la richiesta di supporto per risolvere il problema.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 2e77586108f1d1380156bac81b4b3cec classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Humanitas con te - Registrazione' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 428
   ğŸ’¬ Token conversazione: 112
   ğŸ“Š Token totali: 540
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 540 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione originale: 112
   ğŸ“Š Token conversazione finale: 112
   ğŸ“Š Token totali: 540
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 371 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] buongiorno, ho effettuato una TAC i cui risultati dovevano essere disponbili dal 26/06 ma non vedo ancora nulla: come Ã¨ possibile? [ASSISTENTE] Per i risultati del tuo esame, puoi visitare la pagina [Referti e Cartelle Cliniche - Humanitas](https://www.humanitas.it/info/referti-cartelle-..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2896 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 428
   ğŸ“Š Token conversazione: 112
   ğŸ“Š Token totali stimati: 540
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] buongiorno, ho effettuato una TAC i cui risultati dovevano essere disponbili dal 26/06 ma non vedo ancora nulla: come Ã¨ possibile? [ASSISTENTE] Per i risultati del tuo esame, puoi visitare la pagina [Referti e Cartelle Cliniche - Humanitas](https://www.humanitas.it/info/referti-cartelle-..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione riguarda l'accesso ai risultati di un esame TAC, quindi la categoria piÃ¹ adatta Ã¨ 'Referti e Cartelle Cliniche'.", 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:44:21.108423
====================================================================================================
ğŸ“‹ Session ID: classify_1756763061
â±ï¸  Processing Time: 1.700s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (371 chars):
   [UTENTE] buongiorno, ho effettuato una TAC i cui risultati dovevano essere disponbili dal 26/06 ma non vedo ancora nulla: come Ã¨ possibile? [ASSISTENTE] Per i risultati del tuo esame, puoi visitare...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [72 more lines] ...
     Line 76: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (217 chars):
   {'confidence': 0.95, 'motivation': "La conversazione riguarda l'accesso ai risultati di un esame TAC, quindi la categoria piÃ¹ adatta Ã¨ 'Referti e Cartelle Cliniche'.", 'predicted_label': 'Referti e Cartelle Cliniche'}

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione riguarda l'accesso ai risultati di un esame TAC, quindi la categoria piÃ¹ adatta Ã¨ 'Referti e Cartelle Cliniche'.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda l'accesso ai risultati di un esame TAC, quindi la categoria piÃ¹ adatta Ã¨ 'Referti e Cartelle Cliniche'.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 4032f70a0bcb23f6e2dbd460bc3023fb classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 581
   ğŸ“Š Token totali: 1029
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1029 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 581
   ğŸ“Š Token conversazione finale: 581
   ğŸ“Š Token totali: 1029
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2072 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Il codice otp non arriva [ASSISTENTE] Se il codice OTP non arriva, ti consiglio di verificare che il numero di telefono o l'indirizzo email associato al tuo account sia corretto. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2924 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 581
   ğŸ“Š Token totali stimati: 1029
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Il codice otp non arriva [ASSISTENTE] Se il codice OTP non arriva, ti consiglio di verificare che il numero di telefono o l'indirizzo email associato al tuo account sia corretto. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.85, 'motivation': "La conversazione verte principalmente sull'assistenza tecnica per il recupero del codice OTP e la verifica delle informazioni di contatto dell'utente.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:44:23.067861
====================================================================================================
ğŸ“‹ Session ID: classify_1756763063
â±ï¸  Processing Time: 1.872s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2072 chars):
   [UTENTE] Il codice otp non arriva [ASSISTENTE] Se il codice OTP non arriva, ti consiglio di verificare che il numero di telefono o l'indirizzo email associato al tuo account sia corretto. Se il pro...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (228 chars):
   {'confidence': 0.85, 'motivation': "La conversazione verte principalmente sull'assistenza tecnica per il recupero del codice OTP e la verifica delle informazioni di contatto dell'utente.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.85
   motivation: La conversazione verte principalmente sull'assistenza tecnica per il recupero del codice OTP e la verifica delle informazioni di contatto dell'utente.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.850
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] 85.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte principalmente sull'assistenza tecnica per il recupero del codice OTP e la verifica delle informazioni di contatto dell'utente.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 510fe27ceb46d9af817065be7c2a555a classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 585
   ğŸ“Š Token totali: 1033
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1033 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 585
   ğŸ“Š Token conversazione finale: 585
   ğŸ“Š Token totali: 1033
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1705 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao! Ho parcheggiato la macchina fuori dall'ospedale. [...] 

Se hai bisogno di ulteriori indicazioni o informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2818 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione: 585
   ğŸ“Š Token totali stimati: 1033
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao! Ho parcheggiato la macchina fuori dall'ospedale. [...] 

Se hai bisogno di ulteriori indicazioni o informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.7, 'motivation': "La conversazione verte principalmente sull'accesso e i parcheggi dell'ospedale Humanitas, quindi la categoria 'Servizi aziendali' Ã¨ appropriata.", 'predicted_label': 'Servizi aziendali'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:44:25.098506
====================================================================================================
ğŸ“‹ Session ID: classify_1756763065
â±ï¸  Processing Time: 1.943s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1705 chars):
   [UTENTE] Ciao! Ho parcheggiato la macchina fuori dall'ospedale. Posso entrare con la macchina per prendere mio marito appena operato? [ASSISTENTE] SÃ¬, Ã¨ consentito l'accesso con l'auto fino all'ing...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (221 chars):
   {'confidence': 0.7, 'motivation': "La conversazione verte principalmente sull'accesso e i parcheggi dell'ospedale Humanitas, quindi la categoria 'Servizi aziendali' Ã¨ appropriata.", 'predicted_label': 'Servizi aziendali'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.7
   motivation: La conversazione verte principalmente sull'accesso e i parcheggi dell'ospedale Humanitas, quindi la categoria 'Servizi aziendali' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.700
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘] 70.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte principalmente sull'accesso e i parcheggi dell'ospedale Humanitas, quindi la categoria 'Servizi aziendali' Ã¨ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione d13af40e26d202b8f2818f74bfd165b3 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 449
   ğŸ’¬ Token conversazione: 278
   ğŸ“Š Token totali: 727
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 727 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione originale: 278
   ğŸ“Š Token conversazione finale: 278
   ğŸ“Š Token totali: 727
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 963 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] in data 27. [...]  

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral-nemo:latest
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 2759 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 449
   ğŸ“Š Token conversazione: 278
   ğŸ“Š Token totali stimati: 727
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {"confidence": 1, "motivation": "Richiesta info convenzioni viaggio", "predicted_label": "convenzioni_viaggio"}

user: "Non trovo l'id per scaricare il referto"
assistant: {"confidence": 1, "motivation": "Problema ID per ritiri referti e cartella clinica", "predicted_label": "problema_ritiro_referti_cartella_clinica"}

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {"confidence": 1, "motivation": "Problema tecnico di accesso al portale online", "predicted_label": "problema_accesso_portale"}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {"confidence": 1, "motivation": "Cambio delle informazioni anagrafiche richiesto", "predicted_label": "cambio_anagrafica"}





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] in data 27. [...]  

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'confidence': 0.95, 'motivation': "La conversazione verte sull'assenza del referto di un esame TACTOR00 sul portale Humanitas con te e sulle opzioni per recuperarlo.", 'predicted_label': 'Referti e Cartelle Cliniche'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T21:44:26.964084
====================================================================================================
ğŸ“‹ Session ID: classify_1756763066
â±ï¸  Processing Time: 1.777s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (963 chars):
   [UTENTE] in data 27.05.2025 ho fatto una TACTOR00, il referto sarebbero dovuto essere pronto in data 04.06.2025 ad oggi non e' presente sul portale humanitas con te e non ho ricevuto ancora sms di ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [75 more lines] ...
     Line 79: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral-nemo:latest
   temperature: 0.1
   max_tokens: 150
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (218 chars):
   {'confidence': 0.95, 'motivation': "La conversazione verte sull'assenza del referto di un esame TACTOR00 sul portale Humanitas con te e sulle opzioni per recuperarlo.", 'predicted_label': 'Referti e Cartelle Cliniche'}

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione verte sull'assenza del referto di un esame TACTOR00 sul portale Humanitas con te e sulle opzioni per recuperarlo.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione verte sull'assenza del referto di un esame TACTOR00 sul portale Humanitas con te e sulle opzioni per recuperarlo.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral-nemo:latest
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione d37b9fd3b006e134f1bec6fad76b43a7 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette Ã¨: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 448
   ğŸ’¬ Token conversazione: 230
   ğŸ“Š Token totali: 678
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 678 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 448
   ğŸ“Š Token conversazione originale: 230
   ğŸ“Š Token conversazione finale: 230
   ğŸ“Š Token totali: 678
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 736 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
