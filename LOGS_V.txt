 ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ­ EmbeddingEngineFactory inizializzata
ğŸ¯ EmbeddingManager inizializzato
ğŸš€ UMAP disponibile per riduzione dimensionale!
ğŸš€ cuML GPU clustering disponibile!
ğŸ’¥ EmbeddingDestroyer inizializzato - Ready to destroy and rebuild!
ğŸ¯ SimpleEmbeddingManager inizializzato
âœ… Blueprint esempi inizializzato correttamente
ğŸ”„ [LLMConfigService] Configurazione ricaricata
ğŸ”§ [LLMConfigService] Servizio inizializzato con config: /home/ubuntu/classificatore/config.yaml
ğŸš€ Avvio server Flask - Debug: True
 * Serving Flask app 'server'
 * Debug mode: on
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
ğŸ” [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
ğŸ” [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
ğŸ” [DEBUG] GET review cases per tenant_id: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Creo oggetto Tenant da a0fd7600-f4f7-11ef-9315-96000228e7fe...
ğŸ¢ Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
ğŸ” [DEBUG] Recuperati 22 oggetti Tenant dal database
ğŸ” [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
ğŸ” [DEBUG] Invio risposta con 22 tenant
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Alleanza (alleanza) UUID=a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Tenant risolto: Alleanza (alleanza)
ğŸ” [DEBUG] Ottieni mongo reader per tenant: alleanza
ğŸ”§ Creazione MongoClassificationReader per cliente: alleanza
ğŸ” Risoluzione tenant da slug: alleanza
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Alleanza (alleanza) UUID=a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Tenant risolto: Alleanza (a0fd7600-f4f7-11ef-9315-96000228e7fe)
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant con oggetto Tenant...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto da slug (DB TAG locale): Alleanza (alleanza) UUID=a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… Tenant risolto da slug: Alleanza (a0fd7600-f4f7-11ef-9315-96000228e7fe)
ğŸ“Š Collection generata: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe per tenant Alleanza
âœ… MongoClassificationReader inizializzato per tenant: Alleanza
   ğŸ“Š Collection: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Alleanza (alleanza)
ğŸ“Š Collection generata: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe per tenant Alleanza
   ğŸ“Š Collection: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe per tenant Alleanza
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Alleanza
ğŸ“Š Calcolo statistiche per tenant: Alleanza
ğŸ” [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Creo oggetto Tenant da a0fd7600-f4f7-11ef-9315-96000228e7fe...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Alleanza (alleanza) UUID=a0fd7600-f4f7-11ef-9315-96000228e7fe
âœ… [DEBUG] Tenant risolto: Alleanza (a0fd7600-f4f7-11ef-9315-96000228e7fe)
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant con oggetto Tenant...
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ” [DEBUG] GET review cases per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] GET /api/prompts/015007d9-d413-11ef-86a5-96000228e7fe/status - Avvio richiesta
ğŸ” [DEBUG] API: Recupero status prompt per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
âœ… [DEBUG] Riconosciuto come tenant_id UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Inizializzo PromptManager...
ğŸ” [DEBUG] Creo oggetto Tenant da 015007d9-d413-11ef-86a5-96000228e7fe...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… [DEBUG] Tenant risolto: Humanitas (humanitas)
ğŸ” [DEBUG] Ottieni mongo reader per tenant: humanitas
ğŸ”§ Creazione MongoClassificationReader per cliente: humanitas
ğŸ” Risoluzione tenant da slug: humanitas
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… [DEBUG] Tenant risolto: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” [DEBUG] Chiamo get_all_prompts_for_tenant con oggetto Tenant...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto da slug (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da slug: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ“Š Calcolo statistiche per tenant: Humanitas
ğŸ” [DEBUG] Recuperati 5 prompt dal PromptManager
ğŸ” [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
âœ… [DEBUG] Status calcolato: {'success': True, 'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-09-01T23:12:42', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
âœ… [DEBUG] Status prompt per tenant_id 015007d9-d413-11ef-86a5-96000228e7fe: 5/5 attivi
ğŸ” [DEBUG] Invio risposta JSON per status prompt
ğŸ” API: Recupero prompt per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ”§ API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
Connessione al database TAG stabilita con successo
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 22, 49, 50)}
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 22, 49, 50), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
âœ… Recuperati 5 prompt per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 22, 49, 50), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ” API: Recupero prompt per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
âœ… Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Recuperati 5 prompt per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
âœ… Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
âœ… Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ­ EmbeddingEngineFactory inizializzata
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“‹ Caricamento parametri LLM specifici per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ¯ Config LLM caricata per 015007d9-d413-11ef-86a5-96000228e7fe (fonte: tenant_specific)
   ğŸ“ Max output tokens: 550
   ğŸ“Š Max input tokens: 8000
   ğŸŒ¡ï¸  Temperature: 0.01
   ğŸ”¢ Top K: 40, Top P: 0.9
ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ FORCE NO CACHE: Bypass cache per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”¥ FORCE NO CACHE: Bypasso cache e leggo DIRETTAMENTE dal database per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 22, 49, 50)}
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 22, 49, 50), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ” DATABASE CONFIG DEBUG per 015007d9-d413-11ef-86a5-96000228e7fe: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'embedding_engine': {'current': 'labse', 'config': {}, 'available_engines': ['labse', 'bge_m3', 'openai_large', 'openai_small']}, 'llm_model': {'current': 'mistral-nemo:latest', 'config': {}, 'available_models': ['mistral-nemo:latest', 'gpt-oss:20b', 'mistral:7b', 'llama3.3:70b-instruct-q2_K']}, 'status': {'embedding_engine_ok': True, 'llm_model_ok': True, 'overall_status': 'ok'}, 'last_updated': '2025-09-01T22:49:50', 'source': 'database', 'updated_at': datetime.datetime(2025, 9, 1, 22, 49, 50)}
ğŸ² DATABASE LEGACY: Modello trovato per 015007d9-d413-11ef-86a5-96000228e7fe: mistral-nemo:latest
ğŸ¯ Uso modello dal DATABASE per 015007d9-d413-11ef-86a5-96000228e7fe: mistral-nemo:latest
ğŸ” LLM Debugger inizializzato e ATTIVO
   ğŸ“ Debug file: ./debug_logs/llm_debug.log
   ğŸ¨ Visual formatting: True
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
ğŸ—„ï¸ MongoClassificationReader inizializzato per tenant: Humanitas
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
Connessione al database TAG stabilita con successo
ğŸ“‹ Recuperati 31 tag dal database TAGS per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
ğŸ“Š Caricamento config SEPARATA per embedding
ğŸ”§ TokenizationManager inizializzato:
   ğŸ“Š Modello tokenizer: cl100k_base
   ğŸ”¢ Limite massimo token: 8000
   âœ‚ï¸  Strategia troncamento: start
ğŸ“‹ Caricamento parametri LLM specifici per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“‹ [API] Parametri LLM per tenant 015007d9-d413-11ef-86a5-96000228e7fe (fonte: tenant_specific)
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
ğŸ“‹ [LLMConfigService] Modelli ricaricati e cached: 4
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ“‹ [API] Info modello mistral-nemo:latest recuperate
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“‹ Caricamento parametri LLM specifici per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ¯ Config LLM caricata per 015007d9-d413-11ef-86a5-96000228e7fe (fonte: tenant_specific)
   ğŸ“ Max output tokens: 550
   ğŸ“Š Max input tokens: 8000
   ğŸŒ¡ï¸  Temperature: 0.01
   ğŸ”¢ Top K: 40, Top P: 0.9
ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ FORCE NO CACHE: Bypass cache per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”¥ FORCE NO CACHE: Bypasso cache e leggo DIRETTAMENTE dal database per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 22, 49, 50)}
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 22, 49, 50), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
ğŸ” DATABASE CONFIG DEBUG per 015007d9-d413-11ef-86a5-96000228e7fe: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'embedding_engine': {'current': 'labse', 'config': {}, 'available_engines': ['labse', 'bge_m3', 'openai_large', 'openai_small']}, 'llm_model': {'current': 'mistral-nemo:latest', 'config': {}, 'available_models': ['mistral-nemo:latest', 'gpt-oss:20b', 'mistral:7b', 'llama3.3:70b-instruct-q2_K']}, 'status': {'embedding_engine_ok': True, 'llm_model_ok': True, 'overall_status': 'ok'}, 'last_updated': '2025-09-01T22:49:50', 'source': 'database', 'updated_at': datetime.datetime(2025, 9, 1, 22, 49, 50)}
ğŸ² DATABASE LEGACY: Modello trovato per 015007d9-d413-11ef-86a5-96000228e7fe: mistral-nemo:latest
ğŸ¯ Uso modello dal DATABASE per 015007d9-d413-11ef-86a5-96000228e7fe: mistral-nemo:latest
ğŸ” LLM Debugger inizializzato e ATTIVO
   ğŸ“ Debug file: ./debug_logs/llm_debug.log
   ğŸ¨ Visual formatting: True
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
ğŸ—„ï¸ MongoClassificationReader inizializzato per tenant: Humanitas
ğŸ“‹ [LLMConfigService] Modelli ricaricati e cached: 4
ğŸ“‹ [API] Modelli disponibili per tenant 015007d9-d413-11ef-86a5-96000228e7fe: 4
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 0s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 0s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 0s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
Connessione al database TAG stabilita con successo
ğŸ“‹ Recuperati 31 tag dal database TAGS per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
ğŸ“Š Caricamento config SEPARATA per embedding
ğŸ”§ TokenizationManager inizializzato:
   ğŸ“Š Modello tokenizer: cl100k_base
   ğŸ”¢ Limite massimo token: 8000
   âœ‚ï¸  Strategia troncamento: start
ğŸ“‹ Caricamento parametri LLM specifici per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“‹ [API] Parametri LLM per tenant 015007d9-d413-11ef-86a5-96000228e7fe (fonte: tenant_specific)
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 0s)
ğŸ“‹ [API] Modelli disponibili per tenant 015007d9-d413-11ef-86a5-96000228e7fe: 4
ğŸ” [DEBUG] get_model_info cercando: mistral-nemo:latest
â™»ï¸  [LLMConfigService] Uso cache modelli: 4 modelli (etÃ : 0s)
ğŸ” [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
âœ… [DEBUG] Modello mistral-nemo:latest trovato nei configurati
ğŸ“‹ [API] Info modello mistral-nemo:latest recuperate
ğŸ” [DEBUG] Salvataggio LLM: tenant_id=015007d9-d413-11ef-86a5-96000228e7fe, model_name=mistral:7b
ğŸ” [DEBUG] Upsert query: 
            INSERT INTO engines (tenant_id, tenant_name, tenant_slug, llm_engine, llm_config)
            VALUES (%s, %s, %s, %s, %s)
            ON DUPLICATE KEY UPDATE
                llm_engine = VALUES(llm_engine),
                llm_config = VALUES(llm_config),
                updated_at = CURRENT_TIMESTAMP
            
ğŸ” [DEBUG] Parametri: (015007d9-d413-11ef-86a5-96000228e7fe, Humanitas, humanitas, mistral:7b, None)
ğŸ—‘ï¸ Cache configurazioni invalidata dopo modifica LLM engine
ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ­ LLM Factory inizializzato con cache invalidation intelligente
â„¹ï¸  Nessuna cache da invalidare per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ—‘ï¸ Cache LLMFactory invalidata per tenant 015007d9-d413-11ef-86a5-96000228e7fe
âœ… Modello LLM 'mistral:7b' impostato per tenant 'Humanitas'
ï¿½}  Kï¿½fï¿½ï¿½  ï¿½ï¿½nï¿½ï¿½}  Huï¿½     ï¿½ï¿½fï¿½ï¿½  `ï¿½nï¿½ï¿½}  ï¿½ï¿½ï¿½ï¿½} ğŸ”„ [API] Reload LLM configuration (solo config, NO pipeline) per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 23, 21, 12)}
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 23, 21, 12), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
âœ… [API] Configurazione LLM aggiornata per 015007d9-d413-11ef-86a5-96000228e7fe: modello={'current': 'mistral:7b', 'config': {}, 'available_models': ['mistral-nemo:latest', 'gpt-oss:20b', 'mistral:7b', 'llama3.3:70b-instruct-q2_K']}
ğŸš€ [API] Pipeline completa sarÃ  caricata solo quando necessaria (test/training/classificazione)
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 23, 21, 12), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ¯ [CLUSTERING CONFIG] Caricando parametri personalizzati per tenant 015007d9-d413-11ef-86a5-96000228e7fe
   allow_single_cluster: non_definito -> False
   alpha: non_definito -> 0.4
   cluster_selection_epsilon: non_definito -> 0.28
   cluster_selection_method: non_definito -> leaf
   max_cluster_size: non_definito -> 0
   metric: non_definito -> euclidean
   min_cluster_size: 5 -> 13
   min_samples: 3 -> 16
   only_user: non_definito -> False
   umap_metric: non_definito -> cosine
   umap_min_dist: non_definito -> 0
   umap_n_components: non_definito -> 17
   umap_n_neighbors: non_definito -> 30
   umap_random_state: non_definito -> 42
   use_umap: non_definito -> True
ğŸ“ˆ [API] Recuperato storico clustering: 41 versioni per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ¯ [CLUSTERING CONFIG] Caricando parametri personalizzati per tenant 015007d9-d413-11ef-86a5-96000228e7fe
   allow_single_cluster: non_definito -> False
   alpha: non_definito -> 0.4
   cluster_selection_epsilon: non_definito -> 0.28
   cluster_selection_method: non_definito -> leaf
   max_cluster_size: non_definito -> 0
   metric: non_definito -> euclidean
   min_cluster_size: 5 -> 13
   min_samples: 3 -> 16
   only_user: non_definito -> False
   umap_metric: non_definito -> cosine
   umap_min_dist: non_definito -> 0
   umap_n_components: non_definito -> 17
   umap_n_neighbors: non_definito -> 30
   umap_random_state: non_definito -> 42
   use_umap: non_definito -> True
ğŸ“ˆ [API] Recuperato storico clustering: 41 versioni per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“Š [API] Recuperata versione 41 per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 23, 21, 12), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
ğŸ” API: Recupero prompt per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
Connessione al database TAG stabilita con successo
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 23, 21, 12), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
âœ… Recuperati 5 prompt per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ”§ API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” API: Recupero prompt per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
âœ… Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
âœ… Recuperati 5 prompt per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
âœ… Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
âœ… Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ” [DEBUG] GET review cases per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… [DEBUG] Tenant risolto: Humanitas (humanitas)
ğŸ” [DEBUG] Ottieni mongo reader per tenant: humanitas
ğŸ”§ Creazione MongoClassificationReader per cliente: humanitas
ğŸ” Risoluzione tenant da slug: humanitas
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto da slug (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
âœ… Tenant risolto da slug: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
âœ… MongoClassificationReader creato per tenant: Humanitas (humanitas)
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
âœ… Connesso a MongoDB database: classificazioni
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ” Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
ğŸ·ï¸ Recupero etichette per tenant: Humanitas
ğŸ“Š Calcolo statistiche per tenant: Humanitas
ğŸ¯ TRAINING SUPERVISIONATO - Cliente: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“‹ Parametri utente semplificati:
  ï¿½ Max sessioni review: 500
  ğŸ¯ Soglia confidenza: 0.95
  ğŸ”„ Forza review: True
  âš–ï¸  Soglia disagreement: 0.3
ğŸ”§ Inizializzazione pipeline per cliente: 015007d9-d413-11ef-86a5-96000228e7fe (con lock)
âš ï¸ [PIPELINE] DEPRECATO: uso di tenant_slug '015007d9-d413-11ef-86a5-96000228e7fe' - convertendo a oggetto Tenant
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”„ [PIPELINE] Conversione completata: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
âœ… [CONFIG] Configurazione base caricata da /home/ubuntu/classificatore/Utils/../config.yaml
ğŸ¯ [PIPELINE CLUSTERING CONFIG] Caricati parametri personalizzati per tenant 015007d9-d413-11ef-86a5-96000228e7fe:
   allow_single_cluster: non_definito -> False
   alpha: non_definito -> 0.4
   cluster_selection_epsilon: non_definito -> 0.28
   cluster_selection_method: non_definito -> leaf
   max_cluster_size: non_definito -> 0
   metric: non_definito -> euclidean
   min_cluster_size: 5 -> 13
   min_samples: 3 -> 16
   only_user: non_definito -> False
   umap_metric: non_definito -> cosine
   umap_min_dist: non_definito -> 0
   umap_n_components: non_definito -> 17
   umap_n_neighbors: non_definito -> 30
   umap_random_state: non_definito -> 42
   use_umap: non_definito -> True

ğŸš€ [FASE 1: INIZIALIZZAZIONE] Avvio pipeline...
ğŸ¥ [FASE 1: INIZIALIZZAZIONE] Tenant: humanitas
ğŸ¯ [FASE 1: INIZIALIZZAZIONE] Configurazione:
   ğŸ“Š Confidence threshold: 0.7
   ğŸ¤– Auto mode: True
   ğŸ”„ Auto retrain: False
ï¿½ [FASE 1: INIZIALIZZAZIONE] Inizializzazione lettore conversazioni...
âœ… [CONFIG] Configurazione base caricata da /home/ubuntu/classificatore/Utils/../config.yaml
âœ… [CONFIG] Config personalizzata tenant 015007d9-d413-11ef-86a5-96000228e7fe: 15 parametri
ğŸ¯ [ONLY_USER] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: False (da config personalizzata)
ğŸ¯ [LETTORE] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: only_user = False (da config tenant)
ï¿½ [FASE 1: INIZIALIZZAZIONE] Inizializzazione aggregator...
   ğŸ” Schema: 'humanitas'
   ğŸ†” Tenant ID: '015007d9-d413-11ef-86a5-96000228e7fe'
ğŸ¯ [SESSION AGGREGATOR] Inizializzazione con oggetto Tenant: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ¯ [ONLY_USER] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: False (da config personalizzata)
ğŸ¯ [LETTORE] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: only_user = False (da config tenant)
ï¿½ [ONLY_USER] Schema None: False (legacy - no tenant_id)
ğŸ§  [FASE 1: INIZIALIZZAZIONE] Sistema embedder dinamico (lazy loading)
ğŸ”§ [FASE 1: INIZIALIZZAZIONE] Parametri clustering:
   ğŸ“Š Min cluster size: 13
   ğŸ“Š Min samples: 16
ğŸ› DEBUG CLUSTER_ALPHA - PRIMA:
   ğŸ“‹ clustering_config.get('alpha', 1.0): 0.4
   ğŸ“‹ Type: <class 'float'>
ğŸ› DEBUG CLUSTER_ALPHA - DOPO CONVERSIONE:
   ğŸ“‹ cluster_alpha: 0.4
   ğŸ“‹ Type: <class 'float'>
ğŸ› DEBUG CLUSTER_ALPHA - FINALE:
   ğŸ“‹ cluster_alpha finale: 0.4
   ğŸ“‹ Type finale: <class 'float'>
   ğŸ“‹ Alpha > 0: True
âœ… [CONFIG] Config personalizzata tenant 015007d9-d413-11ef-86a5-96000228e7fe: 15 parametri
ğŸ—‚ï¸  [UMAP] Parametri per tenant 015007d9-d413-11ef-86a5-96000228e7fe:
   use_umap: True
   n_neighbors: 30
   min_dist: 0
   n_components: 17
   metric: cosine
ğŸ”§ [FIX DEBUG] Parametri tenant passati a HDBSCANClusterer:
   min_cluster_size: 13
   min_samples: 16
   alpha: 0.4
   cluster_selection_method: leaf
   cluster_selection_epsilon: 0.28
   metric: euclidean
   allow_single_cluster: False
   max_cluster_size: 0
   ğŸ—‚ï¸  use_umap: True
   ğŸ—‚ï¸  umap_n_neighbors: 30
   ğŸ—‚ï¸  umap_min_dist: 0
   ğŸ—‚ï¸  umap_n_components: 17
ğŸ¯ [BERTOPIC] Parametri consistenti configurati:
   ğŸ“Š HDBSCAN: 10 parametri
   ğŸ“Š UMAP: 5 parametri
ğŸ”§ HDBSCANClusterer inizializzato:
   min_cluster_size: 13
   min_samples: 16
   metric: euclidean
   cluster_selection_epsilon: 0.28
   ğŸ—‚ï¸  UMAP enabled: True
     ğŸ“ n_neighbors: 30
     ğŸ“ min_dist: 0
     ğŸ“Š n_components: 17
     ğŸ¯ metric: cosine
   ğŸš€ GPU enabled: True
   ğŸ’¾ GPU memory limit: 80%
   ğŸ”„ CPU fallback: True
   âš ï¸  [GPU MODE] Limitazioni cuML HDBSCAN:
     ğŸš« leaf_size=40 sarÃ  IGNORATO su GPU
     âœ… Parametri supportati: cluster_selection_method, alpha, allow_single_cluster
ğŸ¯ [DEBUG REACT] Parametri configurati:
   cluster_selection_method: leaf
   alpha: 0.4
   allow_single_cluster: False
ğŸ§  Inizializzazione memoria semantica...
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
ğŸ“Š Caricamento config SEPARATA per embedding
ğŸ”§ TokenizationManager inizializzato:
   ğŸ“Š Modello tokenizer: cl100k_base
   ğŸ”¢ Limite massimo token: 8000
   âœ‚ï¸  Strategia troncamento: start
âœ… TokenizationManager integrato in LaBSE per gestione conversazioni lunghe
ğŸš€ Inizializzazione LaBSE embedder su device: cuda
ğŸ“¥ Caricamento modello sentence-transformers/LaBSE...
ğŸš€ Caricamento diretto su GPU...
âœ… Modello caricato con successo!
ğŸ“Š Dimensione embedding: 768
ğŸ”§ Device: cuda
ğŸ® GPU: NVIDIA A10G
ğŸ’¾ GPU Memory: 23.7 GB
ğŸ“ˆ GPU Memory utilizzata: 1.89 GB
ï¿½ Primo parametro su device: cuda:0
ğŸ§ª Test del modello LaBSE...
ğŸ” Encoding 3 testi con LaBSE su device cuda...

ğŸ” TOKENIZZAZIONE PREVENTIVA LABSE CLUSTERING
============================================================
ğŸ” ELABORAZIONE CONVERSAZIONI PER CLUSTERING
   ğŸ“Š Numero conversazioni: 3
   ğŸ†” Session IDs forniti: No

ğŸ“Š STATISTICHE ELABORAZIONE:
   ğŸ”¢ Conversazioni totali: 3
   âœ‚ï¸  Conversazioni troncate: 0
   ğŸ“ Token originali totali: 20
   ğŸ“ Token finali totali: 20
   ğŸ“Š Range token: 6 - 7
âœ… Tokenizzazione LaBSE completata:
   ğŸ“Š Conversazioni processate: 3
   ğŸ“Š Conversazioni troncate: 0
   ğŸ“Š Token limite configurato: 8000
   âœ… Tutte le conversazioni entro i limiti, nessun troncamento
============================================================
âœ… Embedding generati: shape (3, 768)
âœ… Test modello completato con successo!
   Shape: (3, 768)
   Norme: [0.99999994 1.         1.        ]
   Device: cuda
ğŸ¯ Modello pronto per l'uso!
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
ğŸ§  SemanticMemoryManager inizializzato
  ğŸ¯ Soglia riutilizzo etichette: 0.8
  ğŸ” Soglia similaritÃ  semantica: 0.8
  ğŸ’¾ Cache path: semantic_cache/humanitas_015007d9_memory
ğŸ”— Inizializzazione ensemble classifier avanzato...
ğŸ” ML Ensemble Debugger inizializzato e ATTIVO
   ğŸ“ Debug file: ./debug_logs/ml_debug.log
ğŸ” ML Ensemble Debugger attivato
ğŸ”§ Tentativo di inizializzazione IntelligentClassifier tramite LLMFactory...
ğŸ§  GPU Memory prima di LLM: 1.8GB/22.1GB (free: 20.3GB)
âœ… Memoria GPU sufficiente, inizializzazione LLM tramite Factory...
ğŸ” LLM FACTORY DEBUG: Chiamata ai_config_service.get_tenant_configuration(humanitas) normale...
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id humanitas
ğŸ” [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 23, 21, 12)}
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 23, 21, 12), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
ğŸ¯ LLM FACTORY DEBUG: Modello normale = 'mistral:7b'
ğŸ”§ Creazione LLM classifier mistral:7b per tenant humanitas
ğŸš€ LLM FACTORY DEBUG: Avvio creazione nuovo classifier modello 'mistral:7b'
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
âœ… Tenant risolto da slug (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“‹ Caricamento parametri LLM specifici per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ¯ Config LLM caricata per 015007d9-d413-11ef-86a5-96000228e7fe (fonte: tenant_specific)
   ğŸ“ Max output tokens: 550
   ğŸ“Š Max input tokens: 8000
   ğŸŒ¡ï¸  Temperature: 0.01
   ğŸ”¢ Top K: 40, Top P: 0.9
ğŸ¯ Uso modello esplicito: mistral:7b
ğŸ” LLM Debugger inizializzato e ATTIVO
   ğŸ“ Debug file: ./debug_logs/llm_debug.log
   ğŸ¨ Visual formatting: True
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
ğŸ—„ï¸ MongoClassificationReader inizializzato per tenant: Humanitas
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
Connessione al database TAG stabilita con successo
ğŸ“‹ Recuperati 31 tag dal database TAGS per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
ğŸ“Š Caricamento config SEPARATA per embedding
ğŸ”§ TokenizationManager inizializzato:
   ğŸ“Š Modello tokenizer: cl100k_base
   ğŸ”¢ Limite massimo token: 8000
   âœ‚ï¸  Strategia troncamento: start
âœ… LLM FACTORY DEBUG: Nuovo classifier creato: mistral:7b
âœ… LLM Classifier mistral:7b (mistral:7b) creato e cached per tenant humanitas
ğŸ­ LLM classifier ottenuto tramite Factory per tenant humanitas
ğŸ¤– LLM classifier creato automaticamente nell'ensemble: mistral:7b
ğŸ’¡ Possibile fine-tuning per humanitas
ğŸ”— Advanced Ensemble Classifier inizializzato
   ğŸ§  LLM weight: 0.60
   ğŸ¤– ML weight: 0.40
   ğŸ¯ Confidence threshold: 0.7
   ğŸ”„ Adaptive weights: True
   ğŸ‘¤ Disaccordi gestiti da QualityGateEngine
ğŸ“¥ Caricamento ultimo modello per humanitas: humanitas_015007d9_20250901_180026
ğŸ“¥ Caricamento ensemble model...
âœ… ML ensemble caricato
âœ… Configurazione caricata
ğŸ”— Ensemble model caricato da models/humanitas_015007d9_20250901_180026
âœ… Modello caricato con successo

ğŸ” VERIFICA BERTOPIC LOADING:
   ğŸ“‹ BERTopic enabled: True
   ğŸ“‹ BERTopic available: True
   ğŸ“ Provider directory: models/humanitas_015007d9_20250901_180026_bertopic
   ğŸ“ Directory exists: True
   ï¿½ File trovati: 3 -> ['metadata.json', 'bertopic_model', 'svd_model.pkl']

ğŸ”„ CARICAMENTO BERTOPIC:
   ğŸ“ Path completo: /home/ubuntu/classificatore/models/humanitas_015007d9_20250901_180026_bertopic
ğŸ”„ Caricamento BERTopic model da models/humanitas_015007d9_20250901_180026_bertopic/bertopic_model
âœ… BERTopic model caricato con successo
ğŸ“¥ SVD caricato (svd_model.pkl)
   â±ï¸ Caricamento completato in 0.22 secondi
   âœ… BERTopic provider caricato con successo
ğŸ”— BERTopic provider impostato (top_k=10, one_hot=False)
   âœ… BERTopic provider configurato nell'ensemble
â¸ï¸ Riaddestramento automatico disabilitato (modalitÃ  supervisione/API)
   ğŸ’¡ Per abilitare, usare auto_retrain=True nell'inizializzazione
âœ… Classificatore LLM disponibile nell'ensemble
ğŸ‘¤ Inizializzazione trainer interattivo...
ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
âœ… MongoClassificationReader inizializzato per tenant: Humanitas
   ğŸ“Š Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   ğŸ¢ Database: classificazioni
ğŸ¯ SIMPLE MANAGER: Usando oggetto Tenant Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
ğŸ“¥ Primo embedder - creazione per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸš€ CREATING FRESH EMBEDDER per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ›ï¸ Configurazioni AI saranno salvate su DATABASE MySQL
ğŸ›ï¸ AIConfigurationService inizializzato
   ï¿½ Backend: DATABASE MySQL
   ğŸ”‘ OpenAI API Key: âœ… Configurata
ğŸ”„ DatabaseAI: ModalitÃ  legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”§ FORCE NO CACHE: Bypass cache per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ”¥ FORCE NO CACHE: Bypasso cache e leggo DIRETTAMENTE dal database per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ” [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 23, 21, 12)}
ğŸ” [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 23, 21, 12), 'embedding_config': {}, 'llm_config': {}}
ğŸ” [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
ğŸ” SIMPLE MANAGER: Engine da DB per 015007d9-d413-11ef-86a5-96000228e7fe = 'labse'
ğŸ¯ Engine configurato: labse
ğŸ”§ DIRECT CREATE: labse
ğŸ³ Tentativo connessione a servizio LaBSE dockerizzato...
ğŸ”— LaBSE Remote Client inizializzato
   ğŸ“¡ Service URL: http://localhost:8081
   â±ï¸  Timeout: 300s
   ğŸ”„ Max retries: 3
   ğŸ›¡ï¸ Fallback locale: True
ğŸ”§ Inizializzazione client remoto LaBSE...
âœ… Servizio embedding online e funzionante
âœ… Client remoto LaBSE inizializzato con successo
âœ… LaBSE Remote Client configurato con successo
âœ… FRESH EMBEDDER creato: LaBSERemoteClient per tenant 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ§  Inizializzazione dedupplicatore intelligente...
ğŸ’¾ [FASE 1: INIZIALIZZAZIONE] Caricamento memoria semantica...
ğŸ“¦ Memoria semantica caricata da cache (77 sessioni)
   ğŸ“Š Campioni: 75
   ğŸ·ï¸ Tag: 10
âœ… [FASE 1: INIZIALIZZAZIONE] Completata in 4.63s
ğŸ¯ [FASE 1: INIZIALIZZAZIONE] Pipeline pronta per l'uso!
âœ… Pipeline 015007d9-d413-11ef-86a5-96000228e7fe inizializzata
ğŸš€ TRAINING SUPERVISIONATO CON DATASET COMPLETO
  ğŸ“Š Estrazione: TUTTE le discussioni dal database
  ğŸ§© Clustering: Su tutto il dataset disponibile
  ğŸ‘¤ Review umana: Max 500 sessioni rappresentative
ğŸ¯ Confidence threshold aggiornato a: 0.95
ğŸ“ TRAINING SUPERVISIONATO AVANZATO
ï¿½ NUOVA LOGICA:
  ğŸ”„ Estrazione: TUTTE le discussioni dal database
  ğŸ§© Clustering: Su tutto il dataset completo
  ğŸ‘¤ Review umana: Massimo 500 sessioni rappresentative
--------------------------------------------------
ğŸ“Š FASE 1: ESTRAZIONE COMPLETA DATASET

ï¿½ [FASE 2: ESTRAZIONE] Avvio estrazione sessioni...
ğŸ¥ [FASE 2: ESTRAZIONE] Tenant: humanitas
ğŸ“… [FASE 2: ESTRAZIONE] Giorni indietro: 7
ğŸ”„ [FASE 2: ESTRAZIONE] ModalitÃ  COMPLETA attivata
ğŸ¯ [FASE 2: ESTRAZIONE] Ignorando limite - estrazione totale dataset
ï¿½ [FASE 2: ESTRAZIONE] ModalitÃ : COMPLETA
ï¿½ [FASE 2: ESTRAZIONE] Connessione database...
ğŸ“Š [DEBUG ONLY_USER] Estrazione sessioni aggregate dal schema 'humanitas'...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 434 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ã¨ possibile eseguire una visita dermatologica in ssn a Castellanza? [ASSISTENTE] SÃ¬, Ã¨ possibile eseguire una visita dermatologica tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater Domini a Castellanza. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4022 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 682
   ğŸ“Š Token conversazione: 124
   ğŸ“Š Token totali stimati: 806
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ã¨ possibile eseguire una visita dermatologica in ssn a Castellanza? [ASSISTENTE] SÃ¬, Ã¨ possibile eseguire una visita dermatologica tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater Domini a Castellanza. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un\'esame dermatologico tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater Domini a Castellanza, quindi Ã¨ stata classificata come "Prenotazione". Il livello di confidenza Ã¨ alto perchÃ© la richiesta Ã¨ chiara e specifica.'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:23:57.493134
====================================================================================================
ğŸ“‹ Session ID: classify_1756769037
â±ï¸  Processing Time: 1.358s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (434 chars):
   [UTENTE] Ã¨ possibile eseguire una visita dermatologica in ssn a Castellanza? [ASSISTENTE] SÃ¬, Ã¨ possibile eseguire una visita dermatologica tramite il Servizio Sanitario Nazionale (SSN) presso Huma...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (357 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un\'esame dermatologico tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater Domini a Castellanza, quindi Ã¨ stata classificata come "Prenotazione". Il livello di c...

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di un'esame dermatologico tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater Domini a Castellanza, quindi Ã¨ stata classificata come "Prenotazione". Il livello di confidenza Ã¨ alto perchÃ© la richiesta Ã¨ chiara e specifica.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un'esame dermatologico tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater Domini a Castellanza, quindi Ã¨ stata classificata come "Prenotazione". Il livello di confidenza Ã¨ alto perchÃ© la richiesta Ã¨ chiara e specifica.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 0e3eebf565d04b5c2e7b92bc92442f46 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 681
   ğŸ’¬ Token conversazione: 1502
   ğŸ“Š Token totali: 2183
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 2183 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 681
   ğŸ“Š Token conversazione originale: 1502
   ğŸ“Š Token conversazione finale: 1502
   ğŸ“Š Token totali: 2183
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 4728 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao giulia [ASSISTENTE] Ciao! Come posso esserti utile oggi? ğŸ˜Š [UTENTE] vorrei prenotare una colonscopia ma l'attesa telefonica Ã¨ troppo lunga e non ci sono posti [ASSISTENTE] Capisco la tua situazione. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 3997 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 681
   ğŸ“Š Token conversazione: 1502
   ğŸ“Š Token totali stimati: 2183
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao giulia [ASSISTENTE] Ciao! Come posso esserti utile oggi? ğŸ˜Š [UTENTE] vorrei prenotare una colonscopia ma l'attesa telefonica Ã¨ troppo lunga e non ci sono posti [ASSISTENTE] Capisco la tua situazione. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un esame medico e viene fornita una serie di opzioni per prenotare tramite il Servizio Sanitario Nazionale (SSN) o privatamente attraverso Humanitas con te.'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:23:59.301550
====================================================================================================
ğŸ“‹ Session ID: classify_1756769039
â±ï¸  Processing Time: 1.722s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (4728 chars):
   [UTENTE] ciao giulia [ASSISTENTE] Ciao! Come posso esserti utile oggi? ğŸ˜Š [UTENTE] vorrei prenotare una colonscopia ma l'attesa telefonica Ã¨ troppo lunga e non ci sono posti [ASSISTENTE] Capisco la ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (276 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un esame medico e viene fornita una serie di opzioni per prenotare tramite il Servizio Sanitario Nazionale (SSN) o privatamente attraverso Humanitas con te.'}

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di un esame medico e viene fornita una serie di opzioni per prenotare tramite il Servizio Sanitario Nazionale (SSN) o privatamente attraverso Humanitas con te.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un esame medico e viene fornita una serie di opzioni per prenotare tramite il Servizio Sanitario Nazionale (SSN) o privatamente attraverso Humanitas con te.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione d0b3dc36ee33f3f7c271e3bd1077b353 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 681
   ğŸ’¬ Token conversazione: 247
   ğŸ“Š Token totali: 928
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 928 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 681
   ğŸ“Š Token conversazione originale: 247
   ğŸ“Š Token conversazione finale: 247
   ğŸ“Š Token totali: 928
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 844 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ritiro referti  [ASSISTENTE] Puoi dirmi di quale tipo di referto hai bisogno? Ad esempio, se si tratta di un test HIV, esami istologici, citologici, tamponi, esami genetici o altro. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4026 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 681
   ğŸ“Š Token conversazione: 247
   ğŸ“Š Token totali stimati: 928
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ritiro referti  [ASSISTENTE] Puoi dirmi di quale tipo di referto hai bisogno? Ad esempio, se si tratta di un test HIV, esami istologici, citologici, tamponi, esami genetici o altro. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Referti e Cartelle Cliniche', 'confidence': 0.95, 'motivation': "La conversazione riguarda il ritiro di un referto del sangue, che Ã¨ una tipologia di referto clinico. Il fatto che l'utente sia invitato a registrarsi al portale online e inserire l'ID fornito all'accettazione indica che il referto puÃ² essere consultato online. Inoltre, viene suggerito di contattare il servizio dedicato per problemi con il ritiro del referto."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:01.029810
====================================================================================================
ğŸ“‹ Session ID: classify_1756769041
â±ï¸  Processing Time: 1.641s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (844 chars):
   [UTENTE] Ritiro referti  [ASSISTENTE] Puoi dirmi di quale tipo di referto hai bisogno? Ad esempio, se si tratta di un test HIV, esami istologici, citologici, tamponi, esami genetici o altro. Alcuni...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [105 more lines] ...
     Line 109: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (449 chars):
   {'predicted_label': 'Referti e Cartelle Cliniche', 'confidence': 0.95, 'motivation': "La conversazione riguarda il ritiro di un referto del sangue, che Ã¨ una tipologia di referto clinico. Il fatto che l'utente sia invitato a registrarsi al portale online e inserire l'ID fornito all'accettazione i...

ğŸ“Š Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione riguarda il ritiro di un referto del sangue, che Ã¨ una tipologia di referto clinico. Il fatto che l'utente sia invitato a registrarsi al portale online e inserire l'ID fornito all'accettazione indica che il referto puÃ² essere consultato online. Inoltre, viene suggerito di contattare il servizio dedicato per problemi con il ritiro del referto.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda il ritiro di un referto del sangue, che Ã¨ una tipologia di referto clinico. Il fatto che l'utente sia invitato a registrarsi al portale online e inserire l'ID fornito all'accettazione indica che il referto puÃ² essere consultato online. Inoltre, viene suggerito di contattare il servizio dedicato per problemi con il ritiro del referto.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione e7be267dbf5f1a7a83384050226d0eea classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Referti e Cartelle Cliniche' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 681
   ğŸ’¬ Token conversazione: 877
   ğŸ“Š Token totali: 1558
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1558 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 681
   ğŸ“Š Token conversazione originale: 877
   ğŸ“Š Token conversazione finale: 877
   ğŸ“Š Token totali: 1558
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2780 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno

vorrei maggiori informazioni riguardo delle analisi fecali. [...]  Se hai bisogno di altro, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 3897 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 681
   ğŸ“Š Token conversazione: 877
   ğŸ“Š Token totali stimati: 1558
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno

vorrei maggiori informazioni riguardo delle analisi fecali. [...]  Se hai bisogno di altro, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Analisi', 'confidence': 0.98, 'motivation': 'La conversazione riguarda la richiesta di informazioni su alcune analisi fecali e sulle possibilitÃ  di effettuare altre analisi specifiche. Il classificatore ha identificato questa conversazione come "Analisi" in quanto il contenuto Ã¨ chiaramente correlato a questo argomento.'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:02.649305
====================================================================================================
ğŸ“‹ Session ID: classify_1756769042
â±ï¸  Processing Time: 1.532s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2780 chars):
   [UTENTE] Buongiorno

vorrei maggiori informazioni riguardo delle analisi fecali.

In particolare, vorrei sapere se fate le seguenti analisi:
- Test metagenomico per lo studio funzionale
- Sequenzia...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [105 more lines] ...
     Line 109: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (344 chars):
   {'predicted_label': 'Analisi', 'confidence': 0.98, 'motivation': 'La conversazione riguarda la richiesta di informazioni su alcune analisi fecali e sulle possibilitÃ  di effettuare altre analisi specifiche. Il classificatore ha identificato questa conversazione come "Analisi" in quanto il contenut...

ğŸ“Š Parsed Response:
   predicted_label: Analisi
   confidence: 0.98
   motivation: La conversazione riguarda la richiesta di informazioni su alcune analisi fecali e sulle possibilitÃ  di effettuare altre analisi specifiche. Il classificatore ha identificato questa conversazione come "Analisi" in quanto il contenuto Ã¨ chiaramente correlato a questo argomento.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.980
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 98.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la richiesta di informazioni su alcune analisi fecali e sulle possibilitÃ  di effettuare altre analisi specifiche. Il classificatore ha identificato questa conversazione come "Analisi" in quanto il contenuto Ã¨ chiaramente correlato a questo argomento.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 35f26aadee1b7e61bf62b16fbb8b7fa1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Analisi' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 681
   ğŸ’¬ Token conversazione: 440
   ğŸ“Š Token totali: 1121
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1121 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 681
   ğŸ“Š Token conversazione originale: 440
   ğŸ“Š Token conversazione finale: 440
   ğŸ“Š Token totali: 1121
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1584 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao, mi chiamo Ditjon, sonno dal Albania, ho un problema che dopo gli esami che ho fatto mi hanno detto hai, prostatite chrono non bacteriale, penso che le cause, perche non ho nessune bacterie in urina, in spermocultura, in af genital, e in swab test,le cause sonno, per prima Ibs soffr..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4062 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 681
   ğŸ“Š Token conversazione: 440
   ğŸ“Š Token totali stimati: 1121
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao, mi chiamo Ditjon, sonno dal Albania, ho un problema che dopo gli esami che ho fatto mi hanno detto hai, prostatite chrono non bacteriale, penso che le cause, perche non ho nessune bacterie in urina, in spermocultura, in af genital, e in swab test,le cause sonno, per prima Ibs soffr..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Visita Specialistica', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di una visita specialistica a un medico specializzato in dolore pelvico cronico presso l'ospedale Humanitas. Il chiarimento del problema e il suggerimento della pagina Ricerca Medici per trovare i professionisti disponibili sono elementi chiari che indicano una visita specialistica come la classificazione piÃ¹ appropriata."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:04.482520
====================================================================================================
ğŸ“‹ Session ID: classify_1756769044
â±ï¸  Processing Time: 1.746s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1584 chars):
   [UTENTE] Ciao, mi chiamo Ditjon, sonno dal Albania, ho un problema che dopo gli esami che ho fatto mi hanno detto hai, prostatite chrono non bacteriale, penso che le cause, perche non ho nessune ba...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (446 chars):
   {'predicted_label': 'Visita Specialistica', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di una visita specialistica a un medico specializzato in dolore pelvico cronico presso l'ospedale Humanitas. Il chiarimento del problema e il suggerimento della pagina Ricerca ...

ğŸ“Š Parsed Response:
   predicted_label: Visita Specialistica
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di una visita specialistica a un medico specializzato in dolore pelvico cronico presso l'ospedale Humanitas. Il chiarimento del problema e il suggerimento della pagina Ricerca Medici per trovare i professionisti disponibili sono elementi chiari che indicano una visita specialistica come la classificazione piÃ¹ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la prenotazione di una visita specialistica a un medico specializzato in dolore pelvico cronico presso l'ospedale Humanitas. Il chiarimento del problema e il suggerimento della pagina Ricerca Medici per trovare i professionisti disponibili sono elementi chiari che indicano una visita specialistica come la classificazione piÃ¹ appropriata.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione b4bde9666da046414472d7f5ad61ed56 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Visita Specialistica' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 661
   ğŸ’¬ Token conversazione: 49
   ğŸ“Š Token totali: 710
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 710 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 661
   ğŸ“Š Token conversazione originale: 49
   ğŸ“Š Token conversazione finale: 49
   ğŸ“Š Token totali: 710
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 155 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Risultato? [ASSISTENTE] Potresti specificare meglio la tua richiesta? Intendi il risultato di un esame, un referto o altro? Sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 3845 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 661
   ğŸ“Š Token conversazione: 49
   ğŸ“Š Token totali stimati: 710
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Risultato? [ASSISTENTE] Potresti specificare meglio la tua richiesta? Intendi il risultato di un esame, un referto o altro? Sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Referti e Cartelle Cliniche"', 'confidence': 0.95, 'motivation': 'La domanda sembra richiedere il risultato di un esame o un referto clinico, quindi la classificazione Ã¨ "Referti e Cartelle Cliniche".'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:05.483686
====================================================================================================
ğŸ“‹ Session ID: classify_1756769045
â±ï¸  Processing Time: 0.914s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (155 chars):
   [UTENTE] Risultato? [ASSISTENTE] Potresti specificare meglio la tua richiesta? Intendi il risultato di un esame, un referto o altro? Sono qui per aiutarti!

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (224 chars):
   {'predicted_label': '"Referti e Cartelle Cliniche"', 'confidence': 0.95, 'motivation': 'La domanda sembra richiedere il risultato di un esame o un referto clinico, quindi la classificazione Ã¨ "Referti e Cartelle Cliniche".'}

ğŸ“Š Parsed Response:
   predicted_label: "Referti e Cartelle Cliniche"
   confidence: 0.95
   motivation: La domanda sembra richiedere il risultato di un esame o un referto clinico, quindi la classificazione Ã¨ "Referti e Cartelle Cliniche".
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La domanda sembra richiedere il risultato di un esame o un referto clinico, quindi la classificazione Ã¨ "Referti e Cartelle Cliniche".
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f862ddcdeb6bacd0a3f391706106eb33 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Referti e Cartelle Cliniche"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 681
   ğŸ’¬ Token conversazione: 303
   ğŸ“Š Token totali: 984
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 984 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 681
   ğŸ“Š Token conversazione originale: 303
   ğŸ“Š Token conversazione finale: 303
   ğŸ“Š Token totali: 984
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1011 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] Sono la Sig. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 3931 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 681
   ğŸ“Š Token conversazione: 303
   ğŸ“Š Token totali stimati: 984
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] Sono la Sig. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Referti e Cartelle Cliniche"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la spedizione di un esame istologico effettuato dalla Sig.ra Mazzucco Gabriella il 15.04.2025. PoichÃ© si tratta di un referto clinico, Ã¨ stata classificata come "Referti e Cartelle Cliniche". La confidenza in questa classificazione Ã¨ alta perchÃ© la conversazione riguarda esplicitamente l\'esame istologico e il suo stato.'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:07.364311
====================================================================================================
ğŸ“‹ Session ID: classify_1756769047
â±ï¸  Processing Time: 1.791s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1011 chars):
   [UTENTE] Buongiorno, [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] Sono la Sig.ra Mazzucco Gabriella, io ho fatto una colonscopia il 15.04.2025 con esame istologico. Mi avevano d...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [105 more lines] ...
     Line 109: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (438 chars):
   {'predicted_label': '"Referti e Cartelle Cliniche"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la spedizione di un esame istologico effettuato dalla Sig.ra Mazzucco Gabriella il 15.04.2025. PoichÃ© si tratta di un referto clinico, Ã¨ stata classificata come "Referti e Cartelle Cl...

ğŸ“Š Parsed Response:
   predicted_label: "Referti e Cartelle Cliniche"
   confidence: 0.95
   motivation: La conversazione riguarda la spedizione di un esame istologico effettuato dalla Sig.ra Mazzucco Gabriella il 15.04.2025. PoichÃ© si tratta di un referto clinico, Ã¨ stata classificata come "Referti e Cartelle Cliniche". La confidenza in questa classificazione Ã¨ alta perchÃ© la conversazione riguarda esplicitamente l'esame istologico e il suo stato.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la spedizione di un esame istologico effettuato dalla Sig.ra Mazzucco Gabriella il 15.04.2025. PoichÃ© si tratta di un referto clinico, Ã¨ stata classificata come "Referti e Cartelle Cliniche". La confidenza in questa classificazione Ã¨ alta perchÃ© la conversazione riguarda esplicitamente l'esame istologico e il suo stato.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione fb424a8b69b472a3b6448e121fdcd3e0 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Referti e Cartelle Cliniche"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 685
   ğŸ’¬ Token conversazione: 305
   ğŸ“Š Token totali: 990
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 990 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione originale: 305
   ğŸ“Š Token conversazione finale: 305
   ğŸ“Š Token totali: 990
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1026 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco a registrarmi. [...] it**, indicando:
   - Nome e cognome
   - Codice fiscale
   - Motivo della richiesta di assistenza

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 3978 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione: 305
   ğŸ“Š Token totali stimati: 990
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco a registrarmi. [...] it**, indicando:
   - Nome e cognome
   - Codice fiscale
   - Motivo della richiesta di assistenza

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la registrazione su Humanitas con te e il problema riscontrato dall\'utente Ã¨ che riceve un messaggio di errore "dati incoerenti, contatta l\'assistenza". In base a ciÃ², la classificazione piÃ¹ appropriata Ã¨ "Humanitas con te - Registrazione"'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:10.246722
====================================================================================================
ğŸ“‹ Session ID: classify_1756769050
â±ï¸  Processing Time: 2.796s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1026 chars):
   [UTENTE] Non riesco a registrarmi. [ASSISTENTE] Mi dispiace che stai riscontrando difficoltÃ  con la registrazione. Potresti dirmi se stai cercando di registrarti su [Humanitas con te](https://www.h...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [108 more lines] ...
     Line 112: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (362 chars):
   {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la registrazione su Humanitas con te e il problema riscontrato dall\'utente Ã¨ che riceve un messaggio di errore "dati incoerenti, contatta l\'assistenza". In base a ciÃ², la class...

ğŸ“Š Parsed Response:
   predicted_label: "Humanitas con te - Registrazione"
   confidence: 0.95
   motivation: La conversazione riguarda la registrazione su Humanitas con te e il problema riscontrato dall'utente Ã¨ che riceve un messaggio di errore "dati incoerenti, contatta l'assistenza". In base a ciÃ², la classificazione piÃ¹ appropriata Ã¨ "Humanitas con te - Registrazione"
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la registrazione su Humanitas con te e il problema riscontrato dall'utente Ã¨ che riceve un messaggio di errore "dati incoerenti, contatta l'assistenza". In base a ciÃ², la classificazione piÃ¹ appropriata Ã¨ "Humanitas con te - Registrazione"
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione bf2effd84e3429966217008da8ab1e17 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Humanitas con te - Registrazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 687
   ğŸ’¬ Token conversazione: 443
   ğŸ“Š Token totali: 1130
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1130 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 687
   ğŸ“Š Token conversazione originale: 443
   ğŸ“Š Token conversazione finale: 443
   ğŸ“Š Token totali: 1130
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1567 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco ad accedere al sito [ASSISTENTE] Se hai problemi ad accedere al sito di Humanitas o al portale [Humanitas con te](https://www. [...]  Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4007 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 687
   ğŸ“Š Token conversazione: 443
   ğŸ“Š Token totali stimati: 1130
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco ad accedere al sito [ASSISTENTE] Se hai problemi ad accedere al sito di Humanitas o al portale [Humanitas con te](https://www. [...]  Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la registrazione su Humanitas con te e il problema di accedere al sito o inserire correttamente il codice fiscale, quindi Ã¨ stata classificata come "Humanitas con te - Registrazione".'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:11.694314
====================================================================================================
ğŸ“‹ Session ID: classify_1756769051
â±ï¸  Processing Time: 1.361s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1567 chars):
   [UTENTE] Non riesco ad accedere al sito [ASSISTENTE] Se hai problemi ad accedere al sito di Humanitas o al portale [Humanitas con te](https://www.humanitasconte.it), ti consiglio di verificare quan...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (304 chars):
   {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la registrazione su Humanitas con te e il problema di accedere al sito o inserire correttamente il codice fiscale, quindi Ã¨ stata classificata come "Humanitas con te - Registrazi...

ğŸ“Š Parsed Response:
   predicted_label: "Humanitas con te - Registrazione"
   confidence: 0.95
   motivation: La conversazione riguarda la registrazione su Humanitas con te e il problema di accedere al sito o inserire correttamente il codice fiscale, quindi Ã¨ stata classificata come "Humanitas con te - Registrazione".
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la registrazione su Humanitas con te e il problema di accedere al sito o inserire correttamente il codice fiscale, quindi Ã¨ stata classificata come "Humanitas con te - Registrazione".
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 331ddfb60f1ba89fb62b8fa8974a0bcb classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Humanitas con te - Registrazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 681
   ğŸ’¬ Token conversazione: 210
   ğŸ“Š Token totali: 891
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 891 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 681
   ğŸ“Š Token conversazione originale: 210
   ğŸ“Š Token conversazione finale: 210
   ğŸ“Š Token totali: 891
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 731 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Inserire numero impegnative con giÃ  appuntamento  [ASSISTENTE] Potresti chiarire meglio la tua richiesta? Intendi dire che desideri sapere come inserire il numero di un'impegnativa per un appuntamento giÃ  prenotato? [UTENTE] Si [ASSISTENTE] Per inserire il numero di un'impegnativa per un..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4062 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 681
   ğŸ“Š Token conversazione: 210
   ğŸ“Š Token totali stimati: 891
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Inserire numero impegnative con giÃ  appuntamento  [ASSISTENTE] Potresti chiarire meglio la tua richiesta? Intendi dire che desideri sapere come inserire il numero di un'impegnativa per un appuntamento giÃ  prenotato? [UTENTE] Si [ASSISTENTE] Per inserire il numero di un'impegnativa per un..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la gestione dei propri appuntamenti, in particolare l\'inserimento del numero di un\'impegnativa per un appuntamento giÃ  prenotato. Questo Ã¨ tipico della categoria "Prenotazione".'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:12.915913
====================================================================================================
ğŸ“‹ Session ID: classify_1756769052
â±ï¸  Processing Time: 1.136s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (731 chars):
   [UTENTE] Inserire numero impegnative con giÃ  appuntamento  [ASSISTENTE] Potresti chiarire meglio la tua richiesta? Intendi dire che desideri sapere come inserire il numero di un'impegnativa per un ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (280 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la gestione dei propri appuntamenti, in particolare l\'inserimento del numero di un\'impegnativa per un appuntamento giÃ  prenotato. Questo Ã¨ tipico della categoria "Prenotazione".'}

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la gestione dei propri appuntamenti, in particolare l'inserimento del numero di un'impegnativa per un appuntamento giÃ  prenotato. Questo Ã¨ tipico della categoria "Prenotazione".
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la gestione dei propri appuntamenti, in particolare l'inserimento del numero di un'impegnativa per un appuntamento giÃ  prenotato. Questo Ã¨ tipico della categoria "Prenotazione".
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 5daf2aec41e9aaba2112859616ced715 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 687
   ğŸ’¬ Token conversazione: 259
   ğŸ“Š Token totali: 946
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 946 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 687
   ğŸ“Š Token conversazione originale: 259
   ğŸ“Š Token conversazione finale: 259
   ğŸ“Š Token totali: 946
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 954 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, non riesco a completare la registrazione a nome di Chorna Valentina ( mi dice che Ã¨ giÃ  registrata. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 3982 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 687
   ğŸ“Š Token conversazione: 259
   ğŸ“Š Token totali stimati: 946
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Problema tecnico di accesso - prioritÃ  problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, non riesco a completare la registrazione a nome di Chorna Valentina ( mi dice che Ã¨ giÃ  registrata. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la registrazione su Humanitas con te e fornisce informazioni su come modificare un account giÃ  registrato o recuperare la password.'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:14.025483
====================================================================================================
ğŸ“‹ Session ID: classify_1756769054
â±ï¸  Processing Time: 1.022s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (954 chars):
   [UTENTE] Buongiorno, non riesco a completare la registrazione a nome di Chorna Valentina ( mi dice che Ã¨ giÃ  registrata...come posso modificare? [ASSISTENTE] Se il sistema segnala che il nome Ã¨ giÃ ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [105 more lines] ...
     Line 109: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (252 chars):
   {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la registrazione su Humanitas con te e fornisce informazioni su come modificare un account giÃ  registrato o recuperare la password.'}

ğŸ“Š Parsed Response:
   predicted_label: "Humanitas con te - Registrazione"
   confidence: 0.95
   motivation: La conversazione riguarda la registrazione su Humanitas con te e fornisce informazioni su come modificare un account giÃ  registrato o recuperare la password.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la registrazione su Humanitas con te e fornisce informazioni su come modificare un account giÃ  registrato o recuperare la password.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione bb87137ce78e95c330b52ff051333a17 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Humanitas con te - Registrazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 681
   ğŸ’¬ Token conversazione: 513
   ğŸ“Š Token totali: 1194
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1194 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 681
   ğŸ“Š Token conversazione originale: 513
   ğŸ“Š Token conversazione finale: 513
   ğŸ“Š Token totali: 1194
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1694 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Devo fare prelievo di sangue presso Humanitas Via Sardegna. [...] it/info/esami-di-laboratorio/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 3867 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 681
   ğŸ“Š Token conversazione: 513
   ğŸ“Š Token totali stimati: 1194
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Devo fare prelievo di sangue presso Humanitas Via Sardegna. [...] it/info/esami-di-laboratorio/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione per un prelievo di sangue presso Humanitas, e il sistema di prenotazione viene menzionato piÃ¹ volte. Inoltre, l'utente chiede se Ã¨ necessario prenotare anche in gravidanza, e l'assistente conferma che sÃ¬."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:15.567617
====================================================================================================
ğŸ“‹ Session ID: classify_1756769055
â±ï¸  Processing Time: 1.453s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1694 chars):
   [UTENTE] Devo fare prelievo di sangue presso Humanitas Via Sardegna. Sono incinta, devo prenotare? [ASSISTENTE] SÃ¬, Ã¨ necessario prenotare per effettuare un prelievo di sangue presso Humanitas. Puo...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (321 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione per un prelievo di sangue presso Humanitas, e il sistema di prenotazione viene menzionato piÃ¹ volte. Inoltre, l'utente chiede se Ã¨ necessario prenotare anche in gravidanza, e l'assis...

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione per un prelievo di sangue presso Humanitas, e il sistema di prenotazione viene menzionato piÃ¹ volte. Inoltre, l'utente chiede se Ã¨ necessario prenotare anche in gravidanza, e l'assistente conferma che sÃ¬.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la prenotazione per un prelievo di sangue presso Humanitas, e il sistema di prenotazione viene menzionato piÃ¹ volte. Inoltre, l'utente chiede se Ã¨ necessario prenotare anche in gravidanza, e l'assistente conferma che sÃ¬.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione fa77d527385a3fa3b113e20706ddb676 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 682
   ğŸ’¬ Token conversazione: 186
   ğŸ“Š Token totali: 868
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 868 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 682
   ğŸ“Š Token conversazione originale: 186
   ğŸ“Š Token conversazione finale: 186
   ğŸ“Š Token totali: 868
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 567 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Il punto prelievi di viale sardegna Ã¨ aperto in estate?  [ASSISTENTE] Il punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele, Ã¨ aperto durante l'estate con i seguenti orari: da lunedÃ¬ a venerdÃ¬ dalle 7:00 alle 13:00. [...] it/info/esami-di-laboratorio/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4036 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 682
   ğŸ“Š Token conversazione: 186
   ğŸ“Š Token totali stimati: 868
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Il punto prelievi di viale sardegna Ã¨ aperto in estate?  [ASSISTENTE] Il punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele, Ã¨ aperto durante l'estate con i seguenti orari: da lunedÃ¬ a venerdÃ¬ dalle 7:00 alle 13:00. [...] it/info/esami-di-laboratorio/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda l'apertura del punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele, durante l'estate e richiede informazioni sui suoi orari di apertura e la necessitÃ  di prenotare per accedere."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:16.926415
====================================================================================================
ğŸ“‹ Session ID: classify_1756769056
â±ï¸  Processing Time: 1.271s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (567 chars):
   [UTENTE] Il punto prelievi di viale sardegna Ã¨ aperto in estate?  [ASSISTENTE] Il punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele, Ã¨ aperto durante l'estate con i seguenti orari: da ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (289 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda l'apertura del punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele, durante l'estate e richiede informazioni sui suoi orari di apertura e la necessitÃ  di prenotare per accedere."}

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda l'apertura del punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele, durante l'estate e richiede informazioni sui suoi orari di apertura e la necessitÃ  di prenotare per accedere.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda l'apertura del punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele, durante l'estate e richiede informazioni sui suoi orari di apertura e la necessitÃ  di prenotare per accedere.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 84603c469a73afd10e6b33f96ccd16fc classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 681
   ğŸ’¬ Token conversazione: 474
   ğŸ“Š Token totali: 1155
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1155 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 681
   ğŸ“Š Token conversazione originale: 474
   ğŸ“Š Token conversazione finale: 474
   ğŸ“Š Token totali: 1155
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1553 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei sapere se sabato 30 settembre 2025 Ã¨ possibile fare gli esami del sangue Humanitas fiordaliso? [ASSISTENTE] Presso Humanitas Medical Care Rozzano-Fiordaliso, il sabato Ã¨ possibile effettuare prelievi del sangue dalle 7:30 alle 10:00 solo su prenotazione, e dalle 10:00 alle 11:00 c..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4062 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 681
   ğŸ“Š Token conversazione: 474
   ğŸ“Š Token totali stimati: 1155
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei sapere se sabato 30 settembre 2025 Ã¨ possibile fare gli esami del sangue Humanitas fiordaliso? [ASSISTENTE] Presso Humanitas Medical Care Rozzano-Fiordaliso, il sabato Ã¨ possibile effettuare prelievi del sangue dalle 7:30 alle 10:00 solo su prenotazione, e dalle 10:00 alle 11:00 c..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.98, 'motivation': 'La conversazione riguarda la possibilitÃ  di prenotare un esame del sangue presso Humanitas Medical Care Rozzano-Fiordaliso, e il fatto che ci sia una possibilitÃ  di accedere liberamente senza prenotazione solo dalle 10:00 alle 11:00. Inoltre, viene consigliato di contattare la struttura per confermare eventuali modalitÃ  specifiche di accesso dedicate a persone con invaliditÃ .'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:18.898793
====================================================================================================
ğŸ“‹ Session ID: classify_1756769058
â±ï¸  Processing Time: 1.886s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1553 chars):
   [UTENTE] Vorrei sapere se sabato 30 settembre 2025 Ã¨ possibile fare gli esami del sangue Humanitas fiordaliso? [ASSISTENTE] Presso Humanitas Medical Care Rozzano-Fiordaliso, il sabato Ã¨ possibile e...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (453 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.98, 'motivation': 'La conversazione riguarda la possibilitÃ  di prenotare un esame del sangue presso Humanitas Medical Care Rozzano-Fiordaliso, e il fatto che ci sia una possibilitÃ  di accedere liberamente senza prenotazione solo dalle 10:00 al...

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.98
   motivation: La conversazione riguarda la possibilitÃ  di prenotare un esame del sangue presso Humanitas Medical Care Rozzano-Fiordaliso, e il fatto che ci sia una possibilitÃ  di accedere liberamente senza prenotazione solo dalle 10:00 alle 11:00. Inoltre, viene consigliato di contattare la struttura per confermare eventuali modalitÃ  specifiche di accesso dedicate a persone con invaliditÃ .
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.980
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 98.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la possibilitÃ  di prenotare un esame del sangue presso Humanitas Medical Care Rozzano-Fiordaliso, e il fatto che ci sia una possibilitÃ  di accedere liberamente senza prenotazione solo dalle 10:00 alle 11:00. Inoltre, viene consigliato di contattare la struttura per confermare eventuali modalitÃ  specifiche di accesso dedicate a persone con invaliditÃ .
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione b58e89f0bba2efa26e8876038fedabbe classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 661
   ğŸ’¬ Token conversazione: 203
   ğŸ“Š Token totali: 864
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 864 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 661
   ğŸ“Š Token conversazione originale: 203
   ğŸ“Š Token conversazione finale: 203
   ğŸ“Š Token totali: 864
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 614 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Orari farmacia per ritiro puntura [ASSISTENTE] La Farmacia dellâ€™Istituto Clinico Humanitas Ã¨ aperta dal lunedÃ¬ al venerdÃ¬ (esclusi i festivi) con i seguenti orari:  
- Mattina: dalle 8:30 alle 13:00;  
- Pomeriggio: dalle 14:00 alle 17:30. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 3950 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 661
   ğŸ“Š Token conversazione: 203
   ğŸ“Š Token totali stimati: 864
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Orari farmacia per ritiro puntura [ASSISTENTE] La Farmacia dellâ€™Istituto Clinico Humanitas Ã¨ aperta dal lunedÃ¬ al venerdÃ¬ (esclusi i festivi) con i seguenti orari:  
- Mattina: dalle 8:30 alle 13:00;  
- Pomeriggio: dalle 14:00 alle 17:30. [...] jsonã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Farmacia"', 'confidence': 0.95, 'motivation': "La conversazione riguarda l'orario di apertura della farmacia dell'Istituto Clinico Humanitas e le informazioni relative all'accesso ai pazienti in trattamento con farmaci sperimentali o ospedalieri."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:20.127384
====================================================================================================
ğŸ“‹ Session ID: classify_1756769060
â±ï¸  Processing Time: 1.141s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (614 chars):
   [UTENTE] Orari farmacia per ritiro puntura [ASSISTENTE] La Farmacia dellâ€™Istituto Clinico Humanitas Ã¨ aperta dal lunedÃ¬ al venerdÃ¬ (esclusi i festivi) con i seguenti orari:  
- Mattina: dalle 8:30 ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [104 more lines] ...
     Line 108: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (270 chars):
   {'predicted_label': '"Farmacia"', 'confidence': 0.95, 'motivation': "La conversazione riguarda l'orario di apertura della farmacia dell'Istituto Clinico Humanitas e le informazioni relative all'accesso ai pazienti in trattamento con farmaci sperimentali o ospedalieri."}

ğŸ“Š Parsed Response:
   predicted_label: "Farmacia"
   confidence: 0.95
   motivation: La conversazione riguarda l'orario di apertura della farmacia dell'Istituto Clinico Humanitas e le informazioni relative all'accesso ai pazienti in trattamento con farmaci sperimentali o ospedalieri.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda l'orario di apertura della farmacia dell'Istituto Clinico Humanitas e le informazioni relative all'accesso ai pazienti in trattamento con farmaci sperimentali o ospedalieri.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione de9f97f13a6ce2d72bb2fb2ecf10a2bb classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  âœ… Nuovo tag '"Farmacia"' aggiunto per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
   ğŸ“ˆ Progresso LLM: 50/155
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 685
   ğŸ’¬ Token conversazione: 695
   ğŸ“Š Token totali: 1380
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1380 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione originale: 695
   ğŸ“Š Token conversazione finale: 695
   ğŸ“Š Token totali: 1380
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2214 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Voglio sapere si posso fare domani, sabato, i seguenti esami de sangue: omocisteina, fattore di necrose tumorale, interleuchina 6 si 8 [ASSISTENTE] Puoi effettuare gli esami del sangue richiesti (omocisteina, fattore di necrosi tumorale, interleuchina 6 e 8) il sabato presso l'Istituto C..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4074 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione: 695
   ğŸ“Š Token totali stimati: 1380
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Voglio sapere si posso fare domani, sabato, i seguenti esami de sangue: omocisteina, fattore di necrose tumorale, interleuchina 6 si 8 [ASSISTENTE] Puoi effettuare gli esami del sangue richiesti (omocisteina, fattore di necrosi tumorale, interleuchina 6 e 8) il sabato presso l'Istituto C..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di un esame di laboratorio per una persona, specificatamente gli esami del sangue richiesti (omocisteina, fattore di necrosi tumorale, interleuchina 6 e 8). Il cliente ha chiesto se puÃ² effettuare l'esame il sabato e se Ã¨ necessario avere un'impegnativa medica. L'assistente ha risposto che gli esami possono essere effettuati il sabato presso l'Istituto Clinico Humanitas, ma senza impegnativa solo in regime privato. Il cliente ha poi chiesto come prenotare gli esami in regime privato e l'assistente ha fornito le informazioni necessarie per farlo. Infine, il cliente ha chiesto dove possono essere effettuati gli esami per una bambina e l'assistente ha consigliato di contattare direttamente l'Istituto Clinico Humanitas per verificare la disponibilitÃ  e i punti prelievo adatti ai bambini."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:23.932837
====================================================================================================
ğŸ“‹ Session ID: classify_1756769063
â±ï¸  Processing Time: 3.712s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2214 chars):
   [UTENTE] Voglio sapere si posso fare domani, sabato, i seguenti esami de sangue: omocisteina, fattore di necrose tumorale, interleuchina 6 si 8 [ASSISTENTE] Puoi effettuare gli esami del sangue ric...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (911 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di un esame di laboratorio per una persona, specificatamente gli esami del sangue richiesti (omocisteina, fattore di necrosi tumorale, interleuchina 6 e 8). Il cliente ha chiesto se ...

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di un esame di laboratorio per una persona, specificatamente gli esami del sangue richiesti (omocisteina, fattore di necrosi tumorale, interleuchina 6 e 8). Il cliente ha chiesto se puÃ² effettuare l'esame il sabato e se Ã¨ necessario avere un'impegnativa medica. L'assistente ha risposto che gli esami possono essere effettuati il sabato presso l'Istituto Clinico Humanitas, ma senza impegnativa solo in regime privato. Il cliente ha poi chiesto come prenotare gli esami in regime privato e l'assistente ha fornito le informazioni necessarie per farlo. Infine, il cliente ha chiesto dove possono essere effettuati gli esami per una bambina e l'assistente ha consigliato di contattare direttamente l'Istituto Clinico Humanitas per verificare la disponibilitÃ  e i punti prelievo adatti ai bambini.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un esame di laboratorio per una persona, specificatamente gli esami del sangue richiesti (omocisteina, fattore di necrosi tumorale, interleuchina 6 e 8). Il cliente ha chiesto se puÃ² effettuare l'esame il sabato e se Ã¨ necessario avere un'impegnativa medica. L'assistente ha risposto che gli esami possono essere effettuati il sabato presso l'Istituto ...
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f146630e1a4c6230f6ce6b77f7906cc4 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 686
   ğŸ’¬ Token conversazione: 381
   ğŸ“Š Token totali: 1067
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1067 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 686
   ğŸ“Š Token conversazione originale: 381
   ğŸ“Š Token conversazione finale: 381
   ğŸ“Š Token totali: 1067
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1128 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei prenotare una visita urologica [ASSISTENTE] Per prenotare una visita urologica presso l'Istituto Clinico Humanitas, puoi utilizzare i seguenti canali di prenotazione:

1. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 3990 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 686
   ğŸ“Š Token conversazione: 381
   ğŸ“Š Token totali stimati: 1067
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei prenotare una visita urologica [ASSISTENTE] Per prenotare una visita urologica presso l'Istituto Clinico Humanitas, puoi utilizzare i seguenti canali di prenotazione:

1. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 1.0, 'motivation': 'La conversazione riguarda la prenotazione di un\'esame urologico presso l\'Istituto Clinico Humanitas, quindi Ã¨ appropriato classificarla come "Prenotazione".'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:25.105172
====================================================================================================
ğŸ“‹ Session ID: classify_1756769065
â±ï¸  Processing Time: 1.087s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1128 chars):
   [UTENTE] Vorrei prenotare una visita urologica [ASSISTENTE] Per prenotare una visita urologica presso l'Istituto Clinico Humanitas, puoi utilizzare i seguenti canali di prenotazione:

1. **Privatam...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [105 more lines] ...
     Line 109: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (232 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 1.0, 'motivation': 'La conversazione riguarda la prenotazione di un\'esame urologico presso l\'Istituto Clinico Humanitas, quindi Ã¨ appropriato classificarla come "Prenotazione".'}

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 1.0
   motivation: La conversazione riguarda la prenotazione di un'esame urologico presso l'Istituto Clinico Humanitas, quindi Ã¨ appropriato classificarla come "Prenotazione".
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 1.000
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un'esame urologico presso l'Istituto Clinico Humanitas, quindi Ã¨ appropriato classificarla come "Prenotazione".
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 7716406c9be5bd21dd42d55b81d57dda classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 665
   ğŸ’¬ Token conversazione: 208
   ğŸ“Š Token totali: 873
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 873 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 665
   ğŸ“Š Token conversazione originale: 208
   ğŸ“Š Token conversazione finale: 208
   ğŸ“Š Token totali: 873
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 671 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] HO PRENOTATO UNA TELEVISITA. [...] docxã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 3751 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 665
   ğŸ“Š Token conversazione: 208
   ğŸ“Š Token totali stimati: 873
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] HO PRENOTATO UNA TELEVISITA. [...] docxã€‘"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Visita Specialistica"', 'confidence': 1.0, 'motivation': 'La conversazione riguarda la modalitÃ  di svolgimento di una visita specialistica tramite televisita, quindi Ã¨ stata classificata come "Visita Specialistica".'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:26.136483
====================================================================================================
ğŸ“‹ Session ID: classify_1756769066
â±ï¸  Processing Time: 0.943s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (671 chars):
   [UTENTE] HO PRENOTATO UNA TELEVISITA. COME FUNZIONA? [ASSISTENTE] La televisita si svolge in questo modo:

1. All'orario fissato, accedi alla piattaforma cliccando sul link ricevuto via email.
2. V...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (239 chars):
   {'predicted_label': '"Visita Specialistica"', 'confidence': 1.0, 'motivation': 'La conversazione riguarda la modalitÃ  di svolgimento di una visita specialistica tramite televisita, quindi Ã¨ stata classificata come "Visita Specialistica".'}

ğŸ“Š Parsed Response:
   predicted_label: "Visita Specialistica"
   confidence: 1.0
   motivation: La conversazione riguarda la modalitÃ  di svolgimento di una visita specialistica tramite televisita, quindi Ã¨ stata classificata come "Visita Specialistica".
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 1.000
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la modalitÃ  di svolgimento di una visita specialistica tramite televisita, quindi Ã¨ stata classificata come "Visita Specialistica".
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione bde8cfeb6db9c96b7cea0e1d3db235a9 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Visita Specialistica"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 665
   ğŸ’¬ Token conversazione: 319
   ğŸ“Š Token totali: 984
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 984 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 665
   ğŸ“Š Token conversazione originale: 319
   ğŸ“Š Token conversazione finale: 319
   ğŸ“Š Token totali: 984
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1078 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao  [ASSISTENTE] Ciao! Come posso esserti utile? ğŸ˜Š [UTENTE] Si  [ASSISTENTE] Perfetto! Dimmi pure, come posso aiutarti? ğŸ˜Š [UTENTE] ho prenotato per il 15 settembre con il Dr. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 3916 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 665
   ğŸ“Š Token conversazione: 319
   ğŸ“Š Token totali stimati: 984
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao  [ASSISTENTE] Ciao! Come posso esserti utile? ğŸ˜Š [UTENTE] Si  [ASSISTENTE] Perfetto! Dimmi pure, come posso aiutarti? ğŸ˜Š [UTENTE] ho prenotato per il 15 settembre con il Dr. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Visita Specialistica"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda una prenotazione per un esame medico specifico, quindi Ã¨ classificata come "Visita Specialistica". Il paziente ha chiesto informazioni specifiche sull\'esecuzione dell\'esame e sulla disponibilitÃ  delle immagini in formato digitale o cartaceo.'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:27.567068
====================================================================================================
ğŸ“‹ Session ID: classify_1756769067
â±ï¸  Processing Time: 1.345s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1078 chars):
   [UTENTE] Ciao  [ASSISTENTE] Ciao! Come posso esserti utile? ğŸ˜Š [UTENTE] Si  [ASSISTENTE] Perfetto! Dimmi pure, come posso aiutarti? ğŸ˜Š [UTENTE] ho prenotato per il 15 settembre con il Dr. Lamberto Zo...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (352 chars):
   {'predicted_label': '"Visita Specialistica"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda una prenotazione per un esame medico specifico, quindi Ã¨ classificata come "Visita Specialistica". Il paziente ha chiesto informazioni specifiche sull\'esecuzione dell\'esame e sulla disponi...

ğŸ“Š Parsed Response:
   predicted_label: "Visita Specialistica"
   confidence: 0.95
   motivation: La conversazione riguarda una prenotazione per un esame medico specifico, quindi Ã¨ classificata come "Visita Specialistica". Il paziente ha chiesto informazioni specifiche sull'esecuzione dell'esame e sulla disponibilitÃ  delle immagini in formato digitale o cartaceo.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda una prenotazione per un esame medico specifico, quindi Ã¨ classificata come "Visita Specialistica". Il paziente ha chiesto informazioni specifiche sull'esecuzione dell'esame e sulla disponibilitÃ  delle immagini in formato digitale o cartaceo.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f45b43736555750a41415269ae3919b4 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Visita Specialistica"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 665
   ğŸ’¬ Token conversazione: 195
   ğŸ“Š Token totali: 860
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 860 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 665
   ğŸ“Š Token conversazione originale: 195
   ğŸ“Š Token conversazione finale: 195
   ğŸ“Š Token totali: 860
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 661 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Dovrei effettuare una enteroscopia con biopsia Humatis effettua questo tipo di prestazione  e il costo in regime privato [ASSISTENTE] Humanitas effettua l'enteroscopia con biopsia, una procedura che consente di esaminare il piccolo intestino e prelevare campioni di tessuto per analisi is..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4002 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 665
   ğŸ“Š Token conversazione: 195
   ğŸ“Š Token totali stimati: 860
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Dovrei effettuare una enteroscopia con biopsia Humatis effettua questo tipo di prestazione  e il costo in regime privato [ASSISTENTE] Humanitas effettua l'enteroscopia con biopsia, una procedura che consente di esaminare il piccolo intestino e prelevare campioni di tessuto per analisi is..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Visita Specialistica Oncologica"', 'confidence': 0.95, 'motivation': "La conversazione riguarda una procedura medica, l'enteroscopia con biopsia, che Ã¨ tipicamente eseguita da un endoscopista digestivo specializzato in malattie oncologiche del piccolo intestino."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:28.828790
====================================================================================================
ğŸ“‹ Session ID: classify_1756769068
â±ï¸  Processing Time: 1.172s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (661 chars):
   [UTENTE] Dovrei effettuare una enteroscopia con biopsia Humatis effettua questo tipo di prestazione  e il costo in regime privato [ASSISTENTE] Humanitas effettua l'enteroscopia con biopsia, una pro...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (286 chars):
   {'predicted_label': '"Visita Specialistica Oncologica"', 'confidence': 0.95, 'motivation': "La conversazione riguarda una procedura medica, l'enteroscopia con biopsia, che Ã¨ tipicamente eseguita da un endoscopista digestivo specializzato in malattie oncologiche del piccolo intestino."}

ğŸ“Š Parsed Response:
   predicted_label: "Visita Specialistica Oncologica"
   confidence: 0.95
   motivation: La conversazione riguarda una procedura medica, l'enteroscopia con biopsia, che Ã¨ tipicamente eseguita da un endoscopista digestivo specializzato in malattie oncologiche del piccolo intestino.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda una procedura medica, l'enteroscopia con biopsia, che Ã¨ tipicamente eseguita da un endoscopista digestivo specializzato in malattie oncologiche del piccolo intestino.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 66230a1dbe5b91de8f85e703d0591980 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Visita Specialistica Oncologica"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 686
   ğŸ’¬ Token conversazione: 407
   ğŸ“Š Token totali: 1093
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1093 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 686
   ğŸ“Š Token conversazione originale: 407
   ğŸ“Š Token conversazione finale: 407
   ğŸ“Š Token totali: 1093
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1204 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, sono Fava Piera (05/07/48) paziente del cardiologo dr Carlo Ceriotti che mi ha visitata ila Rozzano il 25/06/25 prescrivendo ECOCARDIO di controllo da fare entro 6 mesi x importante patologia. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4059 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 686
   ğŸ“Š Token conversazione: 407
   ğŸ“Š Token totali stimati: 1093
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, sono Fava Piera (05/07/48) paziente del cardiologo dr Carlo Ceriotti che mi ha visitata ila Rozzano il 25/06/25 prescrivendo ECOCARDIO di controllo da fare entro 6 mesi x importante patologia. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di un esame medico (ecocardiogramma) e il paziente Ã¨ stato indirizzato ad utilizzare i canali di prenotazione disponibili all'ospedale Humanitas."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:30.130693
====================================================================================================
ğŸ“‹ Session ID: classify_1756769070
â±ï¸  Processing Time: 1.214s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1204 chars):
   [UTENTE] Buongiorno, sono Fava Piera (05/07/48) paziente del cardiologo dr Carlo Ceriotti che mi ha visitata ila Rozzano il 25/06/25 prescrivendo ECOCARDIO di controllo da fare entro 6 mesi x impor...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [105 more lines] ...
     Line 109: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (262 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di un esame medico (ecocardiogramma) e il paziente Ã¨ stato indirizzato ad utilizzare i canali di prenotazione disponibili all'ospedale Humanitas."}

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di un esame medico (ecocardiogramma) e il paziente Ã¨ stato indirizzato ad utilizzare i canali di prenotazione disponibili all'ospedale Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un esame medico (ecocardiogramma) e il paziente Ã¨ stato indirizzato ad utilizzare i canali di prenotazione disponibili all'ospedale Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 2668862c9859bf5e81d8b07ea421b69d classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 685
   ğŸ’¬ Token conversazione: 150
   ğŸ“Š Token totali: 835
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 835 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione originale: 150
   ğŸ“Š Token conversazione finale: 150
   ğŸ“Š Token totali: 835
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 487 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei sapere gli orari di visita ai pazienti nel reparto ortopedia [ASSISTENTE] Per visitare i pazienti ricoverati in Humanitas, gli orari di visita possono variare a seconda del reparto. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4043 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione: 150
   ğŸ“Š Token totali stimati: 835
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei sapere gli orari di visita ai pazienti nel reparto ortopedia [ASSISTENTE] Per visitare i pazienti ricoverati in Humanitas, gli orari di visita possono variare a seconda del reparto. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Visita Specialistica"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la visita a un paziente ricoverato in ospedale, quindi Ã¨ stata classificata come "Visita Specialistica".'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:31.117070
====================================================================================================
ğŸ“‹ Session ID: classify_1756769071
â±ï¸  Processing Time: 0.899s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (487 chars):
   [UTENTE] Vorrei sapere gli orari di visita ai pazienti nel reparto ortopedia [ASSISTENTE] Per visitare i pazienti ricoverati in Humanitas, gli orari di visita possono variare a seconda del reparto....

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (213 chars):
   {'predicted_label': '"Visita Specialistica"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la visita a un paziente ricoverato in ospedale, quindi Ã¨ stata classificata come "Visita Specialistica".'}

ğŸ“Š Parsed Response:
   predicted_label: "Visita Specialistica"
   confidence: 0.95
   motivation: La conversazione riguarda la visita a un paziente ricoverato in ospedale, quindi Ã¨ stata classificata come "Visita Specialistica".
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la visita a un paziente ricoverato in ospedale, quindi Ã¨ stata classificata come "Visita Specialistica".
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 37dd89d3ec43b068f7f82c392d81bda7 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Visita Specialistica"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 685
   ğŸ’¬ Token conversazione: 276
   ğŸ“Š Token totali: 961
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 961 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione originale: 276
   ğŸ“Š Token conversazione finale: 276
   ğŸ“Š Token totali: 961
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 841 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia, vorrei mettermi in contatto con la ginecologia del pio x [ASSISTENTE] Per contattare la ginecologia presso Humanitas San Pio X, puoi fare riferimento al Punto Nascita. [...]  Se hai bisogno di ulteriori dettagli, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4022 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione: 276
   ğŸ“Š Token totali stimati: 961
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia, vorrei mettermi in contatto con la ginecologia del pio x [ASSISTENTE] Per contattare la ginecologia presso Humanitas San Pio X, puoi fare riferimento al Punto Nascita. [...]  Se hai bisogno di ulteriori dettagli, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Referti e Cartelle Cliniche"', 'confidence': 0.95, 'motivation': "La conversazione riguarda l'indirizzo dell'ufficio ritiro referti presso Humanitas San Pio X, che Ã¨ situato in Via Francesco Nava, 31, 20159 - Milano. Il messaggio contiene anche un link al sito ufficiale di Humanitas San Pio X per maggiori informazioni."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:32.700770
====================================================================================================
ğŸ“‹ Session ID: classify_1756769072
â±ï¸  Processing Time: 1.497s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (841 chars):
   [UTENTE] Ciao Giulia, vorrei mettermi in contatto con la ginecologia del pio x [ASSISTENTE] Per contattare la ginecologia presso Humanitas San Pio X, puoi fare riferimento al Punto Nascita. Ãˆ attiv...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (344 chars):
   {'predicted_label': '"Referti e Cartelle Cliniche"', 'confidence': 0.95, 'motivation': "La conversazione riguarda l'indirizzo dell'ufficio ritiro referti presso Humanitas San Pio X, che Ã¨ situato in Via Francesco Nava, 31, 20159 - Milano. Il messaggio contiene anche un link al sito ufficiale di H...

ğŸ“Š Parsed Response:
   predicted_label: "Referti e Cartelle Cliniche"
   confidence: 0.95
   motivation: La conversazione riguarda l'indirizzo dell'ufficio ritiro referti presso Humanitas San Pio X, che Ã¨ situato in Via Francesco Nava, 31, 20159 - Milano. Il messaggio contiene anche un link al sito ufficiale di Humanitas San Pio X per maggiori informazioni.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda l'indirizzo dell'ufficio ritiro referti presso Humanitas San Pio X, che Ã¨ situato in Via Francesco Nava, 31, 20159 - Milano. Il messaggio contiene anche un link al sito ufficiale di Humanitas San Pio X per maggiori informazioni.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione dd9ef683d003b896bdd4d0abbf8b6c39 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Referti e Cartelle Cliniche"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 665
   ğŸ’¬ Token conversazione: 87
   ğŸ“Š Token totali: 752
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 752 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 665
   ğŸ“Š Token conversazione originale: 87
   ğŸ“Š Token conversazione finale: 87
   ğŸ“Š Token totali: 752
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 279 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] a che ore siete aperti? [ASSISTENTE] Gli orari di apertura possono variare a seconda del servizio o del reparto che desideri visitare. Potresti specificare a quale servizio o reparto ti riferisci? Ad esempio, pronto soccorso, ufficio ritiro referti, punti prelievo, ecc."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 3981 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 665
   ğŸ“Š Token conversazione: 87
   ğŸ“Š Token totali stimati: 752
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] a che ore siete aperti? [ASSISTENTE] Gli orari di apertura possono variare a seconda del servizio o del reparto che desideri visitare. Potresti specificare a quale servizio o reparto ti riferisci? Ad esempio, pronto soccorso, ufficio ritiro referti, punti prelievo, ecc."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.85, 'motivation': "La domanda dell'utente indica che potrebbe essere interessato a prenotare un appuntamento con un determinato servizio o reparto."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:33.614601
====================================================================================================
ğŸ“‹ Session ID: classify_1756769073
â±ï¸  Processing Time: 0.827s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (279 chars):
   [UTENTE] a che ore siete aperti? [ASSISTENTE] Gli orari di apertura possono variare a seconda del servizio o del reparto che desideri visitare. Potresti specificare a quale servizio o reparto ti ri...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (203 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.85, 'motivation': "La domanda dell'utente indica che potrebbe essere interessato a prenotare un appuntamento con un determinato servizio o reparto."}

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.85
   motivation: La domanda dell'utente indica che potrebbe essere interessato a prenotare un appuntamento con un determinato servizio o reparto.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.850
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] 85.0%

ğŸ§  Reasoning/Motivation:
   La domanda dell'utente indica che potrebbe essere interessato a prenotare un appuntamento con un determinato servizio o reparto.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione ccda1ed50a5417e2dcaf8e0e44c89e87 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 685
   ğŸ’¬ Token conversazione: 188
   ğŸ“Š Token totali: 873
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 873 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione originale: 188
   ğŸ“Š Token conversazione finale: 188
   ğŸ“Š Token totali: 873
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 663 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] La struttura Ã¨ convenzionata ma alcuni medici non lo sono Unisalute [ASSISTENTE] Se ti riferisci alla possibilitÃ  di prenotare visite o esami con Unisalute, Ã¨ importante sapere che alcune prestazioni potrebbero essere coperte dalla convenzione, mentre altre no. Inoltre, non tutti i medic..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4074 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione: 188
   ğŸ“Š Token totali stimati: 873
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] La struttura Ã¨ convenzionata ma alcuni medici non lo sono Unisalute [ASSISTENTE] Se ti riferisci alla possibilitÃ  di prenotare visite o esami con Unisalute, Ã¨ importante sapere che alcune prestazioni potrebbero essere coperte dalla convenzione, mentre altre no. Inoltre, non tutti i medic..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di visite o esami con Unisalute e il fatto che non tutti i medici potrebbero essere inclusi nella convenzione con Humanitas. Questo fa capire che si tratta di un servizio aziendale, in particolare l'ufficio prenotazioni."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:35.029541
====================================================================================================
ğŸ“‹ Session ID: classify_1756769075
â±ï¸  Processing Time: 1.328s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (663 chars):
   [UTENTE] La struttura Ã¨ convenzionata ma alcuni medici non lo sono Unisalute [ASSISTENTE] Se ti riferisci alla possibilitÃ  di prenotare visite o esami con Unisalute, Ã¨ importante sapere che alcune ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (342 chars):
   {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di visite o esami con Unisalute e il fatto che non tutti i medici potrebbero essere inclusi nella convenzione con Humanitas. Questo fa capire che si tratta di un servizio aziend...

ğŸ“Š Parsed Response:
   predicted_label: "Servizi aziendali"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di visite o esami con Unisalute e il fatto che non tutti i medici potrebbero essere inclusi nella convenzione con Humanitas. Questo fa capire che si tratta di un servizio aziendale, in particolare l'ufficio prenotazioni.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la prenotazione di visite o esami con Unisalute e il fatto che non tutti i medici potrebbero essere inclusi nella convenzione con Humanitas. Questo fa capire che si tratta di un servizio aziendale, in particolare l'ufficio prenotazioni.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione c709a229dd6729152098b7849dfcb7b8 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Servizi aziendali"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 686
   ğŸ’¬ Token conversazione: 129
   ğŸ“Š Token totali: 815
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 815 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 686
   ğŸ“Š Token conversazione originale: 129
   ğŸ“Š Token conversazione finale: 129
   ğŸ“Š Token totali: 815
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 457 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] come prenotare albergo convenzionato [ASSISTENTE] Per prenotare una struttura alberghiera convenzionata con Humanitas, puoi consultare l'elenco delle strutture disponibili alla pagina dedicata sul sito di Humanitas. [...] 

Se hai necessitÃ  di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4074 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 686
   ğŸ“Š Token conversazione: 129
   ğŸ“Š Token totali stimati: 815
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] come prenotare albergo convenzionato [ASSISTENTE] Per prenotare una struttura alberghiera convenzionata con Humanitas, puoi consultare l'elenco delle strutture disponibili alla pagina dedicata sul sito di Humanitas. [...] 

Se hai necessitÃ  di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'alloggio', 'confidence': 1.0, 'motivation': 'La conversazione riguarda la prenotazione di un albergo convenzionato con Humanitas, quindi la classificazione Ã¨ "alloggio".'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:35.913590
====================================================================================================
ğŸ“‹ Session ID: classify_1756769075
â±ï¸  Processing Time: 0.797s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (457 chars):
   [UTENTE] come prenotare albergo convenzionato [ASSISTENTE] Per prenotare una struttura alberghiera convenzionata con Humanitas, puoi consultare l'elenco delle strutture disponibili alla pagina dedi...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [105 more lines] ...
     Line 109: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (192 chars):
   {'predicted_label': 'alloggio', 'confidence': 1.0, 'motivation': 'La conversazione riguarda la prenotazione di un albergo convenzionato con Humanitas, quindi la classificazione Ã¨ "alloggio".'}

ğŸ“Š Parsed Response:
   predicted_label: alloggio
   confidence: 1.0
   motivation: La conversazione riguarda la prenotazione di un albergo convenzionato con Humanitas, quindi la classificazione Ã¨ "alloggio".
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 1.000
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un albergo convenzionato con Humanitas, quindi la classificazione Ã¨ "alloggio".
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 1d54dd8cd6a07edd51e97388c0ba687b classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'alloggio' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 686
   ğŸ’¬ Token conversazione: 169
   ğŸ“Š Token totali: 855
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 855 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 686
   ğŸ“Š Token conversazione originale: 169
   ğŸ“Š Token conversazione finale: 169
   ğŸ“Š Token totali: 855
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 557 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ci sono navette da Milano Linate per l'ospedale? [ASSISTENTE] Non ci sono informazioni specifiche sulla presenza di navette dirette da Milano Linate all'Istituto Clinico Humanitas. [...] it/info/viaggi)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 3986 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 686
   ğŸ“Š Token conversazione: 169
   ğŸ“Š Token totali stimati: 855
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ci sono navette da Milano Linate per l'ospedale? [ASSISTENTE] Non ci sono informazioni specifiche sulla presenza di navette dirette da Milano Linate all'Istituto Clinico Humanitas. [...] it/info/viaggi)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda un servizio di trasporto offerto dall\'ospedale Humanitas, quindi Ã¨ stata classificata come "Servizi aziendali".'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:36.927520
====================================================================================================
ğŸ“‹ Session ID: classify_1756769076
â±ï¸  Processing Time: 0.928s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (557 chars):
   [UTENTE] Ci sono navette da Milano Linate per l'ospedale? [ASSISTENTE] Non ci sono informazioni specifiche sulla presenza di navette dirette da Milano Linate all'Istituto Clinico Humanitas. Tuttavi...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (218 chars):
   {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda un servizio di trasporto offerto dall\'ospedale Humanitas, quindi Ã¨ stata classificata come "Servizi aziendali".'}

ğŸ“Š Parsed Response:
   predicted_label: "Servizi aziendali"
   confidence: 0.95
   motivation: La conversazione riguarda un servizio di trasporto offerto dall'ospedale Humanitas, quindi Ã¨ stata classificata come "Servizi aziendali".
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda un servizio di trasporto offerto dall'ospedale Humanitas, quindi Ã¨ stata classificata come "Servizi aziendali".
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 050328634e866caa6c93d49607c05940 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Servizi aziendali"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 684
   ğŸ’¬ Token conversazione: 731
   ğŸ“Š Token totali: 1415
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1415 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 684
   ğŸ“Š Token conversazione originale: 731
   ğŸ“Š Token conversazione finale: 731
   ğŸ“Š Token totali: 1415
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2360 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao sono Giada, ho bisogno di aiuto per l'aereo  [ASSISTENTE] Ciao Giada! Potresti spiegarmi meglio di cosa hai bisogno riguardo l'aereo? Ad esempio, hai bisogno di indicazioni per raggiungere un aeroporto, informazioni sui voli o altro? Sono qui per aiutarti! [UTENTE] Informazioni sui ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4066 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 684
   ğŸ“Š Token conversazione: 731
   ğŸ“Š Token totali stimati: 1415
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao sono Giada, ho bisogno di aiuto per l'aereo  [ASSISTENTE] Ciao Giada! Potresti spiegarmi meglio di cosa hai bisogno riguardo l'aereo? Ad esempio, hai bisogno di indicazioni per raggiungere un aeroporto, informazioni sui voli o altro? Sono qui per aiutarti! [UTENTE] Informazioni sui ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la richiesta di informazioni per raggiungere l\'ospedale Humanitas tramite un taxi dall\'Aeroporto di Milano Linate, quindi Ã¨ piÃ¹ appropriato classificarla come "Prenotazione" poichÃ© il cliente ha espresso la necessitÃ  di trasporto.'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:38.578799
====================================================================================================
ğŸ“‹ Session ID: classify_1756769078
â±ï¸  Processing Time: 1.560s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2360 chars):
   [UTENTE] Ciao sono Giada, ho bisogno di aiuto per l'aereo  [ASSISTENTE] Ciao Giada! Potresti spiegarmi meglio di cosa hai bisogno riguardo l'aereo? Ad esempio, hai bisogno di indicazioni per raggiu...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (333 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la richiesta di informazioni per raggiungere l\'ospedale Humanitas tramite un taxi dall\'Aeroporto di Milano Linate, quindi Ã¨ piÃ¹ appropriato classificarla come "Prenotazione" poichÃ© il cliente ha e...

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la richiesta di informazioni per raggiungere l'ospedale Humanitas tramite un taxi dall'Aeroporto di Milano Linate, quindi Ã¨ piÃ¹ appropriato classificarla come "Prenotazione" poichÃ© il cliente ha espresso la necessitÃ  di trasporto.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la richiesta di informazioni per raggiungere l'ospedale Humanitas tramite un taxi dall'Aeroporto di Milano Linate, quindi Ã¨ piÃ¹ appropriato classificarla come "Prenotazione" poichÃ© il cliente ha espresso la necessitÃ  di trasporto.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 9f75200918400cf753d993e72bde7eab classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 665
   ğŸ’¬ Token conversazione: 382
   ğŸ“Š Token totali: 1047
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1047 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 665
   ğŸ“Š Token conversazione originale: 382
   ğŸ“Š Token conversazione finale: 382
   ğŸ“Š Token totali: 1047
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1280 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Salve Giulia, se prenoto un volo, tramite le vostre convenzioni viaggiare insieme, Ã¨  prevista l'assistenza medica o solo una scontistica del prezzo del biglietto aereo? [ASSISTENTE] La convenzione "Viaggia insieme a noi" di Humanitas offre sconti sui biglietti aerei (50%-55% sulle tarif..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4002 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 665
   ğŸ“Š Token conversazione: 382
   ğŸ“Š Token totali stimati: 1047
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Salve Giulia, se prenoto un volo, tramite le vostre convenzioni viaggiare insieme, Ã¨  prevista l'assistenza medica o solo una scontistica del prezzo del biglietto aereo? [ASSISTENTE] La convenzione "Viaggia insieme a noi" di Humanitas offre sconti sui biglietti aerei (50%-55% sulle tarif..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un volo e l\'assistenza medica o speciale che puÃ² essere richiesta in aeroporto, nonchÃ© il costo di questi servizi. Questo Ã¨ un argomento relativo ai "Servizi aziendali" offerti da Humanitas.'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:40.039318
====================================================================================================
ğŸ“‹ Session ID: classify_1756769080
â±ï¸  Processing Time: 1.373s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1280 chars):
   [UTENTE] Salve Giulia, se prenoto un volo, tramite le vostre convenzioni viaggiare insieme, Ã¨  prevista l'assistenza medica o solo una scontistica del prezzo del biglietto aereo? [ASSISTENTE] La co...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (316 chars):
   {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un volo e l\'assistenza medica o speciale che puÃ² essere richiesta in aeroporto, nonchÃ© il costo di questi servizi. Questo Ã¨ un argomento relativo ai "Servizi aziendali" offe...

ğŸ“Š Parsed Response:
   predicted_label: "Servizi aziendali"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di un volo e l'assistenza medica o speciale che puÃ² essere richiesta in aeroporto, nonchÃ© il costo di questi servizi. Questo Ã¨ un argomento relativo ai "Servizi aziendali" offerti da Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un volo e l'assistenza medica o speciale che puÃ² essere richiesta in aeroporto, nonchÃ© il costo di questi servizi. Questo Ã¨ un argomento relativo ai "Servizi aziendali" offerti da Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione b0cf7c8405339e14a5be077d7b754023 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Servizi aziendali"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 685
   ğŸ’¬ Token conversazione: 127
   ğŸ“Š Token totali: 812
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 812 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione originale: 127
   ğŸ“Š Token conversazione finale: 127
   ğŸ“Š Token totali: 812
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 439 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Desidero sapere il costo di una prima visita proctologica  [ASSISTENTE] Non ho trovato informazioni specifiche sul costo di una prima visita proctologica nei documenti forniti. [...] it/visite-ed-esami/visita-proctologica)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4005 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione: 127
   ğŸ“Š Token totali stimati: 812
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Desidero sapere il costo di una prima visita proctologica  [ASSISTENTE] Non ho trovato informazioni specifiche sul costo di una prima visita proctologica nei documenti forniti. [...] it/visite-ed-esami/visita-proctologica)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di informazioni sui costi per una visita proctologica, che Ã¨ un servizio offerto dall'azienda."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:41.036479
====================================================================================================
ğŸ“‹ Session ID: classify_1756769081
â±ï¸  Processing Time: 0.910s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (439 chars):
   [UTENTE] Desidero sapere il costo di una prima visita proctologica  [ASSISTENTE] Non ho trovato informazioni specifiche sul costo di una prima visita proctologica nei documenti forniti. Ti consigli...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (213 chars):
   {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di informazioni sui costi per una visita proctologica, che Ã¨ un servizio offerto dall'azienda."}

ğŸ“Š Parsed Response:
   predicted_label: "Servizi aziendali"
   confidence: 0.95
   motivation: La conversazione riguarda la richiesta di informazioni sui costi per una visita proctologica, che Ã¨ un servizio offerto dall'azienda.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la richiesta di informazioni sui costi per una visita proctologica, che Ã¨ un servizio offerto dall'azienda.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione b0ea843d48d0711c3a0d740aee83aa2d classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Servizi aziendali"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 685
   ğŸ’¬ Token conversazione: 201
   ğŸ“Š Token totali: 886
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 886 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione originale: 201
   ğŸ“Š Token conversazione finale: 201
   ğŸ“Š Token totali: 886
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 693 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei fare vaccino anti epatite A [ASSISTENTE] Per sapere se Ã¨ possibile effettuare il vaccino contro l'epatite A presso Humanitas, ti consiglio di contattare direttamente il centralino al numero 02 82241. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4061 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione: 201
   ğŸ“Š Token totali stimati: 886
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei fare vaccino anti epatite A [ASSISTENTE] Per sapere se Ã¨ possibile effettuare il vaccino contro l'epatite A presso Humanitas, ti consiglio di contattare direttamente il centralino al numero 02 82241. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un vaccino anti epatite A presso Humanitas, che richiede contatto con il centralino per verificare se Ã¨ possibile effettuare la prenotazione online o seguire altre modalitÃ .'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:42.252466
====================================================================================================
ğŸ“‹ Session ID: classify_1756769082
â±ï¸  Processing Time: 1.129s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (693 chars):
   [UTENTE] Vorrei fare vaccino anti epatite A [ASSISTENTE] Per sapere se Ã¨ possibile effettuare il vaccino contro l'epatite A presso Humanitas, ti consiglio di contattare direttamente il centralino a...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (293 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un vaccino anti epatite A presso Humanitas, che richiede contatto con il centralino per verificare se Ã¨ possibile effettuare la prenotazione online o seguire altre modalitÃ .'}

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di un vaccino anti epatite A presso Humanitas, che richiede contatto con il centralino per verificare se Ã¨ possibile effettuare la prenotazione online o seguire altre modalitÃ .
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un vaccino anti epatite A presso Humanitas, che richiede contatto con il centralino per verificare se Ã¨ possibile effettuare la prenotazione online o seguire altre modalitÃ .
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 50b0258a70adcc854fddb070c61d7cde classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 685
   ğŸ’¬ Token conversazione: 358
   ğŸ“Š Token totali: 1043
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1043 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione originale: 358
   ğŸ“Š Token conversazione finale: 358
   ğŸ“Š Token totali: 1043
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1220 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao, devo fare il rinnovo del certificato DSA, volevo sapere cosa devo fare e quanto mi viene a costare e poi volevo chiedere se potevo farlo a pagamento?  [ASSISTENTE] Non ho trovato informazioni specifiche sul rinnovo del certificato DSA nei documenti caricati. Ti consiglio di contatt..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4074 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione: 358
   ğŸ“Š Token totali stimati: 1043
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao, devo fare il rinnovo del certificato DSA, volevo sapere cosa devo fare e quanto mi viene a costare e poi volevo chiedere se potevo farlo a pagamento?  [ASSISTENTE] Non ho trovato informazioni specifiche sul rinnovo del certificato DSA nei documenti caricati. Ti consiglio di contatt..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di un esame medico, precisamente il rinnovo del certificato DSA. Il richiedente chiede informazioni su come procedere e sul costo dell'esame, oltre a verificare l'indirizzo email corretto per contattare il centro di prenotazione."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:43.796187
====================================================================================================
ğŸ“‹ Session ID: classify_1756769083
â±ï¸  Processing Time: 1.455s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1220 chars):
   [UTENTE] ciao, devo fare il rinnovo del certificato DSA, volevo sapere cosa devo fare e quanto mi viene a costare e poi volevo chiedere se potevo farlo a pagamento?  [ASSISTENTE] Non ho trovato inf...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (346 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di un esame medico, precisamente il rinnovo del certificato DSA. Il richiedente chiede informazioni su come procedere e sul costo dell'esame, oltre a verificare l'indirizzo email cor...

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di un esame medico, precisamente il rinnovo del certificato DSA. Il richiedente chiede informazioni su come procedere e sul costo dell'esame, oltre a verificare l'indirizzo email corretto per contattare il centro di prenotazione.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un esame medico, precisamente il rinnovo del certificato DSA. Il richiedente chiede informazioni su come procedere e sul costo dell'esame, oltre a verificare l'indirizzo email corretto per contattare il centro di prenotazione.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f0e99f278a51d9a46ad87c6574653568 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 665
   ğŸ’¬ Token conversazione: 142
   ğŸ“Š Token totali: 807
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 807 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 665
   ğŸ“Š Token conversazione originale: 142
   ğŸ“Š Token conversazione finale: 142
   ğŸ“Š Token totali: 807
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 531 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei acquistare tramite welfare un checkup uomo personalizzato del valore di 1000euro, in cosa consiste il checkup personalizzato del valore di 1000euro?  [ASSISTENTE] Non ho trovato informazioni specifiche sul checkup uomo personalizzato del valore di 1000 euro nei documenti caricati...."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4002 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 665
   ğŸ“Š Token conversazione: 142
   ğŸ“Š Token totali stimati: 807
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei acquistare tramite welfare un checkup uomo personalizzato del valore di 1000euro, in cosa consiste il checkup personalizzato del valore di 1000euro?  [ASSISTENTE] Non ho trovato informazioni specifiche sul checkup uomo personalizzato del valore di 1000 euro nei documenti caricati...."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': 'La richiesta riguarda un servizio di welfare che non Ã¨ specifico in nessun documento caricato, quindi la classificazione piÃ¹ appropriata Ã¨ "Servizi aziendali".'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:44.868486
====================================================================================================
ğŸ“‹ Session ID: classify_1756769084
â±ï¸  Processing Time: 0.985s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (531 chars):
   [UTENTE] Vorrei acquistare tramite welfare un checkup uomo personalizzato del valore di 1000euro, in cosa consiste il checkup personalizzato del valore di 1000euro?  [ASSISTENTE] Non ho trovato inf...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (239 chars):
   {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': 'La richiesta riguarda un servizio di welfare che non Ã¨ specifico in nessun documento caricato, quindi la classificazione piÃ¹ appropriata Ã¨ "Servizi aziendali".'}

ğŸ“Š Parsed Response:
   predicted_label: "Servizi aziendali"
   confidence: 0.95
   motivation: La richiesta riguarda un servizio di welfare che non Ã¨ specifico in nessun documento caricato, quindi la classificazione piÃ¹ appropriata Ã¨ "Servizi aziendali".
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La richiesta riguarda un servizio di welfare che non Ã¨ specifico in nessun documento caricato, quindi la classificazione piÃ¹ appropriata Ã¨ "Servizi aziendali".
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione fc2734ad1c81a347cbe142838178a44f classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Servizi aziendali"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 685
   ğŸ’¬ Token conversazione: 178
   ğŸ“Š Token totali: 863
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 863 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione originale: 178
   ğŸ“Š Token conversazione finale: 178
   ğŸ“Š Token totali: 863
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 543 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia, io devo venire in Humanitas domani. [...] )

Fammi sapere cosÃ¬ posso darti indicazioni precise! [UTENTE] Rozzano, mezzi pubblici [ASSISTENTE] Perfetto! Vuoi utilizzare l'autobus, la metro, il tram o il treno per raggiungere Humanitas Rozzano da Porta Venezia?"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4055 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione: 178
   ğŸ“Š Token totali stimati: 863
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia, io devo venire in Humanitas domani. [...] )

Fammi sapere cosÃ¬ posso darti indicazioni precise! [UTENTE] Rozzano, mezzi pubblici [ASSISTENTE] Perfetto! Vuoi utilizzare l'autobus, la metro, il tram o il treno per raggiungere Humanitas Rozzano da Porta Venezia?"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda una prenotazione di un paziente che intende recarsi a Humanitas Rozzano il giorno successivo e chiede indicazioni su come raggiungere l'ospedale utilizzando i mezzi pubblici."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:46.086160
====================================================================================================
ğŸ“‹ Session ID: classify_1756769086
â±ï¸  Processing Time: 1.132s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (543 chars):
   [UTENTE] Ciao Giulia, io devo venire in Humanitas domani. Come posso arrivarci da Porta Venezia? [ASSISTENTE] Per aiutarti al meglio, ho bisogno di sapere:

1. In quale sede di Humanitas devi andar...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [105 more lines] ...
     Line 109: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (275 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda una prenotazione di un paziente che intende recarsi a Humanitas Rozzano il giorno successivo e chiede indicazioni su come raggiungere l'ospedale utilizzando i mezzi pubblici."}

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda una prenotazione di un paziente che intende recarsi a Humanitas Rozzano il giorno successivo e chiede indicazioni su come raggiungere l'ospedale utilizzando i mezzi pubblici.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda una prenotazione di un paziente che intende recarsi a Humanitas Rozzano il giorno successivo e chiede indicazioni su come raggiungere l'ospedale utilizzando i mezzi pubblici.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 68416f611be4828552d0f69d164e274c classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 665
   ğŸ’¬ Token conversazione: 85
   ğŸ“Š Token totali: 750
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 750 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 665
   ğŸ“Š Token conversazione originale: 85
   ğŸ“Š Token conversazione finale: 85
   ğŸ“Š Token totali: 750
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 267 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] La linea 220 Ã¨ extraurbana? [ASSISTENTE] SÃ¬, la linea 220 Ã¨ una linea extraurbana che collega Humanitas con Pieve Emanuele, Opera e Locate, partendo da Rozzano, via della SolidarietÃ ã€6:0â€ scraped_https___www.humanitas.it_info_come-raggiungere-humanitas.jsonã€‘."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 3969 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 665
   ğŸ“Š Token conversazione: 85
   ğŸ“Š Token totali stimati: 750
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] La linea 220 Ã¨ extraurbana? [ASSISTENTE] SÃ¬, la linea 220 Ã¨ una linea extraurbana che collega Humanitas con Pieve Emanuele, Opera e Locate, partendo da Rozzano, via della SolidarietÃ ã€6:0â€ scraped_https___www.humanitas.it_info_come-raggiungere-humanitas.jsonã€‘."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 1.0, 'motivation': "La domanda dell'utente riguarda la localizzazione della linea di trasporto che collega l'ospedale Humanitas con altre cittÃ , quindi si tratta di una prenotazione."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:47.120103
====================================================================================================
ğŸ“‹ Session ID: classify_1756769087
â±ï¸  Processing Time: 0.948s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (267 chars):
   [UTENTE] La linea 220 Ã¨ extraurbana? [ASSISTENTE] SÃ¬, la linea 220 Ã¨ una linea extraurbana che collega Humanitas con Pieve Emanuele, Opera e Locate, partendo da Rozzano, via della SolidarietÃ ã€6:0â€ s...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (236 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 1.0, 'motivation': "La domanda dell'utente riguarda la localizzazione della linea di trasporto che collega l'ospedale Humanitas con altre cittÃ , quindi si tratta di una prenotazione."}

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 1.0
   motivation: La domanda dell'utente riguarda la localizzazione della linea di trasporto che collega l'ospedale Humanitas con altre cittÃ , quindi si tratta di una prenotazione.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 1.000
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100.0%

ğŸ§  Reasoning/Motivation:
   La domanda dell'utente riguarda la localizzazione della linea di trasporto che collega l'ospedale Humanitas con altre cittÃ , quindi si tratta di una prenotazione.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione f7322d94b97b199c32b8ac8028531b47 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 665
   ğŸ’¬ Token conversazione: 303
   ğŸ“Š Token totali: 968
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 968 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 665
   ğŸ“Š Token conversazione originale: 303
   ğŸ“Š Token conversazione finale: 303
   ğŸ“Š Token totali: 968
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 903 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao giulia abito a lesmo come raggiungo la sede di rozzano in auto [ASSISTENTE] Per aiutarti a raggiungere la sede di Rozzano in auto da Lesmo, calcolo il percorso. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 3948 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 665
   ğŸ“Š Token conversazione: 303
   ğŸ“Š Token totali stimati: 968
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao giulia abito a lesmo come raggiungo la sede di rozzano in auto [ASSISTENTE] Per aiutarti a raggiungere la sede di Rozzano in auto da Lesmo, calcolo il percorso. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di percorso da Lesmo a Rozzano in auto, che Ã¨ una richiesta comune per le prenotazioni o visite presso l'ospedale Humanitas."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:48.301559
====================================================================================================
ğŸ“‹ Session ID: classify_1756769088
â±ï¸  Processing Time: 1.095s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (903 chars):
   [UTENTE] ciao giulia abito a lesmo come raggiungo la sede di rozzano in auto [ASSISTENTE] Per aiutarti a raggiungere la sede di Rozzano in auto da Lesmo, calcolo il percorso. Un attimo di pazienza....

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (238 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di percorso da Lesmo a Rozzano in auto, che Ã¨ una richiesta comune per le prenotazioni o visite presso l'ospedale Humanitas."}

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la richiesta di percorso da Lesmo a Rozzano in auto, che Ã¨ una richiesta comune per le prenotazioni o visite presso l'ospedale Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la richiesta di percorso da Lesmo a Rozzano in auto, che Ã¨ una richiesta comune per le prenotazioni o visite presso l'ospedale Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione bf943628a47730c170498e26807edc8e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 685
   ğŸ’¬ Token conversazione: 85
   ğŸ“Š Token totali: 770
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 770 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione originale: 85
   ğŸ“Š Token conversazione finale: 85
   ğŸ“Š Token totali: 770
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 277 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, vorrei capire come arrivare dallâ€™autostrada al centro di P Ricovero via Building 4 [ASSISTENTE] Per aiutarti al meglio, potresti specificare da quale autostrada stai arrivando? Inoltre, desideri sapere il percorso in auto o con un altro mezzo di trasporto?"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4051 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione: 85
   ğŸ“Š Token totali stimati: 770
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, vorrei capire come arrivare dallâ€™autostrada al centro di P Ricovero via Building 4 [ASSISTENTE] Per aiutarti al meglio, potresti specificare da quale autostrada stai arrivando? Inoltre, desideri sapere il percorso in auto o con un altro mezzo di trasporto?"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione sembra riguardare la prenotazione di un viaggio verso il centro di P Ricovero, ma manca informazioni sulla autostrada da cui si sta arrivando e sul mezzo di trasporto utilizzato.'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:49.431871
====================================================================================================
ğŸ“‹ Session ID: classify_1756769089
â±ï¸  Processing Time: 1.044s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (277 chars):
   [UTENTE] Buongiorno, vorrei capire come arrivare dallâ€™autostrada al centro di P Ricovero via Building 4 [ASSISTENTE] Per aiutarti al meglio, potresti specificare da quale autostrada stai arrivando?...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (270 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione sembra riguardare la prenotazione di un viaggio verso il centro di P Ricovero, ma manca informazioni sulla autostrada da cui si sta arrivando e sul mezzo di trasporto utilizzato.'}

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione sembra riguardare la prenotazione di un viaggio verso il centro di P Ricovero, ma manca informazioni sulla autostrada da cui si sta arrivando e sul mezzo di trasporto utilizzato.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione sembra riguardare la prenotazione di un viaggio verso il centro di P Ricovero, ma manca informazioni sulla autostrada da cui si sta arrivando e sul mezzo di trasporto utilizzato.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 36034ecbd1ab10badd44b5abf6a5055c classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 685
   ğŸ’¬ Token conversazione: 181
   ğŸ“Š Token totali: 866
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 866 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione originale: 181
   ğŸ“Š Token conversazione finale: 181
   ğŸ“Š Token totali: 866
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 692 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao,vorrei sapere se ci sono degli incontri gratuiti dove spiegano tutto il percorso di inseminazione assistita,con ginecologi,psicologi [ASSISTENTE] Per quanto riguarda il percorso di inseminazione assistita, Humanitas offre un Fertility Center specializzato in procreazione medicalment..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4074 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione: 181
   ğŸ“Š Token totali stimati: 866
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao,vorrei sapere se ci sono degli incontri gratuiti dove spiegano tutto il percorso di inseminazione assistita,con ginecologi,psicologi [ASSISTENTE] Per quanto riguarda il percorso di inseminazione assistita, Humanitas offre un Fertility Center specializzato in procreazione medicalment..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la richiesta di informazioni su incontri gratuiti per spiegare il percorso di inseminazione assistita, che Ã¨ un servizio offerto dal Fertility Center di Humanitas. Tuttavia, non sono state fornite informazioni specifiche su eventuali incontri gratuiti con ginecologi o psicologi. La risposta consiglia di contattare direttamente il Fertility Center per ottenere dettagli su eventuali incontri o consulenze, e fornisce un link alla pagina dedicata al Fertility Center di Humanitas.'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:51.639021
====================================================================================================
ğŸ“‹ Session ID: classify_1756769091
â±ï¸  Processing Time: 2.119s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (692 chars):
   [UTENTE] Ciao,vorrei sapere se ci sono degli incontri gratuiti dove spiegano tutto il percorso di inseminazione assistita,con ginecologi,psicologi [ASSISTENTE] Per quanto riguarda il percorso di in...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (601 chars):
   {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la richiesta di informazioni su incontri gratuiti per spiegare il percorso di inseminazione assistita, che Ã¨ un servizio offerto dal Fertility Center di Humanitas. Tuttavia, non ...

ğŸ“Š Parsed Response:
   predicted_label: "Humanitas con te - Registrazione"
   confidence: 0.95
   motivation: La conversazione riguarda la richiesta di informazioni su incontri gratuiti per spiegare il percorso di inseminazione assistita, che Ã¨ un servizio offerto dal Fertility Center di Humanitas. Tuttavia, non sono state fornite informazioni specifiche su eventuali incontri gratuiti con ginecologi o psicologi. La risposta consiglia di contattare direttamente il Fertility Center per ottenere dettagli su eventuali incontri o consulenze, e fornisce un link alla pagina dedicata al Fertility Center di Humanitas.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la richiesta di informazioni su incontri gratuiti per spiegare il percorso di inseminazione assistita, che Ã¨ un servizio offerto dal Fertility Center di Humanitas. Tuttavia, non sono state fornite informazioni specifiche su eventuali incontri gratuiti con ginecologi o psicologi. La risposta consiglia di contattare direttamente il Fertility Center per ottenere dettagli ...
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione e603ab5e96a4628539deea7406ac6d7b classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Humanitas con te - Registrazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 685
   ğŸ’¬ Token conversazione: 697
   ğŸ“Š Token totali: 1382
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1382 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione originale: 697
   ğŸ“Š Token conversazione finale: 697
   ğŸ“Š Token totali: 1382
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2276 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao! ho bisogno di informazioni sulla crioconservazione degli ovociti [ASSISTENTE] La crioconservazione degli ovociti Ã¨ una tecnica che consente di preservare la fertilitÃ  congelando gli ovociti in azoto liquido. [...] 

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4069 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 685
   ğŸ“Š Token conversazione: 697
   ğŸ“Š Token totali stimati: 1382
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao! ho bisogno di informazioni sulla crioconservazione degli ovociti [ASSISTENTE] La crioconservazione degli ovociti Ã¨ una tecnica che consente di preservare la fertilitÃ  congelando gli ovociti in azoto liquido. [...] 

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Crioconservazione degli ovociti"', 'confidence': 1.0, 'motivation': "La conversazione riguarda la crioconservazione degli ovociti e fornisce informazioni su come funziona, dove si puÃ² trovare il servizio presso l'Humanitas Fertility Center, e come contattare il centro per ulteriori dettagli."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:53.155790
====================================================================================================
ğŸ“‹ Session ID: classify_1756769093
â±ï¸  Processing Time: 1.431s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2276 chars):
   [UTENTE] ciao! ho bisogno di informazioni sulla crioconservazione degli ovociti [ASSISTENTE] La crioconservazione degli ovociti Ã¨ una tecnica che consente di preservare la fertilitÃ  congelando gli ...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [105 more lines] ...
     Line 109: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (316 chars):
   {'predicted_label': '"Crioconservazione degli ovociti"', 'confidence': 1.0, 'motivation': "La conversazione riguarda la crioconservazione degli ovociti e fornisce informazioni su come funziona, dove si puÃ² trovare il servizio presso l'Humanitas Fertility Center, e come contattare il centro per ul...

ğŸ“Š Parsed Response:
   predicted_label: "Crioconservazione degli ovociti"
   confidence: 1.0
   motivation: La conversazione riguarda la crioconservazione degli ovociti e fornisce informazioni su come funziona, dove si puÃ² trovare il servizio presso l'Humanitas Fertility Center, e come contattare il centro per ulteriori dettagli.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 1.000
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la crioconservazione degli ovociti e fornisce informazioni su come funziona, dove si puÃ² trovare il servizio presso l'Humanitas Fertility Center, e come contattare il centro per ulteriori dettagli.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione a95a8638e9b52c4b8a678e6bf9a9d343 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  âœ… Nuovo tag '"Crioconservazione degli ovociti"' aggiunto per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 697
   ğŸ’¬ Token conversazione: 419
   ğŸ“Š Token totali: 1116
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1116 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 697
   ğŸ“Š Token conversazione originale: 419
   ğŸ“Š Token conversazione finale: 419
   ğŸ“Š Token totali: 1116
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1470 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei avere informazioni su come accedere alla PMA [ASSISTENTE] Per accedere alla Procreazione Medicalmente Assistita (PMA) presso Humanitas, puoi seguire un percorso dedicato che include diverse tecniche, come l'inseminazione intrauterina (IUI) e la fecondazione in vitro (FIVET/ICSI). ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4110 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 697
   ğŸ“Š Token conversazione: 419
   ğŸ“Š Token totali stimati: 1116
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei avere informazioni su come accedere alla PMA [ASSISTENTE] Per accedere alla Procreazione Medicalmente Assistita (PMA) presso Humanitas, puoi seguire un percorso dedicato che include diverse tecniche, come l'inseminazione intrauterina (IUI) e la fecondazione in vitro (FIVET/ICSI). ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Crioconservazione degli ovociti"', 'confidence': 0.98, 'motivation': "La conversazione riguarda l'accesso alla Procreazione Medicalmente Assistita (PMA) e la richiesta di informazioni su come accedere tramite il Servizio Sanitario Nazionale (SSN). In particolare, viene chiesto quale tipo di impegnativa devono portare per accedere al trattamento. La conversazione Ã¨ molto chiara e specifica sul fatto che si tratta di una richiesta di informazioni su come accedere alla Crioconservazione degli ovociti, un trattamento di PMA."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:55.420482
====================================================================================================
ğŸ“‹ Session ID: classify_1756769095
â±ï¸  Processing Time: 2.169s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1470 chars):
   [UTENTE] Vorrei avere informazioni su come accedere alla PMA [ASSISTENTE] Per accedere alla Procreazione Medicalmente Assistita (PMA) presso Humanitas, puoi seguire un percorso dedicato che include...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (550 chars):
   {'predicted_label': '"Crioconservazione degli ovociti"', 'confidence': 0.98, 'motivation': "La conversazione riguarda l'accesso alla Procreazione Medicalmente Assistita (PMA) e la richiesta di informazioni su come accedere tramite il Servizio Sanitario Nazionale (SSN). In particolare, viene chies...

ğŸ“Š Parsed Response:
   predicted_label: "Crioconservazione degli ovociti"
   confidence: 0.98
   motivation: La conversazione riguarda l'accesso alla Procreazione Medicalmente Assistita (PMA) e la richiesta di informazioni su come accedere tramite il Servizio Sanitario Nazionale (SSN). In particolare, viene chiesto quale tipo di impegnativa devono portare per accedere al trattamento. La conversazione Ã¨ molto chiara e specifica sul fatto che si tratta di una richiesta di informazioni su come accedere alla Crioconservazione degli ovociti, un trattamento di PMA.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.980
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 98.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda l'accesso alla Procreazione Medicalmente Assistita (PMA) e la richiesta di informazioni su come accedere tramite il Servizio Sanitario Nazionale (SSN). In particolare, viene chiesto quale tipo di impegnativa devono portare per accedere al trattamento. La conversazione Ã¨ molto chiara e specifica sul fatto che si tratta di una richiesta di informazioni su come accedere a...
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione c505b12e4e761de86e1fc8f280450482 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Crioconservazione degli ovociti"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 696
   ğŸ’¬ Token conversazione: 927
   ğŸ“Š Token totali: 1623
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1623 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 696
   ğŸ“Š Token conversazione originale: 927
   ğŸ“Š Token conversazione finale: 927
   ğŸ“Š Token totali: 1623
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 3113 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] informazioni su p,a omologa [ASSISTENTE] Non ho trovato informazioni specifiche sulla "P. [...]  Se desideri ulteriori informazioni sui percorsi di PMA eterologa presso Humanitas, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4011 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 696
   ğŸ“Š Token conversazione: 927
   ğŸ“Š Token totali stimati: 1623
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] informazioni su p,a omologa [ASSISTENTE] Non ho trovato informazioni specifiche sulla "P. [...]  Se desideri ulteriori informazioni sui percorsi di PMA eterologa presso Humanitas, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di informazioni su un percorso medico specifico (in questo caso PMA omologa) e l'assistente fornisce dettagli sulle tecnologie e i servizi disponibili presso il Fertility Center di Humanitas. Inoltre, l'assistente offre ulteriori informazioni su come accedere al percorso PMA in regime privato o tramite il Servizio Sanitario Nazionale (SSN)."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:57.551224
====================================================================================================
ğŸ“‹ Session ID: classify_1756769097
â±ï¸  Processing Time: 2.043s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (3113 chars):
   [UTENTE] informazioni su p,a omologa [ASSISTENTE] Non ho trovato informazioni specifiche sulla "P.A. omologa" nei documenti caricati. Potresti fornire ulteriori dettagli o chiarire la tua richiesta...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (456 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di informazioni su un percorso medico specifico (in questo caso PMA omologa) e l'assistente fornisce dettagli sulle tecnologie e i servizi disponibili presso il Fertility Center di Huma...

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la richiesta di informazioni su un percorso medico specifico (in questo caso PMA omologa) e l'assistente fornisce dettagli sulle tecnologie e i servizi disponibili presso il Fertility Center di Humanitas. Inoltre, l'assistente offre ulteriori informazioni su come accedere al percorso PMA in regime privato o tramite il Servizio Sanitario Nazionale (SSN).
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la richiesta di informazioni su un percorso medico specifico (in questo caso PMA omologa) e l'assistente fornisce dettagli sulle tecnologie e i servizi disponibili presso il Fertility Center di Humanitas. Inoltre, l'assistente offre ulteriori informazioni su come accedere al percorso PMA in regime privato o tramite il Servizio Sanitario Nazionale (SSN).
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 68bddbfcc3906e4a448cb5ef945aaf14 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 696
   ğŸ’¬ Token conversazione: 209
   ğŸ“Š Token totali: 905
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 905 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 696
   ğŸ“Š Token conversazione originale: 209
   ğŸ“Š Token conversazione finale: 209
   ğŸ“Š Token totali: 905
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 642 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Dove parcheggiare  [ASSISTENTE] In quale building o sede Humanitas devi andare? CosÃ¬ posso indicarti il parcheggio piÃ¹ vicino. [...] it/info/come-raggiungere-humanitas/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 3987 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 696
   ğŸ“Š Token conversazione: 209
   ğŸ“Š Token totali stimati: 905
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Dove parcheggiare  [ASSISTENTE] In quale building o sede Humanitas devi andare? CosÃ¬ posso indicarti il parcheggio piÃ¹ vicino. [...] it/info/come-raggiungere-humanitas/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Visita Specialistica Oncologica"', 'confidence': 1.0, 'motivation': 'La conversazione riguarda una visita oncologica, quindi la classificazione Ã¨ "Visita Specialistica Oncologica". Il livello di confidenza Ã¨ alto perchÃ© il contenuto della conversazione Ã¨ chiaramente correlato a questa categoria.'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:58.860055
====================================================================================================
ğŸ“‹ Session ID: classify_1756769098
â±ï¸  Processing Time: 1.215s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (642 chars):
   [UTENTE] Dove parcheggiare  [ASSISTENTE] In quale building o sede Humanitas devi andare? CosÃ¬ posso indicarti il parcheggio piÃ¹ vicino. [UTENTE] Devo fare visita oncologica  [ASSISTENTE] Per una vi...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (320 chars):
   {'predicted_label': '"Visita Specialistica Oncologica"', 'confidence': 1.0, 'motivation': 'La conversazione riguarda una visita oncologica, quindi la classificazione Ã¨ "Visita Specialistica Oncologica". Il livello di confidenza Ã¨ alto perchÃ© il contenuto della conversazione Ã¨ chiaramente correlat...

ğŸ“Š Parsed Response:
   predicted_label: "Visita Specialistica Oncologica"
   confidence: 1.0
   motivation: La conversazione riguarda una visita oncologica, quindi la classificazione Ã¨ "Visita Specialistica Oncologica". Il livello di confidenza Ã¨ alto perchÃ© il contenuto della conversazione Ã¨ chiaramente correlato a questa categoria.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 1.000
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda una visita oncologica, quindi la classificazione Ã¨ "Visita Specialistica Oncologica". Il livello di confidenza Ã¨ alto perchÃ© il contenuto della conversazione Ã¨ chiaramente correlato a questa categoria.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 8197ec36efaa04942e24a1b77eb30b49 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Visita Specialistica Oncologica"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 700
   ğŸ’¬ Token conversazione: 191
   ğŸ“Š Token totali: 891
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 891 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 700
   ğŸ“Š Token conversazione originale: 191
   ğŸ“Š Token conversazione finale: 191
   ğŸ“Š Token totali: 891
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 614 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] il parcheggio per 2 ore e 35 minuti mi Ã¨ stato fatto pagare 9,50 quando la tariffa massima risulta 8 euro [ASSISTENTE] Il costo massimo giornaliero per i parcheggi Humanitas (eccetto il Parcheggio 3) Ã¨ di 8 euro. [...]  Se hai bisogno di ulteriori dettagli, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4113 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 700
   ğŸ“Š Token conversazione: 191
   ğŸ“Š Token totali stimati: 891
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] il parcheggio per 2 ore e 35 minuti mi Ã¨ stato fatto pagare 9,50 quando la tariffa massima risulta 8 euro [ASSISTENTE] Il costo massimo giornaliero per i parcheggi Humanitas (eccetto il Parcheggio 3) Ã¨ di 8 euro. [...]  Se hai bisogno di ulteriori dettagli, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Servizi aziendali', 'confidence': 0.95, 'motivation': 'La conversazione riguarda un problema con il parcheggio dell\'ospedale Humanitas e non Ã¨ una richiesta di servizio medico, pertanto la classificazione piÃ¹ appropriata Ã¨ "Servizi aziendali".'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:00.036781
====================================================================================================
ğŸ“‹ Session ID: classify_1756769100
â±ï¸  Processing Time: 1.089s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (614 chars):
   [UTENTE] il parcheggio per 2 ore e 35 minuti mi Ã¨ stato fatto pagare 9,50 quando la tariffa massima risulta 8 euro [ASSISTENTE] Il costo massimo giornaliero per i parcheggi Humanitas (eccetto il Pa...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (267 chars):
   {'predicted_label': 'Servizi aziendali', 'confidence': 0.95, 'motivation': 'La conversazione riguarda un problema con il parcheggio dell\'ospedale Humanitas e non Ã¨ una richiesta di servizio medico, pertanto la classificazione piÃ¹ appropriata Ã¨ "Servizi aziendali".'}

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.95
   motivation: La conversazione riguarda un problema con il parcheggio dell'ospedale Humanitas e non Ã¨ una richiesta di servizio medico, pertanto la classificazione piÃ¹ appropriata Ã¨ "Servizi aziendali".
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda un problema con il parcheggio dell'ospedale Humanitas e non Ã¨ una richiesta di servizio medico, pertanto la classificazione piÃ¹ appropriata Ã¨ "Servizi aziendali".
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 73baf4007e0bd6a7707f56c9ce583ab1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 676
   ğŸ’¬ Token conversazione: 244
   ğŸ“Š Token totali: 920
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 920 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 676
   ğŸ“Š Token conversazione originale: 244
   ğŸ“Š Token conversazione finale: 244
   ğŸ“Š Token totali: 920
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 788 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] penso di avere perso il bancomat e la patente al Humanitas a Rozzano come posso fare [ASSISTENTE] Se hai perso il bancomat e la patente presso Humanitas a Rozzano, ti consiglio di recarti alla guardiania dell'ospedale...."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4037 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 676
   ğŸ“Š Token conversazione: 244
   ğŸ“Š Token totali stimati: 920
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] penso di avere perso il bancomat e la patente al Humanitas a Rozzano come posso fare [ASSISTENTE] Se hai perso il bancomat e la patente presso Humanitas a Rozzano, ti consiglio di recarti alla guardiania dell'ospedale...."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la perdita di bancomat e patente presso l'ospedale Humanitas a Rozzano, ed Ã¨ chiaro che il utente desideri recuperare queste cose. Tuttavia, la richiesta di un numero di telefono per la guardiania indica che il utente potrebbe anche voler prenotarsi per recuperare le sue cose."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:01.670159
====================================================================================================
ğŸ“‹ Session ID: classify_1756769101
â±ï¸  Processing Time: 1.543s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (788 chars):
   [UTENTE] Ciao [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] penso di avere perso il bancomat e la patente al Humanitas a Rozzano come posso fare [ASSISTENTE] Se hai perso il banc...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (378 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la perdita di bancomat e patente presso l'ospedale Humanitas a Rozzano, ed Ã¨ chiaro che il utente desideri recuperare queste cose. Tuttavia, la richiesta di un numero di telefono per la guardiania i...

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la perdita di bancomat e patente presso l'ospedale Humanitas a Rozzano, ed Ã¨ chiaro che il utente desideri recuperare queste cose. Tuttavia, la richiesta di un numero di telefono per la guardiania indica che il utente potrebbe anche voler prenotarsi per recuperare le sue cose.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la perdita di bancomat e patente presso l'ospedale Humanitas a Rozzano, ed Ã¨ chiaro che il utente desideri recuperare queste cose. Tuttavia, la richiesta di un numero di telefono per la guardiania indica che il utente potrebbe anche voler prenotarsi per recuperare le sue cose.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione e83be993a0796c4ccb879766b1133fb4 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 696
   ğŸ’¬ Token conversazione: 252
   ğŸ“Š Token totali: 948
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 948 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 696
   ğŸ“Š Token conversazione originale: 252
   ğŸ“Š Token conversazione finale: 252
   ğŸ“Š Token totali: 948
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 826 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] P18 coperto [ASSISTENTE] Il parcheggio P18 Ã¨ parzialmente coperto. [...]  Se hai bisogno di ulteriori informazioni sui parcheggi o su come raggiungere la struttura, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4005 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 696
   ğŸ“Š Token conversazione: 252
   ğŸ“Š Token totali stimati: 948
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] P18 coperto [ASSISTENTE] Il parcheggio P18 Ã¨ parzialmente coperto. [...]  Se hai bisogno di ulteriori informazioni sui parcheggi o su come raggiungere la struttura, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Servizi aziendali', 'confidence': 0.95, 'motivation': 'La conversazione riguarda il parcheggio P18 e le sue caratteristiche, in particolare che Ã¨ parzialmente coperto. Questo indica che la conversazione non riguarda un servizio medico specifico, ma piuttosto un servizio aziendale come i parcheggi.'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:03.061802
====================================================================================================
ğŸ“‹ Session ID: classify_1756769103
â±ï¸  Processing Time: 1.304s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (826 chars):
   [UTENTE] P18 coperto [ASSISTENTE] Il parcheggio P18 Ã¨ parzialmente coperto. Se hai bisogno di ulteriori informazioni sui parcheggi, puoi visitare la pagina [Indicazioni e Parcheggi](https://www.hum...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (321 chars):
   {'predicted_label': 'Servizi aziendali', 'confidence': 0.95, 'motivation': 'La conversazione riguarda il parcheggio P18 e le sue caratteristiche, in particolare che Ã¨ parzialmente coperto. Questo indica che la conversazione non riguarda un servizio medico specifico, ma piuttosto un servizio azien...

ğŸ“Š Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.95
   motivation: La conversazione riguarda il parcheggio P18 e le sue caratteristiche, in particolare che Ã¨ parzialmente coperto. Questo indica che la conversazione non riguarda un servizio medico specifico, ma piuttosto un servizio aziendale come i parcheggi.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda il parcheggio P18 e le sue caratteristiche, in particolare che Ã¨ parzialmente coperto. Questo indica che la conversazione non riguarda un servizio medico specifico, ma piuttosto un servizio aziendale come i parcheggi.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione bc04daee42adb1ef9c2bfb51c4f51319 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Servizi aziendali' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 676
   ğŸ’¬ Token conversazione: 165
   ğŸ“Š Token totali: 841
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 841 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 676
   ğŸ“Š Token conversazione originale: 165
   ğŸ“Š Token conversazione finale: 165
   ğŸ“Š Token totali: 841
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 595 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco a registrarmi tramite codice fiscale [ASSISTENTE] Se hai difficoltÃ  a registrarti utilizzando il codice fiscale, ti consiglio di verificare che i dati inseriti siano corretti. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4001 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 676
   ğŸ“Š Token conversazione: 165
   ğŸ“Š Token totali stimati: 841
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco a registrarmi tramite codice fiscale [ASSISTENTE] Se hai difficoltÃ  a registrarti utilizzando il codice fiscale, ti consiglio di verificare che i dati inseriti siano corretti. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la registrazione all\'ospedale Humanitas tramite codice fiscale, quindi Ã¨ stata classificata come "Humanitas con te - Registrazione". Il livello di confidenza Ã¨ alto perchÃ© il contenuto della conversazione Ã¨ chiaramente correlato a questa categoria.'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:04.512989
====================================================================================================
ğŸ“‹ Session ID: classify_1756769104
â±ï¸  Processing Time: 1.365s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (595 chars):
   [UTENTE] Non riesco a registrarmi tramite codice fiscale [ASSISTENTE] Se hai difficoltÃ  a registrarti utilizzando il codice fiscale, ti consiglio di verificare che i dati inseriti siano corretti. S...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [104 more lines] ...
     Line 108: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (370 chars):
   {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la registrazione all\'ospedale Humanitas tramite codice fiscale, quindi Ã¨ stata classificata come "Humanitas con te - Registrazione". Il livello di confidenza Ã¨ alto perchÃ© il co...

ğŸ“Š Parsed Response:
   predicted_label: "Humanitas con te - Registrazione"
   confidence: 0.95
   motivation: La conversazione riguarda la registrazione all'ospedale Humanitas tramite codice fiscale, quindi Ã¨ stata classificata come "Humanitas con te - Registrazione". Il livello di confidenza Ã¨ alto perchÃ© il contenuto della conversazione Ã¨ chiaramente correlato a questa categoria.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la registrazione all'ospedale Humanitas tramite codice fiscale, quindi Ã¨ stata classificata come "Humanitas con te - Registrazione". Il livello di confidenza Ã¨ alto perchÃ© il contenuto della conversazione Ã¨ chiaramente correlato a questa categoria.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione c919db36bc19031a3b13c936ccc54f36 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Humanitas con te - Registrazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 696
   ğŸ’¬ Token conversazione: 98
   ğŸ“Š Token totali: 794
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 794 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 696
   ğŸ“Š Token conversazione originale: 98
   ğŸ“Š Token conversazione finale: 98
   ğŸ“Š Token totali: 794
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 336 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] La mail non Ã¨ ancora arrivata puÃ² essere normale? [ASSISTENTE] Potrebbe essere normale che una mail impieghi un po' di tempo per arrivare, a seconda del sistema di posta elettronica utilizzato. [...]  Se hai bisogno di ulteriore assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4072 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 696
   ğŸ“Š Token conversazione: 98
   ğŸ“Š Token totali stimati: 794
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] La mail non Ã¨ ancora arrivata puÃ² essere normale? [ASSISTENTE] Potrebbe essere normale che una mail impieghi un po' di tempo per arrivare, a seconda del sistema di posta elettronica utilizzato. [...]  Se hai bisogno di ulteriore assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un servizio o una procedura medica, e il problema Ã¨ che non si Ã¨ ancora ricevuta la mail di conferma.'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:05.490627
====================================================================================================
ğŸ“‹ Session ID: classify_1756769105
â±ï¸  Processing Time: 0.891s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (336 chars):
   [UTENTE] La mail non Ã¨ ancora arrivata puÃ² essere normale? [ASSISTENTE] Potrebbe essere normale che una mail impieghi un po' di tempo per arrivare, a seconda del sistema di posta elettronica utiliz...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (221 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un servizio o una procedura medica, e il problema Ã¨ che non si Ã¨ ancora ricevuta la mail di conferma.'}

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di un servizio o una procedura medica, e il problema Ã¨ che non si Ã¨ ancora ricevuta la mail di conferma.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un servizio o una procedura medica, e il problema Ã¨ che non si Ã¨ ancora ricevuta la mail di conferma.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 7692031981c479f34d2c1a8cc9c5a900 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 697
   ğŸ’¬ Token conversazione: 316
   ğŸ“Š Token totali: 1013
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1013 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 697
   ğŸ“Š Token conversazione originale: 316
   ğŸ“Š Token conversazione finale: 316
   ğŸ“Š Token totali: 1013
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1118 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buona sera Giulia  [ASSISTENTE] Buona sera! Come posso esserti utile? ğŸ˜Š [UTENTE] Allora, devo entrare nella sezione referti, perÃ² non posso piÃ¹ entrare, perchÃ© non ho piÃ¹ il vecchio numero e non posso neppure cambiare il numero ti telefono dal vecchio a quello nuovo, perchÃ© giustamente m..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4110 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 697
   ğŸ“Š Token conversazione: 316
   ğŸ“Š Token totali stimati: 1013
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buona sera Giulia  [ASSISTENTE] Buona sera! Come posso esserti utile? ğŸ˜Š [UTENTE] Allora, devo entrare nella sezione referti, perÃ² non posso piÃ¹ entrare, perchÃ© non ho piÃ¹ il vecchio numero e non posso neppure cambiare il numero ti telefono dal vecchio a quello nuovo, perchÃ© giustamente m..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda il problema del cambio del numero di telefono associato all'account dell'utente e la richiesta di assistenza per risolvere questo problema. Il modo migliore per risolvere il problema Ã¨ contattare il Servizio di assistenza dedicata di Humanitas con te, che puÃ² essere raggiunto attraverso due modi: compilando il modulo di contatto disponibile alla pagina Help o inviando una richiesta via email all'indirizzo humanitasconte@humanitas.it."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:07.565429
====================================================================================================
ğŸ“‹ Session ID: classify_1756769107
â±ï¸  Processing Time: 1.985s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1118 chars):
   [UTENTE] Buona sera Giulia  [ASSISTENTE] Buona sera! Come posso esserti utile? ğŸ˜Š [UTENTE] Allora, devo entrare nella sezione referti, perÃ² non posso piÃ¹ entrare, perchÃ© non ho piÃ¹ il vecchio numero...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (558 chars):
   {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda il problema del cambio del numero di telefono associato all'account dell'utente e la richiesta di assistenza per risolvere questo problema. Il modo migliore per risolvere il prob...

ğŸ“Š Parsed Response:
   predicted_label: "Humanitas con te - Registrazione"
   confidence: 0.95
   motivation: La conversazione riguarda il problema del cambio del numero di telefono associato all'account dell'utente e la richiesta di assistenza per risolvere questo problema. Il modo migliore per risolvere il problema Ã¨ contattare il Servizio di assistenza dedicata di Humanitas con te, che puÃ² essere raggiunto attraverso due modi: compilando il modulo di contatto disponibile alla pagina Help o inviando una richiesta via email all'indirizzo humanitasconte@humanitas.it.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda il problema del cambio del numero di telefono associato all'account dell'utente e la richiesta di assistenza per risolvere questo problema. Il modo migliore per risolvere il problema Ã¨ contattare il Servizio di assistenza dedicata di Humanitas con te, che puÃ² essere raggiunto attraverso due modi: compilando il modulo di contatto disponibile alla pagina Help o inviando ...
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione ad8fa498655deda1b1c2b3521b35295e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Humanitas con te - Registrazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 696
   ğŸ’¬ Token conversazione: 278
   ğŸ“Š Token totali: 974
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 974 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 696
   ğŸ“Š Token conversazione originale: 278
   ğŸ“Š Token conversazione finale: 278
   ğŸ“Š Token totali: 974
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 919 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] VENGONO INVIATE EMAIL PER CONFERMA INTERVENTO [ASSISTENTE] Puoi fornirmi maggiori dettagli? Intendi sapere se Humanitas invia email per confermare un intervento chirurgico? [UTENTE] si [ASSISTENTE] SÃ¬, Humanitas invia email per confermare gli interventi chirurgici. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4106 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 696
   ğŸ“Š Token conversazione: 278
   ğŸ“Š Token totali stimati: 974
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] VENGONO INVIATE EMAIL PER CONFERMA INTERVENTO [ASSISTENTE] Puoi fornirmi maggiori dettagli? Intendi sapere se Humanitas invia email per confermare un intervento chirurgico? [UTENTE] si [ASSISTENTE] SÃ¬, Humanitas invia email per confermare gli interventi chirurgici. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Visita Specialistica Chirurgica"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda l\'invio di email per conferma di un intervento chirurgico all\'ospedale Humanitas, quindi Ã¨ stata classificata come "Visita Specialistica Chirurgica". Il livello di confidenza Ã¨ alto a causa della chiarezza del contenuto.'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:09.011292
====================================================================================================
ğŸ“‹ Session ID: classify_1756769109
â±ï¸  Processing Time: 1.358s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (919 chars):
   [UTENTE] VENGONO INVIATE EMAIL PER CONFERMA INTERVENTO [ASSISTENTE] Puoi fornirmi maggiori dettagli? Intendi sapere se Humanitas invia email per confermare un intervento chirurgico? [UTENTE] si [AS...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (342 chars):
   {'predicted_label': '"Visita Specialistica Chirurgica"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda l\'invio di email per conferma di un intervento chirurgico all\'ospedale Humanitas, quindi Ã¨ stata classificata come "Visita Specialistica Chirurgica". Il livello di confidenza Ã¨ ...

ğŸ“Š Parsed Response:
   predicted_label: "Visita Specialistica Chirurgica"
   confidence: 0.95
   motivation: La conversazione riguarda l'invio di email per conferma di un intervento chirurgico all'ospedale Humanitas, quindi Ã¨ stata classificata come "Visita Specialistica Chirurgica". Il livello di confidenza Ã¨ alto a causa della chiarezza del contenuto.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda l'invio di email per conferma di un intervento chirurgico all'ospedale Humanitas, quindi Ã¨ stata classificata come "Visita Specialistica Chirurgica". Il livello di confidenza Ã¨ alto a causa della chiarezza del contenuto.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 41155d8563772fe421942a563889a1db classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  âœ… Nuovo tag '"Visita Specialistica Chirurgica"' aggiunto per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 705
   ğŸ’¬ Token conversazione: 264
   ğŸ“Š Token totali: 969
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 969 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 705
   ğŸ“Š Token conversazione originale: 264
   ğŸ“Š Token conversazione finale: 264
   ğŸ“Š Token totali: 969
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 895 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, per errore ho cancellato una mail newletter ricevuta il 01/08/2025 che, fra gli altri link,  conteneva il link CARENZA DI VITAMINE: quali sono i sintomi ? Cortesemente posso riceverla di nuovo ? Grazie [ASSISTENTE] Non ho accesso diretto alle email o alle newsletter inviate d..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4136 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 705
   ğŸ“Š Token conversazione: 264
   ğŸ“Š Token totali stimati: 969
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, per errore ho cancellato una mail newletter ricevuta il 01/08/2025 che, fra gli altri link,  conteneva il link CARENZA DI VITAMINE: quali sono i sintomi ? Cortesemente posso riceverla di nuovo ? Grazie [ASSISTENTE] Non ho accesso diretto alle email o alle newsletter inviate d..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di una newsletter inviata da Humanitas, che l'utente ha cancellato per errore e desidera riceverla di nuovo. Ho suggerito all'utente di contattare il servizio di assistenza dedicato compilando il modulo di contatto disponibile alla pagina Help o inviando una richiesta via email allâ€™indirizzo humanitasconte@humanitas.it, indicando il motivo della tua richiesta."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:11.114986
====================================================================================================
ğŸ“‹ Session ID: classify_1756769111
â±ï¸  Processing Time: 2.008s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (895 chars):
   [UTENTE] Buongiorno, per errore ho cancellato una mail newletter ricevuta il 01/08/2025 che, fra gli altri link,  conteneva il link CARENZA DI VITAMINE: quali sono i sintomi ? Cortesemente posso ri...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (496 chars):
   {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di una newsletter inviata da Humanitas, che l'utente ha cancellato per errore e desidera riceverla di nuovo. Ho suggerito all'utente di contattare il servizio di ass...

ğŸ“Š Parsed Response:
   predicted_label: "Humanitas con te - Registrazione"
   confidence: 0.95
   motivation: La conversazione riguarda la richiesta di una newsletter inviata da Humanitas, che l'utente ha cancellato per errore e desidera riceverla di nuovo. Ho suggerito all'utente di contattare il servizio di assistenza dedicato compilando il modulo di contatto disponibile alla pagina Help o inviando una richiesta via email allâ€™indirizzo humanitasconte@humanitas.it, indicando il motivo della tua richiesta.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la richiesta di una newsletter inviata da Humanitas, che l'utente ha cancellato per errore e desidera riceverla di nuovo. Ho suggerito all'utente di contattare il servizio di assistenza dedicato compilando il modulo di contatto disponibile alla pagina Help o inviando una richiesta via email allâ€™indirizzo humanitasconte@humanitas.it, indicando il motivo della tua richie...
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 73f637a5a1515a8d26bf383aa2c23c45 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Humanitas con te - Registrazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 707
   ğŸ’¬ Token conversazione: 608
   ğŸ“Š Token totali: 1315
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1315 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 707
   ğŸ“Š Token conversazione originale: 608
   ğŸ“Š Token conversazione finale: 608
   ğŸ“Š Token totali: 1315
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2063 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ho mal di pancia e sto cercando cosa fare [ASSISTENTE] Come assistente digitale di Humanitas, il mio scopo Ã¨ fornire informazioni di carattere generale e notizie inerenti lâ€™ospedale. Per il tuo mal di pancia, ti consiglio di rivolgerti al tuo medico di fiducia o al tuo medico di Medicina..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4145 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 707
   ğŸ“Š Token conversazione: 608
   ğŸ“Š Token totali stimati: 1315
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ho mal di pancia e sto cercando cosa fare [ASSISTENTE] Come assistente digitale di Humanitas, il mio scopo Ã¨ fornire informazioni di carattere generale e notizie inerenti lâ€™ospedale. Per il tuo mal di pancia, ti consiglio di rivolgerti al tuo medico di fiducia o al tuo medico di Medicina..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Visita Specialistica', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la ricerca di un medico gastroenterologo a Humanitas, quindi Ã¨ piÃ¹ probabile che si tratti di una visita specialistica.'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:12.301780
====================================================================================================
ğŸ“‹ Session ID: classify_1756769112
â±ï¸  Processing Time: 1.098s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2063 chars):
   [UTENTE] Ho mal di pancia e sto cercando cosa fare [ASSISTENTE] Come assistente digitale di Humanitas, il mio scopo Ã¨ fornire informazioni di carattere generale e notizie inerenti lâ€™ospedale. Per i...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (226 chars):
   {'predicted_label': 'Visita Specialistica', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la ricerca di un medico gastroenterologo a Humanitas, quindi Ã¨ piÃ¹ probabile che si tratti di una visita specialistica.'}

ğŸ“Š Parsed Response:
   predicted_label: Visita Specialistica
   confidence: 0.95
   motivation: La conversazione riguarda la ricerca di un medico gastroenterologo a Humanitas, quindi Ã¨ piÃ¹ probabile che si tratti di una visita specialistica.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la ricerca di un medico gastroenterologo a Humanitas, quindi Ã¨ piÃ¹ probabile che si tratti di una visita specialistica.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 0ed0e5bb7d514f567208786674e4a1a6 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'Visita Specialistica' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 686
   ğŸ’¬ Token conversazione: 475
   ğŸ“Š Token totali: 1161
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1161 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 686
   ğŸ“Š Token conversazione originale: 475
   ğŸ“Š Token conversazione finale: 475
   ğŸ“Š Token totali: 1161
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2111 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] hello [ASSISTENTE] Hello! How can I assist you today? [UTENTE] Do you provide alcoholism treatment? [ASSISTENTE] To determine if Humanitas provides treatment for alcoholism, I will need to check the available information. Please give me a moment.Humanitas provides treatment for condition..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4072 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 686
   ğŸ“Š Token conversazione: 475
   ğŸ“Š Token totali stimati: 1161
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] hello [ASSISTENTE] Hello! How can I assist you today? [UTENTE] Do you provide alcoholism treatment? [ASSISTENTE] To determine if Humanitas provides treatment for alcoholism, I will need to check the available information. Please give me a moment.Humanitas provides treatment for condition..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"alloggio"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di informazioni sull'alloggio in un hotel o facility vicino all'ospedale Humanitas, nonchÃ© l'assistenza per il prenotamento. Non Ã¨ stato menzionato alcun tipo di trattamento medico."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:13.669786
====================================================================================================
ğŸ“‹ Session ID: classify_1756769113
â±ï¸  Processing Time: 1.280s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (2111 chars):
   [UTENTE] hello [ASSISTENTE] Hello! How can I assist you today? [UTENTE] Do you provide alcoholism treatment? [ASSISTENTE] To determine if Humanitas provides treatment for alcoholism, I will need to...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (291 chars):
   {'predicted_label': '"alloggio"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di informazioni sull'alloggio in un hotel o facility vicino all'ospedale Humanitas, nonchÃ© l'assistenza per il prenotamento. Non Ã¨ stato menzionato alcun tipo di trattamento medico."}

ğŸ“Š Parsed Response:
   predicted_label: "alloggio"
   confidence: 0.95
   motivation: La conversazione riguarda la richiesta di informazioni sull'alloggio in un hotel o facility vicino all'ospedale Humanitas, nonchÃ© l'assistenza per il prenotamento. Non Ã¨ stato menzionato alcun tipo di trattamento medico.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la richiesta di informazioni sull'alloggio in un hotel o facility vicino all'ospedale Humanitas, nonchÃ© l'assistenza per il prenotamento. Non Ã¨ stato menzionato alcun tipo di trattamento medico.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione d806654dd34f0612884c0ad7455bc517 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"alloggio"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 705
   ğŸ’¬ Token conversazione: 115
   ğŸ“Š Token totali: 820
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 820 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 705
   ğŸ“Š Token conversazione originale: 115
   ğŸ“Š Token conversazione finale: 115
   ğŸ“Š Token totali: 820
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 385 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia, cosa vuol dire ICE? [ASSISTENTE] "ICE" Ã¨ l'acronimo di "In Case of Emergency" (in caso di emergenza). [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4033 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 705
   ğŸ“Š Token conversazione: 115
   ğŸ“Š Token totali stimati: 820
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta urgente - valuta prioritÃ  massima

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia, cosa vuol dire ICE? [ASSISTENTE] "ICE" Ã¨ l'acronimo di "In Case of Emergency" (in caso di emergenza). [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda un servizio aziendale (ICE) che Ã¨ utilizzato in caso di emergenza.'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:14.575553
====================================================================================================
ğŸ“‹ Session ID: classify_1756769114
â±ï¸  Processing Time: 0.803s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (385 chars):
   [UTENTE] Ciao Giulia, cosa vuol dire ICE? [ASSISTENTE] "ICE" Ã¨ l'acronimo di "In Case of Emergency" (in caso di emergenza). Viene spesso utilizzato per indicare un contatto da chiamare in caso di e...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [105 more lines] ...
     Line 109: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (172 chars):
   {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda un servizio aziendale (ICE) che Ã¨ utilizzato in caso di emergenza.'}

ğŸ“Š Parsed Response:
   predicted_label: "Servizi aziendali"
   confidence: 0.95
   motivation: La conversazione riguarda un servizio aziendale (ICE) che Ã¨ utilizzato in caso di emergenza.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda un servizio aziendale (ICE) che Ã¨ utilizzato in caso di emergenza.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione efceb4f0753d074042b4f7158273a8e2 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Servizi aziendali"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 706
   ğŸ’¬ Token conversazione: 980
   ğŸ“Š Token totali: 1686
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1686 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 706
   ğŸ“Š Token conversazione originale: 980
   ğŸ“Š Token conversazione finale: 980
   ğŸ“Š Token totali: 1686
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 3337 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Che bello iniziare un percorso equilibrato di benessere e stile di vita [ASSISTENTE] Sono felice che tu voglia intraprendere un percorso di benessere e stile di vita equilibrato! Se hai bisogno di informazioni su servizi, visite o percorsi specifici offerti da Humanitas, sono qui per aiu..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4144 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 706
   ğŸ“Š Token conversazione: 980
   ğŸ“Š Token totali stimati: 1686
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Che bello iniziare un percorso equilibrato di benessere e stile di vita [ASSISTENTE] Sono felice che tu voglia intraprendere un percorso di benessere e stile di vita equilibrato! Se hai bisogno di informazioni su servizi, visite o percorsi specifici offerti da Humanitas, sono qui per aiu..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': 'benessere', 'confidence': 0.95, 'motivation': "La conversazione riguarda il desiderio dell'utente di intraprendere un percorso di benessere e stile di vita equilibrato, e l'assistente fornisce informazioni su come ottenere consigli personalizzati."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:16.112979
====================================================================================================
ğŸ“‹ Session ID: classify_1756769116
â±ï¸  Processing Time: 1.450s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (3337 chars):
   [UTENTE] Che bello iniziare un percorso equilibrato di benessere e stile di vita [ASSISTENTE] Sono felice che tu voglia intraprendere un percorso di benessere e stile di vita equilibrato! Se hai bi...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (270 chars):
   {'predicted_label': 'benessere', 'confidence': 0.95, 'motivation': "La conversazione riguarda il desiderio dell'utente di intraprendere un percorso di benessere e stile di vita equilibrato, e l'assistente fornisce informazioni su come ottenere consigli personalizzati."}

ğŸ“Š Parsed Response:
   predicted_label: benessere
   confidence: 0.95
   motivation: La conversazione riguarda il desiderio dell'utente di intraprendere un percorso di benessere e stile di vita equilibrato, e l'assistente fornisce informazioni su come ottenere consigli personalizzati.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda il desiderio dell'utente di intraprendere un percorso di benessere e stile di vita equilibrato, e l'assistente fornisce informazioni su come ottenere consigli personalizzati.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione b0309b27adbaa947377df5ec566e82c1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag 'benessere' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 706
   ğŸ’¬ Token conversazione: 124
   ğŸ“Š Token totali: 830
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 830 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 706
   ğŸ“Š Token conversazione originale: 124
   ğŸ“Š Token conversazione finale: 124
   ğŸ“Š Token totali: 830
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 388 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno vorrei sapere se fate l'esame ANTICORPI ANTI PIASTRINE TEST DIRETTO [ASSISTENTE] Non ho trovato informazioni specifiche sull'esame "ANTICORPI ANTI PIASTRINE TEST DIRETTO" nei documenti forniti. [...]  Se hai bisogno di ulteriori dettagli o assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4129 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 706
   ğŸ“Š Token conversazione: 124
   ğŸ“Š Token totali stimati: 830
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno vorrei sapere se fate l'esame ANTICORPI ANTI PIASTRINE TEST DIRETTO [ASSISTENTE] Non ho trovato informazioni specifiche sull'esame "ANTICORPI ANTI PIASTRINE TEST DIRETTO" nei documenti forniti. [...]  Se hai bisogno di ulteriori dettagli o assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"altro"', 'confidence': 0.85, 'motivation': 'La conversazione non riguarda una categoria specifica dell\'ospedale Humanitas. L\'utente ha chiesto informazioni sull\'esame "ANTICORPI ANTI PIASTRINE TEST DIRETTO", che non Ã¨ un esame disponibile nell\'ospedale.'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:17.324779
====================================================================================================
ğŸ“‹ Session ID: classify_1756769117
â±ï¸  Processing Time: 1.123s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (388 chars):
   [UTENTE] Buongiorno vorrei sapere se fate l'esame ANTICORPI ANTI PIASTRINE TEST DIRETTO [ASSISTENTE] Non ho trovato informazioni specifiche sull'esame "ANTICORPI ANTI PIASTRINE TEST DIRETTO" nei do...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (281 chars):
   {'predicted_label': '"altro"', 'confidence': 0.85, 'motivation': 'La conversazione non riguarda una categoria specifica dell\'ospedale Humanitas. L\'utente ha chiesto informazioni sull\'esame "ANTICORPI ANTI PIASTRINE TEST DIRETTO", che non Ã¨ un esame disponibile nell\'ospedale.'}

ğŸ“Š Parsed Response:
   predicted_label: "altro"
   confidence: 0.85
   motivation: La conversazione non riguarda una categoria specifica dell'ospedale Humanitas. L'utente ha chiesto informazioni sull'esame "ANTICORPI ANTI PIASTRINE TEST DIRETTO", che non Ã¨ un esame disponibile nell'ospedale.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.850
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] 85.0%

ğŸ§  Reasoning/Motivation:
   La conversazione non riguarda una categoria specifica dell'ospedale Humanitas. L'utente ha chiesto informazioni sull'esame "ANTICORPI ANTI PIASTRINE TEST DIRETTO", che non Ã¨ un esame disponibile nell'ospedale.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 82d967dfd210012a20a7fb99fd3223b1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"altro"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 686
   ğŸ’¬ Token conversazione: 332
   ğŸ“Š Token totali: 1018
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1018 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 686
   ğŸ“Š Token conversazione originale: 332
   ğŸ“Š Token conversazione finale: 332
   ğŸ“Š Token totali: 1018
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 1136 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno eseguite esame del sangue per allergia nickel? [ASSISTENTE] Non ho trovato informazioni specifiche sull'esecuzione di un esame del sangue per l'allergia al nichel presso Humanitas. [...] it/malattie/allergia-al-nichel)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4010 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 686
   ğŸ“Š Token conversazione: 332
   ğŸ“Š Token totali stimati: 1018
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno eseguite esame del sangue per allergia nickel? [ASSISTENTE] Non ho trovato informazioni specifiche sull'esecuzione di un esame del sangue per l'allergia al nichel presso Humanitas. [...] it/malattie/allergia-al-nichel)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Allergia al nichel"', 'confidence': 0.95, 'motivation': "La conversazione riguarda l'esecuzione di un esame per allergia al nichel presso Humanitas, ma non Ã¨ stato trovato alcun esame del sangue specifico per questa allergia. Invece, si consiglia di consultare uno specialista in allergologia per valutare il percorso diagnostico piÃ¹ adatto."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:18.839469
====================================================================================================
ğŸ“‹ Session ID: classify_1756769118
â±ï¸  Processing Time: 1.427s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (1136 chars):
   [UTENTE] Buongiorno eseguite esame del sangue per allergia nickel? [ASSISTENTE] Non ho trovato informazioni specifiche sull'esecuzione di un esame del sangue per l'allergia al nichel presso Humanit...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (365 chars):
   {'predicted_label': '"Allergia al nichel"', 'confidence': 0.95, 'motivation': "La conversazione riguarda l'esecuzione di un esame per allergia al nichel presso Humanitas, ma non Ã¨ stato trovato alcun esame del sangue specifico per questa allergia. Invece, si consiglia di consultare uno specialist...

ğŸ“Š Parsed Response:
   predicted_label: "Allergia al nichel"
   confidence: 0.95
   motivation: La conversazione riguarda l'esecuzione di un esame per allergia al nichel presso Humanitas, ma non Ã¨ stato trovato alcun esame del sangue specifico per questa allergia. Invece, si consiglia di consultare uno specialista in allergologia per valutare il percorso diagnostico piÃ¹ adatto.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda l'esecuzione di un esame per allergia al nichel presso Humanitas, ma non Ã¨ stato trovato alcun esame del sangue specifico per questa allergia. Invece, si consiglia di consultare uno specialista in allergologia per valutare il percorso diagnostico piÃ¹ adatto.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 145752599710f8fe999022f93fc0d8d5 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  âœ… Nuovo tag '"Allergia al nichel"' aggiunto per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"Allergia al nichel", "alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 713
   ğŸ’¬ Token conversazione: 197
   ğŸ“Š Token totali: 910
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 910 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 713
   ğŸ“Š Token conversazione originale: 197
   ğŸ“Š Token conversazione finale: 197
   ğŸ“Š Token totali: 910
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 608 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] cistiscopia [ASSISTENTE] Puoi chiarire meglio la tua richiesta? Intendi sapere:

1. [...]  

Se hai bisogno di ulteriori informazioni o assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4045 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 713
   ğŸ“Š Token conversazione: 197
   ğŸ“Š Token totali stimati: 910
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"Allergia al nichel", "alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] cistiscopia [ASSISTENTE] Puoi chiarire meglio la tua richiesta? Intendi sapere:

1. [...]  

Se hai bisogno di ulteriori informazioni o assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Visita Specialistica"', 'confidence': 0.95, 'motivation': "La richiesta dell'utente riguarda la cistoscopia e il medico che la esegue. PoichÃ© non Ã¨ specificato se l'utente vuole sapere se eseguono la cistoscopia presso Humanitas o come prepararsi per una cistoscopia, ho fornito informazioni su come trovare i medici che eseguono la procedura e suggerito di consultare la pagina Ricerca Medici."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:20.743614
====================================================================================================
ğŸ“‹ Session ID: classify_1756769120
â±ï¸  Processing Time: 1.809s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (608 chars):
   [UTENTE] cistiscopia [ASSISTENTE] Puoi chiarire meglio la tua richiesta? Intendi sapere:

1. Se eseguiamo la cistoscopia presso Humanitas?
2. Come prepararti per una cistoscopia?
3. Altro?

Fammi s...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [107 more lines] ...
     Line 111: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (418 chars):
   {'predicted_label': '"Visita Specialistica"', 'confidence': 0.95, 'motivation': "La richiesta dell'utente riguarda la cistoscopia e il medico che la esegue. PoichÃ© non Ã¨ specificato se l'utente vuole sapere se eseguono la cistoscopia presso Humanitas o come prepararsi per una cistoscopia, ho forn...

ğŸ“Š Parsed Response:
   predicted_label: "Visita Specialistica"
   confidence: 0.95
   motivation: La richiesta dell'utente riguarda la cistoscopia e il medico che la esegue. PoichÃ© non Ã¨ specificato se l'utente vuole sapere se eseguono la cistoscopia presso Humanitas o come prepararsi per una cistoscopia, ho fornito informazioni su come trovare i medici che eseguono la procedura e suggerito di consultare la pagina Ricerca Medici.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La richiesta dell'utente riguarda la cistoscopia e il medico che la esegue. PoichÃ© non Ã¨ specificato se l'utente vuole sapere se eseguono la cistoscopia presso Humanitas o come prepararsi per una cistoscopia, ho fornito informazioni su come trovare i medici che eseguono la procedura e suggerito di consultare la pagina Ricerca Medici.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione e7e524ffc2bce8c7e49c75017cf7ad4e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Visita Specialistica"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"Allergia al nichel", "alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 693
   ğŸ’¬ Token conversazione: 138
   ğŸ“Š Token totali: 831
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 831 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 693
   ğŸ“Š Token conversazione originale: 138
   ğŸ“Š Token conversazione finale: 138
   ğŸ“Š Token totali: 831
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 430 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] humanitas effettua l'holter cardiaco di 20 giorni? [ASSISTENTE] Non ho trovato informazioni specifiche sull'Holter cardiaco di 20 giorni presso Humanitas. [...] it/pazienti/diagnosi/esami-del-cuore-e-vascolari/7952-elettrocardiogramma)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4038 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 693
   ğŸ“Š Token conversazione: 138
   ğŸ“Š Token totali stimati: 831
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"Allergia al nichel", "alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] humanitas effettua l'holter cardiaco di 20 giorni? [ASSISTENTE] Non ho trovato informazioni specifiche sull'Holter cardiaco di 20 giorni presso Humanitas. [...] it/pazienti/diagnosi/esami-del-cuore-e-vascolari/7952-elettrocardiogramma)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Visita Specialistica Cardiologica"', 'confidence': 0.85, 'motivation': 'La conversazione riguarda l\'esame dell\'Holter cardiaco, che Ã¨ un esame cardiologico. PoichÃ© non sono state trovate informazioni specifiche sull\'Holter cardiaco di 20 giorni presso Humanitas, la classificazione piÃ¹ appropriata Ã¨ "Visita Specialistica Cardiologica".'}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:22.222688
====================================================================================================
ğŸ“‹ Session ID: classify_1756769122
â±ï¸  Processing Time: 1.392s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (430 chars):
   [UTENTE] humanitas effettua l'holter cardiaco di 20 giorni? [ASSISTENTE] Non ho trovato informazioni specifiche sull'Holter cardiaco di 20 giorni presso Humanitas. Ti consiglio di contattare dirett...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (363 chars):
   {'predicted_label': '"Visita Specialistica Cardiologica"', 'confidence': 0.85, 'motivation': 'La conversazione riguarda l\'esame dell\'Holter cardiaco, che Ã¨ un esame cardiologico. PoichÃ© non sono state trovate informazioni specifiche sull\'Holter cardiaco di 20 giorni presso Humanitas, la classi...

ğŸ“Š Parsed Response:
   predicted_label: "Visita Specialistica Cardiologica"
   confidence: 0.85
   motivation: La conversazione riguarda l'esame dell'Holter cardiaco, che Ã¨ un esame cardiologico. PoichÃ© non sono state trovate informazioni specifiche sull'Holter cardiaco di 20 giorni presso Humanitas, la classificazione piÃ¹ appropriata Ã¨ "Visita Specialistica Cardiologica".
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.850
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] 85.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda l'esame dell'Holter cardiaco, che Ã¨ un esame cardiologico. PoichÃ© non sono state trovate informazioni specifiche sull'Holter cardiaco di 20 giorni presso Humanitas, la classificazione piÃ¹ appropriata Ã¨ "Visita Specialistica Cardiologica".
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 44b211e74774f7ae10740a86336df131 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Visita Specialistica Cardiologica"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"Allergia al nichel", "alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 713
   ğŸ’¬ Token conversazione: 137
   ğŸ“Š Token totali: 850
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 850 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 713
   ğŸ“Š Token conversazione originale: 137
   ğŸ“Š Token conversazione finale: 137
   ğŸ“Š Token totali: 850
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 466 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Oggi si possono fare esami del sangue all' Humanitas di Rozzano? [ASSISTENTE] Per sapere se oggi Ã¨ possibile effettuare esami del sangue presso l'Humanitas di Rozzano, ti consiglio di contattare direttamente il punto prelievi. Puoi trovare tutte le informazioni sui punti prelievi e gli o..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4166 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 713
   ğŸ“Š Token conversazione: 137
   ğŸ“Š Token totali stimati: 850
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"Allergia al nichel", "alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Oggi si possono fare esami del sangue all' Humanitas di Rozzano? [ASSISTENTE] Per sapere se oggi Ã¨ possibile effettuare esami del sangue presso l'Humanitas di Rozzano, ti consiglio di contattare direttamente il punto prelievi. Puoi trovare tutte le informazioni sui punti prelievi e gli o..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

ğŸ” STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di un esame del sangue presso l'Humanitas di Rozzano. Il richiedente chiede se Ã¨ possibile effettuare l'esame oggi e l'assistente gli consiglia di contattare il punto prelievi per ottenere informazioni precise sui tempi disponibili."}

====================================================================================================
ğŸ¤– LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:23.709133
====================================================================================================
ğŸ“‹ Session ID: classify_1756769123
â±ï¸  Processing Time: 1.398s
----------------------------------------------------------------------------------------------------
ğŸ“¥ INPUT SECTION
--------------------------------------------------
ğŸ’¬ Original Text (466 chars):
   [UTENTE] Oggi si possono fare esami del sangue all' Humanitas di Rozzano? [ASSISTENTE] Per sapere se oggi Ã¨ possibile effettuare esami del sangue presso l'Humanitas di Rozzano, ti consiglio di cont...

ğŸ¯ Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

âš™ï¸  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
ğŸ“¤ OUTPUT SECTION
--------------------------------------------------
ğŸ” Raw Response (349 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di un esame del sangue presso l'Humanitas di Rozzano. Il richiedente chiede se Ã¨ possibile effettuare l'esame oggi e l'assistente gli consiglia di contattare il punto prelievi per ot...

ğŸ“Š Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di un esame del sangue presso l'Humanitas di Rozzano. Il richiedente chiede se Ã¨ possibile effettuare l'esame oggi e l'assistente gli consiglia di contattare il punto prelievi per ottenere informazioni precise sui tempi disponibili.
----------------------------------------------------------------------------------------------------
ğŸ“ˆ ANALYSIS SECTION
--------------------------------------------------
ğŸ¯ Confidence Score: 0.950
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 95.0%

ğŸ§  Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un esame del sangue presso l'Humanitas di Rozzano. Il richiedente chiede se Ã¨ possibile effettuare l'esame oggi e l'assistente gli consiglia di contattare il punto prelievi per ottenere informazioni precise sui tempi disponibili.
----------------------------------------------------------------------------------------------------
ğŸ” CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
âœ… LLM DEBUG COMPLETED
====================================================================================================

ğŸ“Š Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
ğŸ¤– LLM DIRECT CLASSIFICATION: Sessione 9c2ef75641b8b4e261ccc61aac81f8cc classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  â„¹ï¸ Tag '"Prenotazione"' giÃ  esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
ğŸ¤– DEBUG PROMPT SYSTEM - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/SYSTEM/intelligent_classifier_system
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
ğŸ“„ SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la piÃ¹ specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon Ã¨ riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"Allergia al nichel", "alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguitÃ 
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

ğŸ” TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
ğŸ¤– ELABORAZIONE CONVERSAZIONE PER LLM
   ğŸ†” Session ID: llm_conversation
   ğŸ“ Token prompt: 714
   ğŸ’¬ Token conversazione: 750
   ğŸ“Š Token totali: 1464
   ğŸ¯ Limite massimo: 8000
   âœ… Conversazione OK: 1464 â‰¤ 8000
âœ… Tokenizzazione LLM completata:
   ğŸ“Š Token prompt base: 714
   ğŸ“Š Token conversazione originale: 750
   ğŸ“Š Token conversazione finale: 750
   ğŸ“Š Token totali: 1464
   ğŸ“Š Limite configurato: 8000
   âœ… Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
ğŸ‘¤ DEBUG PROMPT USER - DATABASE
================================================================================
ğŸ“‹ Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
ğŸ¢ Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Text Length: 2396 chars
--------------------------------------------------------------------------------
ğŸ“„ USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non Ã¨ valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] quali esami di laboratorio fate? [ASSISTENTE] Il Laboratorio Analisi dellâ€™IRCCS Istituto Clinico Humanitas offre una vasta gamma di esami di laboratorio, tra cui esami di base e specialistici per la promozione della salute, prevenzione, diagnosi e monitoraggio terapeutico. Gli esami incl..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta piÃ¹ appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸš€ PROMPT COMPLETO FINALE INVIATO ALL'LLM
ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
ğŸ¤– Model: mistral:7b
ğŸŒ Ollama URL: http://localhost:11434
ğŸ¢ Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
ğŸ“ Total Prompt Length: 4167 characters
ğŸ”¢ Token Analysis:
   ğŸ“Š Token prompt base: 714
   ğŸ“Š Token conversazione: 750
   ğŸ“Š Token totali stimati: 1464
   ğŸ“Š Limite configurato: 8000
   âœ… STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
ğŸ“„ FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
