 🎛️ Configurazioni AI saranno salvate su DATABASE MySQL
🎛️ AIConfigurationService inizializzato
   � Backend: DATABASE MySQL
   🔑 OpenAI API Key: ✅ Configurata
🏭 EmbeddingEngineFactory inizializzata
🎯 EmbeddingManager inizializzato
🚀 UMAP disponibile per riduzione dimensionale!
🚀 cuML GPU clustering disponibile!
💥 EmbeddingDestroyer inizializzato - Ready to destroy and rebuild!
🎯 SimpleEmbeddingManager inizializzato
✅ Blueprint esempi inizializzato correttamente
🔄 [LLMConfigService] Configurazione ricaricata
🔧 [LLMConfigService] Servizio inizializzato con config: /home/ubuntu/classificatore/config.yaml
🚀 Avvio server Flask - Debug: True
 * Serving Flask app 'server'
 * Debug mode: on
🔍 [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
🔍 [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
🏢 Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
🔍 [DEBUG] Recuperati 22 oggetti Tenant dal database
🔍 [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
🔍 [DEBUG] Invio risposta con 22 tenant
🔍 [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
🔍 [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
🔍 [DEBUG] GET review cases per tenant_id: a0fd7600-f4f7-11ef-9315-96000228e7fe
🔍 [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
🔍 [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
✅ [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
🔍 [DEBUG] Inizializzo PromptManager...
🔍 [DEBUG] Creo oggetto Tenant da a0fd7600-f4f7-11ef-9315-96000228e7fe...
🏢 Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
🔍 [DEBUG] Recuperati 22 oggetti Tenant dal database
🔍 [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
🔍 [DEBUG] Invio risposta con 22 tenant
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Alleanza (alleanza) UUID=a0fd7600-f4f7-11ef-9315-96000228e7fe
✅ [DEBUG] Tenant risolto: Alleanza (alleanza)
🔍 [DEBUG] Ottieni mongo reader per tenant: alleanza
🔧 Creazione MongoClassificationReader per cliente: alleanza
🔍 Risoluzione tenant da slug: alleanza
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Alleanza (alleanza) UUID=a0fd7600-f4f7-11ef-9315-96000228e7fe
✅ [DEBUG] Tenant risolto: Alleanza (a0fd7600-f4f7-11ef-9315-96000228e7fe)
🔍 [DEBUG] Chiamo get_all_prompts_for_tenant con oggetto Tenant...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto da slug (DB TAG locale): Alleanza (alleanza) UUID=a0fd7600-f4f7-11ef-9315-96000228e7fe
✅ Tenant risolto da slug: Alleanza (a0fd7600-f4f7-11ef-9315-96000228e7fe)
📊 Collection generata: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe per tenant Alleanza
✅ MongoClassificationReader inizializzato per tenant: Alleanza
   📊 Collection: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe
   🏢 Database: classificazioni
✅ MongoClassificationReader creato per tenant: Alleanza (alleanza)
📊 Collection generata: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe per tenant Alleanza
   📊 Collection: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe
🔍 [DEBUG] Recuperati 5 prompt dal PromptManager
🔍 [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
✅ [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
✅ [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
🔍 [DEBUG] Invio risposta JSON per status prompt
✅ Connesso a MongoDB database: classificazioni
📊 Collection generata: alleanza_a0fd7600-f4f7-11ef-9315-96000228e7fe per tenant Alleanza
🔍 Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
🏷️ Recupero etichette per tenant: Alleanza
📊 Calcolo statistiche per tenant: Alleanza
🔍 [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
🔍 [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
✅ [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
🔍 [DEBUG] Inizializzo PromptManager...
🔍 [DEBUG] Creo oggetto Tenant da a0fd7600-f4f7-11ef-9315-96000228e7fe...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Alleanza (alleanza) UUID=a0fd7600-f4f7-11ef-9315-96000228e7fe
✅ [DEBUG] Tenant risolto: Alleanza (a0fd7600-f4f7-11ef-9315-96000228e7fe)
🔍 [DEBUG] Chiamo get_all_prompts_for_tenant con oggetto Tenant...
🔍 [DEBUG] Recuperati 5 prompt dal PromptManager
🔍 [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
✅ [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
✅ [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
🔍 [DEBUG] Invio risposta JSON per status prompt
🔍 [DEBUG] GET review cases per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG] GET /api/prompts/015007d9-d413-11ef-86a5-96000228e7fe/status - Avvio richiesta
🔍 [DEBUG] API: Recupero status prompt per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
✅ [DEBUG] Riconosciuto come tenant_id UUID: 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG] Inizializzo PromptManager...
🔍 [DEBUG] Creo oggetto Tenant da 015007d9-d413-11ef-86a5-96000228e7fe...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ [DEBUG] Tenant risolto: Humanitas (humanitas)
🔍 [DEBUG] Ottieni mongo reader per tenant: humanitas
🔧 Creazione MongoClassificationReader per cliente: humanitas
🔍 Risoluzione tenant da slug: humanitas
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ [DEBUG] Tenant risolto: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
🔍 [DEBUG] Chiamo get_all_prompts_for_tenant con oggetto Tenant...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto da slug (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Tenant risolto da slug: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
✅ MongoClassificationReader creato per tenant: Humanitas (humanitas)
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
✅ Connesso a MongoDB database: classificazioni
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🔍 Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
🏷️ Recupero etichette per tenant: Humanitas
📊 Calcolo statistiche per tenant: Humanitas
🔍 [DEBUG] Recuperati 5 prompt dal PromptManager
🔍 [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
✅ [DEBUG] Status calcolato: {'success': True, 'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-09-01T23:12:42', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
✅ [DEBUG] Status prompt per tenant_id 015007d9-d413-11ef-86a5-96000228e7fe: 5/5 attivi
🔍 [DEBUG] Invio risposta JSON per status prompt
🔍 API: Recupero prompt per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
🎛️ Configurazioni AI saranno salvate su DATABASE MySQL
🔧 API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
🎛️ AIConfigurationService inizializzato
   � Backend: DATABASE MySQL
   🔑 OpenAI API Key: ✅ Configurata
Connessione al database TAG stabilita con successo
🔄 DatabaseAI: Modalità legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 22, 49, 50)}
🔍 [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 22, 49, 50), 'embedding_config': {}, 'llm_config': {}}
🔍 [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Tenant risolto: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
✅ Recuperati 5 prompt per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🔍 Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
🔄 DatabaseAI: Modalità legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 22, 49, 50), 'embedding_config': {}, 'llm_config': {}}
🔍 [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
🔍 API: Recupero prompt per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
🔧 API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Tenant risolto: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
✅ Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Recuperati 5 prompt per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🔧 API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
✅ Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🔧 API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
✅ Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🎛️ Configurazioni AI saranno salvate su DATABASE MySQL
🎛️ AIConfigurationService inizializzato
   � Backend: DATABASE MySQL
   🔑 OpenAI API Key: ✅ Configurata
🏭 EmbeddingEngineFactory inizializzata
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
📋 Caricamento parametri LLM specifici per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
🎯 Config LLM caricata per 015007d9-d413-11ef-86a5-96000228e7fe (fonte: tenant_specific)
   📝 Max output tokens: 550
   📊 Max input tokens: 8000
   🌡️  Temperature: 0.01
   🔢 Top K: 40, Top P: 0.9
🎛️ Configurazioni AI saranno salvate su DATABASE MySQL
🎛️ AIConfigurationService inizializzato
   � Backend: DATABASE MySQL
   🔑 OpenAI API Key: ✅ Configurata
🔍 Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
🔄 DatabaseAI: Modalità legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
🔧 FORCE NO CACHE: Bypass cache per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🔥 FORCE NO CACHE: Bypasso cache e leggo DIRETTAMENTE dal database per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 22, 49, 50)}
🔍 [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 22, 49, 50), 'embedding_config': {}, 'llm_config': {}}
🔍 [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
🔍 DATABASE CONFIG DEBUG per 015007d9-d413-11ef-86a5-96000228e7fe: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'embedding_engine': {'current': 'labse', 'config': {}, 'available_engines': ['labse', 'bge_m3', 'openai_large', 'openai_small']}, 'llm_model': {'current': 'mistral-nemo:latest', 'config': {}, 'available_models': ['mistral-nemo:latest', 'gpt-oss:20b', 'mistral:7b', 'llama3.3:70b-instruct-q2_K']}, 'status': {'embedding_engine_ok': True, 'llm_model_ok': True, 'overall_status': 'ok'}, 'last_updated': '2025-09-01T22:49:50', 'source': 'database', 'updated_at': datetime.datetime(2025, 9, 1, 22, 49, 50)}
🎲 DATABASE LEGACY: Modello trovato per 015007d9-d413-11ef-86a5-96000228e7fe: mistral-nemo:latest
🎯 Uso modello dal DATABASE per 015007d9-d413-11ef-86a5-96000228e7fe: mistral-nemo:latest
🔍 LLM Debugger inizializzato e ATTIVO
   📝 Debug file: ./debug_logs/llm_debug.log
   🎨 Visual formatting: True
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
🗄️ MongoClassificationReader inizializzato per tenant: Humanitas
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
Connessione al database TAG stabilita con successo
📋 Recuperati 31 tag dal database TAGS per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
📊 Caricamento config SEPARATA per embedding
🔧 TokenizationManager inizializzato:
   📊 Modello tokenizer: cl100k_base
   🔢 Limite massimo token: 8000
   ✂️  Strategia troncamento: start
📋 Caricamento parametri LLM specifici per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📋 [API] Parametri LLM per tenant 015007d9-d413-11ef-86a5-96000228e7fe (fonte: tenant_specific)
🔍 [DEBUG] get_model_info cercando: mistral-nemo:latest
📋 [LLMConfigService] Modelli ricaricati e cached: 4
🔍 [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
✅ [DEBUG] Modello mistral-nemo:latest trovato nei configurati
📋 [API] Info modello mistral-nemo:latest recuperate
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
📋 Caricamento parametri LLM specifici per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
🎯 Config LLM caricata per 015007d9-d413-11ef-86a5-96000228e7fe (fonte: tenant_specific)
   📝 Max output tokens: 550
   📊 Max input tokens: 8000
   🌡️  Temperature: 0.01
   🔢 Top K: 40, Top P: 0.9
🎛️ Configurazioni AI saranno salvate su DATABASE MySQL
🎛️ AIConfigurationService inizializzato
   � Backend: DATABASE MySQL
   🔑 OpenAI API Key: ✅ Configurata
🔄 DatabaseAI: Modalità legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
🔧 FORCE NO CACHE: Bypass cache per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🔥 FORCE NO CACHE: Bypasso cache e leggo DIRETTAMENTE dal database per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 22, 49, 50)}
🔍 [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral-nemo:latest', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 22, 49, 50), 'embedding_config': {}, 'llm_config': {}}
🔍 [DEBUG AIConfig] llm_engine nel db_config: mistral-nemo:latest
🔍 DATABASE CONFIG DEBUG per 015007d9-d413-11ef-86a5-96000228e7fe: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'embedding_engine': {'current': 'labse', 'config': {}, 'available_engines': ['labse', 'bge_m3', 'openai_large', 'openai_small']}, 'llm_model': {'current': 'mistral-nemo:latest', 'config': {}, 'available_models': ['mistral-nemo:latest', 'gpt-oss:20b', 'mistral:7b', 'llama3.3:70b-instruct-q2_K']}, 'status': {'embedding_engine_ok': True, 'llm_model_ok': True, 'overall_status': 'ok'}, 'last_updated': '2025-09-01T22:49:50', 'source': 'database', 'updated_at': datetime.datetime(2025, 9, 1, 22, 49, 50)}
🎲 DATABASE LEGACY: Modello trovato per 015007d9-d413-11ef-86a5-96000228e7fe: mistral-nemo:latest
🎯 Uso modello dal DATABASE per 015007d9-d413-11ef-86a5-96000228e7fe: mistral-nemo:latest
🔍 LLM Debugger inizializzato e ATTIVO
   📝 Debug file: ./debug_logs/llm_debug.log
   🎨 Visual formatting: True
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
🗄️ MongoClassificationReader inizializzato per tenant: Humanitas
📋 [LLMConfigService] Modelli ricaricati e cached: 4
📋 [API] Modelli disponibili per tenant 015007d9-d413-11ef-86a5-96000228e7fe: 4
🔍 [DEBUG] get_model_info cercando: mistral-nemo:latest
♻️  [LLMConfigService] Uso cache modelli: 4 modelli (età: 0s)
🔍 [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
✅ [DEBUG] Modello mistral-nemo:latest trovato nei configurati
🔍 [DEBUG] get_model_info cercando: mistral-nemo:latest
♻️  [LLMConfigService] Uso cache modelli: 4 modelli (età: 0s)
🔍 [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
✅ [DEBUG] Modello mistral-nemo:latest trovato nei configurati
🔍 [DEBUG] get_model_info cercando: mistral-nemo:latest
♻️  [LLMConfigService] Uso cache modelli: 4 modelli (età: 0s)
🔍 [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
✅ [DEBUG] Modello mistral-nemo:latest trovato nei configurati
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
Connessione al database TAG stabilita con successo
📋 Recuperati 31 tag dal database TAGS per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
📊 Caricamento config SEPARATA per embedding
🔧 TokenizationManager inizializzato:
   📊 Modello tokenizer: cl100k_base
   🔢 Limite massimo token: 8000
   ✂️  Strategia troncamento: start
📋 Caricamento parametri LLM specifici per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📋 [API] Parametri LLM per tenant 015007d9-d413-11ef-86a5-96000228e7fe (fonte: tenant_specific)
♻️  [LLMConfigService] Uso cache modelli: 4 modelli (età: 0s)
📋 [API] Modelli disponibili per tenant 015007d9-d413-11ef-86a5-96000228e7fe: 4
🔍 [DEBUG] get_model_info cercando: mistral-nemo:latest
♻️  [LLMConfigService] Uso cache modelli: 4 modelli (età: 0s)
🔍 [DEBUG] Modelli configurati: ['mistral:7b', 'mistral-nemo:latest', 'llama3.3:70b-instruct-q2_K', 'gpt-oss:20b']
✅ [DEBUG] Modello mistral-nemo:latest trovato nei configurati
📋 [API] Info modello mistral-nemo:latest recuperate
🔍 [DEBUG] Salvataggio LLM: tenant_id=015007d9-d413-11ef-86a5-96000228e7fe, model_name=mistral:7b
🔍 [DEBUG] Upsert query: 
            INSERT INTO engines (tenant_id, tenant_name, tenant_slug, llm_engine, llm_config)
            VALUES (%s, %s, %s, %s, %s)
            ON DUPLICATE KEY UPDATE
                llm_engine = VALUES(llm_engine),
                llm_config = VALUES(llm_config),
                updated_at = CURRENT_TIMESTAMP
            
🔍 [DEBUG] Parametri: (015007d9-d413-11ef-86a5-96000228e7fe, Humanitas, humanitas, mistral:7b, None)
🗑️ Cache configurazioni invalidata dopo modifica LLM engine
🎛️ Configurazioni AI saranno salvate su DATABASE MySQL
🎛️ AIConfigurationService inizializzato
   � Backend: DATABASE MySQL
   🔑 OpenAI API Key: ✅ Configurata
🏭 LLM Factory inizializzato con cache invalidation intelligente
ℹ️  Nessuna cache da invalidare per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🗑️ Cache LLMFactory invalidata per tenant 015007d9-d413-11ef-86a5-96000228e7fe
✅ Modello LLM 'mistral:7b' impostato per tenant 'Humanitas'
�}  K�f��  ��n��}  Hu�     ��f��  `�n��}  ����} 🔄 [API] Reload LLM configuration (solo config, NO pipeline) per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🔄 DatabaseAI: Modalità legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 23, 21, 12)}
🔍 [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 23, 21, 12), 'embedding_config': {}, 'llm_config': {}}
🔍 [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
✅ [API] Configurazione LLM aggiornata per 015007d9-d413-11ef-86a5-96000228e7fe: modello={'current': 'mistral:7b', 'config': {}, 'available_models': ['mistral-nemo:latest', 'gpt-oss:20b', 'mistral:7b', 'llama3.3:70b-instruct-q2_K']}
🚀 [API] Pipeline completa sarà caricata solo quando necessaria (test/training/classificazione)
🔄 DatabaseAI: Modalità legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 23, 21, 12), 'embedding_config': {}, 'llm_config': {}}
🔍 [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
🔍 Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
🎯 [CLUSTERING CONFIG] Caricando parametri personalizzati per tenant 015007d9-d413-11ef-86a5-96000228e7fe
   allow_single_cluster: non_definito -> False
   alpha: non_definito -> 0.4
   cluster_selection_epsilon: non_definito -> 0.28
   cluster_selection_method: non_definito -> leaf
   max_cluster_size: non_definito -> 0
   metric: non_definito -> euclidean
   min_cluster_size: 5 -> 13
   min_samples: 3 -> 16
   only_user: non_definito -> False
   umap_metric: non_definito -> cosine
   umap_min_dist: non_definito -> 0
   umap_n_components: non_definito -> 17
   umap_n_neighbors: non_definito -> 30
   umap_random_state: non_definito -> 42
   use_umap: non_definito -> True
📈 [API] Recuperato storico clustering: 41 versioni per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🎯 [CLUSTERING CONFIG] Caricando parametri personalizzati per tenant 015007d9-d413-11ef-86a5-96000228e7fe
   allow_single_cluster: non_definito -> False
   alpha: non_definito -> 0.4
   cluster_selection_epsilon: non_definito -> 0.28
   cluster_selection_method: non_definito -> leaf
   max_cluster_size: non_definito -> 0
   metric: non_definito -> euclidean
   min_cluster_size: 5 -> 13
   min_samples: 3 -> 16
   only_user: non_definito -> False
   umap_metric: non_definito -> cosine
   umap_min_dist: non_definito -> 0
   umap_n_components: non_definito -> 17
   umap_n_neighbors: non_definito -> 30
   umap_random_state: non_definito -> 42
   use_umap: non_definito -> True
📈 [API] Recuperato storico clustering: 41 versioni per tenant 015007d9-d413-11ef-86a5-96000228e7fe
📊 [API] Recuperata versione 41 per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🔄 DatabaseAI: Modalità legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 23, 21, 12), 'embedding_config': {}, 'llm_config': {}}
🔍 [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
🔍 API: Recupero prompt per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
🔧 API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Tenant risolto: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
Connessione al database TAG stabilita con successo
🔄 DatabaseAI: Modalità legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 23, 21, 12), 'embedding_config': {}, 'llm_config': {}}
🔍 [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🔍 Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
✅ Recuperati 5 prompt per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
🔧 API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
🔍 API: Recupero prompt per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
✅ Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Tenant risolto: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
✅ Recuperati 5 prompt per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🔧 API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
✅ Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🔧 API: Recupero tools per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
✅ Recuperati 1 tools per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🔍 Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
🔍 [DEBUG] GET review cases per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ [DEBUG] Tenant risolto: Humanitas (humanitas)
🔍 [DEBUG] Ottieni mongo reader per tenant: humanitas
🔧 Creazione MongoClassificationReader per cliente: humanitas
🔍 Risoluzione tenant da slug: humanitas
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto da slug (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Tenant risolto da slug: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
✅ MongoClassificationReader creato per tenant: Humanitas (humanitas)
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
✅ Connesso a MongoDB database: classificazioni
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🔍 Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
🏷️ Recupero etichette per tenant: Humanitas
📊 Calcolo statistiche per tenant: Humanitas
🎯 TRAINING SUPERVISIONATO - Cliente: 015007d9-d413-11ef-86a5-96000228e7fe
📋 Parametri utente semplificati:
  � Max sessioni review: 500
  🎯 Soglia confidenza: 0.95
  🔄 Forza review: True
  ⚖️  Soglia disagreement: 0.3
🔧 Inizializzazione pipeline per cliente: 015007d9-d413-11ef-86a5-96000228e7fe (con lock)
⚠️ [PIPELINE] DEPRECATO: uso di tenant_slug '015007d9-d413-11ef-86a5-96000228e7fe' - convertendo a oggetto Tenant
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
🔄 [PIPELINE] Conversione completata: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
✅ [CONFIG] Configurazione base caricata da /home/ubuntu/classificatore/Utils/../config.yaml
🎯 [PIPELINE CLUSTERING CONFIG] Caricati parametri personalizzati per tenant 015007d9-d413-11ef-86a5-96000228e7fe:
   allow_single_cluster: non_definito -> False
   alpha: non_definito -> 0.4
   cluster_selection_epsilon: non_definito -> 0.28
   cluster_selection_method: non_definito -> leaf
   max_cluster_size: non_definito -> 0
   metric: non_definito -> euclidean
   min_cluster_size: 5 -> 13
   min_samples: 3 -> 16
   only_user: non_definito -> False
   umap_metric: non_definito -> cosine
   umap_min_dist: non_definito -> 0
   umap_n_components: non_definito -> 17
   umap_n_neighbors: non_definito -> 30
   umap_random_state: non_definito -> 42
   use_umap: non_definito -> True

🚀 [FASE 1: INIZIALIZZAZIONE] Avvio pipeline...
🏥 [FASE 1: INIZIALIZZAZIONE] Tenant: humanitas
🎯 [FASE 1: INIZIALIZZAZIONE] Configurazione:
   📊 Confidence threshold: 0.7
   🤖 Auto mode: True
   🔄 Auto retrain: False
� [FASE 1: INIZIALIZZAZIONE] Inizializzazione lettore conversazioni...
✅ [CONFIG] Configurazione base caricata da /home/ubuntu/classificatore/Utils/../config.yaml
✅ [CONFIG] Config personalizzata tenant 015007d9-d413-11ef-86a5-96000228e7fe: 15 parametri
🎯 [ONLY_USER] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: False (da config personalizzata)
🎯 [LETTORE] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: only_user = False (da config tenant)
� [FASE 1: INIZIALIZZAZIONE] Inizializzazione aggregator...
   🔍 Schema: 'humanitas'
   🆔 Tenant ID: '015007d9-d413-11ef-86a5-96000228e7fe'
🎯 [SESSION AGGREGATOR] Inizializzazione con oggetto Tenant: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
🎯 [ONLY_USER] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: False (da config personalizzata)
🎯 [LETTORE] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: only_user = False (da config tenant)
� [ONLY_USER] Schema None: False (legacy - no tenant_id)
🧠 [FASE 1: INIZIALIZZAZIONE] Sistema embedder dinamico (lazy loading)
🔧 [FASE 1: INIZIALIZZAZIONE] Parametri clustering:
   📊 Min cluster size: 13
   📊 Min samples: 16
🐛 DEBUG CLUSTER_ALPHA - PRIMA:
   📋 clustering_config.get('alpha', 1.0): 0.4
   📋 Type: <class 'float'>
🐛 DEBUG CLUSTER_ALPHA - DOPO CONVERSIONE:
   📋 cluster_alpha: 0.4
   📋 Type: <class 'float'>
🐛 DEBUG CLUSTER_ALPHA - FINALE:
   📋 cluster_alpha finale: 0.4
   📋 Type finale: <class 'float'>
   📋 Alpha > 0: True
✅ [CONFIG] Config personalizzata tenant 015007d9-d413-11ef-86a5-96000228e7fe: 15 parametri
🗂️  [UMAP] Parametri per tenant 015007d9-d413-11ef-86a5-96000228e7fe:
   use_umap: True
   n_neighbors: 30
   min_dist: 0
   n_components: 17
   metric: cosine
🔧 [FIX DEBUG] Parametri tenant passati a HDBSCANClusterer:
   min_cluster_size: 13
   min_samples: 16
   alpha: 0.4
   cluster_selection_method: leaf
   cluster_selection_epsilon: 0.28
   metric: euclidean
   allow_single_cluster: False
   max_cluster_size: 0
   🗂️  use_umap: True
   🗂️  umap_n_neighbors: 30
   🗂️  umap_min_dist: 0
   🗂️  umap_n_components: 17
🎯 [BERTOPIC] Parametri consistenti configurati:
   📊 HDBSCAN: 10 parametri
   📊 UMAP: 5 parametri
🔧 HDBSCANClusterer inizializzato:
   min_cluster_size: 13
   min_samples: 16
   metric: euclidean
   cluster_selection_epsilon: 0.28
   🗂️  UMAP enabled: True
     📏 n_neighbors: 30
     📐 min_dist: 0
     📊 n_components: 17
     🎯 metric: cosine
   🚀 GPU enabled: True
   💾 GPU memory limit: 80%
   🔄 CPU fallback: True
   ⚠️  [GPU MODE] Limitazioni cuML HDBSCAN:
     🚫 leaf_size=40 sarà IGNORATO su GPU
     ✅ Parametri supportati: cluster_selection_method, alpha, allow_single_cluster
🎯 [DEBUG REACT] Parametri configurati:
   cluster_selection_method: leaf
   alpha: 0.4
   allow_single_cluster: False
🧠 Inizializzazione memoria semantica...
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
📊 Caricamento config SEPARATA per embedding
🔧 TokenizationManager inizializzato:
   📊 Modello tokenizer: cl100k_base
   🔢 Limite massimo token: 8000
   ✂️  Strategia troncamento: start
✅ TokenizationManager integrato in LaBSE per gestione conversazioni lunghe
🚀 Inizializzazione LaBSE embedder su device: cuda
📥 Caricamento modello sentence-transformers/LaBSE...
🚀 Caricamento diretto su GPU...
✅ Modello caricato con successo!
📊 Dimensione embedding: 768
🔧 Device: cuda
🎮 GPU: NVIDIA A10G
💾 GPU Memory: 23.7 GB
📈 GPU Memory utilizzata: 1.89 GB
� Primo parametro su device: cuda:0
🧪 Test del modello LaBSE...
🔍 Encoding 3 testi con LaBSE su device cuda...

🔍 TOKENIZZAZIONE PREVENTIVA LABSE CLUSTERING
============================================================
🔍 ELABORAZIONE CONVERSAZIONI PER CLUSTERING
   📊 Numero conversazioni: 3
   🆔 Session IDs forniti: No

📊 STATISTICHE ELABORAZIONE:
   🔢 Conversazioni totali: 3
   ✂️  Conversazioni troncate: 0
   📏 Token originali totali: 20
   📐 Token finali totali: 20
   📊 Range token: 6 - 7
✅ Tokenizzazione LaBSE completata:
   📊 Conversazioni processate: 3
   📊 Conversazioni troncate: 0
   📊 Token limite configurato: 8000
   ✅ Tutte le conversazioni entro i limiti, nessun troncamento
============================================================
✅ Embedding generati: shape (3, 768)
✅ Test modello completato con successo!
   Shape: (3, 768)
   Norme: [0.99999994 1.         1.        ]
   Device: cuda
🎯 Modello pronto per l'uso!
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
🧠 SemanticMemoryManager inizializzato
  🎯 Soglia riutilizzo etichette: 0.8
  🔍 Soglia similarità semantica: 0.8
  💾 Cache path: semantic_cache/humanitas_015007d9_memory
🔗 Inizializzazione ensemble classifier avanzato...
🔍 ML Ensemble Debugger inizializzato e ATTIVO
   📝 Debug file: ./debug_logs/ml_debug.log
🔍 ML Ensemble Debugger attivato
🔧 Tentativo di inizializzazione IntelligentClassifier tramite LLMFactory...
🧠 GPU Memory prima di LLM: 1.8GB/22.1GB (free: 20.3GB)
✅ Memoria GPU sufficiente, inizializzazione LLM tramite Factory...
🔍 LLM FACTORY DEBUG: Chiamata ai_config_service.get_tenant_configuration(humanitas) normale...
🔄 DatabaseAI: Modalità legacy - risolvo tenant_id humanitas
🔍 [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 23, 21, 12)}
🔍 [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 23, 21, 12), 'embedding_config': {}, 'llm_config': {}}
🔍 [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
🎯 LLM FACTORY DEBUG: Modello normale = 'mistral:7b'
🔧 Creazione LLM classifier mistral:7b per tenant humanitas
🚀 LLM FACTORY DEBUG: Avvio creazione nuovo classifier modello 'mistral:7b'
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto da slug (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
📋 Caricamento parametri LLM specifici per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
🎯 Config LLM caricata per 015007d9-d413-11ef-86a5-96000228e7fe (fonte: tenant_specific)
   📝 Max output tokens: 550
   📊 Max input tokens: 8000
   🌡️  Temperature: 0.01
   🔢 Top K: 40, Top P: 0.9
🎯 Uso modello esplicito: mistral:7b
🔍 LLM Debugger inizializzato e ATTIVO
   📝 Debug file: ./debug_logs/llm_debug.log
   🎨 Visual formatting: True
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
🗄️ MongoClassificationReader inizializzato per tenant: Humanitas
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
Connessione al database TAG stabilita con successo
📋 Recuperati 31 tag dal database TAGS per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
📊 Caricamento config SEPARATA per embedding
🔧 TokenizationManager inizializzato:
   📊 Modello tokenizer: cl100k_base
   🔢 Limite massimo token: 8000
   ✂️  Strategia troncamento: start
✅ LLM FACTORY DEBUG: Nuovo classifier creato: mistral:7b
✅ LLM Classifier mistral:7b (mistral:7b) creato e cached per tenant humanitas
🏭 LLM classifier ottenuto tramite Factory per tenant humanitas
🤖 LLM classifier creato automaticamente nell'ensemble: mistral:7b
💡 Possibile fine-tuning per humanitas
🔗 Advanced Ensemble Classifier inizializzato
   🧠 LLM weight: 0.60
   🤖 ML weight: 0.40
   🎯 Confidence threshold: 0.7
   🔄 Adaptive weights: True
   👤 Disaccordi gestiti da QualityGateEngine
📥 Caricamento ultimo modello per humanitas: humanitas_015007d9_20250901_180026
📥 Caricamento ensemble model...
✅ ML ensemble caricato
✅ Configurazione caricata
🔗 Ensemble model caricato da models/humanitas_015007d9_20250901_180026
✅ Modello caricato con successo

🔍 VERIFICA BERTOPIC LOADING:
   📋 BERTopic enabled: True
   📋 BERTopic available: True
   📁 Provider directory: models/humanitas_015007d9_20250901_180026_bertopic
   📁 Directory exists: True
   � File trovati: 3 -> ['metadata.json', 'bertopic_model', 'svd_model.pkl']

🔄 CARICAMENTO BERTOPIC:
   📁 Path completo: /home/ubuntu/classificatore/models/humanitas_015007d9_20250901_180026_bertopic
🔄 Caricamento BERTopic model da models/humanitas_015007d9_20250901_180026_bertopic/bertopic_model
✅ BERTopic model caricato con successo
📥 SVD caricato (svd_model.pkl)
   ⏱️ Caricamento completato in 0.22 secondi
   ✅ BERTopic provider caricato con successo
🔗 BERTopic provider impostato (top_k=10, one_hot=False)
   ✅ BERTopic provider configurato nell'ensemble
⏸️ Riaddestramento automatico disabilitato (modalità supervisione/API)
   💡 Per abilitare, usare auto_retrain=True nell'inizializzazione
✅ Classificatore LLM disponibile nell'ensemble
👤 Inizializzazione trainer interattivo...
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
🎯 SIMPLE MANAGER: Usando oggetto Tenant Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
📥 Primo embedder - creazione per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🚀 CREATING FRESH EMBEDDER per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🎛️ Configurazioni AI saranno salvate su DATABASE MySQL
🎛️ AIConfigurationService inizializzato
   � Backend: DATABASE MySQL
   🔑 OpenAI API Key: ✅ Configurata
🔄 DatabaseAI: Modalità legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
🔧 FORCE NO CACHE: Bypass cache per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🔥 FORCE NO CACHE: Bypasso cache e leggo DIRETTAMENTE dal database per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 23, 21, 12)}
🔍 [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 9, 1, 23, 21, 12), 'embedding_config': {}, 'llm_config': {}}
🔍 [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
🔍 SIMPLE MANAGER: Engine da DB per 015007d9-d413-11ef-86a5-96000228e7fe = 'labse'
🎯 Engine configurato: labse
🔧 DIRECT CREATE: labse
🐳 Tentativo connessione a servizio LaBSE dockerizzato...
🔗 LaBSE Remote Client inizializzato
   📡 Service URL: http://localhost:8081
   ⏱️  Timeout: 300s
   🔄 Max retries: 3
   🛡️ Fallback locale: True
🔧 Inizializzazione client remoto LaBSE...
✅ Servizio embedding online e funzionante
✅ Client remoto LaBSE inizializzato con successo
✅ LaBSE Remote Client configurato con successo
✅ FRESH EMBEDDER creato: LaBSERemoteClient per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🧠 Inizializzazione dedupplicatore intelligente...
💾 [FASE 1: INIZIALIZZAZIONE] Caricamento memoria semantica...
📦 Memoria semantica caricata da cache (77 sessioni)
   📊 Campioni: 75
   🏷️ Tag: 10
✅ [FASE 1: INIZIALIZZAZIONE] Completata in 4.63s
🎯 [FASE 1: INIZIALIZZAZIONE] Pipeline pronta per l'uso!
✅ Pipeline 015007d9-d413-11ef-86a5-96000228e7fe inizializzata
🚀 TRAINING SUPERVISIONATO CON DATASET COMPLETO
  📊 Estrazione: TUTTE le discussioni dal database
  🧩 Clustering: Su tutto il dataset disponibile
  👤 Review umana: Max 500 sessioni rappresentative
🎯 Confidence threshold aggiornato a: 0.95
🎓 TRAINING SUPERVISIONATO AVANZATO
� NUOVA LOGICA:
  🔄 Estrazione: TUTTE le discussioni dal database
  🧩 Clustering: Su tutto il dataset completo
  👤 Review umana: Massimo 500 sessioni rappresentative
--------------------------------------------------
📊 FASE 1: ESTRAZIONE COMPLETA DATASET

� [FASE 2: ESTRAZIONE] Avvio estrazione sessioni...
🏥 [FASE 2: ESTRAZIONE] Tenant: humanitas
📅 [FASE 2: ESTRAZIONE] Giorni indietro: 7
🔄 [FASE 2: ESTRAZIONE] Modalità COMPLETA attivata
🎯 [FASE 2: ESTRAZIONE] Ignorando limite - estrazione totale dataset
� [FASE 2: ESTRAZIONE] Modalità: COMPLETA
� [FASE 2: ESTRAZIONE] Connessione database...
📊 [DEBUG ONLY_USER] Estrazione sessioni aggregate dal schema 'humanitas'...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 434 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] è possibile eseguire una visita dermatologica in ssn a Castellanza? [ASSISTENTE] Sì, è possibile eseguire una visita dermatologica tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater Domini a Castellanza. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4022 characters
🔢 Token Analysis:
   📊 Token prompt base: 682
   📊 Token conversazione: 124
   📊 Token totali stimati: 806
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] è possibile eseguire una visita dermatologica in ssn a Castellanza? [ASSISTENTE] Sì, è possibile eseguire una visita dermatologica tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater Domini a Castellanza. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un\'esame dermatologico tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater Domini a Castellanza, quindi è stata classificata come "Prenotazione". Il livello di confidenza è alto perché la richiesta è chiara e specifica.'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:23:57.493134
====================================================================================================
📋 Session ID: classify_1756769037
⏱️  Processing Time: 1.358s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (434 chars):
   [UTENTE] è possibile eseguire una visita dermatologica in ssn a Castellanza? [ASSISTENTE] Sì, è possibile eseguire una visita dermatologica tramite il Servizio Sanitario Nazionale (SSN) presso Huma...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (357 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un\'esame dermatologico tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater Domini a Castellanza, quindi è stata classificata come "Prenotazione". Il livello di c...

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di un'esame dermatologico tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater Domini a Castellanza, quindi è stata classificata come "Prenotazione". Il livello di confidenza è alto perché la richiesta è chiara e specifica.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un'esame dermatologico tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater Domini a Castellanza, quindi è stata classificata come "Prenotazione". Il livello di confidenza è alto perché la richiesta è chiara e specifica.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 0e3eebf565d04b5c2e7b92bc92442f46 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 681
   💬 Token conversazione: 1502
   📊 Token totali: 2183
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 2183 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 681
   📊 Token conversazione originale: 1502
   📊 Token conversazione finale: 1502
   📊 Token totali: 2183
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 4728 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao giulia [ASSISTENTE] Ciao! Come posso esserti utile oggi? 😊 [UTENTE] vorrei prenotare una colonscopia ma l'attesa telefonica è troppo lunga e non ci sono posti [ASSISTENTE] Capisco la tua situazione. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 3997 characters
🔢 Token Analysis:
   📊 Token prompt base: 681
   📊 Token conversazione: 1502
   📊 Token totali stimati: 2183
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao giulia [ASSISTENTE] Ciao! Come posso esserti utile oggi? 😊 [UTENTE] vorrei prenotare una colonscopia ma l'attesa telefonica è troppo lunga e non ci sono posti [ASSISTENTE] Capisco la tua situazione. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un esame medico e viene fornita una serie di opzioni per prenotare tramite il Servizio Sanitario Nazionale (SSN) o privatamente attraverso Humanitas con te.'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:23:59.301550
====================================================================================================
📋 Session ID: classify_1756769039
⏱️  Processing Time: 1.722s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (4728 chars):
   [UTENTE] ciao giulia [ASSISTENTE] Ciao! Come posso esserti utile oggi? 😊 [UTENTE] vorrei prenotare una colonscopia ma l'attesa telefonica è troppo lunga e non ci sono posti [ASSISTENTE] Capisco la ...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (276 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un esame medico e viene fornita una serie di opzioni per prenotare tramite il Servizio Sanitario Nazionale (SSN) o privatamente attraverso Humanitas con te.'}

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di un esame medico e viene fornita una serie di opzioni per prenotare tramite il Servizio Sanitario Nazionale (SSN) o privatamente attraverso Humanitas con te.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un esame medico e viene fornita una serie di opzioni per prenotare tramite il Servizio Sanitario Nazionale (SSN) o privatamente attraverso Humanitas con te.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione d0b3dc36ee33f3f7c271e3bd1077b353 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 681
   💬 Token conversazione: 247
   📊 Token totali: 928
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 928 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 681
   📊 Token conversazione originale: 247
   📊 Token conversazione finale: 247
   📊 Token totali: 928
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 844 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ritiro referti  [ASSISTENTE] Puoi dirmi di quale tipo di referto hai bisogno? Ad esempio, se si tratta di un test HIV, esami istologici, citologici, tamponi, esami genetici o altro. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4026 characters
🔢 Token Analysis:
   📊 Token prompt base: 681
   📊 Token conversazione: 247
   📊 Token totali stimati: 928
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ritiro referti  [ASSISTENTE] Puoi dirmi di quale tipo di referto hai bisogno? Ad esempio, se si tratta di un test HIV, esami istologici, citologici, tamponi, esami genetici o altro. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Referti e Cartelle Cliniche', 'confidence': 0.95, 'motivation': "La conversazione riguarda il ritiro di un referto del sangue, che è una tipologia di referto clinico. Il fatto che l'utente sia invitato a registrarsi al portale online e inserire l'ID fornito all'accettazione indica che il referto può essere consultato online. Inoltre, viene suggerito di contattare il servizio dedicato per problemi con il ritiro del referto."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:01.029810
====================================================================================================
📋 Session ID: classify_1756769041
⏱️  Processing Time: 1.641s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (844 chars):
   [UTENTE] Ritiro referti  [ASSISTENTE] Puoi dirmi di quale tipo di referto hai bisogno? Ad esempio, se si tratta di un test HIV, esami istologici, citologici, tamponi, esami genetici o altro. Alcuni...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [105 more lines] ...
     Line 109: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (449 chars):
   {'predicted_label': 'Referti e Cartelle Cliniche', 'confidence': 0.95, 'motivation': "La conversazione riguarda il ritiro di un referto del sangue, che è una tipologia di referto clinico. Il fatto che l'utente sia invitato a registrarsi al portale online e inserire l'ID fornito all'accettazione i...

📊 Parsed Response:
   predicted_label: Referti e Cartelle Cliniche
   confidence: 0.95
   motivation: La conversazione riguarda il ritiro di un referto del sangue, che è una tipologia di referto clinico. Il fatto che l'utente sia invitato a registrarsi al portale online e inserire l'ID fornito all'accettazione indica che il referto può essere consultato online. Inoltre, viene suggerito di contattare il servizio dedicato per problemi con il ritiro del referto.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda il ritiro di un referto del sangue, che è una tipologia di referto clinico. Il fatto che l'utente sia invitato a registrarsi al portale online e inserire l'ID fornito all'accettazione indica che il referto può essere consultato online. Inoltre, viene suggerito di contattare il servizio dedicato per problemi con il ritiro del referto.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione e7be267dbf5f1a7a83384050226d0eea classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag 'Referti e Cartelle Cliniche' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 681
   💬 Token conversazione: 877
   📊 Token totali: 1558
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1558 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 681
   📊 Token conversazione originale: 877
   📊 Token conversazione finale: 877
   📊 Token totali: 1558
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 2780 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno

vorrei maggiori informazioni riguardo delle analisi fecali. [...]  Se hai bisogno di altro, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 3897 characters
🔢 Token Analysis:
   📊 Token prompt base: 681
   📊 Token conversazione: 877
   📊 Token totali stimati: 1558
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno

vorrei maggiori informazioni riguardo delle analisi fecali. [...]  Se hai bisogno di altro, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Analisi', 'confidence': 0.98, 'motivation': 'La conversazione riguarda la richiesta di informazioni su alcune analisi fecali e sulle possibilità di effettuare altre analisi specifiche. Il classificatore ha identificato questa conversazione come "Analisi" in quanto il contenuto è chiaramente correlato a questo argomento.'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:02.649305
====================================================================================================
📋 Session ID: classify_1756769042
⏱️  Processing Time: 1.532s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (2780 chars):
   [UTENTE] Buongiorno

vorrei maggiori informazioni riguardo delle analisi fecali.

In particolare, vorrei sapere se fate le seguenti analisi:
- Test metagenomico per lo studio funzionale
- Sequenzia...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [105 more lines] ...
     Line 109: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (344 chars):
   {'predicted_label': 'Analisi', 'confidence': 0.98, 'motivation': 'La conversazione riguarda la richiesta di informazioni su alcune analisi fecali e sulle possibilità di effettuare altre analisi specifiche. Il classificatore ha identificato questa conversazione come "Analisi" in quanto il contenut...

📊 Parsed Response:
   predicted_label: Analisi
   confidence: 0.98
   motivation: La conversazione riguarda la richiesta di informazioni su alcune analisi fecali e sulle possibilità di effettuare altre analisi specifiche. Il classificatore ha identificato questa conversazione come "Analisi" in quanto il contenuto è chiaramente correlato a questo argomento.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.980
   [███████████████████░] 98.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la richiesta di informazioni su alcune analisi fecali e sulle possibilità di effettuare altre analisi specifiche. Il classificatore ha identificato questa conversazione come "Analisi" in quanto il contenuto è chiaramente correlato a questo argomento.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 35f26aadee1b7e61bf62b16fbb8b7fa1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag 'Analisi' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 681
   💬 Token conversazione: 440
   📊 Token totali: 1121
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1121 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 681
   📊 Token conversazione originale: 440
   📊 Token conversazione finale: 440
   📊 Token totali: 1121
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1584 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao, mi chiamo Ditjon, sonno dal Albania, ho un problema che dopo gli esami che ho fatto mi hanno detto hai, prostatite chrono non bacteriale, penso che le cause, perche non ho nessune bacterie in urina, in spermocultura, in af genital, e in swab test,le cause sonno, per prima Ibs soffr..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4062 characters
🔢 Token Analysis:
   📊 Token prompt base: 681
   📊 Token conversazione: 440
   📊 Token totali stimati: 1121
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao, mi chiamo Ditjon, sonno dal Albania, ho un problema che dopo gli esami che ho fatto mi hanno detto hai, prostatite chrono non bacteriale, penso che le cause, perche non ho nessune bacterie in urina, in spermocultura, in af genital, e in swab test,le cause sonno, per prima Ibs soffr..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Visita Specialistica', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di una visita specialistica a un medico specializzato in dolore pelvico cronico presso l'ospedale Humanitas. Il chiarimento del problema e il suggerimento della pagina Ricerca Medici per trovare i professionisti disponibili sono elementi chiari che indicano una visita specialistica come la classificazione più appropriata."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:04.482520
====================================================================================================
📋 Session ID: classify_1756769044
⏱️  Processing Time: 1.746s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (1584 chars):
   [UTENTE] Ciao, mi chiamo Ditjon, sonno dal Albania, ho un problema che dopo gli esami che ho fatto mi hanno detto hai, prostatite chrono non bacteriale, penso che le cause, perche non ho nessune ba...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (446 chars):
   {'predicted_label': 'Visita Specialistica', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di una visita specialistica a un medico specializzato in dolore pelvico cronico presso l'ospedale Humanitas. Il chiarimento del problema e il suggerimento della pagina Ricerca ...

📊 Parsed Response:
   predicted_label: Visita Specialistica
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di una visita specialistica a un medico specializzato in dolore pelvico cronico presso l'ospedale Humanitas. Il chiarimento del problema e il suggerimento della pagina Ricerca Medici per trovare i professionisti disponibili sono elementi chiari che indicano una visita specialistica come la classificazione più appropriata.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la prenotazione di una visita specialistica a un medico specializzato in dolore pelvico cronico presso l'ospedale Humanitas. Il chiarimento del problema e il suggerimento della pagina Ricerca Medici per trovare i professionisti disponibili sono elementi chiari che indicano una visita specialistica come la classificazione più appropriata.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione b4bde9666da046414472d7f5ad61ed56 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag 'Visita Specialistica' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 661
   💬 Token conversazione: 49
   📊 Token totali: 710
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 710 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 661
   📊 Token conversazione originale: 49
   📊 Token conversazione finale: 49
   📊 Token totali: 710
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 155 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Risultato? [ASSISTENTE] Potresti specificare meglio la tua richiesta? Intendi il risultato di un esame, un referto o altro? Sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 3845 characters
🔢 Token Analysis:
   📊 Token prompt base: 661
   📊 Token conversazione: 49
   📊 Token totali stimati: 710
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Risultato? [ASSISTENTE] Potresti specificare meglio la tua richiesta? Intendi il risultato di un esame, un referto o altro? Sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Referti e Cartelle Cliniche"', 'confidence': 0.95, 'motivation': 'La domanda sembra richiedere il risultato di un esame o un referto clinico, quindi la classificazione è "Referti e Cartelle Cliniche".'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:05.483686
====================================================================================================
📋 Session ID: classify_1756769045
⏱️  Processing Time: 0.914s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (155 chars):
   [UTENTE] Risultato? [ASSISTENTE] Potresti specificare meglio la tua richiesta? Intendi il risultato di un esame, un referto o altro? Sono qui per aiutarti!

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (224 chars):
   {'predicted_label': '"Referti e Cartelle Cliniche"', 'confidence': 0.95, 'motivation': 'La domanda sembra richiedere il risultato di un esame o un referto clinico, quindi la classificazione è "Referti e Cartelle Cliniche".'}

📊 Parsed Response:
   predicted_label: "Referti e Cartelle Cliniche"
   confidence: 0.95
   motivation: La domanda sembra richiedere il risultato di un esame o un referto clinico, quindi la classificazione è "Referti e Cartelle Cliniche".
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La domanda sembra richiedere il risultato di un esame o un referto clinico, quindi la classificazione è "Referti e Cartelle Cliniche".
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione f862ddcdeb6bacd0a3f391706106eb33 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Referti e Cartelle Cliniche"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 681
   💬 Token conversazione: 303
   📊 Token totali: 984
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 984 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 681
   📊 Token conversazione originale: 303
   📊 Token conversazione finale: 303
   📊 Token totali: 984
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1011 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] Sono la Sig. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 3931 characters
🔢 Token Analysis:
   📊 Token prompt base: 681
   📊 Token conversazione: 303
   📊 Token totali stimati: 984
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] Sono la Sig. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Referti e Cartelle Cliniche"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la spedizione di un esame istologico effettuato dalla Sig.ra Mazzucco Gabriella il 15.04.2025. Poiché si tratta di un referto clinico, è stata classificata come "Referti e Cartelle Cliniche". La confidenza in questa classificazione è alta perché la conversazione riguarda esplicitamente l\'esame istologico e il suo stato.'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:07.364311
====================================================================================================
📋 Session ID: classify_1756769047
⏱️  Processing Time: 1.791s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (1011 chars):
   [UTENTE] Buongiorno, [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] Sono la Sig.ra Mazzucco Gabriella, io ho fatto una colonscopia il 15.04.2025 con esame istologico. Mi avevano d...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [105 more lines] ...
     Line 109: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (438 chars):
   {'predicted_label': '"Referti e Cartelle Cliniche"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la spedizione di un esame istologico effettuato dalla Sig.ra Mazzucco Gabriella il 15.04.2025. Poiché si tratta di un referto clinico, è stata classificata come "Referti e Cartelle Cl...

📊 Parsed Response:
   predicted_label: "Referti e Cartelle Cliniche"
   confidence: 0.95
   motivation: La conversazione riguarda la spedizione di un esame istologico effettuato dalla Sig.ra Mazzucco Gabriella il 15.04.2025. Poiché si tratta di un referto clinico, è stata classificata come "Referti e Cartelle Cliniche". La confidenza in questa classificazione è alta perché la conversazione riguarda esplicitamente l'esame istologico e il suo stato.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la spedizione di un esame istologico effettuato dalla Sig.ra Mazzucco Gabriella il 15.04.2025. Poiché si tratta di un referto clinico, è stata classificata come "Referti e Cartelle Cliniche". La confidenza in questa classificazione è alta perché la conversazione riguarda esplicitamente l'esame istologico e il suo stato.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione fb424a8b69b472a3b6448e121fdcd3e0 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Referti e Cartelle Cliniche"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 685
   💬 Token conversazione: 305
   📊 Token totali: 990
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 990 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 685
   📊 Token conversazione originale: 305
   📊 Token conversazione finale: 305
   📊 Token totali: 990
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1026 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco a registrarmi. [...] it**, indicando:
   - Nome e cognome
   - Codice fiscale
   - Motivo della richiesta di assistenza

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 3978 characters
🔢 Token Analysis:
   📊 Token prompt base: 685
   📊 Token conversazione: 305
   📊 Token totali stimati: 990
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco a registrarmi. [...] it**, indicando:
   - Nome e cognome
   - Codice fiscale
   - Motivo della richiesta di assistenza

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la registrazione su Humanitas con te e il problema riscontrato dall\'utente è che riceve un messaggio di errore "dati incoerenti, contatta l\'assistenza". In base a ciò, la classificazione più appropriata è "Humanitas con te - Registrazione"'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:10.246722
====================================================================================================
📋 Session ID: classify_1756769050
⏱️  Processing Time: 2.796s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (1026 chars):
   [UTENTE] Non riesco a registrarmi. [ASSISTENTE] Mi dispiace che stai riscontrando difficoltà con la registrazione. Potresti dirmi se stai cercando di registrarti su [Humanitas con te](https://www.h...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [108 more lines] ...
     Line 112: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (362 chars):
   {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la registrazione su Humanitas con te e il problema riscontrato dall\'utente è che riceve un messaggio di errore "dati incoerenti, contatta l\'assistenza". In base a ciò, la class...

📊 Parsed Response:
   predicted_label: "Humanitas con te - Registrazione"
   confidence: 0.95
   motivation: La conversazione riguarda la registrazione su Humanitas con te e il problema riscontrato dall'utente è che riceve un messaggio di errore "dati incoerenti, contatta l'assistenza". In base a ciò, la classificazione più appropriata è "Humanitas con te - Registrazione"
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la registrazione su Humanitas con te e il problema riscontrato dall'utente è che riceve un messaggio di errore "dati incoerenti, contatta l'assistenza". In base a ciò, la classificazione più appropriata è "Humanitas con te - Registrazione"
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione bf2effd84e3429966217008da8ab1e17 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Humanitas con te - Registrazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Problema tecnico di accesso - priorità problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 687
   💬 Token conversazione: 443
   📊 Token totali: 1130
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1130 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 687
   📊 Token conversazione originale: 443
   📊 Token conversazione finale: 443
   📊 Token totali: 1130
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1567 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco ad accedere al sito [ASSISTENTE] Se hai problemi ad accedere al sito di Humanitas o al portale [Humanitas con te](https://www. [...]  Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4007 characters
🔢 Token Analysis:
   📊 Token prompt base: 687
   📊 Token conversazione: 443
   📊 Token totali stimati: 1130
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Problema tecnico di accesso - priorità problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco ad accedere al sito [ASSISTENTE] Se hai problemi ad accedere al sito di Humanitas o al portale [Humanitas con te](https://www. [...]  Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la registrazione su Humanitas con te e il problema di accedere al sito o inserire correttamente il codice fiscale, quindi è stata classificata come "Humanitas con te - Registrazione".'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:11.694314
====================================================================================================
📋 Session ID: classify_1756769051
⏱️  Processing Time: 1.361s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (1567 chars):
   [UTENTE] Non riesco ad accedere al sito [ASSISTENTE] Se hai problemi ad accedere al sito di Humanitas o al portale [Humanitas con te](https://www.humanitasconte.it), ti consiglio di verificare quan...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (304 chars):
   {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la registrazione su Humanitas con te e il problema di accedere al sito o inserire correttamente il codice fiscale, quindi è stata classificata come "Humanitas con te - Registrazi...

📊 Parsed Response:
   predicted_label: "Humanitas con te - Registrazione"
   confidence: 0.95
   motivation: La conversazione riguarda la registrazione su Humanitas con te e il problema di accedere al sito o inserire correttamente il codice fiscale, quindi è stata classificata come "Humanitas con te - Registrazione".
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la registrazione su Humanitas con te e il problema di accedere al sito o inserire correttamente il codice fiscale, quindi è stata classificata come "Humanitas con te - Registrazione".
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 331ddfb60f1ba89fb62b8fa8974a0bcb classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Humanitas con te - Registrazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 681
   💬 Token conversazione: 210
   📊 Token totali: 891
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 891 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 681
   📊 Token conversazione originale: 210
   📊 Token conversazione finale: 210
   📊 Token totali: 891
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 731 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Inserire numero impegnative con già appuntamento  [ASSISTENTE] Potresti chiarire meglio la tua richiesta? Intendi dire che desideri sapere come inserire il numero di un'impegnativa per un appuntamento già prenotato? [UTENTE] Si [ASSISTENTE] Per inserire il numero di un'impegnativa per un..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4062 characters
🔢 Token Analysis:
   📊 Token prompt base: 681
   📊 Token conversazione: 210
   📊 Token totali stimati: 891
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Inserire numero impegnative con già appuntamento  [ASSISTENTE] Potresti chiarire meglio la tua richiesta? Intendi dire che desideri sapere come inserire il numero di un'impegnativa per un appuntamento già prenotato? [UTENTE] Si [ASSISTENTE] Per inserire il numero di un'impegnativa per un..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la gestione dei propri appuntamenti, in particolare l\'inserimento del numero di un\'impegnativa per un appuntamento già prenotato. Questo è tipico della categoria "Prenotazione".'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:12.915913
====================================================================================================
📋 Session ID: classify_1756769052
⏱️  Processing Time: 1.136s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (731 chars):
   [UTENTE] Inserire numero impegnative con già appuntamento  [ASSISTENTE] Potresti chiarire meglio la tua richiesta? Intendi dire che desideri sapere come inserire il numero di un'impegnativa per un ...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (280 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la gestione dei propri appuntamenti, in particolare l\'inserimento del numero di un\'impegnativa per un appuntamento già prenotato. Questo è tipico della categoria "Prenotazione".'}

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la gestione dei propri appuntamenti, in particolare l'inserimento del numero di un'impegnativa per un appuntamento già prenotato. Questo è tipico della categoria "Prenotazione".
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la gestione dei propri appuntamenti, in particolare l'inserimento del numero di un'impegnativa per un appuntamento già prenotato. Questo è tipico della categoria "Prenotazione".
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 5daf2aec41e9aaba2112859616ced715 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Problema tecnico di accesso - priorità problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 687
   💬 Token conversazione: 259
   📊 Token totali: 946
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 946 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 687
   📊 Token conversazione originale: 259
   📊 Token conversazione finale: 259
   📊 Token totali: 946
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 954 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, non riesco a completare la registrazione a nome di Chorna Valentina ( mi dice che è già registrata. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 3982 characters
🔢 Token Analysis:
   📊 Token prompt base: 687
   📊 Token conversazione: 259
   📊 Token totali stimati: 946
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Problema tecnico di accesso - priorità problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, non riesco a completare la registrazione a nome di Chorna Valentina ( mi dice che è già registrata. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la registrazione su Humanitas con te e fornisce informazioni su come modificare un account già registrato o recuperare la password.'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:14.025483
====================================================================================================
📋 Session ID: classify_1756769054
⏱️  Processing Time: 1.022s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (954 chars):
   [UTENTE] Buongiorno, non riesco a completare la registrazione a nome di Chorna Valentina ( mi dice che è già registrata...come posso modificare? [ASSISTENTE] Se il sistema segnala che il nome è già...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [105 more lines] ...
     Line 109: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (252 chars):
   {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la registrazione su Humanitas con te e fornisce informazioni su come modificare un account già registrato o recuperare la password.'}

📊 Parsed Response:
   predicted_label: "Humanitas con te - Registrazione"
   confidence: 0.95
   motivation: La conversazione riguarda la registrazione su Humanitas con te e fornisce informazioni su come modificare un account già registrato o recuperare la password.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la registrazione su Humanitas con te e fornisce informazioni su come modificare un account già registrato o recuperare la password.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione bb87137ce78e95c330b52ff051333a17 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Humanitas con te - Registrazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 681
   💬 Token conversazione: 513
   📊 Token totali: 1194
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1194 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 681
   📊 Token conversazione originale: 513
   📊 Token conversazione finale: 513
   📊 Token totali: 1194
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1694 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Devo fare prelievo di sangue presso Humanitas Via Sardegna. [...] it/info/esami-di-laboratorio/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 3867 characters
🔢 Token Analysis:
   📊 Token prompt base: 681
   📊 Token conversazione: 513
   📊 Token totali stimati: 1194
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Devo fare prelievo di sangue presso Humanitas Via Sardegna. [...] it/info/esami-di-laboratorio/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione per un prelievo di sangue presso Humanitas, e il sistema di prenotazione viene menzionato più volte. Inoltre, l'utente chiede se è necessario prenotare anche in gravidanza, e l'assistente conferma che sì."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:15.567617
====================================================================================================
📋 Session ID: classify_1756769055
⏱️  Processing Time: 1.453s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (1694 chars):
   [UTENTE] Devo fare prelievo di sangue presso Humanitas Via Sardegna. Sono incinta, devo prenotare? [ASSISTENTE] Sì, è necessario prenotare per effettuare un prelievo di sangue presso Humanitas. Puo...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (321 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione per un prelievo di sangue presso Humanitas, e il sistema di prenotazione viene menzionato più volte. Inoltre, l'utente chiede se è necessario prenotare anche in gravidanza, e l'assis...

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione per un prelievo di sangue presso Humanitas, e il sistema di prenotazione viene menzionato più volte. Inoltre, l'utente chiede se è necessario prenotare anche in gravidanza, e l'assistente conferma che sì.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la prenotazione per un prelievo di sangue presso Humanitas, e il sistema di prenotazione viene menzionato più volte. Inoltre, l'utente chiede se è necessario prenotare anche in gravidanza, e l'assistente conferma che sì.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione fa77d527385a3fa3b113e20706ddb676 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 682
   💬 Token conversazione: 186
   📊 Token totali: 868
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 868 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 682
   📊 Token conversazione originale: 186
   📊 Token conversazione finale: 186
   📊 Token totali: 868
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 567 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Il punto prelievi di viale sardegna è aperto in estate?  [ASSISTENTE] Il punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele, è aperto durante l'estate con i seguenti orari: da lunedì a venerdì dalle 7:00 alle 13:00. [...] it/info/esami-di-laboratorio/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4036 characters
🔢 Token Analysis:
   📊 Token prompt base: 682
   📊 Token conversazione: 186
   📊 Token totali stimati: 868
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Il punto prelievi di viale sardegna è aperto in estate?  [ASSISTENTE] Il punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele, è aperto durante l'estate con i seguenti orari: da lunedì a venerdì dalle 7:00 alle 13:00. [...] it/info/esami-di-laboratorio/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda l'apertura del punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele, durante l'estate e richiede informazioni sui suoi orari di apertura e la necessità di prenotare per accedere."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:16.926415
====================================================================================================
📋 Session ID: classify_1756769056
⏱️  Processing Time: 1.271s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (567 chars):
   [UTENTE] Il punto prelievi di viale sardegna è aperto in estate?  [ASSISTENTE] Il punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele, è aperto durante l'estate con i seguenti orari: da ...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (289 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda l'apertura del punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele, durante l'estate e richiede informazioni sui suoi orari di apertura e la necessità di prenotare per accedere."}

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda l'apertura del punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele, durante l'estate e richiede informazioni sui suoi orari di apertura e la necessità di prenotare per accedere.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda l'apertura del punto prelievi di Via Sardegna 5, Fizzonasco di Pieve Emanuele, durante l'estate e richiede informazioni sui suoi orari di apertura e la necessità di prenotare per accedere.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 84603c469a73afd10e6b33f96ccd16fc classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 681
   💬 Token conversazione: 474
   📊 Token totali: 1155
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1155 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 681
   📊 Token conversazione originale: 474
   📊 Token conversazione finale: 474
   📊 Token totali: 1155
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1553 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei sapere se sabato 30 settembre 2025 è possibile fare gli esami del sangue Humanitas fiordaliso? [ASSISTENTE] Presso Humanitas Medical Care Rozzano-Fiordaliso, il sabato è possibile effettuare prelievi del sangue dalle 7:30 alle 10:00 solo su prenotazione, e dalle 10:00 alle 11:00 c..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4062 characters
🔢 Token Analysis:
   📊 Token prompt base: 681
   📊 Token conversazione: 474
   📊 Token totali stimati: 1155
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei sapere se sabato 30 settembre 2025 è possibile fare gli esami del sangue Humanitas fiordaliso? [ASSISTENTE] Presso Humanitas Medical Care Rozzano-Fiordaliso, il sabato è possibile effettuare prelievi del sangue dalle 7:30 alle 10:00 solo su prenotazione, e dalle 10:00 alle 11:00 c..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.98, 'motivation': 'La conversazione riguarda la possibilità di prenotare un esame del sangue presso Humanitas Medical Care Rozzano-Fiordaliso, e il fatto che ci sia una possibilità di accedere liberamente senza prenotazione solo dalle 10:00 alle 11:00. Inoltre, viene consigliato di contattare la struttura per confermare eventuali modalità specifiche di accesso dedicate a persone con invalidità.'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:18.898793
====================================================================================================
📋 Session ID: classify_1756769058
⏱️  Processing Time: 1.886s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (1553 chars):
   [UTENTE] Vorrei sapere se sabato 30 settembre 2025 è possibile fare gli esami del sangue Humanitas fiordaliso? [ASSISTENTE] Presso Humanitas Medical Care Rozzano-Fiordaliso, il sabato è possibile e...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (453 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.98, 'motivation': 'La conversazione riguarda la possibilità di prenotare un esame del sangue presso Humanitas Medical Care Rozzano-Fiordaliso, e il fatto che ci sia una possibilità di accedere liberamente senza prenotazione solo dalle 10:00 al...

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.98
   motivation: La conversazione riguarda la possibilità di prenotare un esame del sangue presso Humanitas Medical Care Rozzano-Fiordaliso, e il fatto che ci sia una possibilità di accedere liberamente senza prenotazione solo dalle 10:00 alle 11:00. Inoltre, viene consigliato di contattare la struttura per confermare eventuali modalità specifiche di accesso dedicate a persone con invalidità.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.980
   [███████████████████░] 98.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la possibilità di prenotare un esame del sangue presso Humanitas Medical Care Rozzano-Fiordaliso, e il fatto che ci sia una possibilità di accedere liberamente senza prenotazione solo dalle 10:00 alle 11:00. Inoltre, viene consigliato di contattare la struttura per confermare eventuali modalità specifiche di accesso dedicate a persone con invalidità.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione b58e89f0bba2efa26e8876038fedabbe classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 661
   💬 Token conversazione: 203
   📊 Token totali: 864
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 864 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 661
   📊 Token conversazione originale: 203
   📊 Token conversazione finale: 203
   📊 Token totali: 864
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 614 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Orari farmacia per ritiro puntura [ASSISTENTE] La Farmacia dell’Istituto Clinico Humanitas è aperta dal lunedì al venerdì (esclusi i festivi) con i seguenti orari:  
- Mattina: dalle 8:30 alle 13:00;  
- Pomeriggio: dalle 14:00 alle 17:30. [...] json】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 3950 characters
🔢 Token Analysis:
   📊 Token prompt base: 661
   📊 Token conversazione: 203
   📊 Token totali stimati: 864
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Orari farmacia per ritiro puntura [ASSISTENTE] La Farmacia dell’Istituto Clinico Humanitas è aperta dal lunedì al venerdì (esclusi i festivi) con i seguenti orari:  
- Mattina: dalle 8:30 alle 13:00;  
- Pomeriggio: dalle 14:00 alle 17:30. [...] json】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Farmacia"', 'confidence': 0.95, 'motivation': "La conversazione riguarda l'orario di apertura della farmacia dell'Istituto Clinico Humanitas e le informazioni relative all'accesso ai pazienti in trattamento con farmaci sperimentali o ospedalieri."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:20.127384
====================================================================================================
📋 Session ID: classify_1756769060
⏱️  Processing Time: 1.141s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (614 chars):
   [UTENTE] Orari farmacia per ritiro puntura [ASSISTENTE] La Farmacia dell’Istituto Clinico Humanitas è aperta dal lunedì al venerdì (esclusi i festivi) con i seguenti orari:  
- Mattina: dalle 8:30 ...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [104 more lines] ...
     Line 108: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (270 chars):
   {'predicted_label': '"Farmacia"', 'confidence': 0.95, 'motivation': "La conversazione riguarda l'orario di apertura della farmacia dell'Istituto Clinico Humanitas e le informazioni relative all'accesso ai pazienti in trattamento con farmaci sperimentali o ospedalieri."}

📊 Parsed Response:
   predicted_label: "Farmacia"
   confidence: 0.95
   motivation: La conversazione riguarda l'orario di apertura della farmacia dell'Istituto Clinico Humanitas e le informazioni relative all'accesso ai pazienti in trattamento con farmaci sperimentali o ospedalieri.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda l'orario di apertura della farmacia dell'Istituto Clinico Humanitas e le informazioni relative all'accesso ai pazienti in trattamento con farmaci sperimentali o ospedalieri.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione de9f97f13a6ce2d72bb2fb2ecf10a2bb classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ✅ Nuovo tag '"Farmacia"' aggiunto per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
   📈 Progresso LLM: 50/155
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 685
   💬 Token conversazione: 695
   📊 Token totali: 1380
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1380 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 685
   📊 Token conversazione originale: 695
   📊 Token conversazione finale: 695
   📊 Token totali: 1380
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 2214 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Voglio sapere si posso fare domani, sabato, i seguenti esami de sangue: omocisteina, fattore di necrose tumorale, interleuchina 6 si 8 [ASSISTENTE] Puoi effettuare gli esami del sangue richiesti (omocisteina, fattore di necrosi tumorale, interleuchina 6 e 8) il sabato presso l'Istituto C..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4074 characters
🔢 Token Analysis:
   📊 Token prompt base: 685
   📊 Token conversazione: 695
   📊 Token totali stimati: 1380
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Voglio sapere si posso fare domani, sabato, i seguenti esami de sangue: omocisteina, fattore di necrose tumorale, interleuchina 6 si 8 [ASSISTENTE] Puoi effettuare gli esami del sangue richiesti (omocisteina, fattore di necrosi tumorale, interleuchina 6 e 8) il sabato presso l'Istituto C..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di un esame di laboratorio per una persona, specificatamente gli esami del sangue richiesti (omocisteina, fattore di necrosi tumorale, interleuchina 6 e 8). Il cliente ha chiesto se può effettuare l'esame il sabato e se è necessario avere un'impegnativa medica. L'assistente ha risposto che gli esami possono essere effettuati il sabato presso l'Istituto Clinico Humanitas, ma senza impegnativa solo in regime privato. Il cliente ha poi chiesto come prenotare gli esami in regime privato e l'assistente ha fornito le informazioni necessarie per farlo. Infine, il cliente ha chiesto dove possono essere effettuati gli esami per una bambina e l'assistente ha consigliato di contattare direttamente l'Istituto Clinico Humanitas per verificare la disponibilità e i punti prelievo adatti ai bambini."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:23.932837
====================================================================================================
📋 Session ID: classify_1756769063
⏱️  Processing Time: 3.712s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (2214 chars):
   [UTENTE] Voglio sapere si posso fare domani, sabato, i seguenti esami de sangue: omocisteina, fattore di necrose tumorale, interleuchina 6 si 8 [ASSISTENTE] Puoi effettuare gli esami del sangue ric...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (911 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di un esame di laboratorio per una persona, specificatamente gli esami del sangue richiesti (omocisteina, fattore di necrosi tumorale, interleuchina 6 e 8). Il cliente ha chiesto se ...

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di un esame di laboratorio per una persona, specificatamente gli esami del sangue richiesti (omocisteina, fattore di necrosi tumorale, interleuchina 6 e 8). Il cliente ha chiesto se può effettuare l'esame il sabato e se è necessario avere un'impegnativa medica. L'assistente ha risposto che gli esami possono essere effettuati il sabato presso l'Istituto Clinico Humanitas, ma senza impegnativa solo in regime privato. Il cliente ha poi chiesto come prenotare gli esami in regime privato e l'assistente ha fornito le informazioni necessarie per farlo. Infine, il cliente ha chiesto dove possono essere effettuati gli esami per una bambina e l'assistente ha consigliato di contattare direttamente l'Istituto Clinico Humanitas per verificare la disponibilità e i punti prelievo adatti ai bambini.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un esame di laboratorio per una persona, specificatamente gli esami del sangue richiesti (omocisteina, fattore di necrosi tumorale, interleuchina 6 e 8). Il cliente ha chiesto se può effettuare l'esame il sabato e se è necessario avere un'impegnativa medica. L'assistente ha risposto che gli esami possono essere effettuati il sabato presso l'Istituto ...
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione f146630e1a4c6230f6ce6b77f7906cc4 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 686
   💬 Token conversazione: 381
   📊 Token totali: 1067
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1067 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 686
   📊 Token conversazione originale: 381
   📊 Token conversazione finale: 381
   📊 Token totali: 1067
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1128 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei prenotare una visita urologica [ASSISTENTE] Per prenotare una visita urologica presso l'Istituto Clinico Humanitas, puoi utilizzare i seguenti canali di prenotazione:

1. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 3990 characters
🔢 Token Analysis:
   📊 Token prompt base: 686
   📊 Token conversazione: 381
   📊 Token totali stimati: 1067
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei prenotare una visita urologica [ASSISTENTE] Per prenotare una visita urologica presso l'Istituto Clinico Humanitas, puoi utilizzare i seguenti canali di prenotazione:

1. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 1.0, 'motivation': 'La conversazione riguarda la prenotazione di un\'esame urologico presso l\'Istituto Clinico Humanitas, quindi è appropriato classificarla come "Prenotazione".'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:25.105172
====================================================================================================
📋 Session ID: classify_1756769065
⏱️  Processing Time: 1.087s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (1128 chars):
   [UTENTE] Vorrei prenotare una visita urologica [ASSISTENTE] Per prenotare una visita urologica presso l'Istituto Clinico Humanitas, puoi utilizzare i seguenti canali di prenotazione:

1. **Privatam...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [105 more lines] ...
     Line 109: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (232 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 1.0, 'motivation': 'La conversazione riguarda la prenotazione di un\'esame urologico presso l\'Istituto Clinico Humanitas, quindi è appropriato classificarla come "Prenotazione".'}

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 1.0
   motivation: La conversazione riguarda la prenotazione di un'esame urologico presso l'Istituto Clinico Humanitas, quindi è appropriato classificarla come "Prenotazione".
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 1.000
   [████████████████████] 100.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un'esame urologico presso l'Istituto Clinico Humanitas, quindi è appropriato classificarla come "Prenotazione".
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 7716406c9be5bd21dd42d55b81d57dda classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 665
   💬 Token conversazione: 208
   📊 Token totali: 873
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 873 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 665
   📊 Token conversazione originale: 208
   📊 Token conversazione finale: 208
   📊 Token totali: 873
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 671 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] HO PRENOTATO UNA TELEVISITA. [...] docx】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 3751 characters
🔢 Token Analysis:
   📊 Token prompt base: 665
   📊 Token conversazione: 208
   📊 Token totali stimati: 873
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] HO PRENOTATO UNA TELEVISITA. [...] docx】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Visita Specialistica"', 'confidence': 1.0, 'motivation': 'La conversazione riguarda la modalità di svolgimento di una visita specialistica tramite televisita, quindi è stata classificata come "Visita Specialistica".'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:26.136483
====================================================================================================
📋 Session ID: classify_1756769066
⏱️  Processing Time: 0.943s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (671 chars):
   [UTENTE] HO PRENOTATO UNA TELEVISITA. COME FUNZIONA? [ASSISTENTE] La televisita si svolge in questo modo:

1. All'orario fissato, accedi alla piattaforma cliccando sul link ricevuto via email.
2. V...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (239 chars):
   {'predicted_label': '"Visita Specialistica"', 'confidence': 1.0, 'motivation': 'La conversazione riguarda la modalità di svolgimento di una visita specialistica tramite televisita, quindi è stata classificata come "Visita Specialistica".'}

📊 Parsed Response:
   predicted_label: "Visita Specialistica"
   confidence: 1.0
   motivation: La conversazione riguarda la modalità di svolgimento di una visita specialistica tramite televisita, quindi è stata classificata come "Visita Specialistica".
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 1.000
   [████████████████████] 100.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la modalità di svolgimento di una visita specialistica tramite televisita, quindi è stata classificata come "Visita Specialistica".
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione bde8cfeb6db9c96b7cea0e1d3db235a9 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Visita Specialistica"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 665
   💬 Token conversazione: 319
   📊 Token totali: 984
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 984 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 665
   📊 Token conversazione originale: 319
   📊 Token conversazione finale: 319
   📊 Token totali: 984
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1078 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao  [ASSISTENTE] Ciao! Come posso esserti utile? 😊 [UTENTE] Si  [ASSISTENTE] Perfetto! Dimmi pure, come posso aiutarti? 😊 [UTENTE] ho prenotato per il 15 settembre con il Dr. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 3916 characters
🔢 Token Analysis:
   📊 Token prompt base: 665
   📊 Token conversazione: 319
   📊 Token totali stimati: 984
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao  [ASSISTENTE] Ciao! Come posso esserti utile? 😊 [UTENTE] Si  [ASSISTENTE] Perfetto! Dimmi pure, come posso aiutarti? 😊 [UTENTE] ho prenotato per il 15 settembre con il Dr. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Visita Specialistica"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda una prenotazione per un esame medico specifico, quindi è classificata come "Visita Specialistica". Il paziente ha chiesto informazioni specifiche sull\'esecuzione dell\'esame e sulla disponibilità delle immagini in formato digitale o cartaceo.'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:27.567068
====================================================================================================
📋 Session ID: classify_1756769067
⏱️  Processing Time: 1.345s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (1078 chars):
   [UTENTE] Ciao  [ASSISTENTE] Ciao! Come posso esserti utile? 😊 [UTENTE] Si  [ASSISTENTE] Perfetto! Dimmi pure, come posso aiutarti? 😊 [UTENTE] ho prenotato per il 15 settembre con il Dr. Lamberto Zo...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (352 chars):
   {'predicted_label': '"Visita Specialistica"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda una prenotazione per un esame medico specifico, quindi è classificata come "Visita Specialistica". Il paziente ha chiesto informazioni specifiche sull\'esecuzione dell\'esame e sulla disponi...

📊 Parsed Response:
   predicted_label: "Visita Specialistica"
   confidence: 0.95
   motivation: La conversazione riguarda una prenotazione per un esame medico specifico, quindi è classificata come "Visita Specialistica". Il paziente ha chiesto informazioni specifiche sull'esecuzione dell'esame e sulla disponibilità delle immagini in formato digitale o cartaceo.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda una prenotazione per un esame medico specifico, quindi è classificata come "Visita Specialistica". Il paziente ha chiesto informazioni specifiche sull'esecuzione dell'esame e sulla disponibilità delle immagini in formato digitale o cartaceo.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione f45b43736555750a41415269ae3919b4 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Visita Specialistica"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 665
   💬 Token conversazione: 195
   📊 Token totali: 860
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 860 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 665
   📊 Token conversazione originale: 195
   📊 Token conversazione finale: 195
   📊 Token totali: 860
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 661 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Dovrei effettuare una enteroscopia con biopsia Humatis effettua questo tipo di prestazione  e il costo in regime privato [ASSISTENTE] Humanitas effettua l'enteroscopia con biopsia, una procedura che consente di esaminare il piccolo intestino e prelevare campioni di tessuto per analisi is..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4002 characters
🔢 Token Analysis:
   📊 Token prompt base: 665
   📊 Token conversazione: 195
   📊 Token totali stimati: 860
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Dovrei effettuare una enteroscopia con biopsia Humatis effettua questo tipo di prestazione  e il costo in regime privato [ASSISTENTE] Humanitas effettua l'enteroscopia con biopsia, una procedura che consente di esaminare il piccolo intestino e prelevare campioni di tessuto per analisi is..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Visita Specialistica Oncologica"', 'confidence': 0.95, 'motivation': "La conversazione riguarda una procedura medica, l'enteroscopia con biopsia, che è tipicamente eseguita da un endoscopista digestivo specializzato in malattie oncologiche del piccolo intestino."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:28.828790
====================================================================================================
📋 Session ID: classify_1756769068
⏱️  Processing Time: 1.172s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (661 chars):
   [UTENTE] Dovrei effettuare una enteroscopia con biopsia Humatis effettua questo tipo di prestazione  e il costo in regime privato [ASSISTENTE] Humanitas effettua l'enteroscopia con biopsia, una pro...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (286 chars):
   {'predicted_label': '"Visita Specialistica Oncologica"', 'confidence': 0.95, 'motivation': "La conversazione riguarda una procedura medica, l'enteroscopia con biopsia, che è tipicamente eseguita da un endoscopista digestivo specializzato in malattie oncologiche del piccolo intestino."}

📊 Parsed Response:
   predicted_label: "Visita Specialistica Oncologica"
   confidence: 0.95
   motivation: La conversazione riguarda una procedura medica, l'enteroscopia con biopsia, che è tipicamente eseguita da un endoscopista digestivo specializzato in malattie oncologiche del piccolo intestino.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda una procedura medica, l'enteroscopia con biopsia, che è tipicamente eseguita da un endoscopista digestivo specializzato in malattie oncologiche del piccolo intestino.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 66230a1dbe5b91de8f85e703d0591980 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Visita Specialistica Oncologica"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 686
   💬 Token conversazione: 407
   📊 Token totali: 1093
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1093 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 686
   📊 Token conversazione originale: 407
   📊 Token conversazione finale: 407
   📊 Token totali: 1093
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1204 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, sono Fava Piera (05/07/48) paziente del cardiologo dr Carlo Ceriotti che mi ha visitata ila Rozzano il 25/06/25 prescrivendo ECOCARDIO di controllo da fare entro 6 mesi x importante patologia. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4059 characters
🔢 Token Analysis:
   📊 Token prompt base: 686
   📊 Token conversazione: 407
   📊 Token totali stimati: 1093
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, sono Fava Piera (05/07/48) paziente del cardiologo dr Carlo Ceriotti che mi ha visitata ila Rozzano il 25/06/25 prescrivendo ECOCARDIO di controllo da fare entro 6 mesi x importante patologia. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di un esame medico (ecocardiogramma) e il paziente è stato indirizzato ad utilizzare i canali di prenotazione disponibili all'ospedale Humanitas."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:30.130693
====================================================================================================
📋 Session ID: classify_1756769070
⏱️  Processing Time: 1.214s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (1204 chars):
   [UTENTE] Buongiorno, sono Fava Piera (05/07/48) paziente del cardiologo dr Carlo Ceriotti che mi ha visitata ila Rozzano il 25/06/25 prescrivendo ECOCARDIO di controllo da fare entro 6 mesi x impor...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [105 more lines] ...
     Line 109: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (262 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di un esame medico (ecocardiogramma) e il paziente è stato indirizzato ad utilizzare i canali di prenotazione disponibili all'ospedale Humanitas."}

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di un esame medico (ecocardiogramma) e il paziente è stato indirizzato ad utilizzare i canali di prenotazione disponibili all'ospedale Humanitas.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un esame medico (ecocardiogramma) e il paziente è stato indirizzato ad utilizzare i canali di prenotazione disponibili all'ospedale Humanitas.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 2668862c9859bf5e81d8b07ea421b69d classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 685
   💬 Token conversazione: 150
   📊 Token totali: 835
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 835 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 685
   📊 Token conversazione originale: 150
   📊 Token conversazione finale: 150
   📊 Token totali: 835
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 487 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei sapere gli orari di visita ai pazienti nel reparto ortopedia [ASSISTENTE] Per visitare i pazienti ricoverati in Humanitas, gli orari di visita possono variare a seconda del reparto. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4043 characters
🔢 Token Analysis:
   📊 Token prompt base: 685
   📊 Token conversazione: 150
   📊 Token totali stimati: 835
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei sapere gli orari di visita ai pazienti nel reparto ortopedia [ASSISTENTE] Per visitare i pazienti ricoverati in Humanitas, gli orari di visita possono variare a seconda del reparto. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Visita Specialistica"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la visita a un paziente ricoverato in ospedale, quindi è stata classificata come "Visita Specialistica".'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:31.117070
====================================================================================================
📋 Session ID: classify_1756769071
⏱️  Processing Time: 0.899s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (487 chars):
   [UTENTE] Vorrei sapere gli orari di visita ai pazienti nel reparto ortopedia [ASSISTENTE] Per visitare i pazienti ricoverati in Humanitas, gli orari di visita possono variare a seconda del reparto....

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (213 chars):
   {'predicted_label': '"Visita Specialistica"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la visita a un paziente ricoverato in ospedale, quindi è stata classificata come "Visita Specialistica".'}

📊 Parsed Response:
   predicted_label: "Visita Specialistica"
   confidence: 0.95
   motivation: La conversazione riguarda la visita a un paziente ricoverato in ospedale, quindi è stata classificata come "Visita Specialistica".
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la visita a un paziente ricoverato in ospedale, quindi è stata classificata come "Visita Specialistica".
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 37dd89d3ec43b068f7f82c392d81bda7 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Visita Specialistica"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 685
   💬 Token conversazione: 276
   📊 Token totali: 961
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 961 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 685
   📊 Token conversazione originale: 276
   📊 Token conversazione finale: 276
   📊 Token totali: 961
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 841 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia, vorrei mettermi in contatto con la ginecologia del pio x [ASSISTENTE] Per contattare la ginecologia presso Humanitas San Pio X, puoi fare riferimento al Punto Nascita. [...]  Se hai bisogno di ulteriori dettagli, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4022 characters
🔢 Token Analysis:
   📊 Token prompt base: 685
   📊 Token conversazione: 276
   📊 Token totali stimati: 961
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia, vorrei mettermi in contatto con la ginecologia del pio x [ASSISTENTE] Per contattare la ginecologia presso Humanitas San Pio X, puoi fare riferimento al Punto Nascita. [...]  Se hai bisogno di ulteriori dettagli, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Referti e Cartelle Cliniche"', 'confidence': 0.95, 'motivation': "La conversazione riguarda l'indirizzo dell'ufficio ritiro referti presso Humanitas San Pio X, che è situato in Via Francesco Nava, 31, 20159 - Milano. Il messaggio contiene anche un link al sito ufficiale di Humanitas San Pio X per maggiori informazioni."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:32.700770
====================================================================================================
📋 Session ID: classify_1756769072
⏱️  Processing Time: 1.497s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (841 chars):
   [UTENTE] Ciao Giulia, vorrei mettermi in contatto con la ginecologia del pio x [ASSISTENTE] Per contattare la ginecologia presso Humanitas San Pio X, puoi fare riferimento al Punto Nascita. È attiv...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (344 chars):
   {'predicted_label': '"Referti e Cartelle Cliniche"', 'confidence': 0.95, 'motivation': "La conversazione riguarda l'indirizzo dell'ufficio ritiro referti presso Humanitas San Pio X, che è situato in Via Francesco Nava, 31, 20159 - Milano. Il messaggio contiene anche un link al sito ufficiale di H...

📊 Parsed Response:
   predicted_label: "Referti e Cartelle Cliniche"
   confidence: 0.95
   motivation: La conversazione riguarda l'indirizzo dell'ufficio ritiro referti presso Humanitas San Pio X, che è situato in Via Francesco Nava, 31, 20159 - Milano. Il messaggio contiene anche un link al sito ufficiale di Humanitas San Pio X per maggiori informazioni.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda l'indirizzo dell'ufficio ritiro referti presso Humanitas San Pio X, che è situato in Via Francesco Nava, 31, 20159 - Milano. Il messaggio contiene anche un link al sito ufficiale di Humanitas San Pio X per maggiori informazioni.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione dd9ef683d003b896bdd4d0abbf8b6c39 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Referti e Cartelle Cliniche"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 665
   💬 Token conversazione: 87
   📊 Token totali: 752
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 752 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 665
   📊 Token conversazione originale: 87
   📊 Token conversazione finale: 87
   📊 Token totali: 752
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 279 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] a che ore siete aperti? [ASSISTENTE] Gli orari di apertura possono variare a seconda del servizio o del reparto che desideri visitare. Potresti specificare a quale servizio o reparto ti riferisci? Ad esempio, pronto soccorso, ufficio ritiro referti, punti prelievo, ecc."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 3981 characters
🔢 Token Analysis:
   📊 Token prompt base: 665
   📊 Token conversazione: 87
   📊 Token totali stimati: 752
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] a che ore siete aperti? [ASSISTENTE] Gli orari di apertura possono variare a seconda del servizio o del reparto che desideri visitare. Potresti specificare a quale servizio o reparto ti riferisci? Ad esempio, pronto soccorso, ufficio ritiro referti, punti prelievo, ecc."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.85, 'motivation': "La domanda dell'utente indica che potrebbe essere interessato a prenotare un appuntamento con un determinato servizio o reparto."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:33.614601
====================================================================================================
📋 Session ID: classify_1756769073
⏱️  Processing Time: 0.827s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (279 chars):
   [UTENTE] a che ore siete aperti? [ASSISTENTE] Gli orari di apertura possono variare a seconda del servizio o del reparto che desideri visitare. Potresti specificare a quale servizio o reparto ti ri...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (203 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.85, 'motivation': "La domanda dell'utente indica che potrebbe essere interessato a prenotare un appuntamento con un determinato servizio o reparto."}

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.85
   motivation: La domanda dell'utente indica che potrebbe essere interessato a prenotare un appuntamento con un determinato servizio o reparto.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.850
   [█████████████████░░░] 85.0%

🧠 Reasoning/Motivation:
   La domanda dell'utente indica che potrebbe essere interessato a prenotare un appuntamento con un determinato servizio o reparto.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione ccda1ed50a5417e2dcaf8e0e44c89e87 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 685
   💬 Token conversazione: 188
   📊 Token totali: 873
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 873 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 685
   📊 Token conversazione originale: 188
   📊 Token conversazione finale: 188
   📊 Token totali: 873
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 663 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] La struttura è convenzionata ma alcuni medici non lo sono Unisalute [ASSISTENTE] Se ti riferisci alla possibilità di prenotare visite o esami con Unisalute, è importante sapere che alcune prestazioni potrebbero essere coperte dalla convenzione, mentre altre no. Inoltre, non tutti i medic..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4074 characters
🔢 Token Analysis:
   📊 Token prompt base: 685
   📊 Token conversazione: 188
   📊 Token totali stimati: 873
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] La struttura è convenzionata ma alcuni medici non lo sono Unisalute [ASSISTENTE] Se ti riferisci alla possibilità di prenotare visite o esami con Unisalute, è importante sapere che alcune prestazioni potrebbero essere coperte dalla convenzione, mentre altre no. Inoltre, non tutti i medic..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di visite o esami con Unisalute e il fatto che non tutti i medici potrebbero essere inclusi nella convenzione con Humanitas. Questo fa capire che si tratta di un servizio aziendale, in particolare l'ufficio prenotazioni."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:35.029541
====================================================================================================
📋 Session ID: classify_1756769075
⏱️  Processing Time: 1.328s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (663 chars):
   [UTENTE] La struttura è convenzionata ma alcuni medici non lo sono Unisalute [ASSISTENTE] Se ti riferisci alla possibilità di prenotare visite o esami con Unisalute, è importante sapere che alcune ...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (342 chars):
   {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di visite o esami con Unisalute e il fatto che non tutti i medici potrebbero essere inclusi nella convenzione con Humanitas. Questo fa capire che si tratta di un servizio aziend...

📊 Parsed Response:
   predicted_label: "Servizi aziendali"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di visite o esami con Unisalute e il fatto che non tutti i medici potrebbero essere inclusi nella convenzione con Humanitas. Questo fa capire che si tratta di un servizio aziendale, in particolare l'ufficio prenotazioni.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la prenotazione di visite o esami con Unisalute e il fatto che non tutti i medici potrebbero essere inclusi nella convenzione con Humanitas. Questo fa capire che si tratta di un servizio aziendale, in particolare l'ufficio prenotazioni.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione c709a229dd6729152098b7849dfcb7b8 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Servizi aziendali"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 686
   💬 Token conversazione: 129
   📊 Token totali: 815
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 815 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 686
   📊 Token conversazione originale: 129
   📊 Token conversazione finale: 129
   📊 Token totali: 815
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 457 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] come prenotare albergo convenzionato [ASSISTENTE] Per prenotare una struttura alberghiera convenzionata con Humanitas, puoi consultare l'elenco delle strutture disponibili alla pagina dedicata sul sito di Humanitas. [...] 

Se hai necessità di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4074 characters
🔢 Token Analysis:
   📊 Token prompt base: 686
   📊 Token conversazione: 129
   📊 Token totali stimati: 815
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] come prenotare albergo convenzionato [ASSISTENTE] Per prenotare una struttura alberghiera convenzionata con Humanitas, puoi consultare l'elenco delle strutture disponibili alla pagina dedicata sul sito di Humanitas. [...] 

Se hai necessità di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': 'alloggio', 'confidence': 1.0, 'motivation': 'La conversazione riguarda la prenotazione di un albergo convenzionato con Humanitas, quindi la classificazione è "alloggio".'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:35.913590
====================================================================================================
📋 Session ID: classify_1756769075
⏱️  Processing Time: 0.797s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (457 chars):
   [UTENTE] come prenotare albergo convenzionato [ASSISTENTE] Per prenotare una struttura alberghiera convenzionata con Humanitas, puoi consultare l'elenco delle strutture disponibili alla pagina dedi...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [105 more lines] ...
     Line 109: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (192 chars):
   {'predicted_label': 'alloggio', 'confidence': 1.0, 'motivation': 'La conversazione riguarda la prenotazione di un albergo convenzionato con Humanitas, quindi la classificazione è "alloggio".'}

📊 Parsed Response:
   predicted_label: alloggio
   confidence: 1.0
   motivation: La conversazione riguarda la prenotazione di un albergo convenzionato con Humanitas, quindi la classificazione è "alloggio".
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 1.000
   [████████████████████] 100.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un albergo convenzionato con Humanitas, quindi la classificazione è "alloggio".
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 1d54dd8cd6a07edd51e97388c0ba687b classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag 'alloggio' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 686
   💬 Token conversazione: 169
   📊 Token totali: 855
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 855 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 686
   📊 Token conversazione originale: 169
   📊 Token conversazione finale: 169
   📊 Token totali: 855
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 557 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ci sono navette da Milano Linate per l'ospedale? [ASSISTENTE] Non ci sono informazioni specifiche sulla presenza di navette dirette da Milano Linate all'Istituto Clinico Humanitas. [...] it/info/viaggi)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 3986 characters
🔢 Token Analysis:
   📊 Token prompt base: 686
   📊 Token conversazione: 169
   📊 Token totali stimati: 855
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ci sono navette da Milano Linate per l'ospedale? [ASSISTENTE] Non ci sono informazioni specifiche sulla presenza di navette dirette da Milano Linate all'Istituto Clinico Humanitas. [...] it/info/viaggi)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda un servizio di trasporto offerto dall\'ospedale Humanitas, quindi è stata classificata come "Servizi aziendali".'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:36.927520
====================================================================================================
📋 Session ID: classify_1756769076
⏱️  Processing Time: 0.928s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (557 chars):
   [UTENTE] Ci sono navette da Milano Linate per l'ospedale? [ASSISTENTE] Non ci sono informazioni specifiche sulla presenza di navette dirette da Milano Linate all'Istituto Clinico Humanitas. Tuttavi...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (218 chars):
   {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda un servizio di trasporto offerto dall\'ospedale Humanitas, quindi è stata classificata come "Servizi aziendali".'}

📊 Parsed Response:
   predicted_label: "Servizi aziendali"
   confidence: 0.95
   motivation: La conversazione riguarda un servizio di trasporto offerto dall'ospedale Humanitas, quindi è stata classificata come "Servizi aziendali".
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda un servizio di trasporto offerto dall'ospedale Humanitas, quindi è stata classificata come "Servizi aziendali".
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 050328634e866caa6c93d49607c05940 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Servizi aziendali"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta urgente - valuta priorità massima

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 684
   💬 Token conversazione: 731
   📊 Token totali: 1415
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1415 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 684
   📊 Token conversazione originale: 731
   📊 Token conversazione finale: 731
   📊 Token totali: 1415
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 2360 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao sono Giada, ho bisogno di aiuto per l'aereo  [ASSISTENTE] Ciao Giada! Potresti spiegarmi meglio di cosa hai bisogno riguardo l'aereo? Ad esempio, hai bisogno di indicazioni per raggiungere un aeroporto, informazioni sui voli o altro? Sono qui per aiutarti! [UTENTE] Informazioni sui ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4066 characters
🔢 Token Analysis:
   📊 Token prompt base: 684
   📊 Token conversazione: 731
   📊 Token totali stimati: 1415
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta urgente - valuta priorità massima

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao sono Giada, ho bisogno di aiuto per l'aereo  [ASSISTENTE] Ciao Giada! Potresti spiegarmi meglio di cosa hai bisogno riguardo l'aereo? Ad esempio, hai bisogno di indicazioni per raggiungere un aeroporto, informazioni sui voli o altro? Sono qui per aiutarti! [UTENTE] Informazioni sui ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la richiesta di informazioni per raggiungere l\'ospedale Humanitas tramite un taxi dall\'Aeroporto di Milano Linate, quindi è più appropriato classificarla come "Prenotazione" poiché il cliente ha espresso la necessità di trasporto.'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:38.578799
====================================================================================================
📋 Session ID: classify_1756769078
⏱️  Processing Time: 1.560s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (2360 chars):
   [UTENTE] Ciao sono Giada, ho bisogno di aiuto per l'aereo  [ASSISTENTE] Ciao Giada! Potresti spiegarmi meglio di cosa hai bisogno riguardo l'aereo? Ad esempio, hai bisogno di indicazioni per raggiu...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (333 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la richiesta di informazioni per raggiungere l\'ospedale Humanitas tramite un taxi dall\'Aeroporto di Milano Linate, quindi è più appropriato classificarla come "Prenotazione" poiché il cliente ha e...

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la richiesta di informazioni per raggiungere l'ospedale Humanitas tramite un taxi dall'Aeroporto di Milano Linate, quindi è più appropriato classificarla come "Prenotazione" poiché il cliente ha espresso la necessità di trasporto.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la richiesta di informazioni per raggiungere l'ospedale Humanitas tramite un taxi dall'Aeroporto di Milano Linate, quindi è più appropriato classificarla come "Prenotazione" poiché il cliente ha espresso la necessità di trasporto.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 9f75200918400cf753d993e72bde7eab classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 665
   💬 Token conversazione: 382
   📊 Token totali: 1047
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1047 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 665
   📊 Token conversazione originale: 382
   📊 Token conversazione finale: 382
   📊 Token totali: 1047
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1280 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Salve Giulia, se prenoto un volo, tramite le vostre convenzioni viaggiare insieme, è  prevista l'assistenza medica o solo una scontistica del prezzo del biglietto aereo? [ASSISTENTE] La convenzione "Viaggia insieme a noi" di Humanitas offre sconti sui biglietti aerei (50%-55% sulle tarif..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4002 characters
🔢 Token Analysis:
   📊 Token prompt base: 665
   📊 Token conversazione: 382
   📊 Token totali stimati: 1047
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Salve Giulia, se prenoto un volo, tramite le vostre convenzioni viaggiare insieme, è  prevista l'assistenza medica o solo una scontistica del prezzo del biglietto aereo? [ASSISTENTE] La convenzione "Viaggia insieme a noi" di Humanitas offre sconti sui biglietti aerei (50%-55% sulle tarif..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un volo e l\'assistenza medica o speciale che può essere richiesta in aeroporto, nonché il costo di questi servizi. Questo è un argomento relativo ai "Servizi aziendali" offerti da Humanitas.'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:40.039318
====================================================================================================
📋 Session ID: classify_1756769080
⏱️  Processing Time: 1.373s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (1280 chars):
   [UTENTE] Salve Giulia, se prenoto un volo, tramite le vostre convenzioni viaggiare insieme, è  prevista l'assistenza medica o solo una scontistica del prezzo del biglietto aereo? [ASSISTENTE] La co...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (316 chars):
   {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un volo e l\'assistenza medica o speciale che può essere richiesta in aeroporto, nonché il costo di questi servizi. Questo è un argomento relativo ai "Servizi aziendali" offe...

📊 Parsed Response:
   predicted_label: "Servizi aziendali"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di un volo e l'assistenza medica o speciale che può essere richiesta in aeroporto, nonché il costo di questi servizi. Questo è un argomento relativo ai "Servizi aziendali" offerti da Humanitas.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un volo e l'assistenza medica o speciale che può essere richiesta in aeroporto, nonché il costo di questi servizi. Questo è un argomento relativo ai "Servizi aziendali" offerti da Humanitas.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione b0cf7c8405339e14a5be077d7b754023 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Servizi aziendali"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 685
   💬 Token conversazione: 127
   📊 Token totali: 812
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 812 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 685
   📊 Token conversazione originale: 127
   📊 Token conversazione finale: 127
   📊 Token totali: 812
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 439 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Desidero sapere il costo di una prima visita proctologica  [ASSISTENTE] Non ho trovato informazioni specifiche sul costo di una prima visita proctologica nei documenti forniti. [...] it/visite-ed-esami/visita-proctologica)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4005 characters
🔢 Token Analysis:
   📊 Token prompt base: 685
   📊 Token conversazione: 127
   📊 Token totali stimati: 812
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Desidero sapere il costo di una prima visita proctologica  [ASSISTENTE] Non ho trovato informazioni specifiche sul costo di una prima visita proctologica nei documenti forniti. [...] it/visite-ed-esami/visita-proctologica)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di informazioni sui costi per una visita proctologica, che è un servizio offerto dall'azienda."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:41.036479
====================================================================================================
📋 Session ID: classify_1756769081
⏱️  Processing Time: 0.910s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (439 chars):
   [UTENTE] Desidero sapere il costo di una prima visita proctologica  [ASSISTENTE] Non ho trovato informazioni specifiche sul costo di una prima visita proctologica nei documenti forniti. Ti consigli...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (213 chars):
   {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di informazioni sui costi per una visita proctologica, che è un servizio offerto dall'azienda."}

📊 Parsed Response:
   predicted_label: "Servizi aziendali"
   confidence: 0.95
   motivation: La conversazione riguarda la richiesta di informazioni sui costi per una visita proctologica, che è un servizio offerto dall'azienda.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la richiesta di informazioni sui costi per una visita proctologica, che è un servizio offerto dall'azienda.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione b0ea843d48d0711c3a0d740aee83aa2d classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Servizi aziendali"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 685
   💬 Token conversazione: 201
   📊 Token totali: 886
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 886 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 685
   📊 Token conversazione originale: 201
   📊 Token conversazione finale: 201
   📊 Token totali: 886
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 693 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei fare vaccino anti epatite A [ASSISTENTE] Per sapere se è possibile effettuare il vaccino contro l'epatite A presso Humanitas, ti consiglio di contattare direttamente il centralino al numero 02 82241. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4061 characters
🔢 Token Analysis:
   📊 Token prompt base: 685
   📊 Token conversazione: 201
   📊 Token totali stimati: 886
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei fare vaccino anti epatite A [ASSISTENTE] Per sapere se è possibile effettuare il vaccino contro l'epatite A presso Humanitas, ti consiglio di contattare direttamente il centralino al numero 02 82241. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un vaccino anti epatite A presso Humanitas, che richiede contatto con il centralino per verificare se è possibile effettuare la prenotazione online o seguire altre modalità.'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:42.252466
====================================================================================================
📋 Session ID: classify_1756769082
⏱️  Processing Time: 1.129s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (693 chars):
   [UTENTE] Vorrei fare vaccino anti epatite A [ASSISTENTE] Per sapere se è possibile effettuare il vaccino contro l'epatite A presso Humanitas, ti consiglio di contattare direttamente il centralino a...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (293 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un vaccino anti epatite A presso Humanitas, che richiede contatto con il centralino per verificare se è possibile effettuare la prenotazione online o seguire altre modalità.'}

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di un vaccino anti epatite A presso Humanitas, che richiede contatto con il centralino per verificare se è possibile effettuare la prenotazione online o seguire altre modalità.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un vaccino anti epatite A presso Humanitas, che richiede contatto con il centralino per verificare se è possibile effettuare la prenotazione online o seguire altre modalità.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 50b0258a70adcc854fddb070c61d7cde classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 685
   💬 Token conversazione: 358
   📊 Token totali: 1043
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1043 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 685
   📊 Token conversazione originale: 358
   📊 Token conversazione finale: 358
   📊 Token totali: 1043
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1220 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao, devo fare il rinnovo del certificato DSA, volevo sapere cosa devo fare e quanto mi viene a costare e poi volevo chiedere se potevo farlo a pagamento?  [ASSISTENTE] Non ho trovato informazioni specifiche sul rinnovo del certificato DSA nei documenti caricati. Ti consiglio di contatt..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4074 characters
🔢 Token Analysis:
   📊 Token prompt base: 685
   📊 Token conversazione: 358
   📊 Token totali stimati: 1043
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao, devo fare il rinnovo del certificato DSA, volevo sapere cosa devo fare e quanto mi viene a costare e poi volevo chiedere se potevo farlo a pagamento?  [ASSISTENTE] Non ho trovato informazioni specifiche sul rinnovo del certificato DSA nei documenti caricati. Ti consiglio di contatt..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di un esame medico, precisamente il rinnovo del certificato DSA. Il richiedente chiede informazioni su come procedere e sul costo dell'esame, oltre a verificare l'indirizzo email corretto per contattare il centro di prenotazione."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:43.796187
====================================================================================================
📋 Session ID: classify_1756769083
⏱️  Processing Time: 1.455s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (1220 chars):
   [UTENTE] ciao, devo fare il rinnovo del certificato DSA, volevo sapere cosa devo fare e quanto mi viene a costare e poi volevo chiedere se potevo farlo a pagamento?  [ASSISTENTE] Non ho trovato inf...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (346 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di un esame medico, precisamente il rinnovo del certificato DSA. Il richiedente chiede informazioni su come procedere e sul costo dell'esame, oltre a verificare l'indirizzo email cor...

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di un esame medico, precisamente il rinnovo del certificato DSA. Il richiedente chiede informazioni su come procedere e sul costo dell'esame, oltre a verificare l'indirizzo email corretto per contattare il centro di prenotazione.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un esame medico, precisamente il rinnovo del certificato DSA. Il richiedente chiede informazioni su come procedere e sul costo dell'esame, oltre a verificare l'indirizzo email corretto per contattare il centro di prenotazione.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione f0e99f278a51d9a46ad87c6574653568 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 665
   💬 Token conversazione: 142
   📊 Token totali: 807
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 807 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 665
   📊 Token conversazione originale: 142
   📊 Token conversazione finale: 142
   📊 Token totali: 807
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 531 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei acquistare tramite welfare un checkup uomo personalizzato del valore di 1000euro, in cosa consiste il checkup personalizzato del valore di 1000euro?  [ASSISTENTE] Non ho trovato informazioni specifiche sul checkup uomo personalizzato del valore di 1000 euro nei documenti caricati...."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4002 characters
🔢 Token Analysis:
   📊 Token prompt base: 665
   📊 Token conversazione: 142
   📊 Token totali stimati: 807
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei acquistare tramite welfare un checkup uomo personalizzato del valore di 1000euro, in cosa consiste il checkup personalizzato del valore di 1000euro?  [ASSISTENTE] Non ho trovato informazioni specifiche sul checkup uomo personalizzato del valore di 1000 euro nei documenti caricati...."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': 'La richiesta riguarda un servizio di welfare che non è specifico in nessun documento caricato, quindi la classificazione più appropriata è "Servizi aziendali".'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:44.868486
====================================================================================================
📋 Session ID: classify_1756769084
⏱️  Processing Time: 0.985s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (531 chars):
   [UTENTE] Vorrei acquistare tramite welfare un checkup uomo personalizzato del valore di 1000euro, in cosa consiste il checkup personalizzato del valore di 1000euro?  [ASSISTENTE] Non ho trovato inf...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (239 chars):
   {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': 'La richiesta riguarda un servizio di welfare che non è specifico in nessun documento caricato, quindi la classificazione più appropriata è "Servizi aziendali".'}

📊 Parsed Response:
   predicted_label: "Servizi aziendali"
   confidence: 0.95
   motivation: La richiesta riguarda un servizio di welfare che non è specifico in nessun documento caricato, quindi la classificazione più appropriata è "Servizi aziendali".
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La richiesta riguarda un servizio di welfare che non è specifico in nessun documento caricato, quindi la classificazione più appropriata è "Servizi aziendali".
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione fc2734ad1c81a347cbe142838178a44f classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Servizi aziendali"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 685
   💬 Token conversazione: 178
   📊 Token totali: 863
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 863 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 685
   📊 Token conversazione originale: 178
   📊 Token conversazione finale: 178
   📊 Token totali: 863
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 543 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia, io devo venire in Humanitas domani. [...] )

Fammi sapere così posso darti indicazioni precise! [UTENTE] Rozzano, mezzi pubblici [ASSISTENTE] Perfetto! Vuoi utilizzare l'autobus, la metro, il tram o il treno per raggiungere Humanitas Rozzano da Porta Venezia?"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4055 characters
🔢 Token Analysis:
   📊 Token prompt base: 685
   📊 Token conversazione: 178
   📊 Token totali stimati: 863
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia, io devo venire in Humanitas domani. [...] )

Fammi sapere così posso darti indicazioni precise! [UTENTE] Rozzano, mezzi pubblici [ASSISTENTE] Perfetto! Vuoi utilizzare l'autobus, la metro, il tram o il treno per raggiungere Humanitas Rozzano da Porta Venezia?"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda una prenotazione di un paziente che intende recarsi a Humanitas Rozzano il giorno successivo e chiede indicazioni su come raggiungere l'ospedale utilizzando i mezzi pubblici."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:46.086160
====================================================================================================
📋 Session ID: classify_1756769086
⏱️  Processing Time: 1.132s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (543 chars):
   [UTENTE] Ciao Giulia, io devo venire in Humanitas domani. Come posso arrivarci da Porta Venezia? [ASSISTENTE] Per aiutarti al meglio, ho bisogno di sapere:

1. In quale sede di Humanitas devi andar...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [105 more lines] ...
     Line 109: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (275 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda una prenotazione di un paziente che intende recarsi a Humanitas Rozzano il giorno successivo e chiede indicazioni su come raggiungere l'ospedale utilizzando i mezzi pubblici."}

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda una prenotazione di un paziente che intende recarsi a Humanitas Rozzano il giorno successivo e chiede indicazioni su come raggiungere l'ospedale utilizzando i mezzi pubblici.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda una prenotazione di un paziente che intende recarsi a Humanitas Rozzano il giorno successivo e chiede indicazioni su come raggiungere l'ospedale utilizzando i mezzi pubblici.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 68416f611be4828552d0f69d164e274c classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 665
   💬 Token conversazione: 85
   📊 Token totali: 750
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 750 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 665
   📊 Token conversazione originale: 85
   📊 Token conversazione finale: 85
   📊 Token totali: 750
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 267 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] La linea 220 è extraurbana? [ASSISTENTE] Sì, la linea 220 è una linea extraurbana che collega Humanitas con Pieve Emanuele, Opera e Locate, partendo da Rozzano, via della Solidarietà【6:0†scraped_https___www.humanitas.it_info_come-raggiungere-humanitas.json】."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 3969 characters
🔢 Token Analysis:
   📊 Token prompt base: 665
   📊 Token conversazione: 85
   📊 Token totali stimati: 750
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] La linea 220 è extraurbana? [ASSISTENTE] Sì, la linea 220 è una linea extraurbana che collega Humanitas con Pieve Emanuele, Opera e Locate, partendo da Rozzano, via della Solidarietà【6:0†scraped_https___www.humanitas.it_info_come-raggiungere-humanitas.json】."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 1.0, 'motivation': "La domanda dell'utente riguarda la localizzazione della linea di trasporto che collega l'ospedale Humanitas con altre città, quindi si tratta di una prenotazione."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:47.120103
====================================================================================================
📋 Session ID: classify_1756769087
⏱️  Processing Time: 0.948s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (267 chars):
   [UTENTE] La linea 220 è extraurbana? [ASSISTENTE] Sì, la linea 220 è una linea extraurbana che collega Humanitas con Pieve Emanuele, Opera e Locate, partendo da Rozzano, via della Solidarietà【6:0†s...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (236 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 1.0, 'motivation': "La domanda dell'utente riguarda la localizzazione della linea di trasporto che collega l'ospedale Humanitas con altre città, quindi si tratta di una prenotazione."}

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 1.0
   motivation: La domanda dell'utente riguarda la localizzazione della linea di trasporto che collega l'ospedale Humanitas con altre città, quindi si tratta di una prenotazione.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 1.000
   [████████████████████] 100.0%

🧠 Reasoning/Motivation:
   La domanda dell'utente riguarda la localizzazione della linea di trasporto che collega l'ospedale Humanitas con altre città, quindi si tratta di una prenotazione.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione f7322d94b97b199c32b8ac8028531b47 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 665
   💬 Token conversazione: 303
   📊 Token totali: 968
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 968 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 665
   📊 Token conversazione originale: 303
   📊 Token conversazione finale: 303
   📊 Token totali: 968
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 903 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao giulia abito a lesmo come raggiungo la sede di rozzano in auto [ASSISTENTE] Per aiutarti a raggiungere la sede di Rozzano in auto da Lesmo, calcolo il percorso. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 3948 characters
🔢 Token Analysis:
   📊 Token prompt base: 665
   📊 Token conversazione: 303
   📊 Token totali stimati: 968
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao giulia abito a lesmo come raggiungo la sede di rozzano in auto [ASSISTENTE] Per aiutarti a raggiungere la sede di Rozzano in auto da Lesmo, calcolo il percorso. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di percorso da Lesmo a Rozzano in auto, che è una richiesta comune per le prenotazioni o visite presso l'ospedale Humanitas."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:48.301559
====================================================================================================
📋 Session ID: classify_1756769088
⏱️  Processing Time: 1.095s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (903 chars):
   [UTENTE] ciao giulia abito a lesmo come raggiungo la sede di rozzano in auto [ASSISTENTE] Per aiutarti a raggiungere la sede di Rozzano in auto da Lesmo, calcolo il percorso. Un attimo di pazienza....

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (238 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di percorso da Lesmo a Rozzano in auto, che è una richiesta comune per le prenotazioni o visite presso l'ospedale Humanitas."}

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la richiesta di percorso da Lesmo a Rozzano in auto, che è una richiesta comune per le prenotazioni o visite presso l'ospedale Humanitas.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la richiesta di percorso da Lesmo a Rozzano in auto, che è una richiesta comune per le prenotazioni o visite presso l'ospedale Humanitas.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione bf943628a47730c170498e26807edc8e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 685
   💬 Token conversazione: 85
   📊 Token totali: 770
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 770 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 685
   📊 Token conversazione originale: 85
   📊 Token conversazione finale: 85
   📊 Token totali: 770
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 277 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, vorrei capire come arrivare dall’autostrada al centro di P Ricovero via Building 4 [ASSISTENTE] Per aiutarti al meglio, potresti specificare da quale autostrada stai arrivando? Inoltre, desideri sapere il percorso in auto o con un altro mezzo di trasporto?"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4051 characters
🔢 Token Analysis:
   📊 Token prompt base: 685
   📊 Token conversazione: 85
   📊 Token totali stimati: 770
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, vorrei capire come arrivare dall’autostrada al centro di P Ricovero via Building 4 [ASSISTENTE] Per aiutarti al meglio, potresti specificare da quale autostrada stai arrivando? Inoltre, desideri sapere il percorso in auto o con un altro mezzo di trasporto?"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione sembra riguardare la prenotazione di un viaggio verso il centro di P Ricovero, ma manca informazioni sulla autostrada da cui si sta arrivando e sul mezzo di trasporto utilizzato.'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:49.431871
====================================================================================================
📋 Session ID: classify_1756769089
⏱️  Processing Time: 1.044s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (277 chars):
   [UTENTE] Buongiorno, vorrei capire come arrivare dall’autostrada al centro di P Ricovero via Building 4 [ASSISTENTE] Per aiutarti al meglio, potresti specificare da quale autostrada stai arrivando?...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (270 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione sembra riguardare la prenotazione di un viaggio verso il centro di P Ricovero, ma manca informazioni sulla autostrada da cui si sta arrivando e sul mezzo di trasporto utilizzato.'}

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione sembra riguardare la prenotazione di un viaggio verso il centro di P Ricovero, ma manca informazioni sulla autostrada da cui si sta arrivando e sul mezzo di trasporto utilizzato.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione sembra riguardare la prenotazione di un viaggio verso il centro di P Ricovero, ma manca informazioni sulla autostrada da cui si sta arrivando e sul mezzo di trasporto utilizzato.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 36034ecbd1ab10badd44b5abf6a5055c classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 685
   💬 Token conversazione: 181
   📊 Token totali: 866
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 866 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 685
   📊 Token conversazione originale: 181
   📊 Token conversazione finale: 181
   📊 Token totali: 866
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 692 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao,vorrei sapere se ci sono degli incontri gratuiti dove spiegano tutto il percorso di inseminazione assistita,con ginecologi,psicologi [ASSISTENTE] Per quanto riguarda il percorso di inseminazione assistita, Humanitas offre un Fertility Center specializzato in procreazione medicalment..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4074 characters
🔢 Token Analysis:
   📊 Token prompt base: 685
   📊 Token conversazione: 181
   📊 Token totali stimati: 866
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao,vorrei sapere se ci sono degli incontri gratuiti dove spiegano tutto il percorso di inseminazione assistita,con ginecologi,psicologi [ASSISTENTE] Per quanto riguarda il percorso di inseminazione assistita, Humanitas offre un Fertility Center specializzato in procreazione medicalment..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la richiesta di informazioni su incontri gratuiti per spiegare il percorso di inseminazione assistita, che è un servizio offerto dal Fertility Center di Humanitas. Tuttavia, non sono state fornite informazioni specifiche su eventuali incontri gratuiti con ginecologi o psicologi. La risposta consiglia di contattare direttamente il Fertility Center per ottenere dettagli su eventuali incontri o consulenze, e fornisce un link alla pagina dedicata al Fertility Center di Humanitas.'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:51.639021
====================================================================================================
📋 Session ID: classify_1756769091
⏱️  Processing Time: 2.119s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (692 chars):
   [UTENTE] Ciao,vorrei sapere se ci sono degli incontri gratuiti dove spiegano tutto il percorso di inseminazione assistita,con ginecologi,psicologi [ASSISTENTE] Per quanto riguarda il percorso di in...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (601 chars):
   {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la richiesta di informazioni su incontri gratuiti per spiegare il percorso di inseminazione assistita, che è un servizio offerto dal Fertility Center di Humanitas. Tuttavia, non ...

📊 Parsed Response:
   predicted_label: "Humanitas con te - Registrazione"
   confidence: 0.95
   motivation: La conversazione riguarda la richiesta di informazioni su incontri gratuiti per spiegare il percorso di inseminazione assistita, che è un servizio offerto dal Fertility Center di Humanitas. Tuttavia, non sono state fornite informazioni specifiche su eventuali incontri gratuiti con ginecologi o psicologi. La risposta consiglia di contattare direttamente il Fertility Center per ottenere dettagli su eventuali incontri o consulenze, e fornisce un link alla pagina dedicata al Fertility Center di Humanitas.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la richiesta di informazioni su incontri gratuiti per spiegare il percorso di inseminazione assistita, che è un servizio offerto dal Fertility Center di Humanitas. Tuttavia, non sono state fornite informazioni specifiche su eventuali incontri gratuiti con ginecologi o psicologi. La risposta consiglia di contattare direttamente il Fertility Center per ottenere dettagli ...
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione e603ab5e96a4628539deea7406ac6d7b classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Humanitas con te - Registrazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 685
   💬 Token conversazione: 697
   📊 Token totali: 1382
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1382 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 685
   📊 Token conversazione originale: 697
   📊 Token conversazione finale: 697
   📊 Token totali: 1382
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 2276 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao! ho bisogno di informazioni sulla crioconservazione degli ovociti [ASSISTENTE] La crioconservazione degli ovociti è una tecnica che consente di preservare la fertilità congelando gli ovociti in azoto liquido. [...] 

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4069 characters
🔢 Token Analysis:
   📊 Token prompt base: 685
   📊 Token conversazione: 697
   📊 Token totali stimati: 1382
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] ciao! ho bisogno di informazioni sulla crioconservazione degli ovociti [ASSISTENTE] La crioconservazione degli ovociti è una tecnica che consente di preservare la fertilità congelando gli ovociti in azoto liquido. [...] 

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Crioconservazione degli ovociti"', 'confidence': 1.0, 'motivation': "La conversazione riguarda la crioconservazione degli ovociti e fornisce informazioni su come funziona, dove si può trovare il servizio presso l'Humanitas Fertility Center, e come contattare il centro per ulteriori dettagli."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:53.155790
====================================================================================================
📋 Session ID: classify_1756769093
⏱️  Processing Time: 1.431s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (2276 chars):
   [UTENTE] ciao! ho bisogno di informazioni sulla crioconservazione degli ovociti [ASSISTENTE] La crioconservazione degli ovociti è una tecnica che consente di preservare la fertilità congelando gli ...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [105 more lines] ...
     Line 109: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (316 chars):
   {'predicted_label': '"Crioconservazione degli ovociti"', 'confidence': 1.0, 'motivation': "La conversazione riguarda la crioconservazione degli ovociti e fornisce informazioni su come funziona, dove si può trovare il servizio presso l'Humanitas Fertility Center, e come contattare il centro per ul...

📊 Parsed Response:
   predicted_label: "Crioconservazione degli ovociti"
   confidence: 1.0
   motivation: La conversazione riguarda la crioconservazione degli ovociti e fornisce informazioni su come funziona, dove si può trovare il servizio presso l'Humanitas Fertility Center, e come contattare il centro per ulteriori dettagli.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 1.000
   [████████████████████] 100.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la crioconservazione degli ovociti e fornisce informazioni su come funziona, dove si può trovare il servizio presso l'Humanitas Fertility Center, e come contattare il centro per ulteriori dettagli.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione a95a8638e9b52c4b8a678e6bf9a9d343 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ✅ Nuovo tag '"Crioconservazione degli ovociti"' aggiunto per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 697
   💬 Token conversazione: 419
   📊 Token totali: 1116
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1116 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 697
   📊 Token conversazione originale: 419
   📊 Token conversazione finale: 419
   📊 Token totali: 1116
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1470 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei avere informazioni su come accedere alla PMA [ASSISTENTE] Per accedere alla Procreazione Medicalmente Assistita (PMA) presso Humanitas, puoi seguire un percorso dedicato che include diverse tecniche, come l'inseminazione intrauterina (IUI) e la fecondazione in vitro (FIVET/ICSI). ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4110 characters
🔢 Token Analysis:
   📊 Token prompt base: 697
   📊 Token conversazione: 419
   📊 Token totali stimati: 1116
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Vorrei avere informazioni su come accedere alla PMA [ASSISTENTE] Per accedere alla Procreazione Medicalmente Assistita (PMA) presso Humanitas, puoi seguire un percorso dedicato che include diverse tecniche, come l'inseminazione intrauterina (IUI) e la fecondazione in vitro (FIVET/ICSI). ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Crioconservazione degli ovociti"', 'confidence': 0.98, 'motivation': "La conversazione riguarda l'accesso alla Procreazione Medicalmente Assistita (PMA) e la richiesta di informazioni su come accedere tramite il Servizio Sanitario Nazionale (SSN). In particolare, viene chiesto quale tipo di impegnativa devono portare per accedere al trattamento. La conversazione è molto chiara e specifica sul fatto che si tratta di una richiesta di informazioni su come accedere alla Crioconservazione degli ovociti, un trattamento di PMA."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:55.420482
====================================================================================================
📋 Session ID: classify_1756769095
⏱️  Processing Time: 2.169s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (1470 chars):
   [UTENTE] Vorrei avere informazioni su come accedere alla PMA [ASSISTENTE] Per accedere alla Procreazione Medicalmente Assistita (PMA) presso Humanitas, puoi seguire un percorso dedicato che include...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (550 chars):
   {'predicted_label': '"Crioconservazione degli ovociti"', 'confidence': 0.98, 'motivation': "La conversazione riguarda l'accesso alla Procreazione Medicalmente Assistita (PMA) e la richiesta di informazioni su come accedere tramite il Servizio Sanitario Nazionale (SSN). In particolare, viene chies...

📊 Parsed Response:
   predicted_label: "Crioconservazione degli ovociti"
   confidence: 0.98
   motivation: La conversazione riguarda l'accesso alla Procreazione Medicalmente Assistita (PMA) e la richiesta di informazioni su come accedere tramite il Servizio Sanitario Nazionale (SSN). In particolare, viene chiesto quale tipo di impegnativa devono portare per accedere al trattamento. La conversazione è molto chiara e specifica sul fatto che si tratta di una richiesta di informazioni su come accedere alla Crioconservazione degli ovociti, un trattamento di PMA.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.980
   [███████████████████░] 98.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda l'accesso alla Procreazione Medicalmente Assistita (PMA) e la richiesta di informazioni su come accedere tramite il Servizio Sanitario Nazionale (SSN). In particolare, viene chiesto quale tipo di impegnativa devono portare per accedere al trattamento. La conversazione è molto chiara e specifica sul fatto che si tratta di una richiesta di informazioni su come accedere a...
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione c505b12e4e761de86e1fc8f280450482 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Crioconservazione degli ovociti"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 696
   💬 Token conversazione: 927
   📊 Token totali: 1623
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1623 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 696
   📊 Token conversazione originale: 927
   📊 Token conversazione finale: 927
   📊 Token totali: 1623
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 3113 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] informazioni su p,a omologa [ASSISTENTE] Non ho trovato informazioni specifiche sulla "P. [...]  Se desideri ulteriori informazioni sui percorsi di PMA eterologa presso Humanitas, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4011 characters
🔢 Token Analysis:
   📊 Token prompt base: 696
   📊 Token conversazione: 927
   📊 Token totali stimati: 1623
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] informazioni su p,a omologa [ASSISTENTE] Non ho trovato informazioni specifiche sulla "P. [...]  Se desideri ulteriori informazioni sui percorsi di PMA eterologa presso Humanitas, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di informazioni su un percorso medico specifico (in questo caso PMA omologa) e l'assistente fornisce dettagli sulle tecnologie e i servizi disponibili presso il Fertility Center di Humanitas. Inoltre, l'assistente offre ulteriori informazioni su come accedere al percorso PMA in regime privato o tramite il Servizio Sanitario Nazionale (SSN)."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:57.551224
====================================================================================================
📋 Session ID: classify_1756769097
⏱️  Processing Time: 2.043s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (3113 chars):
   [UTENTE] informazioni su p,a omologa [ASSISTENTE] Non ho trovato informazioni specifiche sulla "P.A. omologa" nei documenti caricati. Potresti fornire ulteriori dettagli o chiarire la tua richiesta...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (456 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di informazioni su un percorso medico specifico (in questo caso PMA omologa) e l'assistente fornisce dettagli sulle tecnologie e i servizi disponibili presso il Fertility Center di Huma...

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la richiesta di informazioni su un percorso medico specifico (in questo caso PMA omologa) e l'assistente fornisce dettagli sulle tecnologie e i servizi disponibili presso il Fertility Center di Humanitas. Inoltre, l'assistente offre ulteriori informazioni su come accedere al percorso PMA in regime privato o tramite il Servizio Sanitario Nazionale (SSN).
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la richiesta di informazioni su un percorso medico specifico (in questo caso PMA omologa) e l'assistente fornisce dettagli sulle tecnologie e i servizi disponibili presso il Fertility Center di Humanitas. Inoltre, l'assistente offre ulteriori informazioni su come accedere al percorso PMA in regime privato o tramite il Servizio Sanitario Nazionale (SSN).
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 68bddbfcc3906e4a448cb5ef945aaf14 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 696
   💬 Token conversazione: 209
   📊 Token totali: 905
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 905 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 696
   📊 Token conversazione originale: 209
   📊 Token conversazione finale: 209
   📊 Token totali: 905
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 642 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Dove parcheggiare  [ASSISTENTE] In quale building o sede Humanitas devi andare? Così posso indicarti il parcheggio più vicino. [...] it/info/come-raggiungere-humanitas/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 3987 characters
🔢 Token Analysis:
   📊 Token prompt base: 696
   📊 Token conversazione: 209
   📊 Token totali stimati: 905
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Dove parcheggiare  [ASSISTENTE] In quale building o sede Humanitas devi andare? Così posso indicarti il parcheggio più vicino. [...] it/info/come-raggiungere-humanitas/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Visita Specialistica Oncologica"', 'confidence': 1.0, 'motivation': 'La conversazione riguarda una visita oncologica, quindi la classificazione è "Visita Specialistica Oncologica". Il livello di confidenza è alto perché il contenuto della conversazione è chiaramente correlato a questa categoria.'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:24:58.860055
====================================================================================================
📋 Session ID: classify_1756769098
⏱️  Processing Time: 1.215s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (642 chars):
   [UTENTE] Dove parcheggiare  [ASSISTENTE] In quale building o sede Humanitas devi andare? Così posso indicarti il parcheggio più vicino. [UTENTE] Devo fare visita oncologica  [ASSISTENTE] Per una vi...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (320 chars):
   {'predicted_label': '"Visita Specialistica Oncologica"', 'confidence': 1.0, 'motivation': 'La conversazione riguarda una visita oncologica, quindi la classificazione è "Visita Specialistica Oncologica". Il livello di confidenza è alto perché il contenuto della conversazione è chiaramente correlat...

📊 Parsed Response:
   predicted_label: "Visita Specialistica Oncologica"
   confidence: 1.0
   motivation: La conversazione riguarda una visita oncologica, quindi la classificazione è "Visita Specialistica Oncologica". Il livello di confidenza è alto perché il contenuto della conversazione è chiaramente correlato a questa categoria.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 1.000
   [████████████████████] 100.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda una visita oncologica, quindi la classificazione è "Visita Specialistica Oncologica". Il livello di confidenza è alto perché il contenuto della conversazione è chiaramente correlato a questa categoria.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 8197ec36efaa04942e24a1b77eb30b49 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Visita Specialistica Oncologica"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 700
   💬 Token conversazione: 191
   📊 Token totali: 891
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 891 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 700
   📊 Token conversazione originale: 191
   📊 Token conversazione finale: 191
   📊 Token totali: 891
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 614 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] il parcheggio per 2 ore e 35 minuti mi è stato fatto pagare 9,50 quando la tariffa massima risulta 8 euro [ASSISTENTE] Il costo massimo giornaliero per i parcheggi Humanitas (eccetto il Parcheggio 3) è di 8 euro. [...]  Se hai bisogno di ulteriori dettagli, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4113 characters
🔢 Token Analysis:
   📊 Token prompt base: 700
   📊 Token conversazione: 191
   📊 Token totali stimati: 891
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] il parcheggio per 2 ore e 35 minuti mi è stato fatto pagare 9,50 quando la tariffa massima risulta 8 euro [ASSISTENTE] Il costo massimo giornaliero per i parcheggi Humanitas (eccetto il Parcheggio 3) è di 8 euro. [...]  Se hai bisogno di ulteriori dettagli, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Servizi aziendali', 'confidence': 0.95, 'motivation': 'La conversazione riguarda un problema con il parcheggio dell\'ospedale Humanitas e non è una richiesta di servizio medico, pertanto la classificazione più appropriata è "Servizi aziendali".'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:00.036781
====================================================================================================
📋 Session ID: classify_1756769100
⏱️  Processing Time: 1.089s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (614 chars):
   [UTENTE] il parcheggio per 2 ore e 35 minuti mi è stato fatto pagare 9,50 quando la tariffa massima risulta 8 euro [ASSISTENTE] Il costo massimo giornaliero per i parcheggi Humanitas (eccetto il Pa...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (267 chars):
   {'predicted_label': 'Servizi aziendali', 'confidence': 0.95, 'motivation': 'La conversazione riguarda un problema con il parcheggio dell\'ospedale Humanitas e non è una richiesta di servizio medico, pertanto la classificazione più appropriata è "Servizi aziendali".'}

📊 Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.95
   motivation: La conversazione riguarda un problema con il parcheggio dell'ospedale Humanitas e non è una richiesta di servizio medico, pertanto la classificazione più appropriata è "Servizi aziendali".
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda un problema con il parcheggio dell'ospedale Humanitas e non è una richiesta di servizio medico, pertanto la classificazione più appropriata è "Servizi aziendali".
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 73baf4007e0bd6a7707f56c9ce583ab1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag 'Servizi aziendali' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 676
   💬 Token conversazione: 244
   📊 Token totali: 920
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 920 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 676
   📊 Token conversazione originale: 244
   📊 Token conversazione finale: 244
   📊 Token totali: 920
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 788 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] penso di avere perso il bancomat e la patente al Humanitas a Rozzano come posso fare [ASSISTENTE] Se hai perso il bancomat e la patente presso Humanitas a Rozzano, ti consiglio di recarti alla guardiania dell'ospedale...."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4037 characters
🔢 Token Analysis:
   📊 Token prompt base: 676
   📊 Token conversazione: 244
   📊 Token totali stimati: 920
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] penso di avere perso il bancomat e la patente al Humanitas a Rozzano come posso fare [ASSISTENTE] Se hai perso il bancomat e la patente presso Humanitas a Rozzano, ti consiglio di recarti alla guardiania dell'ospedale...."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la perdita di bancomat e patente presso l'ospedale Humanitas a Rozzano, ed è chiaro che il utente desideri recuperare queste cose. Tuttavia, la richiesta di un numero di telefono per la guardiania indica che il utente potrebbe anche voler prenotarsi per recuperare le sue cose."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:01.670159
====================================================================================================
📋 Session ID: classify_1756769101
⏱️  Processing Time: 1.543s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (788 chars):
   [UTENTE] Ciao [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] penso di avere perso il bancomat e la patente al Humanitas a Rozzano come posso fare [ASSISTENTE] Se hai perso il banc...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (378 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la perdita di bancomat e patente presso l'ospedale Humanitas a Rozzano, ed è chiaro che il utente desideri recuperare queste cose. Tuttavia, la richiesta di un numero di telefono per la guardiania i...

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la perdita di bancomat e patente presso l'ospedale Humanitas a Rozzano, ed è chiaro che il utente desideri recuperare queste cose. Tuttavia, la richiesta di un numero di telefono per la guardiania indica che il utente potrebbe anche voler prenotarsi per recuperare le sue cose.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la perdita di bancomat e patente presso l'ospedale Humanitas a Rozzano, ed è chiaro che il utente desideri recuperare queste cose. Tuttavia, la richiesta di un numero di telefono per la guardiania indica che il utente potrebbe anche voler prenotarsi per recuperare le sue cose.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione e83be993a0796c4ccb879766b1133fb4 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 696
   💬 Token conversazione: 252
   📊 Token totali: 948
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 948 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 696
   📊 Token conversazione originale: 252
   📊 Token conversazione finale: 252
   📊 Token totali: 948
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 826 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] P18 coperto [ASSISTENTE] Il parcheggio P18 è parzialmente coperto. [...]  Se hai bisogno di ulteriori informazioni sui parcheggi o su come raggiungere la struttura, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4005 characters
🔢 Token Analysis:
   📊 Token prompt base: 696
   📊 Token conversazione: 252
   📊 Token totali stimati: 948
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] P18 coperto [ASSISTENTE] Il parcheggio P18 è parzialmente coperto. [...]  Se hai bisogno di ulteriori informazioni sui parcheggi o su come raggiungere la struttura, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Servizi aziendali', 'confidence': 0.95, 'motivation': 'La conversazione riguarda il parcheggio P18 e le sue caratteristiche, in particolare che è parzialmente coperto. Questo indica che la conversazione non riguarda un servizio medico specifico, ma piuttosto un servizio aziendale come i parcheggi.'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:03.061802
====================================================================================================
📋 Session ID: classify_1756769103
⏱️  Processing Time: 1.304s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (826 chars):
   [UTENTE] P18 coperto [ASSISTENTE] Il parcheggio P18 è parzialmente coperto. Se hai bisogno di ulteriori informazioni sui parcheggi, puoi visitare la pagina [Indicazioni e Parcheggi](https://www.hum...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (321 chars):
   {'predicted_label': 'Servizi aziendali', 'confidence': 0.95, 'motivation': 'La conversazione riguarda il parcheggio P18 e le sue caratteristiche, in particolare che è parzialmente coperto. Questo indica che la conversazione non riguarda un servizio medico specifico, ma piuttosto un servizio azien...

📊 Parsed Response:
   predicted_label: Servizi aziendali
   confidence: 0.95
   motivation: La conversazione riguarda il parcheggio P18 e le sue caratteristiche, in particolare che è parzialmente coperto. Questo indica che la conversazione non riguarda un servizio medico specifico, ma piuttosto un servizio aziendale come i parcheggi.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda il parcheggio P18 e le sue caratteristiche, in particolare che è parzialmente coperto. Questo indica che la conversazione non riguarda un servizio medico specifico, ma piuttosto un servizio aziendale come i parcheggi.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione bc04daee42adb1ef9c2bfb51c4f51319 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag 'Servizi aziendali' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 676
   💬 Token conversazione: 165
   📊 Token totali: 841
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 841 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 676
   📊 Token conversazione originale: 165
   📊 Token conversazione finale: 165
   📊 Token totali: 841
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 595 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco a registrarmi tramite codice fiscale [ASSISTENTE] Se hai difficoltà a registrarti utilizzando il codice fiscale, ti consiglio di verificare che i dati inseriti siano corretti. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4001 characters
🔢 Token Analysis:
   📊 Token prompt base: 676
   📊 Token conversazione: 165
   📊 Token totali stimati: 841
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Non riesco a registrarmi tramite codice fiscale [ASSISTENTE] Se hai difficoltà a registrarti utilizzando il codice fiscale, ti consiglio di verificare che i dati inseriti siano corretti. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la registrazione all\'ospedale Humanitas tramite codice fiscale, quindi è stata classificata come "Humanitas con te - Registrazione". Il livello di confidenza è alto perché il contenuto della conversazione è chiaramente correlato a questa categoria.'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:04.512989
====================================================================================================
📋 Session ID: classify_1756769104
⏱️  Processing Time: 1.365s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (595 chars):
   [UTENTE] Non riesco a registrarmi tramite codice fiscale [ASSISTENTE] Se hai difficoltà a registrarti utilizzando il codice fiscale, ti consiglio di verificare che i dati inseriti siano corretti. S...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [104 more lines] ...
     Line 108: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (370 chars):
   {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la registrazione all\'ospedale Humanitas tramite codice fiscale, quindi è stata classificata come "Humanitas con te - Registrazione". Il livello di confidenza è alto perché il co...

📊 Parsed Response:
   predicted_label: "Humanitas con te - Registrazione"
   confidence: 0.95
   motivation: La conversazione riguarda la registrazione all'ospedale Humanitas tramite codice fiscale, quindi è stata classificata come "Humanitas con te - Registrazione". Il livello di confidenza è alto perché il contenuto della conversazione è chiaramente correlato a questa categoria.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la registrazione all'ospedale Humanitas tramite codice fiscale, quindi è stata classificata come "Humanitas con te - Registrazione". Il livello di confidenza è alto perché il contenuto della conversazione è chiaramente correlato a questa categoria.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione c919db36bc19031a3b13c936ccc54f36 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Humanitas con te - Registrazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 696
   💬 Token conversazione: 98
   📊 Token totali: 794
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 794 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 696
   📊 Token conversazione originale: 98
   📊 Token conversazione finale: 98
   📊 Token totali: 794
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 336 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] La mail non è ancora arrivata può essere normale? [ASSISTENTE] Potrebbe essere normale che una mail impieghi un po' di tempo per arrivare, a seconda del sistema di posta elettronica utilizzato. [...]  Se hai bisogno di ulteriore assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4072 characters
🔢 Token Analysis:
   📊 Token prompt base: 696
   📊 Token conversazione: 98
   📊 Token totali stimati: 794
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] La mail non è ancora arrivata può essere normale? [ASSISTENTE] Potrebbe essere normale che una mail impieghi un po' di tempo per arrivare, a seconda del sistema di posta elettronica utilizzato. [...]  Se hai bisogno di ulteriore assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un servizio o una procedura medica, e il problema è che non si è ancora ricevuta la mail di conferma.'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:05.490627
====================================================================================================
📋 Session ID: classify_1756769105
⏱️  Processing Time: 0.891s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (336 chars):
   [UTENTE] La mail non è ancora arrivata può essere normale? [ASSISTENTE] Potrebbe essere normale che una mail impieghi un po' di tempo per arrivare, a seconda del sistema di posta elettronica utiliz...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (221 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la prenotazione di un servizio o una procedura medica, e il problema è che non si è ancora ricevuta la mail di conferma.'}

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di un servizio o una procedura medica, e il problema è che non si è ancora ricevuta la mail di conferma.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un servizio o una procedura medica, e il problema è che non si è ancora ricevuta la mail di conferma.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 7692031981c479f34d2c1a8cc9c5a900 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 697
   💬 Token conversazione: 316
   📊 Token totali: 1013
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1013 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 697
   📊 Token conversazione originale: 316
   📊 Token conversazione finale: 316
   📊 Token totali: 1013
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1118 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buona sera Giulia  [ASSISTENTE] Buona sera! Come posso esserti utile? 😊 [UTENTE] Allora, devo entrare nella sezione referti, però non posso più entrare, perché non ho più il vecchio numero e non posso neppure cambiare il numero ti telefono dal vecchio a quello nuovo, perché giustamente m..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4110 characters
🔢 Token Analysis:
   📊 Token prompt base: 697
   📊 Token conversazione: 316
   📊 Token totali stimati: 1013
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buona sera Giulia  [ASSISTENTE] Buona sera! Come posso esserti utile? 😊 [UTENTE] Allora, devo entrare nella sezione referti, però non posso più entrare, perché non ho più il vecchio numero e non posso neppure cambiare il numero ti telefono dal vecchio a quello nuovo, perché giustamente m..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda il problema del cambio del numero di telefono associato all'account dell'utente e la richiesta di assistenza per risolvere questo problema. Il modo migliore per risolvere il problema è contattare il Servizio di assistenza dedicata di Humanitas con te, che può essere raggiunto attraverso due modi: compilando il modulo di contatto disponibile alla pagina Help o inviando una richiesta via email all'indirizzo humanitasconte@humanitas.it."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:07.565429
====================================================================================================
📋 Session ID: classify_1756769107
⏱️  Processing Time: 1.985s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (1118 chars):
   [UTENTE] Buona sera Giulia  [ASSISTENTE] Buona sera! Come posso esserti utile? 😊 [UTENTE] Allora, devo entrare nella sezione referti, però non posso più entrare, perché non ho più il vecchio numero...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (558 chars):
   {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda il problema del cambio del numero di telefono associato all'account dell'utente e la richiesta di assistenza per risolvere questo problema. Il modo migliore per risolvere il prob...

📊 Parsed Response:
   predicted_label: "Humanitas con te - Registrazione"
   confidence: 0.95
   motivation: La conversazione riguarda il problema del cambio del numero di telefono associato all'account dell'utente e la richiesta di assistenza per risolvere questo problema. Il modo migliore per risolvere il problema è contattare il Servizio di assistenza dedicata di Humanitas con te, che può essere raggiunto attraverso due modi: compilando il modulo di contatto disponibile alla pagina Help o inviando una richiesta via email all'indirizzo humanitasconte@humanitas.it.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda il problema del cambio del numero di telefono associato all'account dell'utente e la richiesta di assistenza per risolvere questo problema. Il modo migliore per risolvere il problema è contattare il Servizio di assistenza dedicata di Humanitas con te, che può essere raggiunto attraverso due modi: compilando il modulo di contatto disponibile alla pagina Help o inviando ...
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione ad8fa498655deda1b1c2b3521b35295e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Humanitas con te - Registrazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 696
   💬 Token conversazione: 278
   📊 Token totali: 974
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 974 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 696
   📊 Token conversazione originale: 278
   📊 Token conversazione finale: 278
   📊 Token totali: 974
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 919 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] VENGONO INVIATE EMAIL PER CONFERMA INTERVENTO [ASSISTENTE] Puoi fornirmi maggiori dettagli? Intendi sapere se Humanitas invia email per confermare un intervento chirurgico? [UTENTE] si [ASSISTENTE] Sì, Humanitas invia email per confermare gli interventi chirurgici. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4106 characters
🔢 Token Analysis:
   📊 Token prompt base: 696
   📊 Token conversazione: 278
   📊 Token totali stimati: 974
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] VENGONO INVIATE EMAIL PER CONFERMA INTERVENTO [ASSISTENTE] Puoi fornirmi maggiori dettagli? Intendi sapere se Humanitas invia email per confermare un intervento chirurgico? [UTENTE] si [ASSISTENTE] Sì, Humanitas invia email per confermare gli interventi chirurgici. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Visita Specialistica Chirurgica"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda l\'invio di email per conferma di un intervento chirurgico all\'ospedale Humanitas, quindi è stata classificata come "Visita Specialistica Chirurgica". Il livello di confidenza è alto a causa della chiarezza del contenuto.'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:09.011292
====================================================================================================
📋 Session ID: classify_1756769109
⏱️  Processing Time: 1.358s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (919 chars):
   [UTENTE] VENGONO INVIATE EMAIL PER CONFERMA INTERVENTO [ASSISTENTE] Puoi fornirmi maggiori dettagli? Intendi sapere se Humanitas invia email per confermare un intervento chirurgico? [UTENTE] si [AS...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (342 chars):
   {'predicted_label': '"Visita Specialistica Chirurgica"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda l\'invio di email per conferma di un intervento chirurgico all\'ospedale Humanitas, quindi è stata classificata come "Visita Specialistica Chirurgica". Il livello di confidenza è ...

📊 Parsed Response:
   predicted_label: "Visita Specialistica Chirurgica"
   confidence: 0.95
   motivation: La conversazione riguarda l'invio di email per conferma di un intervento chirurgico all'ospedale Humanitas, quindi è stata classificata come "Visita Specialistica Chirurgica". Il livello di confidenza è alto a causa della chiarezza del contenuto.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda l'invio di email per conferma di un intervento chirurgico all'ospedale Humanitas, quindi è stata classificata come "Visita Specialistica Chirurgica". Il livello di confidenza è alto a causa della chiarezza del contenuto.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 41155d8563772fe421942a563889a1db classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ✅ Nuovo tag '"Visita Specialistica Chirurgica"' aggiunto per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta urgente - valuta priorità massima

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 705
   💬 Token conversazione: 264
   📊 Token totali: 969
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 969 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 705
   📊 Token conversazione originale: 264
   📊 Token conversazione finale: 264
   📊 Token totali: 969
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 895 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, per errore ho cancellato una mail newletter ricevuta il 01/08/2025 che, fra gli altri link,  conteneva il link CARENZA DI VITAMINE: quali sono i sintomi ? Cortesemente posso riceverla di nuovo ? Grazie [ASSISTENTE] Non ho accesso diretto alle email o alle newsletter inviate d..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4136 characters
🔢 Token Analysis:
   📊 Token prompt base: 705
   📊 Token conversazione: 264
   📊 Token totali stimati: 969
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta urgente - valuta priorità massima

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno, per errore ho cancellato una mail newletter ricevuta il 01/08/2025 che, fra gli altri link,  conteneva il link CARENZA DI VITAMINE: quali sono i sintomi ? Cortesemente posso riceverla di nuovo ? Grazie [ASSISTENTE] Non ho accesso diretto alle email o alle newsletter inviate d..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di una newsletter inviata da Humanitas, che l'utente ha cancellato per errore e desidera riceverla di nuovo. Ho suggerito all'utente di contattare il servizio di assistenza dedicato compilando il modulo di contatto disponibile alla pagina Help o inviando una richiesta via email all’indirizzo humanitasconte@humanitas.it, indicando il motivo della tua richiesta."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:11.114986
====================================================================================================
📋 Session ID: classify_1756769111
⏱️  Processing Time: 2.008s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (895 chars):
   [UTENTE] Buongiorno, per errore ho cancellato una mail newletter ricevuta il 01/08/2025 che, fra gli altri link,  conteneva il link CARENZA DI VITAMINE: quali sono i sintomi ? Cortesemente posso ri...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (496 chars):
   {'predicted_label': '"Humanitas con te - Registrazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di una newsletter inviata da Humanitas, che l'utente ha cancellato per errore e desidera riceverla di nuovo. Ho suggerito all'utente di contattare il servizio di ass...

📊 Parsed Response:
   predicted_label: "Humanitas con te - Registrazione"
   confidence: 0.95
   motivation: La conversazione riguarda la richiesta di una newsletter inviata da Humanitas, che l'utente ha cancellato per errore e desidera riceverla di nuovo. Ho suggerito all'utente di contattare il servizio di assistenza dedicato compilando il modulo di contatto disponibile alla pagina Help o inviando una richiesta via email all’indirizzo humanitasconte@humanitas.it, indicando il motivo della tua richiesta.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la richiesta di una newsletter inviata da Humanitas, che l'utente ha cancellato per errore e desidera riceverla di nuovo. Ho suggerito all'utente di contattare il servizio di assistenza dedicato compilando il modulo di contatto disponibile alla pagina Help o inviando una richiesta via email all’indirizzo humanitasconte@humanitas.it, indicando il motivo della tua richie...
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 73f637a5a1515a8d26bf383aa2c23c45 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Humanitas con te - Registrazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 707
   💬 Token conversazione: 608
   📊 Token totali: 1315
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1315 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 707
   📊 Token conversazione originale: 608
   📊 Token conversazione finale: 608
   📊 Token totali: 1315
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 2063 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ho mal di pancia e sto cercando cosa fare [ASSISTENTE] Come assistente digitale di Humanitas, il mio scopo è fornire informazioni di carattere generale e notizie inerenti l’ospedale. Per il tuo mal di pancia, ti consiglio di rivolgerti al tuo medico di fiducia o al tuo medico di Medicina..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4145 characters
🔢 Token Analysis:
   📊 Token prompt base: 707
   📊 Token conversazione: 608
   📊 Token totali stimati: 1315
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ho mal di pancia e sto cercando cosa fare [ASSISTENTE] Come assistente digitale di Humanitas, il mio scopo è fornire informazioni di carattere generale e notizie inerenti l’ospedale. Per il tuo mal di pancia, ti consiglio di rivolgerti al tuo medico di fiducia o al tuo medico di Medicina..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': 'Visita Specialistica', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la ricerca di un medico gastroenterologo a Humanitas, quindi è più probabile che si tratti di una visita specialistica.'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:12.301780
====================================================================================================
📋 Session ID: classify_1756769112
⏱️  Processing Time: 1.098s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (2063 chars):
   [UTENTE] Ho mal di pancia e sto cercando cosa fare [ASSISTENTE] Come assistente digitale di Humanitas, il mio scopo è fornire informazioni di carattere generale e notizie inerenti l’ospedale. Per i...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (226 chars):
   {'predicted_label': 'Visita Specialistica', 'confidence': 0.95, 'motivation': 'La conversazione riguarda la ricerca di un medico gastroenterologo a Humanitas, quindi è più probabile che si tratti di una visita specialistica.'}

📊 Parsed Response:
   predicted_label: Visita Specialistica
   confidence: 0.95
   motivation: La conversazione riguarda la ricerca di un medico gastroenterologo a Humanitas, quindi è più probabile che si tratti di una visita specialistica.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la ricerca di un medico gastroenterologo a Humanitas, quindi è più probabile che si tratti di una visita specialistica.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 0ed0e5bb7d514f567208786674e4a1a6 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag 'Visita Specialistica' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 686
   💬 Token conversazione: 475
   📊 Token totali: 1161
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1161 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 686
   📊 Token conversazione originale: 475
   📊 Token conversazione finale: 475
   📊 Token totali: 1161
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 2111 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] hello [ASSISTENTE] Hello! How can I assist you today? [UTENTE] Do you provide alcoholism treatment? [ASSISTENTE] To determine if Humanitas provides treatment for alcoholism, I will need to check the available information. Please give me a moment.Humanitas provides treatment for condition..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4072 characters
🔢 Token Analysis:
   📊 Token prompt base: 686
   📊 Token conversazione: 475
   📊 Token totali stimati: 1161
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] hello [ASSISTENTE] Hello! How can I assist you today? [UTENTE] Do you provide alcoholism treatment? [ASSISTENTE] To determine if Humanitas provides treatment for alcoholism, I will need to check the available information. Please give me a moment.Humanitas provides treatment for condition..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"alloggio"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di informazioni sull'alloggio in un hotel o facility vicino all'ospedale Humanitas, nonché l'assistenza per il prenotamento. Non è stato menzionato alcun tipo di trattamento medico."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:13.669786
====================================================================================================
📋 Session ID: classify_1756769113
⏱️  Processing Time: 1.280s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (2111 chars):
   [UTENTE] hello [ASSISTENTE] Hello! How can I assist you today? [UTENTE] Do you provide alcoholism treatment? [ASSISTENTE] To determine if Humanitas provides treatment for alcoholism, I will need to...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (291 chars):
   {'predicted_label': '"alloggio"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la richiesta di informazioni sull'alloggio in un hotel o facility vicino all'ospedale Humanitas, nonché l'assistenza per il prenotamento. Non è stato menzionato alcun tipo di trattamento medico."}

📊 Parsed Response:
   predicted_label: "alloggio"
   confidence: 0.95
   motivation: La conversazione riguarda la richiesta di informazioni sull'alloggio in un hotel o facility vicino all'ospedale Humanitas, nonché l'assistenza per il prenotamento. Non è stato menzionato alcun tipo di trattamento medico.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la richiesta di informazioni sull'alloggio in un hotel o facility vicino all'ospedale Humanitas, nonché l'assistenza per il prenotamento. Non è stato menzionato alcun tipo di trattamento medico.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione d806654dd34f0612884c0ad7455bc517 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"alloggio"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta urgente - valuta priorità massima

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 705
   💬 Token conversazione: 115
   📊 Token totali: 820
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 820 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 705
   📊 Token conversazione originale: 115
   📊 Token conversazione finale: 115
   📊 Token totali: 820
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 385 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia, cosa vuol dire ICE? [ASSISTENTE] "ICE" è l'acronimo di "In Case of Emergency" (in caso di emergenza). [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4033 characters
🔢 Token Analysis:
   📊 Token prompt base: 705
   📊 Token conversazione: 115
   📊 Token totali stimati: 820
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta urgente - valuta priorità massima

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Ciao Giulia, cosa vuol dire ICE? [ASSISTENTE] "ICE" è l'acronimo di "In Case of Emergency" (in caso di emergenza). [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda un servizio aziendale (ICE) che è utilizzato in caso di emergenza.'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:14.575553
====================================================================================================
📋 Session ID: classify_1756769114
⏱️  Processing Time: 0.803s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (385 chars):
   [UTENTE] Ciao Giulia, cosa vuol dire ICE? [ASSISTENTE] "ICE" è l'acronimo di "In Case of Emergency" (in caso di emergenza). Viene spesso utilizzato per indicare un contatto da chiamare in caso di e...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [105 more lines] ...
     Line 109: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (172 chars):
   {'predicted_label': '"Servizi aziendali"', 'confidence': 0.95, 'motivation': 'La conversazione riguarda un servizio aziendale (ICE) che è utilizzato in caso di emergenza.'}

📊 Parsed Response:
   predicted_label: "Servizi aziendali"
   confidence: 0.95
   motivation: La conversazione riguarda un servizio aziendale (ICE) che è utilizzato in caso di emergenza.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda un servizio aziendale (ICE) che è utilizzato in caso di emergenza.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione efceb4f0753d074042b4f7158273a8e2 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Servizi aziendali"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 706
   💬 Token conversazione: 980
   📊 Token totali: 1686
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1686 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 706
   📊 Token conversazione originale: 980
   📊 Token conversazione finale: 980
   📊 Token totali: 1686
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 3337 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Che bello iniziare un percorso equilibrato di benessere e stile di vita [ASSISTENTE] Sono felice che tu voglia intraprendere un percorso di benessere e stile di vita equilibrato! Se hai bisogno di informazioni su servizi, visite o percorsi specifici offerti da Humanitas, sono qui per aiu..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4144 characters
🔢 Token Analysis:
   📊 Token prompt base: 706
   📊 Token conversazione: 980
   📊 Token totali stimati: 1686
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Che bello iniziare un percorso equilibrato di benessere e stile di vita [ASSISTENTE] Sono felice che tu voglia intraprendere un percorso di benessere e stile di vita equilibrato! Se hai bisogno di informazioni su servizi, visite o percorsi specifici offerti da Humanitas, sono qui per aiu..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': 'benessere', 'confidence': 0.95, 'motivation': "La conversazione riguarda il desiderio dell'utente di intraprendere un percorso di benessere e stile di vita equilibrato, e l'assistente fornisce informazioni su come ottenere consigli personalizzati."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:16.112979
====================================================================================================
📋 Session ID: classify_1756769116
⏱️  Processing Time: 1.450s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (3337 chars):
   [UTENTE] Che bello iniziare un percorso equilibrato di benessere e stile di vita [ASSISTENTE] Sono felice che tu voglia intraprendere un percorso di benessere e stile di vita equilibrato! Se hai bi...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (270 chars):
   {'predicted_label': 'benessere', 'confidence': 0.95, 'motivation': "La conversazione riguarda il desiderio dell'utente di intraprendere un percorso di benessere e stile di vita equilibrato, e l'assistente fornisce informazioni su come ottenere consigli personalizzati."}

📊 Parsed Response:
   predicted_label: benessere
   confidence: 0.95
   motivation: La conversazione riguarda il desiderio dell'utente di intraprendere un percorso di benessere e stile di vita equilibrato, e l'assistente fornisce informazioni su come ottenere consigli personalizzati.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda il desiderio dell'utente di intraprendere un percorso di benessere e stile di vita equilibrato, e l'assistente fornisce informazioni su come ottenere consigli personalizzati.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione b0309b27adbaa947377df5ec566e82c1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag 'benessere' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 706
   💬 Token conversazione: 124
   📊 Token totali: 830
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 830 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 706
   📊 Token conversazione originale: 124
   📊 Token conversazione finale: 124
   📊 Token totali: 830
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 388 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno vorrei sapere se fate l'esame ANTICORPI ANTI PIASTRINE TEST DIRETTO [ASSISTENTE] Non ho trovato informazioni specifiche sull'esame "ANTICORPI ANTI PIASTRINE TEST DIRETTO" nei documenti forniti. [...]  Se hai bisogno di ulteriori dettagli o assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4129 characters
🔢 Token Analysis:
   📊 Token prompt base: 706
   📊 Token conversazione: 124
   📊 Token totali stimati: 830
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno vorrei sapere se fate l'esame ANTICORPI ANTI PIASTRINE TEST DIRETTO [ASSISTENTE] Non ho trovato informazioni specifiche sull'esame "ANTICORPI ANTI PIASTRINE TEST DIRETTO" nei documenti forniti. [...]  Se hai bisogno di ulteriori dettagli o assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"altro"', 'confidence': 0.85, 'motivation': 'La conversazione non riguarda una categoria specifica dell\'ospedale Humanitas. L\'utente ha chiesto informazioni sull\'esame "ANTICORPI ANTI PIASTRINE TEST DIRETTO", che non è un esame disponibile nell\'ospedale.'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:17.324779
====================================================================================================
📋 Session ID: classify_1756769117
⏱️  Processing Time: 1.123s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (388 chars):
   [UTENTE] Buongiorno vorrei sapere se fate l'esame ANTICORPI ANTI PIASTRINE TEST DIRETTO [ASSISTENTE] Non ho trovato informazioni specifiche sull'esame "ANTICORPI ANTI PIASTRINE TEST DIRETTO" nei do...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (281 chars):
   {'predicted_label': '"altro"', 'confidence': 0.85, 'motivation': 'La conversazione non riguarda una categoria specifica dell\'ospedale Humanitas. L\'utente ha chiesto informazioni sull\'esame "ANTICORPI ANTI PIASTRINE TEST DIRETTO", che non è un esame disponibile nell\'ospedale.'}

📊 Parsed Response:
   predicted_label: "altro"
   confidence: 0.85
   motivation: La conversazione non riguarda una categoria specifica dell'ospedale Humanitas. L'utente ha chiesto informazioni sull'esame "ANTICORPI ANTI PIASTRINE TEST DIRETTO", che non è un esame disponibile nell'ospedale.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.850
   [█████████████████░░░] 85.0%

🧠 Reasoning/Motivation:
   La conversazione non riguarda una categoria specifica dell'ospedale Humanitas. L'utente ha chiesto informazioni sull'esame "ANTICORPI ANTI PIASTRINE TEST DIRETTO", che non è un esame disponibile nell'ospedale.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 82d967dfd210012a20a7fb99fd3223b1 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"altro"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 686
   💬 Token conversazione: 332
   📊 Token totali: 1018
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1018 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 686
   📊 Token conversazione originale: 332
   📊 Token conversazione finale: 332
   📊 Token totali: 1018
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1136 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno eseguite esame del sangue per allergia nickel? [ASSISTENTE] Non ho trovato informazioni specifiche sull'esecuzione di un esame del sangue per l'allergia al nichel presso Humanitas. [...] it/malattie/allergia-al-nichel)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4010 characters
🔢 Token Analysis:
   📊 Token prompt base: 686
   📊 Token conversazione: 332
   📊 Token totali stimati: 1018
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Buongiorno eseguite esame del sangue per allergia nickel? [ASSISTENTE] Non ho trovato informazioni specifiche sull'esecuzione di un esame del sangue per l'allergia al nichel presso Humanitas. [...] it/malattie/allergia-al-nichel)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Allergia al nichel"', 'confidence': 0.95, 'motivation': "La conversazione riguarda l'esecuzione di un esame per allergia al nichel presso Humanitas, ma non è stato trovato alcun esame del sangue specifico per questa allergia. Invece, si consiglia di consultare uno specialista in allergologia per valutare il percorso diagnostico più adatto."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:18.839469
====================================================================================================
📋 Session ID: classify_1756769118
⏱️  Processing Time: 1.427s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (1136 chars):
   [UTENTE] Buongiorno eseguite esame del sangue per allergia nickel? [ASSISTENTE] Non ho trovato informazioni specifiche sull'esecuzione di un esame del sangue per l'allergia al nichel presso Humanit...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (365 chars):
   {'predicted_label': '"Allergia al nichel"', 'confidence': 0.95, 'motivation': "La conversazione riguarda l'esecuzione di un esame per allergia al nichel presso Humanitas, ma non è stato trovato alcun esame del sangue specifico per questa allergia. Invece, si consiglia di consultare uno specialist...

📊 Parsed Response:
   predicted_label: "Allergia al nichel"
   confidence: 0.95
   motivation: La conversazione riguarda l'esecuzione di un esame per allergia al nichel presso Humanitas, ma non è stato trovato alcun esame del sangue specifico per questa allergia. Invece, si consiglia di consultare uno specialista in allergologia per valutare il percorso diagnostico più adatto.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda l'esecuzione di un esame per allergia al nichel presso Humanitas, ma non è stato trovato alcun esame del sangue specifico per questa allergia. Invece, si consiglia di consultare uno specialista in allergologia per valutare il percorso diagnostico più adatto.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 145752599710f8fe999022f93fc0d8d5 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ✅ Nuovo tag '"Allergia al nichel"' aggiunto per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"Allergia al nichel", "alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 713
   💬 Token conversazione: 197
   📊 Token totali: 910
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 910 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 713
   📊 Token conversazione originale: 197
   📊 Token conversazione finale: 197
   📊 Token totali: 910
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 608 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] cistiscopia [ASSISTENTE] Puoi chiarire meglio la tua richiesta? Intendi sapere:

1. [...]  

Se hai bisogno di ulteriori informazioni o assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4045 characters
🔢 Token Analysis:
   📊 Token prompt base: 713
   📊 Token conversazione: 197
   📊 Token totali stimati: 910
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"Allergia al nichel", "alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] cistiscopia [ASSISTENTE] Puoi chiarire meglio la tua richiesta? Intendi sapere:

1. [...]  

Se hai bisogno di ulteriori informazioni o assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Visita Specialistica"', 'confidence': 0.95, 'motivation': "La richiesta dell'utente riguarda la cistoscopia e il medico che la esegue. Poiché non è specificato se l'utente vuole sapere se eseguono la cistoscopia presso Humanitas o come prepararsi per una cistoscopia, ho fornito informazioni su come trovare i medici che eseguono la procedura e suggerito di consultare la pagina Ricerca Medici."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:20.743614
====================================================================================================
📋 Session ID: classify_1756769120
⏱️  Processing Time: 1.809s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (608 chars):
   [UTENTE] cistiscopia [ASSISTENTE] Puoi chiarire meglio la tua richiesta? Intendi sapere:

1. Se eseguiamo la cistoscopia presso Humanitas?
2. Come prepararti per una cistoscopia?
3. Altro?

Fammi s...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [107 more lines] ...
     Line 111: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (418 chars):
   {'predicted_label': '"Visita Specialistica"', 'confidence': 0.95, 'motivation': "La richiesta dell'utente riguarda la cistoscopia e il medico che la esegue. Poiché non è specificato se l'utente vuole sapere se eseguono la cistoscopia presso Humanitas o come prepararsi per una cistoscopia, ho forn...

📊 Parsed Response:
   predicted_label: "Visita Specialistica"
   confidence: 0.95
   motivation: La richiesta dell'utente riguarda la cistoscopia e il medico che la esegue. Poiché non è specificato se l'utente vuole sapere se eseguono la cistoscopia presso Humanitas o come prepararsi per una cistoscopia, ho fornito informazioni su come trovare i medici che eseguono la procedura e suggerito di consultare la pagina Ricerca Medici.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La richiesta dell'utente riguarda la cistoscopia e il medico che la esegue. Poiché non è specificato se l'utente vuole sapere se eseguono la cistoscopia presso Humanitas o come prepararsi per una cistoscopia, ho fornito informazioni su come trovare i medici che eseguono la procedura e suggerito di consultare la pagina Ricerca Medici.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione e7e524ffc2bce8c7e49c75017cf7ad4e classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Visita Specialistica"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"Allergia al nichel", "alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 693
   💬 Token conversazione: 138
   📊 Token totali: 831
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 831 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 693
   📊 Token conversazione originale: 138
   📊 Token conversazione finale: 138
   📊 Token totali: 831
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 430 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] humanitas effettua l'holter cardiaco di 20 giorni? [ASSISTENTE] Non ho trovato informazioni specifiche sull'Holter cardiaco di 20 giorni presso Humanitas. [...] it/pazienti/diagnosi/esami-del-cuore-e-vascolari/7952-elettrocardiogramma)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4038 characters
🔢 Token Analysis:
   📊 Token prompt base: 693
   📊 Token conversazione: 138
   📊 Token totali stimati: 831
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"Allergia al nichel", "alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare



OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] humanitas effettua l'holter cardiaco di 20 giorni? [ASSISTENTE] Non ho trovato informazioni specifiche sull'Holter cardiaco di 20 giorni presso Humanitas. [...] it/pazienti/diagnosi/esami-del-cuore-e-vascolari/7952-elettrocardiogramma)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Visita Specialistica Cardiologica"', 'confidence': 0.85, 'motivation': 'La conversazione riguarda l\'esame dell\'Holter cardiaco, che è un esame cardiologico. Poiché non sono state trovate informazioni specifiche sull\'Holter cardiaco di 20 giorni presso Humanitas, la classificazione più appropriata è "Visita Specialistica Cardiologica".'}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:22.222688
====================================================================================================
📋 Session ID: classify_1756769122
⏱️  Processing Time: 1.392s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (430 chars):
   [UTENTE] humanitas effettua l'holter cardiaco di 20 giorni? [ASSISTENTE] Non ho trovato informazioni specifiche sull'Holter cardiaco di 20 giorni presso Humanitas. Ti consiglio di contattare dirett...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [102 more lines] ...
     Line 106: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (363 chars):
   {'predicted_label': '"Visita Specialistica Cardiologica"', 'confidence': 0.85, 'motivation': 'La conversazione riguarda l\'esame dell\'Holter cardiaco, che è un esame cardiologico. Poiché non sono state trovate informazioni specifiche sull\'Holter cardiaco di 20 giorni presso Humanitas, la classi...

📊 Parsed Response:
   predicted_label: "Visita Specialistica Cardiologica"
   confidence: 0.85
   motivation: La conversazione riguarda l'esame dell'Holter cardiaco, che è un esame cardiologico. Poiché non sono state trovate informazioni specifiche sull'Holter cardiaco di 20 giorni presso Humanitas, la classificazione più appropriata è "Visita Specialistica Cardiologica".
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.850
   [█████████████████░░░] 85.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda l'esame dell'Holter cardiaco, che è un esame cardiologico. Poiché non sono state trovate informazioni specifiche sull'Holter cardiaco di 20 giorni presso Humanitas, la classificazione più appropriata è "Visita Specialistica Cardiologica".
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 44b211e74774f7ae10740a86336df131 classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Visita Specialistica Cardiologica"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"Allergia al nichel", "alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 713
   💬 Token conversazione: 137
   📊 Token totali: 850
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 850 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 713
   📊 Token conversazione originale: 137
   📊 Token conversazione finale: 137
   📊 Token totali: 850
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 466 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Oggi si possono fare esami del sangue all' Humanitas di Rozzano? [ASSISTENTE] Per sapere se oggi è possibile effettuare esami del sangue presso l'Humanitas di Rozzano, ti consiglio di contattare direttamente il punto prelievi. Puoi trovare tutte le informazioni sui punti prelievi e gli o..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4166 characters
🔢 Token Analysis:
   📊 Token prompt base: 713
   📊 Token conversazione: 137
   📊 Token totali stimati: 850
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"Allergia al nichel", "alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] Oggi si possono fare esami del sangue all' Humanitas di Rozzano? [ASSISTENTE] Per sapere se oggi è possibile effettuare esami del sangue presso l'Humanitas di Rozzano, ti consiglio di contattare direttamente il punto prelievi. Puoi trovare tutte le informazioni sui punti prelievi e gli o..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔍 STRUCTURED RESPONSE DEBUG: {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di un esame del sangue presso l'Humanitas di Rozzano. Il richiedente chiede se è possibile effettuare l'esame oggi e l'assistente gli consiglia di contattare il punto prelievi per ottenere informazioni precise sui tempi disponibili."}

====================================================================================================
🤖 LLM DEBUG - CLASSIFICATION | 2025-09-01T23:25:23.709133
====================================================================================================
📋 Session ID: classify_1756769123
⏱️  Processing Time: 1.398s
----------------------------------------------------------------------------------------------------
📥 INPUT SECTION
--------------------------------------------------
💬 Original Text (466 chars):
   [UTENTE] Oggi si possono fare esami del sangue all' Humanitas di Rozzano? [ASSISTENTE] Per sapere se oggi è possibile effettuare esami del sangue presso l'Humanitas di Rozzano, ti consiglio di cont...

🎯 Prompt Template:
   
     Line 1: <|system|>
     Line 2: Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario
     Line 3: 
     ... [103 more lines] ...
     Line 107: <|assistant|>

⚙️  Model Parameters:
   model: mistral:7b
   temperature: 0.01
   max_tokens: 550
   timeout: 300
----------------------------------------------------------------------------------------------------
📤 OUTPUT SECTION
--------------------------------------------------
🔍 Raw Response (349 chars):
   {'predicted_label': '"Prenotazione"', 'confidence': 0.95, 'motivation': "La conversazione riguarda la prenotazione di un esame del sangue presso l'Humanitas di Rozzano. Il richiedente chiede se è possibile effettuare l'esame oggi e l'assistente gli consiglia di contattare il punto prelievi per ot...

📊 Parsed Response:
   predicted_label: "Prenotazione"
   confidence: 0.95
   motivation: La conversazione riguarda la prenotazione di un esame del sangue presso l'Humanitas di Rozzano. Il richiedente chiede se è possibile effettuare l'esame oggi e l'assistente gli consiglia di contattare il punto prelievi per ottenere informazioni precise sui tempi disponibili.
----------------------------------------------------------------------------------------------------
📈 ANALYSIS SECTION
--------------------------------------------------
🎯 Confidence Score: 0.950
   [███████████████████░] 95.0%

🧠 Reasoning/Motivation:
   La conversazione riguarda la prenotazione di un esame del sangue presso l'Humanitas di Rozzano. Il richiedente chiede se è possibile effettuare l'esame oggi e l'assistente gli consiglia di contattare il punto prelievi per ottenere informazioni precise sui tempi disponibili.
----------------------------------------------------------------------------------------------------
🔍 CONTEXT & METADATA
--------------------------------------------------
   model_used: mistral:7b
   cache_hit: False
   context_provided: False
   embedding_validation_enabled: True
   client_name: humanitas
   raw_mode_used: False
----------------------------------------------------------------------------------------------------
✅ LLM DEBUG COMPLETED
====================================================================================================

📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🤖 LLM DIRECT CLASSIFICATION: Sessione 9c2ef75641b8b4e261ccc61aac81f8cc classificata tramite LLM diretto (classificazione=unknown)
Connessione al database TAG stabilita con successo
  ℹ️ Tag '"Prenotazione"' già esistente per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica
5. Riconduci ad una delle etichette presenti in <|LABELING|>
6. Se la conversazionenon è riconducibile a nessuna <|LABELING|> riconducila all'etichetta "altro". 


<|LABELING|>:
"Allergia al nichel", "alloggio", "altro", "Analisi", "Centro Malattie del Metabolismo e della Nutrizione", "Crioconservazione degli ovociti", "esame anticorpi anti covid", "Farmacia", "Helicobacter Pylori", "Humanitas con te - Registrazione", "Prenotazione", "Referti e Cartelle Cliniche", "Servizi aziendali", "Visita Specialistica Cardiologica", "Visita Specialistica Chirurgica", "Visita Specialistica Oncologica", "Visita Specialistica", "alloggio", "altro", "analisi", "benessere", "Centro Malattie del Metabolismo e della Nutrizione", "Chirurgia Generale e Chirurgia del Colon-Retto", "ecografia addome superiore con liquido contrasto", "esame anticorpi anti covid", "Helicobacter Pylori", "Humanitas con te - Registrazione", "pneumologia", "prenotazione", "Pronto Soccorso", "Referti e Cartelle Cliniche", "Risonanza magnetica", "Servizi aziendali", "Visita Specialistica", "Visita Specialistica Cardiologica", "Visita Specialistica Oncologica"


CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare


CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "etichetta",
    "confidence": 1.0,
    "motivation": "motivazione"
  }


CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 714
   💬 Token conversazione: 750
   📊 Token totali: 1464
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1464 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 714
   📊 Token conversazione originale: 750
   📊 Token conversazione finale: 750
   📊 Token totali: 1464
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user_template
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 2396 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi 

<|ESEMPI|>

user: "Ci sono convenzioni con hotel per assistere un ricoverato?"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "convenzioni_viaggio",
    "confidence": 1.0,
    "motivation": "Richiesta info convenzioni viaggio"
  }

user: "Non trovo l'id per scaricare il referto"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_ritiro_referti_cartella_clinica",
    "confidence": 1.0,
    "motivation": ""Problema ID per ritiri referti e cartella clinica"
  }

user: "Non mi fa registrare al portale, dice codice fiscale errato"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Problema tecnico di accesso al portale online"
  }

user: "Quando inserisco il CF dice che non è valido"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "problema_accesso_portale",
    "confidence": 1.0,
    "motivation": "Segnalazione mancato riconoscimento Codice Fiscale"
  }
}

user: "Devo cambiare la mail con cui mi sono registrato al portale"
assistant: {
  "name": "classify_conversation", 
  "arguments": {
    "predicted_label": "cambio_anagrafica",
    "confidence": 1.0,
    "motivation": "Cambio delle informazioni anagrafiche richiesto"
  }





<|TESTO DA CLASSIFICARE|>:
"[UTENTE] quali esami di laboratorio fate? [ASSISTENTE] Il Laboratorio Analisi dell’IRCCS Istituto Clinico Humanitas offre una vasta gamma di esami di laboratorio, tra cui esami di base e specialistici per la promozione della salute, prevenzione, diagnosi e monitoraggio terapeutico. Gli esami incl..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

VINCOLI OUTPUT (SOLO JSON). 
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 4167 characters
🔢 Token Analysis:
   📊 Token prompt base: 714
   📊 Token conversazione: 750
   📊 Token totali stimati: 1464
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
