🚀 UMAP disponibile per riduzione dimensionale!
🚀 cuML GPU clustering disponibile!
💥 EmbeddingDestroyer inizializzato - Ready to destroy and rebuild!
🎯 SimpleEmbeddingManager inizializzato
🎛️ Configurazioni AI saranno salvate su DATABASE MySQL
🎛️ AIConfigurationService inizializzato
   � Backend: DATABASE MySQL
   🔑 OpenAI API Key: ✅ Configurata
🏭 EmbeddingEngineFactory inizializzata
🎯 EmbeddingManager inizializzato
✅ Blueprint esempi inizializzato correttamente
🚀 Avvio server Flask - Debug: True
 * Serving Flask app 'server'
 * Debug mode: on
🔍 [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
🔍 [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
🏢 Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
🔍 [DEBUG] Recuperati 22 oggetti Tenant dal database
🔍 [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
🔍 [DEBUG] Invio risposta con 22 tenant
🔍 [DEBUG] GET /api/tenants - Avvio richiesta tenant con oggetti Tenant
🔍 [DEBUG] Chiamo get_available_tenants() per oggetti Tenant...
🔍 [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
🔍 [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
✅ [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
🔍 [DEBUG] Inizializzo PromptManager...
🔍 [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
🏢 Recuperati 22 oggetti Tenant dalla tabella TAG.tenants
🔍 [DEBUG] Recuperati 22 oggetti Tenant dal database
🔍 [DEBUG] Primi 3 tenant convertiti: [{'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'tenant_slug': 'alleanza', 'is_active': True}, {'tenant_id': '6bc4f06f-742e-11f0-acb8-96000228e7fe', 'tenant_name': 'BluPantheon', 'tenant_slug': 'blupantheon', 'is_active': True}, {'tenant_id': '0f9d6e90-d319-11ef-86a5-96000228e7fe', 'tenant_name': 'Boots', 'tenant_slug': 'boots', 'is_active': True}]
🔍 [DEBUG] Invio risposta con 22 tenant
🔍 [DEBUG] Recuperati 5 prompt dal PromptManager
🔍 [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
✅ [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
✅ [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
🔍 [DEBUG] Invio risposta JSON per status prompt
🔍 [DEBUG] GET /api/prompts/a0fd7600-f4f7-11ef-9315-96000228e7fe/status - Avvio richiesta
🔍 [DEBUG] API: Recupero status prompt per tenant: a0fd7600-f4f7-11ef-9315-96000228e7fe
✅ [DEBUG] Riconosciuto come tenant_id UUID: a0fd7600-f4f7-11ef-9315-96000228e7fe
🔍 [DEBUG] Inizializzo PromptManager...
🔍 [DEBUG] Chiamo get_all_prompts_for_tenant(a0fd7600-f4f7-11ef-9315-96000228e7fe)...
🔍 [DEBUG] Recuperati 5 prompt dal PromptManager
🔍 [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
✅ [DEBUG] Status calcolato: {'success': True, 'tenant_id': 'a0fd7600-f4f7-11ef-9315-96000228e7fe', 'tenant_name': 'Alleanza', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-25T08:54:43', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
✅ [DEBUG] Status prompt per tenant_id a0fd7600-f4f7-11ef-9315-96000228e7fe: 5/5 attivi
🔍 [DEBUG] Invio risposta JSON per status prompt
🔍 [DEBUG] GET /api/prompts/015007d9-d413-11ef-86a5-96000228e7fe/status - Avvio richiesta
🔍 [DEBUG] API: Recupero status prompt per tenant: 015007d9-d413-11ef-86a5-96000228e7fe
✅ [DEBUG] Riconosciuto come tenant_id UUID: 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG] Inizializzo PromptManager...
🔍 [DEBUG] Chiamo get_all_prompts_for_tenant(015007d9-d413-11ef-86a5-96000228e7fe)...
🔍 [DEBUG] Recuperati 5 prompt dal PromptManager
🔍 [DEBUG] Statistiche: 5/5 attivi, 0 inattivi
✅ [DEBUG] Status calcolato: {'success': True, 'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'total_prompts': 5, 'active_prompts': 5, 'inactive_prompts': 0, 'last_updated': '2025-08-30T12:34:13', 'status': 'ready', 'canOperate': True, 'requiredPrompts': [{'name': 'System Prompt', 'type': 'system', 'description': 'Prompt di sistema per la classificazione', 'exists': True}, {'name': 'User Template', 'type': 'user', 'description': 'Template per prompt utente', 'exists': True}, {'name': 'Classification Prompt', 'type': 'classification', 'description': 'Prompt per classificazione intelligente', 'exists': False}], 'missingCount': 1}
✅ [DEBUG] Status prompt per tenant_id 015007d9-d413-11ef-86a5-96000228e7fe: 5/5 attivi
🔍 [DEBUG] Invio risposta JSON per status prompt
🔧 Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
🔍 Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
✅ MongoClassificationReader creato per tenant: Humanitas (humanitas)
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
✅ Connesso a MongoDB database: classificazioni
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🔍 Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
🏷️ Recupero etichette per tenant: Humanitas
📊 Calcolo statistiche per tenant: Humanitas
🔧 Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
🔍 Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
✅ MongoClassificationReader creato per tenant: Humanitas (humanitas)
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
✅ Connesso a MongoDB database: classificazioni
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🔍 Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
🏷️ Recupero etichette per tenant: Humanitas
📊 Calcolo statistiche per tenant: Humanitas
🔧 Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
🔍 Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
✅ MongoClassificationReader creato per tenant: Humanitas (humanitas)
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
✅ Connesso a MongoDB database: classificazioni
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🔍 Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
🏷️ Recupero etichette per tenant: Humanitas
📊 Calcolo statistiche per tenant: Humanitas
🎯 TRAINING SUPERVISIONATO - Cliente: 015007d9-d413-11ef-86a5-96000228e7fe
📋 Parametri utente semplificati:
  � Max sessioni review: 500
  🎯 Soglia confidenza: 0.95
  🔄 Forza review: False
  ⚖️  Soglia disagreement: 0.3
🔧 Inizializzazione pipeline per cliente: 015007d9-d413-11ef-86a5-96000228e7fe (con lock)
⚠️ [PIPELINE] DEPRECATO: uso di tenant_slug '015007d9-d413-11ef-86a5-96000228e7fe' - convertendo a oggetto Tenant
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
🔄 [PIPELINE] Conversione completata: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
✅ [CONFIG] Configurazione base caricata da /home/ubuntu/classificatore/Utils/../config.yaml
🎯 [PIPELINE CLUSTERING CONFIG] Caricati parametri personalizzati per tenant 015007d9-d413-11ef-86a5-96000228e7fe:
   allow_single_cluster: non_definito -> False
   alpha: non_definito -> 0.7
   cluster_selection_epsilon: non_definito -> 0.13
   cluster_selection_method: non_definito -> leaf
   max_cluster_size: non_definito -> 0
   metric: non_definito -> euclidean
   min_cluster_size: 5 -> 21
   min_samples: 3 -> 14
   only_user: non_definito -> False
   umap_metric: non_definito -> cosine
   umap_min_dist: non_definito -> 0.05
   umap_n_components: non_definito -> 100
   umap_n_neighbors: non_definito -> 15
   umap_random_state: non_definito -> 42
   use_umap: non_definito -> True

🚀 [FASE 1: INIZIALIZZAZIONE] Avvio pipeline...
🏥 [FASE 1: INIZIALIZZAZIONE] Tenant: humanitas
🎯 [FASE 1: INIZIALIZZAZIONE] Configurazione:
   📊 Confidence threshold: 0.7
   🤖 Auto mode: True
   🔄 Auto retrain: False
� [FASE 1: INIZIALIZZAZIONE] Inizializzazione lettore conversazioni...
✅ [CONFIG] Configurazione base caricata da /home/ubuntu/classificatore/Utils/../config.yaml
✅ [CONFIG] Config personalizzata tenant 015007d9-d413-11ef-86a5-96000228e7fe: 15 parametri
🎯 [ONLY_USER] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: False (da config personalizzata)
🎯 [LETTORE] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: only_user = False (da config tenant)
� [FASE 1: INIZIALIZZAZIONE] Inizializzazione aggregator...
   🔍 Schema: 'humanitas'
   🆔 Tenant ID: '015007d9-d413-11ef-86a5-96000228e7fe'
🎯 [SESSION AGGREGATOR] Inizializzazione con oggetto Tenant: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
🎯 [ONLY_USER] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: False (da config personalizzata)
🎯 [LETTORE] Tenant 015007d9-d413-11ef-86a5-96000228e7fe: only_user = False (da config tenant)
� [ONLY_USER] Schema None: False (legacy - no tenant_id)
🧠 [FASE 1: INIZIALIZZAZIONE] Sistema embedder dinamico (lazy loading)
🔧 [FASE 1: INIZIALIZZAZIONE] Parametri clustering:
   📊 Min cluster size: 21
   📊 Min samples: 14
🐛 DEBUG CLUSTER_ALPHA - PRIMA:
   📋 clustering_config.get('alpha', 1.0): 0.7
   📋 Type: <class 'float'>
🐛 DEBUG CLUSTER_ALPHA - DOPO CONVERSIONE:
   📋 cluster_alpha: 0.7
   📋 Type: <class 'float'>
🐛 DEBUG CLUSTER_ALPHA - FINALE:
   📋 cluster_alpha finale: 0.7
   📋 Type finale: <class 'float'>
   📋 Alpha > 0: True
✅ [CONFIG] Config personalizzata tenant 015007d9-d413-11ef-86a5-96000228e7fe: 15 parametri
🗂️  [UMAP] Parametri per tenant 015007d9-d413-11ef-86a5-96000228e7fe:
   use_umap: True
   n_neighbors: 15
   min_dist: 0.05
   n_components: 100
   metric: cosine
🔧 [FIX DEBUG] Parametri tenant passati a HDBSCANClusterer:
   min_cluster_size: 21
   min_samples: 14
   alpha: 0.7
   cluster_selection_method: leaf
   cluster_selection_epsilon: 0.13
   metric: euclidean
   allow_single_cluster: False
   max_cluster_size: 0
   🗂️  use_umap: True
   🗂️  umap_n_neighbors: 15
   🗂️  umap_min_dist: 0.05
   🗂️  umap_n_components: 100
🎯 [BERTOPIC] Parametri consistenti configurati:
   📊 HDBSCAN: 10 parametri
   📊 UMAP: 5 parametri
🔧 HDBSCANClusterer inizializzato:
   min_cluster_size: 21
   min_samples: 14
   metric: euclidean
   cluster_selection_epsilon: 0.13
   🗂️  UMAP enabled: True
     📏 n_neighbors: 15
     📐 min_dist: 0.05
     📊 n_components: 100
     🎯 metric: cosine
   🚀 GPU enabled: True
   💾 GPU memory limit: 80%
   🔄 CPU fallback: True
   ⚠️  [GPU MODE] Limitazioni cuML HDBSCAN:
     🚫 leaf_size=40 sarà IGNORATO su GPU
     ✅ Parametri supportati: cluster_selection_method, alpha, allow_single_cluster
🎯 [DEBUG REACT] Parametri configurati:
   cluster_selection_method: leaf
   alpha: 0.7
   allow_single_cluster: False
🧠 Inizializzazione memoria semantica...
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
🔧 TokenizationManager inizializzato:
   📊 Modello tokenizer: cl100k_base
   🔢 Limite massimo token: 8000
   ✂️  Strategia troncamento: start
✅ TokenizationManager integrato in LaBSE per gestione conversazioni lunghe
🚀 Inizializzazione LaBSE embedder su device: cuda
📥 Caricamento modello sentence-transformers/LaBSE...
🚀 Caricamento diretto su GPU...
✅ Modello caricato con successo!
📊 Dimensione embedding: 768
🔧 Device: cuda
🎮 GPU: NVIDIA A10G
💾 GPU Memory: 23.7 GB
📈 GPU Memory utilizzata: 1.89 GB
� Primo parametro su device: cuda:0
🧪 Test del modello LaBSE...
🔍 Encoding 3 testi con LaBSE su device cuda...

🔍 TOKENIZZAZIONE PREVENTIVA LABSE CLUSTERING
============================================================
🔍 ELABORAZIONE CONVERSAZIONI PER CLUSTERING
   📊 Numero conversazioni: 3
   🆔 Session IDs forniti: No

📊 STATISTICHE ELABORAZIONE:
   🔢 Conversazioni totali: 3
   ✂️  Conversazioni troncate: 0
   📏 Token originali totali: 20
   📐 Token finali totali: 20
   📊 Range token: 6 - 7
✅ Tokenizzazione LaBSE completata:
   📊 Conversazioni processate: 3
   📊 Conversazioni troncate: 0
   📊 Token limite configurato: 8000
   ✅ Tutte le conversazioni entro i limiti, nessun troncamento
============================================================
✅ Embedding generati: shape (3, 768)
✅ Test modello completato con successo!
   Shape: (3, 768)
   Norme: [0.99999994 1.         1.        ]
   Device: cuda
🎯 Modello pronto per l'uso!
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
🧠 SemanticMemoryManager inizializzato
  🎯 Soglia riutilizzo etichette: 0.8
  🔍 Soglia similarità semantica: 0.8
  💾 Cache path: semantic_cache/humanitas_015007d9_memory
🔗 Inizializzazione ensemble classifier avanzato...
🔍 ML Ensemble Debugger inizializzato e ATTIVO
   📝 Debug file: ./debug_logs/ml_debug.log
🔍 ML Ensemble Debugger attivato
🔧 Tentativo di inizializzazione IntelligentClassifier tramite LLMFactory...
🧠 GPU Memory prima di LLM: 1.8GB/22.1GB (free: 20.3GB)
✅ Memoria GPU sufficiente, inizializzazione LLM tramite Factory...
🎛️ Configurazioni AI saranno salvate su DATABASE MySQL
🎛️ AIConfigurationService inizializzato
   � Backend: DATABASE MySQL
   🔑 OpenAI API Key: ✅ Configurata
🏭 LLM Factory inizializzato con cache invalidation intelligente
🔍 LLM FACTORY DEBUG: Chiamata ai_config_service.get_tenant_configuration(humanitas) normale...
🔄 DatabaseAI: Modalità legacy - risolvo tenant_id humanitas
🔍 [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 28, 16, 51, 54)}
🔍 [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 28, 16, 51, 54), 'embedding_config': {}, 'llm_config': {}}
🔍 [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
🎯 LLM FACTORY DEBUG: Modello normale = 'mistral:7b'
🔧 Creazione LLM classifier mistral:7b per tenant humanitas
🚀 LLM FACTORY DEBUG: Avvio creazione nuovo classifier modello 'mistral:7b'
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto da slug (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
🔍 LLM Debugger inizializzato e ATTIVO
   📝 Debug file: ./debug_logs/llm_debug.log
   🎨 Visual formatting: True
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
🗄️ MongoClassificationReader inizializzato per tenant: Humanitas
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
Connessione al database TAG stabilita con successo
📋 Recuperati 265 tag dal database TAGS per tenant 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG chiusa
🔧 TokenizationManager inizializzato:
   📊 Modello tokenizer: cl100k_base
   🔢 Limite massimo token: 8000
   ✂️  Strategia troncamento: start
✅ LLM FACTORY DEBUG: Nuovo classifier creato: mistral:7b
✅ LLM Classifier mistral:7b (mistral:7b) creato e cached per tenant humanitas
🏭 LLM classifier ottenuto tramite Factory per tenant humanitas
🤖 LLM classifier creato automaticamente nell'ensemble: mistral:7b
💡 Possibile fine-tuning per humanitas
🔗 Advanced Ensemble Classifier inizializzato
   🧠 LLM weight: 0.60
   🤖 ML weight: 0.40
   🎯 Confidence threshold: 0.7
   🔄 Adaptive weights: True
   👤 Disaccordi gestiti da QualityGateEngine
📥 Caricamento ultimo modello per humanitas: humanitas_015007d9_20250829_181313
📥 Caricamento ensemble model...
✅ ML ensemble caricato
✅ Configurazione caricata
🔗 Ensemble model caricato da models/humanitas_015007d9_20250829_181313
✅ Modello caricato con successo

🔍 VERIFICA BERTOPIC LOADING:
   📋 BERTopic enabled: True
   📋 BERTopic available: True
   📁 Provider directory: models/humanitas_015007d9_20250829_181313_bertopic
   📁 Directory exists: True
   � File trovati: 3 -> ['metadata.json', 'bertopic_model', 'svd_model.pkl']

🔄 CARICAMENTO BERTOPIC:
   📁 Path completo: /home/ubuntu/classificatore/models/humanitas_015007d9_20250829_181313_bertopic
🔄 Caricamento BERTopic model da models/humanitas_015007d9_20250829_181313_bertopic/bertopic_model
✅ BERTopic model caricato con successo
📥 SVD caricato (svd_model.pkl)
   ⏱️ Caricamento completato in 0.20 secondi
   ✅ BERTopic provider caricato con successo
🔗 BERTopic provider impostato (top_k=10, one_hot=False)
   ✅ BERTopic provider configurato nell'ensemble
⏸️ Riaddestramento automatico disabilitato (modalità supervisione/API)
   💡 Per abilitare, usare auto_retrain=True nell'inizializzazione
✅ Classificatore LLM disponibile nell'ensemble
👤 Inizializzazione trainer interattivo...
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
🎯 SIMPLE MANAGER: Richiesta embedder per tenant 015007d9-d413-11ef-86a5-96000228e7fe
📥 Primo embedder - creazione per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🚀 CREATING FRESH EMBEDDER per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🎛️ Configurazioni AI saranno salvate su DATABASE MySQL
🎛️ AIConfigurationService inizializzato
   � Backend: DATABASE MySQL
   🔑 OpenAI API Key: ✅ Configurata
🔄 DatabaseAI: Modalità legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
🔧 FORCE NO CACHE: Bypass cache per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🔥 FORCE NO CACHE: Bypasso cache e leggo DIRETTAMENTE dal database per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 28, 16, 51, 54)}
🔍 [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 28, 16, 51, 54), 'embedding_config': {}, 'llm_config': {}}
🔍 [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
🔍 SIMPLE MANAGER: Engine da DB per 015007d9-d413-11ef-86a5-96000228e7fe = 'labse'
🎯 Engine configurato: labse
🔧 DIRECT CREATE: labse
🐳 Tentativo connessione a servizio LaBSE dockerizzato...
🔗 LaBSE Remote Client inizializzato
   📡 Service URL: http://localhost:8081
   ⏱️  Timeout: 300s
   🔄 Max retries: 3
   🛡️ Fallback locale: True
🔧 Inizializzazione client remoto LaBSE...
✅ Servizio embedding online e funzionante
✅ Client remoto LaBSE inizializzato con successo
✅ LaBSE Remote Client configurato con successo
✅ FRESH EMBEDDER creato: LaBSERemoteClient per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🧠 Inizializzazione dedupplicatore intelligente...
💾 [FASE 1: INIZIALIZZAZIONE] Caricamento memoria semantica...
🔄 Caricamento memoria semantica dal database...
🔄 Caricamento memoria semantica da MongoDB...
✅ Connesso a MongoDB database: classificazioni
📊 Recupero sessioni per tenant: Humanitas
   📂 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
📭 Nessuna classificazione trovata nel database MongoDB
📭 Inizializzata memoria semantica vuota
   📊 Campioni: 0
   🏷️ Tag: 0
✅ [FASE 1: INIZIALIZZAZIONE] Completata in 4.93s
🎯 [FASE 1: INIZIALIZZAZIONE] Pipeline pronta per l'uso!
✅ Pipeline 015007d9-d413-11ef-86a5-96000228e7fe inizializzata
🚀 TRAINING SUPERVISIONATO CON DATASET COMPLETO
  📊 Estrazione: TUTTE le discussioni dal database
  🧩 Clustering: Su tutto il dataset disponibile
  👤 Review umana: Max 500 sessioni rappresentative
🎯 Confidence threshold aggiornato a: 0.95
🎓 TRAINING SUPERVISIONATO AVANZATO
� NUOVA LOGICA:
  🔄 Estrazione: TUTTE le discussioni dal database
  🧩 Clustering: Su tutto il dataset completo
  👤 Review umana: Massimo 500 sessioni rappresentative
--------------------------------------------------
📊 FASE 1: ESTRAZIONE COMPLETA DATASET

� [FASE 2: ESTRAZIONE] Avvio estrazione sessioni...
🏥 [FASE 2: ESTRAZIONE] Tenant: humanitas
📅 [FASE 2: ESTRAZIONE] Giorni indietro: 7
🔄 [FASE 2: ESTRAZIONE] Modalità COMPLETA attivata
🎯 [FASE 2: ESTRAZIONE] Ignorando limite - estrazione totale dataset
� [FASE 2: ESTRAZIONE] Modalità: COMPLETA
� [FASE 2: ESTRAZIONE] Connessione database...
📊 [DEBUG ONLY_USER] Estrazione sessioni aggregate dal schema 'humanitas'...
🎯 [DEBUG ONLY_USER] Parametro only_user = False (tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe)
📄 [DEBUG ONLY_USER] Estrazione completa (senza limite)
📄 [DEBUG ONLY_USER] Filtraggio standard: messaggi USER e AGENT
🔍 [DEBUG ONLY_USER] Esecuzione query per leggere conversazioni dal schema 'humanitas'...
🎯 [DEBUG ONLY_USER] Parametro only_user = False
📋 [DEBUG ONLY_USER] Filtro applicato: WHERE csm.said_by IN ('USER', 'AGENT')
Connessione al database MySQL stabilita con successo
✅ [DEBUG ONLY_USER] Query eseguita con successo!
📊 [DEBUG ONLY_USER] Totale righe: 21575
👤 [DEBUG ONLY_USER] Messaggi USER: 10769
🤖 [DEBUG ONLY_USER] Messaggi AGENT: 10806
✅ [DEBUG ONLY_USER] Filtro funziona correttamente!
✅ Trovate 21575 righe da aggregare
🔄 [DEBUG ONLY_USER] Inizio generazione testo completo per 4303 sessioni
🔍 [DEBUG ONLY_USER] Sessione 0008ef4f-c2f4-4f5e-933e-646574f3638c: 3 USER, 3 AGENT
📝 [DEBUG ONLY_USER] Sessione 0008ef4f-c2f4-4f5e-933e-646574f3638c testo finale:
   [UTENTE] tags: 2
   [ASSISTENTE] tags: 2
   Lunghezza testo: 554 caratteri
🔍 [DEBUG ONLY_USER] Sessione 000b61d7-4431-40d2-b83c-9abbb70c98be: 4 USER, 4 AGENT
📝 [DEBUG ONLY_USER] Sessione 000b61d7-4431-40d2-b83c-9abbb70c98be testo finale:
   [UTENTE] tags: 3
   [ASSISTENTE] tags: 3
   Lunghezza testo: 1133 caratteri
🔍 [DEBUG ONLY_USER] Sessione 00160700-ac7f-463d-8fa0-fe57f74a73e6: 4 USER, 4 AGENT
✅ Aggregate 4303 sessioni uniche
🔄 Saltati 8606 messaggi di benvenuto (primi 2 per sessione)
🔄 Sessioni vuote (solo benvenuto): 906
📥 [FASE 2: ESTRAZIONE] Sessioni grezze: 4303
🔍 [FASE 2: ESTRAZIONE] Filtraggio sessioni...
🔍 Filtraggio sessioni vuote/irrilevanti...
✅ Filtro completato:
  📊 Sessioni originali: 4303
  ❌ Sessioni scartate: 906
  ✅ Sessioni valide: 3397
✅ [FASE 2: ESTRAZIONE] Completata in 0.67s
📊 [FASE 2: ESTRAZIONE] Dataset completo: 3397 sessioni
🗑️ [FASE 2: ESTRAZIONE] Filtrate: 906 sessioni vuote/irrilevanti
🎯 [FASE 2: ESTRAZIONE] Pronte per clustering completo
✅ Dataset completo: 3397 sessioni totali

📊 FASE 2: CLUSTERING COMPLETO

🚀 [FASE 4: CLUSTERING] Avvio clustering intelligente...
📊 [FASE 4: CLUSTERING] Dataset: 3397 sessioni
🎯 [FASE 4: CLUSTERING] Modalità: INTELLIGENTE
🧠 [FASE 4: CLUSTERING] Clustering incrementale (se possibile)...

🚀 [FASE 3: EMBEDDINGS] Avvio generazione embeddings...
� [FASE 3: EMBEDDINGS] Dataset: 3397 sessioni
📊 [FASE 3: EMBEDDINGS] Caratteristiche testo:
   📏 Lunghezza media: 1012 caratteri
   📏 Lunghezza massima: 29104 caratteri
   📏 Lunghezza minima: 75 caratteri
🧠 [FASE 3: EMBEDDINGS] Generazione embeddings...
🔄 LAZY LOADING: Caricamento embedder dinamico per tenant 'humanitas'
🎯 SimpleEmbeddingManager inizializzato
🔄 SIMPLE MANAGER: Normalizzato 'humanitas' -> '015007d9-d413-11ef-86a5-96000228e7fe'
🎯 SIMPLE MANAGER: Richiesta embedder per tenant 015007d9-d413-11ef-86a5-96000228e7fe
📥 Primo embedder - creazione per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🚀 CREATING FRESH EMBEDDER per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🎛️ Configurazioni AI saranno salvate su DATABASE MySQL
🎛️ AIConfigurationService inizializzato
   � Backend: DATABASE MySQL
   🔑 OpenAI API Key: ✅ Configurata
🔄 DatabaseAI: Modalità legacy - risolvo tenant_id 015007d9-d413-11ef-86a5-96000228e7fe
🔧 FORCE NO CACHE: Bypass cache per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🔥 FORCE NO CACHE: Bypasso cache e leggo DIRETTAMENTE dal database per tenant 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG] Query eseguita per tenant_id: 015007d9-d413-11ef-86a5-96000228e7fe
🔍 [DEBUG] Risultato database: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'embedding_config': None, 'llm_config': None, 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 28, 16, 51, 54)}
🔍 [DEBUG AIConfig] db_config ricevuto: {'tenant_id': '015007d9-d413-11ef-86a5-96000228e7fe', 'tenant_name': 'Humanitas', 'tenant_slug': 'humanitas', 'embedding_engine': 'labse', 'llm_engine': 'mistral:7b', 'is_active': 1, 'updated_at': datetime.datetime(2025, 8, 28, 16, 51, 54), 'embedding_config': {}, 'llm_config': {}}
🔍 [DEBUG AIConfig] llm_engine nel db_config: mistral:7b
🔍 SIMPLE MANAGER: Engine da DB per 015007d9-d413-11ef-86a5-96000228e7fe = 'labse'
🎯 Engine configurato: labse
🔧 DIRECT CREATE: labse
🐳 Tentativo connessione a servizio LaBSE dockerizzato...
🔗 LaBSE Remote Client inizializzato
   📡 Service URL: http://localhost:8081
   ⏱️  Timeout: 300s
   🔄 Max retries: 3
   🛡️ Fallback locale: True
🔧 Inizializzazione client remoto LaBSE...
✅ Servizio embedding online e funzionante
✅ Client remoto LaBSE inizializzato con successo
✅ LaBSE Remote Client configurato con successo
✅ FRESH EMBEDDER creato: LaBSERemoteClient per tenant 015007d9-d413-11ef-86a5-96000228e7fe
✅ Embedder caricato per tenant UUID 'humanitas': LaBSERemoteClient
📡 Richiesta embedding remoto per 3397 testi...
✅ Embedding remoto completato in 6.915s
   📊 Shape: (3397, 768)
   ⚡ Tempo servizio: 3.420s
✅ [FASE 3: EMBEDDINGS] Completata in 7.08s
📈 [FASE 3: EMBEDDINGS] Shape: (3397, 768)
⚡ [FASE 3: EMBEDDINGS] Throughput: 480.1 testi/secondo

📊 FASE 2A: TRAINING BERTOPIC ANTICIPATO

🚀 TRAINING BERTOPIC ANTICIPATO (NUOVO FLUSSO OTTIMIZZATO):
   📊 Dataset completo: 3397 sessioni
   📊 Embeddings shape: (3397, 768)
   🎯 Addestramento su TUTTO il dataset per features ottimali
   🔥 Esecuzione bertopic_provider.fit() su dataset completo...
📊 BERTopic training su 3397 campioni
   🎯 Embedder configurato: LaBSERemoteClient
   🔧 STRATEGIA: BERTopic userà embedder personalizzato via wrapper
   ✅ Wrapper embedder creato per BERTopic
   🔧 BERTopic userà embedder personalizzato interno
✅ BERTopic FIT completato su 3397 campioni
   🔧 SVD Training: Usando embedder personalizzato interno
✅ SVD addestrato su full probas (k=20)
   ✅ BERTopic FIT completato in 40.77 secondi
   🔄 Esecuzione bertopic_provider.transform() per features extraction...
🔧 Transform: BERTopic userà embedder personalizzato interno
   ✅ BERTopic TRANSFORM completato in 4.44 secondi
   📊 Topic probabilities shape: (3397, 20)
   📊 One-hot shape: None
   ✅ BERTopic provider addestrato con successo su 3397 sessioni
   ✅ BERTopic provider disponibile per augmentation features
   🔗 BERTopic model assegnato al trainer per validazione ALTRO

📊 FASE 2B: CLUSTERING HDBSCAN
🧠 Usando clustering INTELLIGENTE (LLM + ML senza pattern)
🗂️  [DEBUG] Caricamento config tenant-specific: /home/ubuntu/classificatore/tenant_configs/015007d9-d413-11ef-86a5-96000228e7fe_clustering.yaml
🗂️  [DEBUG] Config tenant caricato: ['allow_single_cluster', 'alpha', 'cluster_selection_epsilon', 'cluster_selection_method', 'max_cluster_size', 'metric', 'min_cluster_size', 'min_samples', 'only_user', 'umap_metric', 'umap_min_dist', 'umap_n_components', 'umap_n_neighbors', 'umap_random_state', 'use_umap']
🗂️  [DEBUG] UMAP config finale: use_umap=True, n_components=100, min_dist=0.05
🧠 Clustering intelligente configurato:
   🎯 Categorie intent suggerite: 12
   🤖 LLM primario: True
   📊 Min confidence: 0.8
   📈 Min conversations per intent: 2
   👥 Rappresentanti diversificati: True
   🔢 Max rappresentanti per cluster: 5
   🤝 Strategia consenso: majority
🧠 Avvio clustering intelligente OTTIMIZZATO di 3397 conversazioni...
📊 Fase 1: Clustering semantico con HDBSCAN...
🔧 HDBSCANClusterer inizializzato:
   min_cluster_size: 21
   min_samples: 14
   metric: euclidean
   cluster_selection_epsilon: 0.13
   🗂️  UMAP enabled: True
     📏 n_neighbors: 15
     📐 min_dist: 0.05
     📊 n_components: 100
     🎯 metric: cosine
   🚀 GPU enabled: True
   💾 GPU memory limit: 80%
   🔄 CPU fallback: True
   ⚠️  [GPU MODE] Limitazioni cuML HDBSCAN:
     🚫 leaf_size=40 sarà IGNORATO su GPU
     ✅ Parametri supportati: cluster_selection_method, alpha, allow_single_cluster
🎯 [DEBUG REACT] Parametri configurati:
   cluster_selection_method: eom
   alpha: 1.0
   allow_single_cluster: False
🔍 Clustering HDBSCAN su 3397 embedding (19.9MB)...
⚙️  Parametri: min_cluster_size=21, min_samples=14, metric=euclidean
📊 [DEBUG FIT_PREDICT] Embedding input:
   📏 Shape: (3397, 768)
   🔢 Dtype: float64
   📈 Range: [-0.1284, 0.0954]
   💾 Memory: 19.9MB

🗂️  [DEBUG FIT_PREDICT] STEP 1: Controllo applicazione UMAP...
🔍 [DEBUG UMAP] Controllo condizioni applicazione UMAP...
   ✅ self.use_umap = True
   ✅ UMAP_AVAILABLE = True
� [DEBUG UMAP] UMAP ABILITATO - Iniziando riduzione dimensionale...
   📏 Dimensioni input: (3397, 768)
   🔢 Tipo dati input: float64
   📊 Range valori input: [-0.1284, 0.0954]
   🎯 Parametri UMAP configurati:
     📐 n_neighbors: 15
     📏 min_dist: 0.05
     🔢 n_components: 100
     📈 metric: cosine
     🎲 random_state: 42
🔧 [DEBUG UMAP] Inizializzazione riduttore UMAP...
🆕 [DEBUG UMAP] Modalità TRAINING - fit nuovo reducer
✅ [DEBUG UMAP] Riduttore UMAP inizializzato con successo
⏳ [DEBUG UMAP] Applicazione fit_transform agli embeddings...
UMAP(angular_rp_forest=True, metric='cosine', min_dist=0.05, n_components=100, n_jobs=1, random_state=42, verbose=True)
Sun Aug 31 08:50:37 2025 Construct fuzzy simplicial set
Sun Aug 31 08:50:51 2025 Finding Nearest Neighbors
Sun Aug 31 08:50:52 2025 Finished Nearest Neighbor Search
Sun Aug 31 08:50:52 2025 Construct embedding
	completed  0  /  500 epochs
	completed  50  /  500 epochs
	completed  100  /  500 epochs
	completed  150  /  500 epochs
	completed  200  /  500 epochs
	completed  250  /  500 epochs
	completed  300  /  500 epochs
	completed  350  /  500 epochs
	completed  400  /  500 epochs
	completed  450  /  500 epochs
Sun Aug 31 08:51:02 2025 Finished embedding
✅ [DEBUG UMAP] UMAP COMPLETATO con SUCCESSO in 25.68s
   📐 Dimensioni output: (3397, 100)
   � Tipo dati output: float32
   �📊 Range valori output: [-2.5495, 10.8164]
   📈 Riduzione dimensionale: 768 → 100 dimensioni
   📉 Fattore riduzione: 7.7x
✅ [DEBUG UMAP] RIDUZIONE DIMENSIONALE CONFERMATA
✅ [DEBUG UMAP] Nessun NaN nel risultato UMAP
✅ [DEBUG UMAP] Nessun valore infinito nel risultato UMAP
📊 [DEBUG UMAP] Diversità embeddings ridotti: 3397/3397 righe uniche
✅ [DEBUG UMAP] Buona diversità negli embeddings ridotti
📋 [DEBUG UMAP] Info riduzione salvate nel clusterer
📋 [DEBUG FIT_PREDICT] Risultato UMAP:
   ✅ UMAP applicato: True
   📏 Shape post-UMAP: (3397, 100)
   📈 Range post-UMAP: [-2.5495, 10.8164]
   ⏱️  Tempo riduzione: 25.68s

🔧 [DEBUG FIT_PREDICT] STEP 2: Normalizzazione per metrica euclidean...
   🎯 Nessuna normalizzazione necessaria per metrica euclidean
   📏 Shape finale per clustering: (3397, 100)
   📈 Range finale: [-2.5495, 10.8164]
   🎯 Metrica effettiva clustering: euclidean
💾 Memoria GPU: 17.7GB disponibili, 0.1GB necessari
🚀 Utilizzo GPU per clustering accelerato

🚀 [DEBUG FIT_PREDICT] STEP 3: Avvio clustering...
   🖥️  Modalità: GPU
� [GPU CLUSTERING] Inizializzazione cuML HDBSCAN con parametri supportati...

✅ [DEBUG FIT_PREDICT] CLUSTERING COMPLETATO in 0.11s con 🚀 GPU!
📊 Risultati finali:
   🎯 Cluster trovati: 39
   🔍 Outlier: 871 (25.6%)
   📈 Silhouette score: 0.678

📋 [DEBUG FIT_PREDICT] RIEPILOGO TRASFORMAZIONI:
   🔤 Input originale: (3397, 768)
   🗂️  Dopo UMAP: (3397, 100)
   🔧 Dopo normalizzazione: (3397, 100)
   🎯 Utilizzato per clustering: (3397, 100) con metrica euclidean
   📈 Cluster HDBSCAN trovati: 39
   🔍 Outliers: 871
👥 Fase 2: Selezione rappresentanti per cluster...
   � Cluster 0: 134 sessioni, 5 rappresentanti selezionati
   � Cluster 1: 44 sessioni, 4 rappresentanti selezionati
   � Cluster 2: 34 sessioni, 4 rappresentanti selezionati
   � Cluster 3: 302 sessioni, 5 rappresentanti selezionati
   � Cluster 4: 96 sessioni, 5 rappresentanti selezionati
   � Cluster 5: 59 sessioni, 5 rappresentanti selezionati
   � Cluster 6: 24 sessioni, 4 rappresentanti selezionati
   � Cluster 7: 155 sessioni, 5 rappresentanti selezionati
   � Cluster 8: 38 sessioni, 4 rappresentanti selezionati
   � Cluster 9: 28 sessioni, 4 rappresentanti selezionati
   � Cluster 10: 49 sessioni, 4 rappresentanti selezionati
   � Cluster 11: 96 sessioni, 5 rappresentanti selezionati
   � Cluster 12: 63 sessioni, 5 rappresentanti selezionati
   � Cluster 13: 56 sessioni, 5 rappresentanti selezionati
   � Cluster 14: 40 sessioni, 4 rappresentanti selezionati
   � Cluster 15: 41 sessioni, 4 rappresentanti selezionati
   � Cluster 16: 97 sessioni, 5 rappresentanti selezionati
   � Cluster 17: 25 sessioni, 4 rappresentanti selezionati
   � Cluster 18: 21 sessioni, 4 rappresentanti selezionati
   � Cluster 19: 26 sessioni, 4 rappresentanti selezionati
   � Cluster 20: 51 sessioni, 5 rappresentanti selezionati
   � Cluster 21: 172 sessioni, 5 rappresentanti selezionati
   � Cluster 22: 33 sessioni, 4 rappresentanti selezionati
   � Cluster 23: 28 sessioni, 4 rappresentanti selezionati
   � Cluster 24: 102 sessioni, 5 rappresentanti selezionati
   � Cluster 25: 58 sessioni, 5 rappresentanti selezionati
   � Cluster 26: 35 sessioni, 4 rappresentanti selezionati
   � Cluster 27: 99 sessioni, 5 rappresentanti selezionati
   � Cluster 28: 32 sessioni, 4 rappresentanti selezionati
   � Cluster 29: 29 sessioni, 4 rappresentanti selezionati
   � Cluster 30: 29 sessioni, 4 rappresentanti selezionati
   � Cluster 31: 98 sessioni, 5 rappresentanti selezionati
   � Cluster 32: 71 sessioni, 5 rappresentanti selezionati
   � Cluster 33: 99 sessioni, 5 rappresentanti selezionati
   � Cluster 34: 48 sessioni, 4 rappresentanti selezionati
   � Cluster 35: 39 sessioni, 4 rappresentanti selezionati
   � Cluster 36: 23 sessioni, 4 rappresentanti selezionati
   � Cluster 37: 30 sessioni, 4 rappresentanti selezionati
   � Cluster 38: 22 sessioni, 4 rappresentanti selezionati
🤖 Fase 3: Analisi LLM di 173 rappresentanti...
🤖 Analisi LLM di 173 conversazioni...
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 274
   📊 Token totali: 723
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 723 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 274
   📊 Token conversazione finale: 274
   📊 Token totali: 723
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 910 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "La polizza copre anche viaggi all'estero?"
Output: info_copertura_geografica_assicurazione
Ragionamento: Richiesta informazioni sulla copertura geografica
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno [ASSISTENTE] Buongiorno! Come posso esserti utile? [UTENTE] Dovrei prenotare un viaggio tramite Italo [UTENTE] come posso fare [ASSISTENTE] Per prenotare un viaggio tramite Italo, puoi contattare l’ufficio viaggi di Humanitas utilizzando il form dedicato disponibile alla pagin..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2856 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 274
   📊 Token totali stimati: 723
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "La polizza copre anche viaggi all'estero?"
Output: info_copertura_geografica_assicurazione
Ragionamento: Richiesta informazioni sulla copertura geografica
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno [ASSISTENTE] Buongiorno! Come posso esserti utile? [UTENTE] Dovrei prenotare un viaggio tramite Italo [UTENTE] come posso fare [ASSISTENTE] Per prenotare un viaggio tramite Italo, puoi contattare l’ufficio viaggi di Humanitas utilizzando il form dedicato disponibile alla pagin..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 244
   📊 Token totali: 693
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 693 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 244
   📊 Token conversazione finale: 244
   📊 Token totali: 693
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 757 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Devo venire al padiglione 2 cancer center. [...] it/info/come-raggiungere-humanitas/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2660 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 244
   📊 Token totali stimati: 693
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Devo venire al padiglione 2 cancer center. [...] it/info/come-raggiungere-humanitas/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 85
   📊 Token totali: 513
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 513 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 85
   📊 Token conversazione finale: 85
   📊 Token totali: 513
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 267 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] La linea 220 è extraurbana? [ASSISTENTE] Sì, la linea 220 è una linea extraurbana che collega Humanitas con Pieve Emanuele, Opera e Locate, partendo da Rozzano, via della Solidarietà【6:0†scraped_https___www.humanitas.it_info_come-raggiungere-humanitas.json】."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2737 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 85
   📊 Token totali stimati: 513
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] La linea 220 è extraurbana? [ASSISTENTE] Sì, la linea 220 è una linea extraurbana che collega Humanitas con Pieve Emanuele, Opera e Locate, partendo da Rozzano, via della Solidarietà【6:0†scraped_https___www.humanitas.it_info_come-raggiungere-humanitas.json】."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 452
   💬 Token conversazione: 191
   📊 Token totali: 643
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 643 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 452
   📊 Token conversazione originale: 191
   📊 Token conversazione finale: 191
   📊 Token totali: 643
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 614 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] il parcheggio per 2 ore e 35 minuti mi è stato fatto pagare 9,50 quando la tariffa massima risulta 8 euro [ASSISTENTE] Il costo massimo giornaliero per i parcheggi Humanitas (eccetto il Parcheggio 3) è di 8 euro. [...]  Se hai bisogno di ulteriori dettagli, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2873 characters
🔢 Token Analysis:
   📊 Token prompt base: 452
   📊 Token conversazione: 191
   📊 Token totali stimati: 643
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] il parcheggio per 2 ore e 35 minuti mi è stato fatto pagare 9,50 quando la tariffa massima risulta 8 euro [ASSISTENTE] Il costo massimo giornaliero per i parcheggi Humanitas (eccetto il Parcheggio 3) è di 8 euro. [...]  Se hai bisogno di ulteriori dettagli, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 582
   📊 Token totali: 1030
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1030 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 582
   📊 Token conversazione finale: 582
   📊 Token totali: 1030
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1553 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] dove sono le vostre sedi? [ASSISTENTE] Le sedi di Humanitas sono distribuite in diverse regioni d'Italia. [...] 

Se hai bisogno di maggiori dettagli su una sede specifica, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2696 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 582
   📊 Token totali stimati: 1030
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] dove sono le vostre sedi? [ASSISTENTE] Le sedi di Humanitas sono distribuite in diverse regioni d'Italia. [...] 

Se hai bisogno di maggiori dettagli su una sede specifica, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 338
   📊 Token totali: 786
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 786 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 338
   📊 Token conversazione finale: 338
   📊 Token totali: 786
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1089 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao, vorrei prenotare un intervento in regime privato, come devo fare? [ASSISTENTE] Per prenotare un ricovero privato presso Humanitas, puoi contattare l'Ufficio Ricoveri Privati chiamando il numero 02 82 24 62 50, attivo dal lunedì al venerdì dalle 8:00 alle 17:00, oppure inviare un'em..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2848 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 338
   📊 Token totali stimati: 786
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao, vorrei prenotare un intervento in regime privato, come devo fare? [ASSISTENTE] Per prenotare un ricovero privato presso Humanitas, puoi contattare l'Ufficio Ricoveri Privati chiamando il numero 02 82 24 62 50, attivo dal lunedì al venerdì dalle 8:00 alle 17:00, oppure inviare un'em..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 196
   📊 Token totali: 644
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 644 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 196
   📊 Token conversazione finale: 196
   📊 Token totali: 644
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 629 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Non ho ricevuto la documentazione della polizza"
Output: problema_amministrativo
Ragionamento: Problemi con documenti o questioni amministrative
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Volevo sapere se nel Building 8 c'è una cappella e a che ora fanno la messa il sabato e la domenica  [ASSISTENTE] Nel Building 8 di Humanitas è presente una cappella dedicata al culto cattolico situata al piano terra. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2816 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 196
   📊 Token totali stimati: 644
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Non ho ricevuto la documentazione della polizza"
Output: problema_amministrativo
Ragionamento: Problemi con documenti o questioni amministrative
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Volevo sapere se nel Building 8 c'è una cappella e a che ora fanno la messa il sabato e la domenica  [ASSISTENTE] Nel Building 8 di Humanitas è presente una cappella dedicata al culto cattolico situata al piano terra. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 363
   📊 Token totali: 811
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 811 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 363
   📊 Token conversazione finale: 363
   📊 Token totali: 811
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1144 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao il bar al Building 2 quali orari osserva [ASSISTENTE] Il bar situato al primo piano del Building 2, in fondo al corridoio centrale, è aperto tutti i giorni dalle 6:30 alle 21:00. [...] it/info/altri-servizi/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2805 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 363
   📊 Token totali stimati: 811
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao il bar al Building 2 quali orari osserva [ASSISTENTE] Il bar situato al primo piano del Building 2, in fondo al corridoio centrale, è aperto tutti i giorni dalle 6:30 alle 21:00. [...] it/info/altri-servizi/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 284
   📊 Token totali: 732
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 732 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 284
   📊 Token conversazione finale: 284
   📊 Token totali: 732
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 895 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Cosa copre esattamente la polizza vita Wopta?"
Output: info_condizioni_polizza
Ragionamento: Richiesta di informazioni sulle condizioni di polizza
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Divrei prenotare per nedicazione [ASSISTENTE] Potresti chiarire meglio cosa intendi per "nedicazione"? Intendi dire "medicazione" o "indicazione"? Oppure hai bisogno di prenotare una visita o un esame? [UTENTE] Medicazione per ferita che non cicatrizza [ASSISTENTE] Per prenotare una medi..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2805 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 284
   📊 Token totali stimati: 732
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Cosa copre esattamente la polizza vita Wopta?"
Output: info_condizioni_polizza
Ragionamento: Richiesta di informazioni sulle condizioni di polizza
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Divrei prenotare per nedicazione [ASSISTENTE] Potresti chiarire meglio cosa intendi per "nedicazione"? Intendi dire "medicazione" o "indicazione"? Oppure hai bisogno di prenotare una visita o un esame? [UTENTE] Medicazione per ferita che non cicatrizza [ASSISTENTE] Per prenotare una medi..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 452
   💬 Token conversazione: 305
   📊 Token totali: 757
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 757 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 452
   📊 Token conversazione originale: 305
   📊 Token conversazione finale: 305
   📊 Token totali: 757
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1026 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale


TESTO DA CLASSIFICARE:
"[UTENTE] Non riesco a registrarmi. [...] it**, indicando:
   - Nome e cognome
   - Codice fiscale
   - Motivo della richiesta di assistenza

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2760 characters
🔢 Token Analysis:
   📊 Token prompt base: 452
   📊 Token conversazione: 305
   📊 Token totali stimati: 757
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale


TESTO DA CLASSIFICARE:
"[UTENTE] Non riesco a registrarmi. [...] it**, indicando:
   - Nome e cognome
   - Codice fiscale
   - Motivo della richiesta di assistenza

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 210
   📊 Token totali: 658
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 658 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 210
   📊 Token conversazione finale: 210
   📊 Token totali: 658
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 731 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] Inserire numero impegnative con già appuntamento  [ASSISTENTE] Potresti chiarire meglio la tua richiesta? Intendi dire che desideri sapere come inserire il numero di un'impegnativa per un appuntamento già prenotato? [UTENTE] Si [ASSISTENTE] Per inserire il numero di un'impegnativa per un..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2849 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 210
   📊 Token totali stimati: 658
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] Inserire numero impegnative con già appuntamento  [ASSISTENTE] Potresti chiarire meglio la tua richiesta? Intendi dire che desideri sapere come inserire il numero di un'impegnativa per un appuntamento già prenotato? [UTENTE] Si [ASSISTENTE] Per inserire il numero di un'impegnativa per un..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 327
   📊 Token totali: 755
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 755 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 327
   📊 Token conversazione finale: 327
   📊 Token totali: 755
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1458 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] English please [ASSISTENTE] Sure! How can I assist you today? [UTENTE] Thank you! I am trying to start my log in at Humanitas Comunicazione Sicura but the system doesnt recognize my cell phone number [ASSISTENTE] If the system does not recognize your cell phone number when trying to log ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2800 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 327
   📊 Token totali stimati: 755
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] English please [ASSISTENTE] Sure! How can I assist you today? [UTENTE] Thank you! I am trying to start my log in at Humanitas Comunicazione Sicura but the system doesnt recognize my cell phone number [ASSISTENTE] If the system does not recognize your cell phone number when trying to log ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - priorità problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 454
   💬 Token conversazione: 534
   📊 Token totali: 988
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 988 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 454
   📊 Token conversazione originale: 534
   📊 Token conversazione finale: 534
   📊 Token totali: 988
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1858 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno, non riesco a registrare mio padre al sito per poter poi prenotare [ASSISTENTE] Per registrare tuo padre al sito [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2832 characters
🔢 Token Analysis:
   📊 Token prompt base: 454
   📊 Token conversazione: 534
   📊 Token totali stimati: 988
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - priorità problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno, non riesco a registrare mio padre al sito per poter poi prenotare [ASSISTENTE] Per registrare tuo padre al sito [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 381
   📊 Token totali: 830
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 830 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 381
   📊 Token conversazione finale: 381
   📊 Token totali: 830
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1128 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Vorrei prenotare una visita urologica [ASSISTENTE] Per prenotare una visita urologica presso l'Istituto Clinico Humanitas, puoi utilizzare i seguenti canali di prenotazione:

1. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2788 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 381
   📊 Token totali stimati: 830
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Vorrei prenotare una visita urologica [ASSISTENTE] Per prenotare una visita urologica presso l'Istituto Clinico Humanitas, puoi utilizzare i seguenti canali di prenotazione:

1. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 319
   📊 Token totali: 747
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 747 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 319
   📊 Token conversazione finale: 319
   📊 Token totali: 747
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1078 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao  [ASSISTENTE] Ciao! Come posso esserti utile? 😊 [UTENTE] Si  [ASSISTENTE] Perfetto! Dimmi pure, come posso aiutarti? 😊 [UTENTE] ho prenotato per il 15 settembre con il Dr. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2683 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 319
   📊 Token totali stimati: 747
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao  [ASSISTENTE] Ciao! Come posso esserti utile? 😊 [UTENTE] Si  [ASSISTENTE] Perfetto! Dimmi pure, come posso aiutarti? 😊 [UTENTE] ho prenotato per il 15 settembre con il Dr. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔧 Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
🔍 Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
✅ MongoClassificationReader creato per tenant: Humanitas (humanitas)
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
✅ Connesso a MongoDB database: classificazioni
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🔍 Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
🏷️ Recupero etichette per tenant: Humanitas
📊 Calcolo statistiche per tenant: Humanitas
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 195
   📊 Token totali: 623
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 623 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 195
   📊 Token conversazione finale: 195
   📊 Token totali: 623
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 661 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Dovrei effettuare una enteroscopia con biopsia Humatis effettua questo tipo di prestazione  e il costo in regime privato [ASSISTENTE] Humanitas effettua l'enteroscopia con biopsia, una procedura che consente di esaminare il piccolo intestino e prelevare campioni di tessuto per analisi is..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2779 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 195
   📊 Token totali stimati: 623
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Dovrei effettuare una enteroscopia con biopsia Humatis effettua questo tipo di prestazione  e il costo in regime privato [ASSISTENTE] Humanitas effettua l'enteroscopia con biopsia, una procedura che consente di esaminare il piccolo intestino e prelevare campioni di tessuto per analisi is..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 407
   📊 Token totali: 856
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 856 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 407
   📊 Token conversazione finale: 407
   📊 Token totali: 856
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1204 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno, sono Fava Piera (05/07/48) paziente del cardiologo dr Carlo Ceriotti che mi ha visitata ila Rozzano il 25/06/25 prescrivendo ECOCARDIO di controllo da fare entro 6 mesi x importante patologia. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2851 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 407
   📊 Token totali stimati: 856
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno, sono Fava Piera (05/07/48) paziente del cardiologo dr Carlo Ceriotti che mi ha visitata ila Rozzano il 25/06/25 prescrivendo ECOCARDIO di controllo da fare entro 6 mesi x importante patologia. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 197
   📊 Token totali: 645
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 645 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 197
   📊 Token conversazione finale: 197
   📊 Token totali: 645
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 608 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] cistiscopia [ASSISTENTE] Puoi chiarire meglio la tua richiesta? Intendi sapere:

1. [...]  

Se hai bisogno di ulteriori informazioni o assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2734 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 197
   📊 Token totali stimati: 645
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] cistiscopia [ASSISTENTE] Puoi chiarire meglio la tua richiesta? Intendi sapere:

1. [...]  

Se hai bisogno di ulteriori informazioni o assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 180
   📊 Token totali: 628
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 628 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 180
   📊 Token conversazione finale: 180
   📊 Token totali: 628
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 551 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Dove trovare informazioni per la preparazione di un ecoendoscopia pancreas [ASSISTENTE] Puoi trovare le norme di preparazione per l'ecoendoscopia del pancreas al seguente [link](https://www. [...]  😊"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2780 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 180
   📊 Token totali stimati: 628
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Dove trovare informazioni per la preparazione di un ecoendoscopia pancreas [ASSISTENTE] Puoi trovare le norme di preparazione per l'ecoendoscopia del pancreas al seguente [link](https://www. [...]  😊"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 180
   📊 Token totali: 628
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 628 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 180
   📊 Token conversazione finale: 180
   📊 Token totali: 628
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 604 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Cosa copre esattamente la polizza vita Wopta?"
Output: info_condizioni_polizza
Ragionamento: Richiesta di informazioni sulle condizioni di polizza
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Volevo sapere se ci sono delle indicazioni da seguire dopo aver effettuato una PET globale corporea con Gallio [ASSISTENTE] Dopo aver effettuato una PET globale corporea con Gallio, è importante evitare stretto contatto con donne in gravidanza, in età fertile o con minorenni per motivi d..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2851 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 180
   📊 Token totali stimati: 628
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Cosa copre esattamente la polizza vita Wopta?"
Output: info_condizioni_polizza
Ragionamento: Richiesta di informazioni sulle condizioni di polizza
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Volevo sapere se ci sono delle indicazioni da seguire dopo aver effettuato una PET globale corporea con Gallio [ASSISTENTE] Dopo aver effettuato una PET globale corporea con Gallio, è importante evitare stretto contatto con donne in gravidanza, in età fertile o con minorenni per motivi d..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 94
   📊 Token totali: 522
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 522 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 94
   📊 Token conversazione finale: 94
   📊 Token totali: 522
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 321 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Preparazione per coronografia  [ASSISTENTE] Per la preparazione alla coronarografia, è necessario eseguire l'esame a digiuno e viene effettuato in regime di ricovero. [...] it/visite-ed-esami/coronarografia)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2725 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 94
   📊 Token totali stimati: 522
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Preparazione per coronografia  [ASSISTENTE] Per la preparazione alla coronarografia, è necessario eseguire l'esame a digiuno e viene effettuato in regime di ricovero. [...] it/visite-ed-esami/coronarografia)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 196
   📊 Token totali: 645
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 645 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 196
   📊 Token conversazione finale: 196
   📊 Token totali: 645
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 618 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Cosa copre esattamente la polizza vita Wopta?"
Output: info_condizioni_polizza
Ragionamento: Richiesta di informazioni sulle condizioni di polizza
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] ciao, cosa devo fare per questo esame che faro domani pomeriggio alla Gavazzeni ,tc coronarica e tc di perfusione miocardica [ASSISTENTE] Per la preparazione alla tomografia computerizzata con mezzo di contrasto e studio per perfusione coronarica con stress farmacologico (adenosina o reg..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2835 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 196
   📊 Token totali stimati: 645
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Cosa copre esattamente la polizza vita Wopta?"
Output: info_condizioni_polizza
Ragionamento: Richiesta di informazioni sulle condizioni di polizza
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] ciao, cosa devo fare per questo esame che faro domani pomeriggio alla Gavazzeni ,tc coronarica e tc di perfusione miocardica [ASSISTENTE] Per la preparazione alla tomografia computerizzata con mezzo di contrasto e studio per perfusione coronarica con stress farmacologico (adenosina o reg..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔧 Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
🔍 Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
✅ MongoClassificationReader creato per tenant: Humanitas (humanitas)
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
✅ Connesso a MongoDB database: classificazioni
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🔍 Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
🏷️ Recupero etichette per tenant: Humanitas
📊 Calcolo statistiche per tenant: Humanitas
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 708
   📊 Token totali: 1156
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1156 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 708
   📊 Token conversazione finale: 708
   📊 Token totali: 1156
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 2173 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] devo fare la colonscopia mi dici come mi devo preparare ? hai le norme ? [ASSISTENTE] Certamente! Puoi trovare le norme di preparazione alla colonscopia a questo [link](https://www. [...] it)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2761 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 708
   📊 Token totali stimati: 1156
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] devo fare la colonscopia mi dici come mi devo preparare ? hai le norme ? [ASSISTENTE] Certamente! Puoi trovare le norme di preparazione alla colonscopia a questo [link](https://www. [...] it)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 513
   📊 Token totali: 961
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 961 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 513
   📊 Token conversazione finale: 513
   📊 Token totali: 961
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1694 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "La polizza copre anche viaggi all'estero?"
Output: info_copertura_geografica_assicurazione
Ragionamento: Richiesta informazioni sulla copertura geografica
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Devo fare prelievo di sangue presso Humanitas Via Sardegna. [...] it/info/esami-di-laboratorio/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2647 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 513
   📊 Token totali stimati: 961
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "La polizza copre anche viaggi all'estero?"
Output: info_copertura_geografica_assicurazione
Ragionamento: Richiesta informazioni sulla copertura geografica
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Devo fare prelievo di sangue presso Humanitas Via Sardegna. [...] it/info/esami-di-laboratorio/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 597
   📊 Token totali: 1045
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1045 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 597
   📊 Token conversazione finale: 597
   📊 Token totali: 1045
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1791 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao dovrei prenotare presso il centro di rozzano queste analisi del sangue: VES, PCR, ANA, anticorpi anti DNA, Ab anti ENA, anticorpi anti SSA, SSB, RNP, centromero, Sm, Jo1, Sel 70) Ra test, Ab anti peptidi ciclici citrullinati, uricemia, TSH, Ab anti tireoglobulina, Ab anti tireoperos..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2908 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 597
   📊 Token totali stimati: 1045
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao dovrei prenotare presso il centro di rozzano queste analisi del sangue: VES, PCR, ANA, anticorpi anti DNA, Ab anti ENA, anticorpi anti SSA, SSB, RNP, centromero, Sm, Jo1, Sel 70) Ra test, Ab anti peptidi ciclici citrullinati, uricemia, TSH, Ab anti tireoglobulina, Ab anti tireoperos..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 452
   💬 Token conversazione: 354
   📊 Token totali: 806
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 806 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 452
   📊 Token conversazione originale: 354
   📊 Token conversazione finale: 354
   📊 Token totali: 806
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1099 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta


TESTO DA CLASSIFICARE:
"[UTENTE] Farmacia interna domani? La settimana di Ferragosto a farmacia interna all'Humanitas di Rozzano è chiusa? [ASSISTENTE] La Farmacia dell’Istituto Clinico Humanitas di Rozzano è aperta dal lunedì al venerdì, dalle 8:30 alle 13:00 e dalle 14:00 alle 17:30, esclusi i giorni festivi. Durante ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2837 characters
🔢 Token Analysis:
   📊 Token prompt base: 452
   📊 Token conversazione: 354
   📊 Token totali stimati: 806
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta


TESTO DA CLASSIFICARE:
"[UTENTE] Farmacia interna domani? La settimana di Ferragosto a farmacia interna all'Humanitas di Rozzano è chiusa? [ASSISTENTE] La Farmacia dell’Istituto Clinico Humanitas di Rozzano è aperta dal lunedì al venerdì, dalle 8:30 alle 13:00 e dalle 14:00 alle 17:30, esclusi i giorni festivi. Durante ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 77
   📊 Token totali: 505
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 505 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 77
   📊 Token conversazione finale: 77
   📊 Token totali: 505
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 256 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Vorrei consegnare domani un campione di urine  [ASSISTENTE] Per consegnare un campione di urine, ti consiglio di contattare il numero 0282248230 per ottenere informazioni dettagliate. Se hai bisogno di ulteriori indicazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2736 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 77
   📊 Token totali stimati: 505
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Vorrei consegnare domani un campione di urine  [ASSISTENTE] Per consegnare un campione di urine, ti consiglio di contattare il numero 0282248230 per ottenere informazioni dettagliate. Se hai bisogno di ulteriori indicazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 474
   📊 Token totali: 922
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 922 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 474
   📊 Token conversazione finale: 474
   📊 Token totali: 922
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1553 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Vorrei sapere se sabato 30 settembre 2025 è possibile fare gli esami del sangue Humanitas fiordaliso? [ASSISTENTE] Presso Humanitas Medical Care Rozzano-Fiordaliso, il sabato è possibile effettuare prelievi del sangue dalle 7:30 alle 10:00 solo su prenotazione, e dalle 10:00 alle 11:00 c..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2878 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 474
   📊 Token totali stimati: 922
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Vorrei sapere se sabato 30 settembre 2025 è possibile fare gli esami del sangue Humanitas fiordaliso? [ASSISTENTE] Presso Humanitas Medical Care Rozzano-Fiordaliso, il sabato è possibile effettuare prelievi del sangue dalle 7:30 alle 10:00 solo su prenotazione, e dalle 10:00 alle 11:00 c..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 157
   📊 Token totali: 605
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 605 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 157
   📊 Token conversazione finale: 157
   📊 Token totali: 605
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 492 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online


TESTO DA CLASSIFICARE:
"[UTENTE] Ho bisogno di sapere gli orari di visita dell'ospedale n̈el wek and  [ASSISTENTE] Per visitare i pazienti ricoverati in Humanitas, gli orari di visita possono variare a seconda del reparto. Ti consiglio di consultare le pagine dedicate per maggiori dettagli:

- [Accesso all'Ospedale](htt..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2866 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 157
   📊 Token totali stimati: 605
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online


TESTO DA CLASSIFICARE:
"[UTENTE] Ho bisogno di sapere gli orari di visita dell'ospedale n̈el wek and  [ASSISTENTE] Per visitare i pazienti ricoverati in Humanitas, gli orari di visita possono variare a seconda del reparto. Ti consiglio di consultare le pagine dedicate per maggiori dettagli:

- [Accesso all'Ospedale](htt..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 87
   📊 Token totali: 515
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 515 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 87
   📊 Token conversazione finale: 87
   📊 Token totali: 515
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 279 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali


TESTO DA CLASSIFICARE:
"[UTENTE] a che ore siete aperti? [ASSISTENTE] Gli orari di apertura possono variare a seconda del servizio o del reparto che desideri visitare. Potresti specificare a quale servizio o reparto ti riferisci? Ad esempio, pronto soccorso, ufficio ritiro referti, punti prelievo, ecc."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2790 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 87
   📊 Token totali stimati: 515
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali


TESTO DA CLASSIFICARE:
"[UTENTE] a che ore siete aperti? [ASSISTENTE] Gli orari di apertura possono variare a seconda del servizio o del reparto che desideri visitare. Potresti specificare a quale servizio o reparto ti riferisci? Ad esempio, pronto soccorso, ufficio ritiro referti, punti prelievo, ecc."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 143
   📊 Token totali: 571
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 571 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 143
   📊 Token conversazione finale: 143
   📊 Token totali: 571
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 476 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao , quanto tempo passa da pre ricovero al ricovero?  [ASSISTENTE] Il tempo tra il prericovero e il ricovero dipende dalla valutazione clinica e dalla tipologia di intervento. [...] json】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2697 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 143
   📊 Token totali stimati: 571
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao , quanto tempo passa da pre ricovero al ricovero?  [ASSISTENTE] Il tempo tra il prericovero e il ricovero dipende dalla valutazione clinica e dalla tipologia di intervento. [...] json】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 188
   📊 Token totali: 636
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 636 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 188
   📊 Token conversazione finale: 188
   📊 Token totali: 636
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 663 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] La struttura è convenzionata ma alcuni medici non lo sono Unisalute [ASSISTENTE] Se ti riferisci alla possibilità di prenotare visite o esami con Unisalute, è importante sapere che alcune prestazioni potrebbero essere coperte dalla convenzione, mentre altre no. Inoltre, non tutti i medic..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2848 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 188
   📊 Token totali stimati: 636
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] La struttura è convenzionata ma alcuni medici non lo sono Unisalute [ASSISTENTE] Se ti riferisci alla possibilità di prenotare visite o esami con Unisalute, è importante sapere che alcune prestazioni potrebbero essere coperte dalla convenzione, mentre altre no. Inoltre, non tutti i medic..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 204
   📊 Token totali: 632
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 632 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 204
   📊 Token conversazione finale: 204
   📊 Token totali: 632
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 646 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] vorrei disdire un appuntamento [ASSISTENTE] Per disdire un appuntamento presso Humanitas, puoi seguire queste indicazioni:

1. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2683 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 204
   📊 Token totali stimati: 632
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] vorrei disdire un appuntamento [ASSISTENTE] Per disdire un appuntamento presso Humanitas, puoi seguire queste indicazioni:

1. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 283
   📊 Token totali: 711
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 711 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 283
   📊 Token conversazione finale: 283
   📊 Token totali: 711
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 916 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno Giulia Mi chiamo Valentina 120 Ho prenotato una visita e il breath test al glucosio per mercoledì in viale Premuda ma mi sono accorta Mi sono ricordata che ho mangiato yogurt Quindi vorrei spostarla a settembre mi può aiutare e possibilmente del [ASSISTENTE] Per spostare la tu..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2782 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 283
   📊 Token totali stimati: 711
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno Giulia Mi chiamo Valentina 120 Ho prenotato una visita e il breath test al glucosio per mercoledì in viale Premuda ma mi sono accorta Mi sono ricordata che ho mangiato yogurt Quindi vorrei spostarla a settembre mi può aiutare e possibilmente del [ASSISTENTE] Per spostare la tu..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 166
   📊 Token totali: 594
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 594 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 166
   📊 Token conversazione finale: 166
   📊 Token totali: 594
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 557 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] buongiorno ho fatto una prenotazione di visita oncologica con prof Santoro, ma siccome al sito mi sono iscritta a mio nome risulta a mio nome la prenr, ma sarebbe per mio babbo [ASSISTENTE] Per modificare i dati della prenotazione e associarla al nome corretto, ti consiglio di contattare..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2764 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 166
   📊 Token totali stimati: 594
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] buongiorno ho fatto una prenotazione di visita oncologica con prof Santoro, ma siccome al sito mi sono iscritta a mio nome risulta a mio nome la prenr, ma sarebbe per mio babbo [ASSISTENTE] Per modificare i dati della prenotazione e associarla al nome corretto, ti consiglio di contattare..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 425
   📊 Token totali: 853
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 853 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 425
   📊 Token conversazione finale: 425
   📊 Token totali: 853
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1383 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Ho prenotato un prelievo venoso tramite assicurazione per una data ma dovrei spostare l'appuntamento. [...]  Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2685 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 425
   📊 Token totali stimati: 853
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Ho prenotato un prelievo venoso tramite assicurazione per una data ma dovrei spostare l'appuntamento. [...]  Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 276
   📊 Token totali: 724
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 724 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 276
   📊 Token conversazione finale: 276
   📊 Token totali: 724
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 889 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno  [ASSISTENTE] Buongiorno! Come posso esserti utile? [UTENTE] Volevo sapere se l’appuntamento che mi avete dato per 14 agosto posso farlo il 13 agosto alle 15 [ASSISTENTE] Non ho accesso alle informazioni personali o agli appuntamenti specifici. Per modificare un appuntamento, ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2870 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 276
   📊 Token totali stimati: 724
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno  [ASSISTENTE] Buongiorno! Come posso esserti utile? [UTENTE] Volevo sapere se l’appuntamento che mi avete dato per 14 agosto posso farlo il 13 agosto alle 15 [ASSISTENTE] Non ho accesso alle informazioni personali o agli appuntamenti specifici. Per modificare un appuntamento, ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 176
   📊 Token totali: 625
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 625 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 176
   📊 Token conversazione finale: 176
   📊 Token totali: 625
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 644 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] Devo modificare il numero di cellulare  [ASSISTENTE] Per modificare il numero di cellulare associato al tuo account o ai tuoi dati presso Humanitas, ti consiglio di accedere al portale [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2875 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 176
   📊 Token totali stimati: 625
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] Devo modificare il numero di cellulare  [ASSISTENTE] Per modificare il numero di cellulare associato al tuo account o ai tuoi dati presso Humanitas, ti consiglio di accedere al portale [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 316
   📊 Token totali: 765
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 765 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 316
   📊 Token conversazione finale: 316
   📊 Token totali: 765
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1118 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste


TESTO DA CLASSIFICARE:
"[UTENTE] Buona sera Giulia  [ASSISTENTE] Buona sera! Come posso esserti utile? 😊 [UTENTE] Allora, devo entrare nella sezione referti, però non posso più entrare, perché non ho più il vecchio numero e non posso neppure cambiare il numero ti telefono dal vecchio a quello nuovo, perché giustamente m..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2876 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 316
   📊 Token totali stimati: 765
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste


TESTO DA CLASSIFICARE:
"[UTENTE] Buona sera Giulia  [ASSISTENTE] Buona sera! Come posso esserti utile? 😊 [UTENTE] Allora, devo entrare nella sezione referti, però non posso più entrare, perché non ho più il vecchio numero e non posso neppure cambiare il numero ti telefono dal vecchio a quello nuovo, perché giustamente m..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - priorità problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 454
   💬 Token conversazione: 384
   📊 Token totali: 838
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 838 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 454
   📊 Token conversazione originale: 384
   📊 Token conversazione finale: 384
   📊 Token totali: 838
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1305 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Non ho ricevuto la documentazione della polizza"
Output: problema_amministrativo
Ragionamento: Problemi con documenti o questioni amministrative


TESTO DA CLASSIFICARE:
"[UTENTE] Non riesco a impostare la ricezione di notifiche sull’area referti  [ASSISTENTE] Per impostare la ricezione di notifiche sull’area referti di [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2809 characters
🔢 Token Analysis:
   📊 Token prompt base: 454
   📊 Token conversazione: 384
   📊 Token totali stimati: 838
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - priorità problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Non ho ricevuto la documentazione della polizza"
Output: problema_amministrativo
Ragionamento: Problemi con documenti o questioni amministrative


TESTO DA CLASSIFICARE:
"[UTENTE] Non riesco a impostare la ricezione di notifiche sull’area referti  [ASSISTENTE] Per impostare la ricezione di notifiche sull’area referti di [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 452
   💬 Token conversazione: 93
   📊 Token totali: 545
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 545 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 452
   📊 Token conversazione originale: 93
   📊 Token conversazione finale: 93
   📊 Token totali: 545
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 322 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Hanno sbagliato il mio numero di telefono  [ASSISTENTE] Se il tuo numero di telefono è stato registrato in modo errato, ti consiglio di contattare direttamente il servizio di assistenza o il reparto con cui hai avuto contatti per correggere l'errore. Se hai bisogno di ulteriori dettagli o s..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2811 characters
🔢 Token Analysis:
   📊 Token prompt base: 452
   📊 Token conversazione: 93
   📊 Token totali stimati: 545
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Utente confuso - semplifica classificazione verso problemi tecnici

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Hanno sbagliato il mio numero di telefono  [ASSISTENTE] Se il tuo numero di telefono è stato registrato in modo errato, ti consiglio di contattare direttamente il servizio di assistenza o il reparto con cui hai avuto contatti per correggere l'errore. Se hai bisogno di ulteriori dettagli o s..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 326
   📊 Token totali: 774
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 774 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 326
   📊 Token conversazione finale: 326
   📊 Token totali: 774
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1023 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "La polizza copre anche viaggi all'estero?"
Output: info_copertura_geografica_assicurazione
Ragionamento: Richiesta informazioni sulla copertura geografica
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno, volevo sapere che esami devo fare per prepararmi all' angio tac coronaricaù [ASSISTENTE] Per sapere quali esami o preparazioni sono necessari per un'angio TAC coronarica, ti consiglio di consultare il tuo medico di fiducia o il medico che ti ha prescritto l'esame. Non posso f..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2881 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 326
   📊 Token totali stimati: 774
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "La polizza copre anche viaggi all'estero?"
Output: info_copertura_geografica_assicurazione
Ragionamento: Richiesta informazioni sulla copertura geografica
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno, volevo sapere che esami devo fare per prepararmi all' angio tac coronaricaù [ASSISTENTE] Per sapere quali esami o preparazioni sono necessari per un'angio TAC coronarica, ti consiglio di consultare il tuo medico di fiducia o il medico che ti ha prescritto l'esame. Non posso f..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 85
   📊 Token totali: 513
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 513 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 85
   📊 Token conversazione finale: 85
   📊 Token totali: 513
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 278 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] zyclara [ASSISTENTE] Non ho trovato informazioni specifiche su "Zyclara" nei documenti forniti. Se hai bisogno di dettagli su un farmaco o un trattamento, ti consiglio di consultare il tuo medico o farmacista di fiducia. Se hai ulteriori domande, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2778 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 85
   📊 Token totali stimati: 513
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] zyclara [ASSISTENTE] Non ho trovato informazioni specifiche su "Zyclara" nei documenti forniti. Se hai bisogno di dettagli su un farmaco o un trattamento, ti consiglio di consultare il tuo medico o farmacista di fiducia. Se hai ulteriori domande, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 101
   📊 Token totali: 549
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 549 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 101
   📊 Token conversazione finale: 101
   📊 Token totali: 549
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 339 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Nervo pudendo  [ASSISTENTE] Non ho trovato informazioni specifiche sul nervo pudendo nei documenti caricati. [...]  Se posso esserti utile in altro, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2727 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 101
   📊 Token totali stimati: 549
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Nervo pudendo  [ASSISTENTE] Non ho trovato informazioni specifiche sul nervo pudendo nei documenti caricati. [...]  Se posso esserti utile in altro, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 126
   📊 Token totali: 574
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 574 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 126
   📊 Token conversazione finale: 126
   📊 Token totali: 574
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 423 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Cosa copre esattamente la polizza vita Wopta?"
Output: info_condizioni_polizza
Ragionamento: Richiesta di informazioni sulle condizioni di polizza
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] per l'impegnativa per per il prericovero Cosa bisogna scrivere come dicitura [ASSISTENTE] Per sapere cosa scrivere come dicitura sull'impegnativa per il prericovero, ti consiglio di consultare il tuo medico di base o lo specialista che ti ha prescritto il ricovero. Saranno loro a indicar..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2883 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 126
   📊 Token totali stimati: 574
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Cosa copre esattamente la polizza vita Wopta?"
Output: info_condizioni_polizza
Ragionamento: Richiesta di informazioni sulle condizioni di polizza
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] per l'impegnativa per per il prericovero Cosa bisogna scrivere come dicitura [ASSISTENTE] Per sapere cosa scrivere come dicitura sull'impegnativa per il prericovero, ti consiglio di consultare il tuo medico di base o lo specialista che ti ha prescritto il ricovero. Saranno loro a indicar..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 608
   📊 Token totali: 1057
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1057 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 608
   📊 Token conversazione finale: 608
   📊 Token totali: 1057
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 2063 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Ho mal di pancia e sto cercando cosa fare [ASSISTENTE] Come assistente digitale di Humanitas, il mio scopo è fornire informazioni di carattere generale e notizie inerenti l’ospedale. Per il tuo mal di pancia, ti consiglio di rivolgerti al tuo medico di fiducia o al tuo medico di Medicina..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2836 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 608
   📊 Token totali stimati: 1057
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Ho mal di pancia e sto cercando cosa fare [ASSISTENTE] Come assistente digitale di Humanitas, il mio scopo è fornire informazioni di carattere generale e notizie inerenti l’ospedale. Per il tuo mal di pancia, ti consiglio di rivolgerti al tuo medico di fiducia o al tuo medico di Medicina..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 591
   📊 Token totali: 1040
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1040 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 591
   📊 Token conversazione finale: 591
   📊 Token totali: 1040
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1862 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Ginecomastia [UTENTE] uomo [ASSISTENTE] Ciao! Sono Giulia, l’assistente digitale dell’Istituto Clinico Humanitas. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2692 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 591
   📊 Token totali stimati: 1040
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Ginecomastia [UTENTE] uomo [ASSISTENTE] Ciao! Sono Giulia, l’assistente digitale dell’Istituto Clinico Humanitas. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 475
   📊 Token totali: 903
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 903 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 475
   📊 Token conversazione finale: 475
   📊 Token totali: 903
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 2111 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "La polizza copre anche viaggi all'estero?"
Output: info_copertura_geografica_assicurazione
Ragionamento: Richiesta informazioni sulla copertura geografica
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] hello [ASSISTENTE] Hello! How can I assist you today? [UTENTE] Do you provide alcoholism treatment? [ASSISTENTE] To determine if Humanitas provides treatment for alcoholism, I will need to check the available information. Please give me a moment.Humanitas provides treatment for condition..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2816 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 475
   📊 Token totali stimati: 903
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "La polizza copre anche viaggi all'estero?"
Output: info_copertura_geografica_assicurazione
Ragionamento: Richiesta informazioni sulla copertura geografica
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] hello [ASSISTENTE] Hello! How can I assist you today? [UTENTE] Do you provide alcoholism treatment? [ASSISTENTE] To determine if Humanitas provides treatment for alcoholism, I will need to check the available information. Please give me a moment.Humanitas provides treatment for condition..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta priorità massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 447
   💬 Token conversazione: 115
   📊 Token totali: 562
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 562 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 447
   📊 Token conversazione originale: 115
   📊 Token conversazione finale: 115
   📊 Token totali: 562
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 385 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Cosa copre esattamente la polizza vita Wopta?"
Output: info_condizioni_polizza
Ragionamento: Richiesta di informazioni sulle condizioni di polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao Giulia, cosa vuol dire ICE? [ASSISTENTE] "ICE" è l'acronimo di "In Case of Emergency" (in caso di emergenza). [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2772 characters
🔢 Token Analysis:
   📊 Token prompt base: 447
   📊 Token conversazione: 115
   📊 Token totali stimati: 562
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta priorità massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Cosa copre esattamente la polizza vita Wopta?"
Output: info_condizioni_polizza
Ragionamento: Richiesta di informazioni sulle condizioni di polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao Giulia, cosa vuol dire ICE? [ASSISTENTE] "ICE" è l'acronimo di "In Case of Emergency" (in caso di emergenza). [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 268
   📊 Token totali: 717
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 717 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 268
   📊 Token conversazione finale: 268
   📊 Token totali: 717
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 778 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] devo prenotare in humanitas con ssn. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2646 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 268
   📊 Token totali stimati: 717
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] devo prenotare in humanitas con ssn. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

   📈 Progresso LLM: 50/173
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 311
   📊 Token totali: 759
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 759 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 311
   📊 Token conversazione finale: 311
   📊 Token totali: 759
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 945 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Non ho ricevuto la documentazione della polizza"
Output: problema_amministrativo
Ragionamento: Problemi con documenti o questioni amministrative
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Buonasera, avrei bisogno di sapere per mia mamma se possibile fare una RM addome sup senza e con MDC per gennaio, in convenzione ssn grazie  [ASSISTENTE] Per prenotare una Risonanza Magnetica (RM) dell'addome superiore senza e con mezzo di contrasto (MDC) in convenzione con il Servizio S..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2866 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 311
   📊 Token totali stimati: 759
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Non ho ricevuto la documentazione della polizza"
Output: problema_amministrativo
Ragionamento: Problemi con documenti o questioni amministrative
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Buonasera, avrei bisogno di sapere per mia mamma se possibile fare una RM addome sup senza e con MDC per gennaio, in convenzione ssn grazie  [ASSISTENTE] Per prenotare una Risonanza Magnetica (RM) dell'addome superiore senza e con mezzo di contrasto (MDC) in convenzione con il Servizio S..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 124
   📊 Token totali: 573
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 573 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 124
   📊 Token conversazione finale: 124
   📊 Token totali: 573
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 434 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] è possibile eseguire una visita dermatologica in ssn a Castellanza? [ASSISTENTE] Sì, è possibile eseguire una visita dermatologica tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater Domini a Castellanza. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2832 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 124
   📊 Token totali stimati: 573
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] è possibile eseguire una visita dermatologica in ssn a Castellanza? [ASSISTENTE] Sì, è possibile eseguire una visita dermatologica tramite il Servizio Sanitario Nazionale (SSN) presso Humanitas Mater Domini a Castellanza. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 1502
   📊 Token totali: 1950
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1950 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 1502
   📊 Token conversazione finale: 1502
   📊 Token totali: 1950
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 4728 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] ciao giulia [ASSISTENTE] Ciao! Come posso esserti utile oggi? 😊 [UTENTE] vorrei prenotare una colonscopia ma l'attesa telefonica è troppo lunga e non ci sono posti [ASSISTENTE] Capisco la tua situazione. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2775 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 1502
   📊 Token totali stimati: 1950
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] ciao giulia [ASSISTENTE] Ciao! Come posso esserti utile oggi? 😊 [UTENTE] vorrei prenotare una colonscopia ma l'attesa telefonica è troppo lunga e non ci sono posti [ASSISTENTE] Capisco la tua situazione. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 640
   📊 Token totali: 1088
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1088 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 640
   📊 Token conversazione finale: 640
   📊 Token totali: 1088
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1975 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] Dopo attesa di oltre 30 min ê caduta la linea. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2627 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 640
   📊 Token totali stimati: 1088
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] Dopo attesa di oltre 30 min ê caduta la linea. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 243
   📊 Token totali: 691
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 691 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 243
   📊 Token conversazione finale: 243
   📊 Token totali: 691
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 800 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali


TESTO DA CLASSIFICARE:
"[UTENTE] Vorrei informazioni sui tempi d’attesa del mio ricovero in urologia  [ASSISTENTE] Non ho accesso diretto alle informazioni personali o ai tempi di attesa specifici per i ricoveri. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2843 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 243
   📊 Token totali stimati: 691
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali


TESTO DA CLASSIFICARE:
"[UTENTE] Vorrei informazioni sui tempi d’attesa del mio ricovero in urologia  [ASSISTENTE] Non ho accesso diretto alle informazioni personali o ai tempi di attesa specifici per i ricoveri. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 567
   📊 Token totali: 1016
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1016 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 567
   📊 Token conversazione finale: 567
   📊 Token totali: 1016
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1748 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno Giulia mi riferimento il Sig. [...] 

Se ha bisogno di ulteriore assistenza, sono qui per aiutarla!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2655 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 567
   📊 Token totali stimati: 1016
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno Giulia mi riferimento il Sig. [...] 

Se ha bisogno di ulteriore assistenza, sono qui per aiutarla!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 521
   📊 Token totali: 969
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 969 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 521
   📊 Token conversazione finale: 521
   📊 Token totali: 969
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1612 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno,  ho avuto un piccolo intervento alle ginocchia il 9 luglio 2025. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2696 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 521
   📊 Token totali stimati: 969
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno,  ho avuto un piccolo intervento alle ginocchia il 9 luglio 2025. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 240
   📊 Token totali: 668
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 668 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 240
   📊 Token conversazione finale: 240
   📊 Token totali: 668
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 809 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao Giulia noi a noi è stato dato con le dimissioni protette di mio padre Fanara Giulio è stato consegnato un letto con materasso antidecubito sedia a rotelle e un deambulatore non sappiamo a chi rivolgersi per poterli riconsegnare adesso che mio papà è s [ASSISTENTE] Mi dispiace per la..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2783 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 240
   📊 Token totali stimati: 668
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao Giulia noi a noi è stato dato con le dimissioni protette di mio padre Fanara Giulio è stato consegnato un letto con materasso antidecubito sedia a rotelle e un deambulatore non sappiamo a chi rivolgersi per poterli riconsegnare adesso che mio papà è s [ASSISTENTE] Mi dispiace per la..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 310
   📊 Token totali: 758
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 758 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 310
   📊 Token conversazione finale: 310
   📊 Token totali: 758
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1069 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno, sono Barbara Capone di Napoli la nipote di un paziente ricoverato d'urgenza Giuseppe Capone, ora spostato nel reparto di Pneumologia in stato di elevata gravità. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2813 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 310
   📊 Token totali stimati: 758
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno, sono Barbara Capone di Napoli la nipote di un paziente ricoverato d'urgenza Giuseppe Capone, ora spostato nel reparto di Pneumologia in stato di elevata gravità. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 262
   📊 Token totali: 690
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 690 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 262
   📊 Token conversazione finale: 262
   📊 Token totali: 690
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 886 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Avrei bisogno di una cartella clinica  [ASSISTENTE] Puoi richiedere la cartella clinica dei ricoveri svolti presso l'Istituto Clinico Humanitas in diversi modi:

1. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2743 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 262
   📊 Token totali stimati: 690
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Avrei bisogno di una cartella clinica  [ASSISTENTE] Puoi richiedere la cartella clinica dei ricoveri svolti presso l'Istituto Clinico Humanitas in diversi modi:

1. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 375
   📊 Token totali: 824
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 824 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 375
   📊 Token conversazione finale: 375
   📊 Token totali: 824
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1296 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] Come ritirare il referto di mia figlia minorenne? [ASSISTENTE] Per ritirare il referto di tua figlia minorenne, è necessario seguire queste indicazioni:

1. [...]  

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2810 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 375
   📊 Token totali stimati: 824
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] Come ritirare il referto di mia figlia minorenne? [ASSISTENTE] Per ritirare il referto di tua figlia minorenne, è necessario seguire queste indicazioni:

1. [...]  

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 841
   📊 Token totali: 1289
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1289 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 841
   📊 Token conversazione finale: 841
   📊 Token totali: 1289
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 2744 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi


TESTO DA CLASSIFICARE:
"[UTENTE] Buon pomeriggio [ASSISTENTE] Buon pomeriggio! Come posso esserti utile? [UTENTE] Vorrei sapere come poter richiedere la cartella clinica di mio padre inerente al suo ricovero al centro di riabilitazione Building 8 dal 17 ottobre 2024 al 26 maggio 2025 [ASSISTENTE] Per richiedere la carte..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2857 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 841
   📊 Token totali stimati: 1289
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi


TESTO DA CLASSIFICARE:
"[UTENTE] Buon pomeriggio [ASSISTENTE] Buon pomeriggio! Come posso esserti utile? [UTENTE] Vorrei sapere come poter richiedere la cartella clinica di mio padre inerente al suo ricovero al centro di riabilitazione Building 8 dal 17 ottobre 2024 al 26 maggio 2025 [ASSISTENTE] Per richiedere la carte..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 683
   📊 Token totali: 1132
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1132 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 683
   📊 Token conversazione finale: 683
   📊 Token totali: 1132
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 2399 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online


TESTO DA CLASSIFICARE:
"[UTENTE] buongiorno Senta io sono stato dimesso vediamo un po' 19:20 martedì 22 maggio Adesso io voglio richiedere la cartella clinica e mi chiede nel seguendola la prassi succede solo a Pegaso che parla io no no come faccio ad avere la cartella clinica [ASSISTENTE] Puoi richiedere la cartella cl..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2841 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 683
   📊 Token totali stimati: 1132
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online


TESTO DA CLASSIFICARE:
"[UTENTE] buongiorno Senta io sono stato dimesso vediamo un po' 19:20 martedì 22 maggio Adesso io voglio richiedere la cartella clinica e mi chiede nel seguendola la prassi succede solo a Pegaso che parla io no no come faccio ad avere la cartella clinica [ASSISTENTE] Puoi richiedere la cartella cl..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 397
   📊 Token totali: 846
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 846 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 397
   📊 Token conversazione finale: 397
   📊 Token totali: 846
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1280 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] ciao [ASSISTENTE] Ciao! Come posso esserti utile oggi? 😊 [UTENTE] devo ritirare copia esami [ASSISTENTE] Per ritirare una copia degli esami, puoi seguire queste indicazioni:

1. [...]  

Posso aiutarti in altro? 😊"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2788 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 397
   📊 Token totali stimati: 846
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] ciao [ASSISTENTE] Ciao! Come posso esserti utile oggi? 😊 [UTENTE] devo ritirare copia esami [ASSISTENTE] Per ritirare una copia degli esami, puoi seguire queste indicazioni:

1. [...]  

Posso aiutarti in altro? 😊"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 168
   📊 Token totali: 616
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 616 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 168
   📊 Token conversazione finale: 168
   📊 Token totali: 616
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 557 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Volevo sapere se a Rozzano effettuano la brachiterapia [ASSISTENTE] Sì, presso l'Istituto Clinico Humanitas di Rozzano è possibile effettuare trattamenti di radioterapia e radiochirurgia, che includono tecniche avanzate come la brachiterapia per specifiche patologie. [...] json】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2830 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 168
   📊 Token totali stimati: 616
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Volevo sapere se a Rozzano effettuano la brachiterapia [ASSISTENTE] Sì, presso l'Istituto Clinico Humanitas di Rozzano è possibile effettuare trattamenti di radioterapia e radiochirurgia, che includono tecniche avanzate come la brachiterapia per specifiche patologie. [...] json】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 295
   📊 Token totali: 743
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 743 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 295
   📊 Token conversazione finale: 295
   📊 Token totali: 743
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1024 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] Catarata  [ASSISTENTE] La cataratta è una patologia oculare caratterizzata dall'opacizzazione del cristallino, la lente naturale dell'occhio, che porta a una progressiva riduzione della vista. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2772 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 295
   📊 Token totali stimati: 743
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] Catarata  [ASSISTENTE] La cataratta è una patologia oculare caratterizzata dall'opacizzazione del cristallino, la lente naturale dell'occhio, che porta a una progressiva riduzione della vista. [...] it/info/prenotazioni/)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 375
   📊 Token totali: 803
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 803 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 375
   📊 Token conversazione finale: 375
   📊 Token totali: 803
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1248 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] termoablazione a radiofrequenza [ASSISTENTE] La termoablazione a radiofrequenza è una tecnica utilizzata per trattare tumori in fase precoce o di piccole dimensioni, come quelli al fegato o ai reni. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2740 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 375
   📊 Token totali stimati: 803
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] termoablazione a radiofrequenza [ASSISTENTE] La termoablazione a radiofrequenza è una tecnica utilizzata per trattare tumori in fase precoce o di piccole dimensioni, come quelli al fegato o ai reni. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 389
   📊 Token totali: 837
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 837 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 389
   📊 Token conversazione finale: 389
   📊 Token totali: 837
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1204 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] buonasera [ASSISTENTE] Buonasera! Come posso esserti utile? [UTENTE] dovrei effettuare una quadrectomia+bls [UTENTE] in regime assicurato [ASSISTENTE] La quadrectomia è un intervento chirurgico che riguarda la rimozione di una parte del tessuto mammario, spesso associata al trattamento d..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2865 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 389
   📊 Token totali stimati: 837
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] buonasera [ASSISTENTE] Buonasera! Come posso esserti utile? [UTENTE] dovrei effettuare una quadrectomia+bls [UTENTE] in regime assicurato [ASSISTENTE] La quadrectomia è un intervento chirurgico che riguarda la rimozione di una parte del tessuto mammario, spesso associata al trattamento d..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - priorità problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 454
   💬 Token conversazione: 260
   📊 Token totali: 714
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 714 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 454
   📊 Token conversazione originale: 260
   📊 Token conversazione finale: 260
   📊 Token totali: 714
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 824 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Non riesco a registrami su Humanitas con te [ASSISTENTE] Per registrarti su [Humanitas con te](https://www. [...] docx】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2708 characters
🔢 Token Analysis:
   📊 Token prompt base: 454
   📊 Token conversazione: 260
   📊 Token totali stimati: 714
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - priorità problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Non riesco a registrami su Humanitas con te [ASSISTENTE] Per registrarti su [Humanitas con te](https://www. [...] docx】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 430
   📊 Token totali: 878
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 878 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 430
   📊 Token conversazione finale: 430
   📊 Token totali: 878
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1423 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao Giulia, come posso registrarmi al vostro portale? [ASSISTENTE] Per registrarti al portale [Humanitas con te](https://www. [...]  Buona giornata! 😊"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2727 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 430
   📊 Token totali stimati: 878
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao Giulia, come posso registrarmi al vostro portale? [ASSISTENTE] Per registrarti al portale [Humanitas con te](https://www. [...]  Buona giornata! 😊"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - priorità problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 454
   💬 Token conversazione: 368
   📊 Token totali: 822
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 822 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 454
   📊 Token conversazione originale: 368
   📊 Token conversazione finale: 368
   📊 Token totali: 822
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1178 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Non riesco ad accedere ne registrarmi al servizio  [ASSISTENTE] Se riscontri problemi con la registrazione o l'accesso al portale [Humanitas con te](https://www. [...] it/info/humanitas-con-te)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2782 characters
🔢 Token Analysis:
   📊 Token prompt base: 454
   📊 Token conversazione: 368
   📊 Token totali stimati: 822
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - priorità problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Non riesco ad accedere ne registrarmi al servizio  [ASSISTENTE] Se riscontri problemi con la registrazione o l'accesso al portale [Humanitas con te](https://www. [...] it/info/humanitas-con-te)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 231
   📊 Token totali: 680
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 680 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 231
   📊 Token conversazione finale: 231
   📊 Token totali: 680
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 775 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao dovrei fare la registrazione per poi scaricare i referti delle visite che ho fatto come devo fare [ASSISTENTE] Per registrarti al portale [Humanitas con te](https://www. [...] docx】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2764 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 231
   📊 Token totali stimati: 680
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao dovrei fare la registrazione per poi scaricare i referti delle visite che ho fatto come devo fare [ASSISTENTE] Per registrarti al portale [Humanitas con te](https://www. [...] docx】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta priorità massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 447
   💬 Token conversazione: 221
   📊 Token totali: 668
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 668 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 447
   📊 Token conversazione originale: 221
   📊 Token conversazione finale: 221
   📊 Token totali: 668
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 771 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale


TESTO DA CLASSIFICARE:
"[UTENTE] Ho bisogno di sapere il mio codice ID Humanitas con te [ASSISTENTE] Per recuperare l’ID di [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2737 characters
🔢 Token Analysis:
   📊 Token prompt base: 447
   📊 Token conversazione: 221
   📊 Token totali stimati: 668
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta priorità massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale


TESTO DA CLASSIFICARE:
"[UTENTE] Ho bisogno di sapere il mio codice ID Humanitas con te [ASSISTENTE] Per recuperare l’ID di [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 115
   📊 Token totali: 563
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 563 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 115
   📊 Token conversazione finale: 115
   📊 Token totali: 563
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 393 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Cosa copre esattamente la polizza vita Wopta?"
Output: info_condizioni_polizza
Ragionamento: Richiesta di informazioni sulle condizioni di polizza
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Mi è arrivato il messaggio che è pronto il referto ma cosa mi serve per ritirarlo? [ASSISTENTE] Per ritirare il referto, ti servirà il tagliando di promemoria ritiro referto rilasciato al momento dell’accettazione (sia al totem che allo sportello). Questo tagliando contiene l'ID necessar..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2880 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 115
   📊 Token totali stimati: 563
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Cosa copre esattamente la polizza vita Wopta?"
Output: info_condizioni_polizza
Ragionamento: Richiesta di informazioni sulle condizioni di polizza
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Mi è arrivato il messaggio che è pronto il referto ma cosa mi serve per ritirarlo? [ASSISTENTE] Per ritirare il referto, ti servirà il tagliando di promemoria ritiro referto rilasciato al momento dell’accettazione (sia al totem che allo sportello). Questo tagliando contiene l'ID necessar..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 1063
   📊 Token totali: 1491
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1491 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 1063
   📊 Token conversazione finale: 1063
   📊 Token totali: 1491
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 3525 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno dovrei richiedere il referto di una TAC del 28 febbraio 2025 sono Pedroli Marisa ma non ho il messaggio con il querrecode sa come posso fare gay [ASSISTENTE] Per richiedere il referto della TAC, puoi accedere al portale [Humanitas con te](https://www.humanitasconte.it). Se non..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2785 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 1063
   📊 Token totali stimati: 1491
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno dovrei richiedere il referto di una TAC del 28 febbraio 2025 sono Pedroli Marisa ma non ho il messaggio con il querrecode sa come posso fare gay [ASSISTENTE] Per richiedere il referto della TAC, puoi accedere al portale [Humanitas con te](https://www.humanitasconte.it). Se non..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 274
   📊 Token totali: 723
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 723 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 274
   📊 Token conversazione finale: 274
   📊 Token totali: 723
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 988 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste


TESTO DA CLASSIFICARE:
"[UTENTE] ho bisogno di recuperare il mio ID Huawei [ASSISTENTE] Non posso aiutarti con il recupero dell'ID Huawei, in quanto mi occupo esclusivamente di informazioni relative all'Istituto Clinico Humanitas. [...] it, indicando nome, cognome, codice fiscale e motivo della richiesta di assistenza"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2861 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 274
   📊 Token totali stimati: 723
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste


TESTO DA CLASSIFICARE:
"[UTENTE] ho bisogno di recuperare il mio ID Huawei [ASSISTENTE] Non posso aiutarti con il recupero dell'ID Huawei, in quanto mi occupo esclusivamente di informazioni relative all'Istituto Clinico Humanitas. [...] it, indicando nome, cognome, codice fiscale e motivo della richiesta di assistenza"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 284
   📊 Token totali: 732
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 732 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 284
   📊 Token conversazione finale: 284
   📊 Token totali: 732
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 964 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] Sono  Bove Marianna  devo scaricare cartelle cliniche ma quando inserisco il codice id mi dice il dato inserito non è corretto, prego ricontrollare. [...]  Se hai bisogno di ulteriore assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2783 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 284
   📊 Token totali stimati: 732
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] Sono  Bove Marianna  devo scaricare cartelle cliniche ma quando inserisco il codice id mi dice il dato inserito non è corretto, prego ricontrollare. [...]  Se hai bisogno di ulteriore assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 181
   📊 Token totali: 629
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 629 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 181
   📊 Token conversazione finale: 181
   📊 Token totali: 629
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 692 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao,vorrei sapere se ci sono degli incontri gratuiti dove spiegano tutto il percorso di inseminazione assistita,con ginecologi,psicologi [ASSISTENTE] Per quanto riguarda il percorso di inseminazione assistita, Humanitas offre un Fertility Center specializzato in procreazione medicalment..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2810 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 181
   📊 Token totali stimati: 629
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao,vorrei sapere se ci sono degli incontri gratuiti dove spiegano tutto il percorso di inseminazione assistita,con ginecologi,psicologi [ASSISTENTE] Per quanto riguarda il percorso di inseminazione assistita, Humanitas offre un Fertility Center specializzato in procreazione medicalment..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 396
   📊 Token totali: 824
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 824 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 396
   📊 Token conversazione finale: 396
   📊 Token totali: 824
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1212 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] PMA quali prestazioni? [ASSISTENTE] Le prestazioni di Procreazione Medicalmente Assistita (PMA) offerte presso Humanitas includono:

1. [...] it/centri/fertility-center)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2678 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 396
   📊 Token totali stimati: 824
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] PMA quali prestazioni? [ASSISTENTE] Le prestazioni di Procreazione Medicalmente Assistita (PMA) offerte presso Humanitas includono:

1. [...] it/centri/fertility-center)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 697
   📊 Token totali: 1145
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1145 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 697
   📊 Token conversazione finale: 697
   📊 Token totali: 1145
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 2276 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] ciao! ho bisogno di informazioni sulla crioconservazione degli ovociti [ASSISTENTE] La crioconservazione degli ovociti è una tecnica che consente di preservare la fertilità congelando gli ovociti in azoto liquido. [...] 

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2792 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 697
   📊 Token totali stimati: 1145
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] ciao! ho bisogno di informazioni sulla crioconservazione degli ovociti [ASSISTENTE] La crioconservazione degli ovociti è una tecnica che consente di preservare la fertilità congelando gli ovociti in azoto liquido. [...] 

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 927
   📊 Token totali: 1375
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1375 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 927
   📊 Token conversazione finale: 927
   📊 Token totali: 1375
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 3113 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] informazioni su p,a omologa [ASSISTENTE] Non ho trovato informazioni specifiche sulla "P. [...]  Se desideri ulteriori informazioni sui percorsi di PMA eterologa presso Humanitas, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2741 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 927
   📊 Token totali stimati: 1375
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] informazioni su p,a omologa [ASSISTENTE] Non ho trovato informazioni specifiche sulla "P. [...]  Se desideri ulteriori informazioni sui percorsi di PMA eterologa presso Humanitas, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 124
   📊 Token totali: 572
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 572 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 124
   📊 Token conversazione finale: 124
   📊 Token totali: 572
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 388 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno vorrei sapere se fate l'esame ANTICORPI ANTI PIASTRINE TEST DIRETTO [ASSISTENTE] Non ho trovato informazioni specifiche sull'esame "ANTICORPI ANTI PIASTRINE TEST DIRETTO" nei documenti forniti. [...]  Se hai bisogno di ulteriori dettagli o assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2837 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 124
   📊 Token totali stimati: 572
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno vorrei sapere se fate l'esame ANTICORPI ANTI PIASTRINE TEST DIRETTO [ASSISTENTE] Non ho trovato informazioni specifiche sull'esame "ANTICORPI ANTI PIASTRINE TEST DIRETTO" nei documenti forniti. [...]  Se hai bisogno di ulteriori dettagli o assistenza, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 332
   📊 Token totali: 760
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 760 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 332
   📊 Token conversazione finale: 332
   📊 Token totali: 760
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1136 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno eseguite esame del sangue per allergia nickel? [ASSISTENTE] Non ho trovato informazioni specifiche sull'esecuzione di un esame del sangue per l'allergia al nichel presso Humanitas. [...] it/malattie/allergia-al-nichel)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2702 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 332
   📊 Token totali stimati: 760
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno eseguite esame del sangue per allergia nickel? [ASSISTENTE] Non ho trovato informazioni specifiche sull'esecuzione di un esame del sangue per l'allergia al nichel presso Humanitas. [...] it/malattie/allergia-al-nichel)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 138
   📊 Token totali: 566
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 566 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 138
   📊 Token conversazione finale: 138
   📊 Token totali: 566
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 430 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] humanitas effettua l'holter cardiaco di 20 giorni? [ASSISTENTE] Non ho trovato informazioni specifiche sull'Holter cardiaco di 20 giorni presso Humanitas. [...] it/pazienti/diagnosi/esami-del-cuore-e-vascolari/7952-elettrocardiogramma)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2724 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 138
   📊 Token totali stimati: 566
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] humanitas effettua l'holter cardiaco di 20 giorni? [ASSISTENTE] Non ho trovato informazioni specifiche sull'Holter cardiaco di 20 giorni presso Humanitas. [...] it/pazienti/diagnosi/esami-del-cuore-e-vascolari/7952-elettrocardiogramma)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 400
   📊 Token totali: 848
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 848 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 400
   📊 Token conversazione finale: 400
   📊 Token totali: 848
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1288 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] buongiorno, come posso sapere se certi tipi di esami del sangue vengono fatti c'o vostra struttura [ASSISTENTE] Per sapere se un determinato esame del sangue viene effettuato presso la nostra struttura, posso verificare per te. Puoi dirmi il nome specifico dell'esame del sangue che ti in..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2855 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 400
   📊 Token totali stimati: 848
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] buongiorno, come posso sapere se certi tipi di esami del sangue vengono fatti c'o vostra struttura [ASSISTENTE] Per sapere se un determinato esame del sangue viene effettuato presso la nostra struttura, posso verificare per te. Puoi dirmi il nome specifico dell'esame del sangue che ti in..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 137
   📊 Token totali: 585
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 585 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 137
   📊 Token conversazione finale: 137
   📊 Token totali: 585
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 466 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online


TESTO DA CLASSIFICARE:
"[UTENTE] Oggi si possono fare esami del sangue all' Humanitas di Rozzano? [ASSISTENTE] Per sapere se oggi è possibile effettuare esami del sangue presso l'Humanitas di Rozzano, ti consiglio di contattare direttamente il punto prelievi. Puoi trovare tutte le informazioni sui punti prelievi e gli o..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2866 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 137
   📊 Token totali stimati: 585
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online


TESTO DA CLASSIFICARE:
"[UTENTE] Oggi si possono fare esami del sangue all' Humanitas di Rozzano? [ASSISTENTE] Per sapere se oggi è possibile effettuare esami del sangue presso l'Humanitas di Rozzano, ti consiglio di contattare direttamente il punto prelievi. Puoi trovare tutte le informazioni sui punti prelievi e gli o..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 211
   📊 Token totali: 659
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 659 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 211
   📊 Token conversazione finale: 211
   📊 Token totali: 659
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 637 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno volevo sapere se eseguire il seguente esame  anticorpi anti cardiolipina (IGG,IGM,IGN) Grazie  [ASSISTENTE] Sì, presso Humanitas è possibile eseguire il test per gli anticorpi anti-cardiolipina (IgG, IgM, IgA). [...] json】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2814 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 211
   📊 Token totali stimati: 659
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno volevo sapere se eseguire il seguente esame  anticorpi anti cardiolipina (IGG,IGM,IGN) Grazie  [ASSISTENTE] Sì, presso Humanitas è possibile eseguire il test per gli anticorpi anti-cardiolipina (IgG, IgM, IgA). [...] json】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 240
   📊 Token totali: 689
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 689 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 240
   📊 Token conversazione finale: 240
   📊 Token totali: 689
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 728 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno, vorrei prenotare un esame per la frammentazione del DNA spermatico [ASSISTENTE] Per prenotare un esame per la frammentazione del DNA spermatico, ti consiglio di contattare direttamente il Fertility Center di Humanitas. Questo esame, come il TUNEL, SCSA o HALO, è utilizzato pe..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2843 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 240
   📊 Token totali stimati: 689
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno, vorrei prenotare un esame per la frammentazione del DNA spermatico [ASSISTENTE] Per prenotare un esame per la frammentazione del DNA spermatico, ti consiglio di contattare direttamente il Fertility Center di Humanitas. Questo esame, come il TUNEL, SCSA o HALO, è utilizzato pe..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 167
   📊 Token totali: 595
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 595 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 167
   📊 Token conversazione finale: 167
   📊 Token totali: 595
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 491 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] dove si esegue esame pet [ASSISTENTE] L'esame PET (Tomografia a Emissione di Positroni) viene eseguito presso l'Unità Operativa di Medicina Nucleare dell'Istituto Clinico Humanitas. [...] json】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2702 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 167
   📊 Token totali stimati: 595
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] dove si esegue esame pet [ASSISTENTE] L'esame PET (Tomografia a Emissione di Positroni) viene eseguito presso l'Unità Operativa di Medicina Nucleare dell'Istituto Clinico Humanitas. [...] json】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 343
   📊 Token totali: 792
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 792 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 343
   📊 Token conversazione finale: 343
   📊 Token totali: 792
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1170 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] Devo richiedere la cartella clinica  [ASSISTENTE] Puoi richiedere il rilascio delle cartelle cliniche dei ricoveri svolti presso l'Istituto Clinico Humanitas online dall’area referti di [Humanitas con te](https://www.humanitasconte.it). Se sei in struttura, puoi rivolgerti all'Ufficio Ri..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2866 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 343
   📊 Token totali stimati: 792
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] Devo richiedere la cartella clinica  [ASSISTENTE] Puoi richiedere il rilascio delle cartelle cliniche dei ricoveri svolti presso l'Istituto Clinico Humanitas online dall’area referti di [Humanitas con te](https://www.humanitasconte.it). Se sei in struttura, puoi rivolgerti all'Ufficio Ri..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 130
   📊 Token totali: 578
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 578 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 130
   📊 Token conversazione finale: 130
   📊 Token totali: 578
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 433 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Informazioni vaccini  [ASSISTENTE] Puoi trovare informazioni dettagliate sui vaccini, inclusi i tipi disponibili, le modalità di somministrazione e le indicazioni, visitando la pagina dedicata sul sito di Humanitas [Vaccini - Humanitas](https://www.humanitas.it/enciclopedia/vaccini)【6:0†..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2873 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 130
   📊 Token totali stimati: 578
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Informazioni vaccini  [ASSISTENTE] Puoi trovare informazioni dettagliate sui vaccini, inclusi i tipi disponibili, le modalità di somministrazione e le indicazioni, visitando la pagina dedicata sul sito di Humanitas [Vaccini - Humanitas](https://www.humanitas.it/enciclopedia/vaccini)【6:0†..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 106
   📊 Token totali: 554
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 554 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 106
   📊 Token conversazione finale: 106
   📊 Token totali: 554
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 368 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Ho bisogno la cartella clinica di un deceduto  [ASSISTENTE] Per richiedere la cartella clinica di una persona deceduta, è necessario seguire una procedura specifica. [...] 

Se hai bisogno di ulteriori dettagli, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2819 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 106
   📊 Token totali stimati: 554
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Ho bisogno la cartella clinica di un deceduto  [ASSISTENTE] Per richiedere la cartella clinica di una persona deceduta, è necessario seguire una procedura specifica. [...] 

Se hai bisogno di ulteriori dettagli, fammi sapere!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 327
   📊 Token totali: 776
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 776 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 327
   📊 Token conversazione finale: 327
   📊 Token totali: 776
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1087 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi


TESTO DA CLASSIFICARE:
"[UTENTE] devo fare richiesta di una cartella clinica di un paziente che è deceduto Lino Humanitas [ASSISTENTE] Per richiedere la cartella clinica di un paziente deceduto, è necessario seguire le normative sulla privacy. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2820 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 327
   📊 Token totali stimati: 776
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi


TESTO DA CLASSIFICARE:
"[UTENTE] devo fare richiesta di una cartella clinica di un paziente che è deceduto Lino Humanitas [ASSISTENTE] Per richiedere la cartella clinica di un paziente deceduto, è necessario seguire le normative sulla privacy. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔧 Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
🔍 Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
✅ MongoClassificationReader creato per tenant: Humanitas (humanitas)
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
✅ Connesso a MongoDB database: classificazioni
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🔍 Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
🏷️ Recupero etichette per tenant: Humanitas
📊 Calcolo statistiche per tenant: Humanitas
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 124
   📊 Token totali: 572
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 572 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 124
   📊 Token conversazione finale: 124
   📊 Token totali: 572
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 447 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] Richiesta preparati istologici  [ASSISTENTE] Per quanto riguarda i preparati istologici, è importante sapere che i referti istologici con esito positivo non possono essere delegati per il ritiro. [...] json】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2782 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 124
   📊 Token totali stimati: 572
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] Richiesta preparati istologici  [ASSISTENTE] Per quanto riguarda i preparati istologici, è importante sapere che i referti istologici con esito positivo non possono essere delegati per il ritiro. [...] json】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 156
   📊 Token totali: 584
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 584 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 156
   📊 Token conversazione finale: 156
   📊 Token totali: 584
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 536 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "La polizza copre anche viaggi all'estero?"
Output: info_copertura_geografica_assicurazione
Ragionamento: Richiesta informazioni sulla copertura geografica


TESTO DA CLASSIFICARE:
"[UTENTE] Vorrei consultare i miei referti  [ASSISTENTE] Per consultare i tuoi referti, devi essere registrato a [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2727 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 156
   📊 Token totali stimati: 584
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "La polizza copre anche viaggi all'estero?"
Output: info_copertura_geografica_assicurazione
Ragionamento: Richiesta informazioni sulla copertura geografica


TESTO DA CLASSIFICARE:
"[UTENTE] Vorrei consultare i miei referti  [ASSISTENTE] Per consultare i tuoi referti, devi essere registrato a [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 98
   📊 Token totali: 526
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 526 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 98
   📊 Token conversazione finale: 98
   📊 Token totali: 526
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 308 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Fatturazione [ASSISTENTE] Puoi consultare e scaricare le tue fatture direttamente dal portale [Humanitas con te](https://www. [...] docx】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2656 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 98
   📊 Token totali stimati: 526
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Fatturazione [ASSISTENTE] Puoi consultare e scaricare le tue fatture direttamente dal portale [Humanitas con te](https://www. [...] docx】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 175
   📊 Token totali: 623
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 623 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 175
   📊 Token conversazione finale: 175
   📊 Token totali: 623
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 626 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao buongiorno Senti vorrei sapere se è possibile rintracciare i risultati delle analisi che avevo fatto circa 3 anni fa [ASSISTENTE] Per recuperare i risultati delle analisi effettuate circa 3 anni fa, puoi accedere al portale [Humanitas con te](https://www.humanitasconte.it). Ti ricor..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2807 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 175
   📊 Token totali stimati: 623
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao buongiorno Senti vorrei sapere se è possibile rintracciare i risultati delle analisi che avevo fatto circa 3 anni fa [ASSISTENTE] Per recuperare i risultati delle analisi effettuate circa 3 anni fa, puoi accedere al portale [Humanitas con te](https://www.humanitasconte.it). Ti ricor..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 217
   📊 Token totali: 645
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 645 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 217
   📊 Token conversazione finale: 217
   📊 Token totali: 645
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 789 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao non riesco ad entrare su ritiro referti e scaricare, per mio papà che ha 87 anni e gli ho creato un email ed id [ASSISTENTE] Per accedere ai referti di tuo papà tramite [Humanitas con te](https://www. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2774 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 217
   📊 Token totali stimati: 645
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao non riesco ad entrare su ritiro referti e scaricare, per mio papà che ha 87 anni e gli ho creato un email ed id [ASSISTENTE] Per accedere ai referti di tuo papà tramite [Humanitas con te](https://www. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 253
   📊 Token totali: 681
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 681 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 253
   📊 Token conversazione finale: 253
   📊 Token totali: 681
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 875 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] sono Marco Giuseppe Alfredo Fontana, FNTMCG67C30F205N è ho effettuato in data 31/05/2024 check-up SALUTE SEMPLICE. [...] 

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2660 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 253
   📊 Token totali stimati: 681
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] sono Marco Giuseppe Alfredo Fontana, FNTMCG67C30F205N è ho effettuato in data 31/05/2024 check-up SALUTE SEMPLICE. [...] 

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

🔧 Creazione MongoClassificationReader per cliente: 015007d9-d413-11ef-86a5-96000228e7fe
🔍 Risoluzione tenant da UUID: 015007d9-d413-11ef-86a5-96000228e7fe
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa
✅ Tenant risolto (DB TAG locale): Humanitas (humanitas) UUID=015007d9-d413-11ef-86a5-96000228e7fe
✅ Tenant risolto da UUID: Humanitas (015007d9-d413-11ef-86a5-96000228e7fe)
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
✅ MongoClassificationReader inizializzato per tenant: Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
   🏢 Database: classificazioni
✅ MongoClassificationReader creato per tenant: Humanitas (humanitas)
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
   📊 Collection: humanitas_015007d9-d413-11ef-86a5-96000228e7fe
✅ Connesso a MongoDB database: classificazioni
📊 Collection generata: humanitas_015007d9-d413-11ef-86a5-96000228e7fe per tenant Humanitas
🔍 Review Queue recuperate 0 sessioni (representatives: True, propagated: True, outliers: True)
🏷️ Recupero etichette per tenant: Humanitas
📊 Calcolo statistiche per tenant: Humanitas
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 212
   📊 Token totali: 640
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 640 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 212
   📊 Token conversazione finale: 212
   📊 Token totali: 640
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 774 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale


TESTO DA CLASSIFICARE:
"[UTENTE] Perchè non riesco a visualizzare le prenotazioni di mia figlia minorenne [ASSISTENTE] Per visualizzare le prenotazioni di un minore su [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2721 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 212
   📊 Token totali stimati: 640
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale


TESTO DA CLASSIFICARE:
"[UTENTE] Perchè non riesco a visualizzare le prenotazioni di mia figlia minorenne [ASSISTENTE] Per visualizzare le prenotazioni di un minore su [Humanitas con te](https://www. [...]  

Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

   📈 Progresso LLM: 100/173
Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 180
   📊 Token totali: 608
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 608 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 180
   📊 Token conversazione finale: 180
   📊 Token totali: 608
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 625 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] delega per gestione profilo humanitas da parte di altri come fare? [ASSISTENTE] Per delegare un utente terzo (curatore, caregiver, amministratore di sostegno) alla gestione del proprio profilo su [Humanitas con te](https://www. [...] json】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2730 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 180
   📊 Token totali stimati: 608
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] delega per gestione profilo humanitas da parte di altri come fare? [ASSISTENTE] Per delegare un utente terzo (curatore, caregiver, amministratore di sostegno) alla gestione del proprio profilo su [Humanitas con te](https://www. [...] json】"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 455
   📊 Token totali: 903
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 903 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 455
   📊 Token conversazione finale: 455
   📊 Token totali: 903
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1610 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Non ho ricevuto la documentazione della polizza"
Output: problema_amministrativo
Ragionamento: Problemi con documenti o questioni amministrative


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao Giulia vorrei sapere se posso  scaricare il referto  della Pet di mio marito  dalla mia app [ASSISTENTE] Per scaricare il referto della PET di tuo marito dalla tua app, è necessario che il referto sia associato al tuo account su [Humanitas con te](https://www. [...]  A presto!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2863 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 455
   📊 Token totali stimati: 903
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Non ho ricevuto la documentazione della polizza"
Output: problema_amministrativo
Ragionamento: Problemi con documenti o questioni amministrative


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao Giulia vorrei sapere se posso  scaricare il referto  della Pet di mio marito  dalla mia app [ASSISTENTE] Per scaricare il referto della PET di tuo marito dalla tua app, è necessario che il referto sia associato al tuo account su [Humanitas con te](https://www. [...]  A presto!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta priorità massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 447
   💬 Token conversazione: 440
   📊 Token totali: 887
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 887 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 447
   📊 Token conversazione originale: 440
   📊 Token conversazione finale: 440
   📊 Token totali: 887
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1476 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta


TESTO DA CLASSIFICARE:
"[UTENTE] ciao, [ASSISTENTE] Ciao! Come posso esserti utile? 😊 [UTENTE] ho fatto gli esami del sangue il 18 luglio, non so dove vederli perché quando li ho fatti ero ancora minorenne [ASSISTENTE] Se hai effettuato gli esami del sangue mentre eri minorenne, è necessario che il tuo profilo venga ass..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2827 characters
🔢 Token Analysis:
   📊 Token prompt base: 447
   📊 Token conversazione: 440
   📊 Token totali stimati: 887
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta priorità massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a raggiungervi? Parto da Milano"
Output: indicazioni_stradali
Ragionamento: Informazioni su come raggiungere la sede Wopta


TESTO DA CLASSIFICARE:
"[UTENTE] ciao, [ASSISTENTE] Ciao! Come posso esserti utile? 😊 [UTENTE] ho fatto gli esami del sangue il 18 luglio, non so dove vederli perché quando li ho fatti ero ancora minorenne [ASSISTENTE] Se hai effettuato gli esami del sangue mentre eri minorenne, è necessario che il tuo profilo venga ass..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 146
   📊 Token totali: 574
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 574 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 146
   📊 Token conversazione finale: 146
   📊 Token totali: 574
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 515 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Non ho ricevuto la documentazione della polizza"
Output: problema_amministrativo
Ragionamento: Problemi con documenti o questioni amministrative
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno, ho ricevuto la comunicazione che avrei ricevuto una chiamata per comunicazioni relative al mio appuntamento di domattina ma non ho ricevuto alcuna chiamata [ASSISTENTE] Mi dispiace per l'inconveniente. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2772 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 146
   📊 Token totali stimati: 574
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Non ho ricevuto la documentazione della polizza"
Output: problema_amministrativo
Ragionamento: Problemi con documenti o questioni amministrative
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno, ho ricevuto la comunicazione che avrei ricevuto una chiamata per comunicazioni relative al mio appuntamento di domattina ma non ho ricevuto alcuna chiamata [ASSISTENTE] Mi dispiace per l'inconveniente. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 152
   📊 Token totali: 580
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 580 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 152
   📊 Token conversazione finale: 152
   📊 Token totali: 580
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 509 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno Giulia, ho un appuntamento con il prof. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2593 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 152
   📊 Token totali stimati: 580
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno Giulia, ho un appuntamento con il prof. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - priorità problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 454
   💬 Token conversazione: 133
   📊 Token totali: 587
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 587 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 454
   📊 Token conversazione originale: 133
   📊 Token conversazione finale: 133
   📊 Token totali: 587
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 469 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi


TESTO DA CLASSIFICARE:
"[UTENTE] cia Giulia sono MAriagrazia non riesco a trovare comunicazione di una prenotazione fatta per mio figlio Jacopo Maria Marino 2. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2817 characters
🔢 Token Analysis:
   📊 Token prompt base: 454
   📊 Token conversazione: 133
   📊 Token totali stimati: 587
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - priorità problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi


TESTO DA CLASSIFICARE:
"[UTENTE] cia Giulia sono MAriagrazia non riesco a trovare comunicazione di una prenotazione fatta per mio figlio Jacopo Maria Marino 2. [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 151
   📊 Token totali: 599
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 599 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 151
   📊 Token conversazione finale: 151
   📊 Token totali: 599
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 489 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] volevo sapere se è stato spostato a luglio un appuntamento del 16/6/2025 per mia moglie Lek Naowabut [ASSISTENTE] Non ho accesso a informazioni personali o specifiche sugli appuntamenti. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2772 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 151
   📊 Token totali stimati: 599
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] volevo sapere se è stato spostato a luglio un appuntamento del 16/6/2025 per mia moglie Lek Naowabut [ASSISTENTE] Non ho accesso a informazioni personali o specifiche sugli appuntamenti. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 206
   📊 Token totali: 634
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 634 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 206
   📊 Token conversazione finale: 206
   📊 Token totali: 634
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 733 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale


TESTO DA CLASSIFICARE:
"[UTENTE] Non riesco accedere a referto  [ASSISTENTE] Se non riesci ad accedere al tuo referto, ti consiglio di verificare di aver inserito correttamente l'ID Humanitas con te. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2716 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 206
   📊 Token totali stimati: 634
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale


TESTO DA CLASSIFICARE:
"[UTENTE] Non riesco accedere a referto  [ASSISTENTE] Se non riesci ad accedere al tuo referto, ti consiglio di verificare di aver inserito correttamente l'ID Humanitas con te. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - priorità problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 454
   💬 Token conversazione: 933
   📊 Token totali: 1387
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1387 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 454
   📊 Token conversazione originale: 933
   📊 Token conversazione finale: 933
   📊 Token totali: 1387
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 3220 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Devo scaricare degli esami di mio papà e devo registrarlo inserisco il codice fiscale ma me lo dà errato l'ho ripetuto più volte ma il codice fiscale corretto solo che mi dice che non va bene [ASSISTENTE] Se il codice fiscale è corretto ma il sistema lo segnala come errato, ti consiglio ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2870 characters
🔢 Token Analysis:
   📊 Token prompt base: 454
   📊 Token conversazione: 933
   📊 Token totali stimati: 1387
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - priorità problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato


TESTO DA CLASSIFICARE:
"[UTENTE] Devo scaricare degli esami di mio papà e devo registrarlo inserisco il codice fiscale ma me lo dà errato l'ho ripetuto più volte ma il codice fiscale corretto solo che mi dice che non va bene [ASSISTENTE] Se il codice fiscale è corretto ma il sistema lo segnala come errato, ti consiglio ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 765
   📊 Token totali: 1214
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1214 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 765
   📊 Token conversazione finale: 765
   📊 Token totali: 1214
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 2628 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] buongiorno, non vedo nei referti l'esito dell'esame TACTOR01 di RAD1 del 08-08-2025, sono TULLIO PIANA ID. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2754 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 765
   📊 Token totali stimati: 1214
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] buongiorno, non vedo nei referti l'esito dell'esame TACTOR01 di RAD1 del 08-08-2025, sono TULLIO PIANA ID. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 267
   📊 Token totali: 695
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 695 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 267
   📊 Token conversazione finale: 267
   📊 Token totali: 695
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 933 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale


TESTO DA CLASSIFICARE:
"[UTENTE] l'ultima visita di controllo mi ero accordato che avrei fatto la prossima l'8 agosto, tuttavia in Humanitas con te non trovo il mio appuntamento. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2695 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 267
   📊 Token totali stimati: 695
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale


TESTO DA CLASSIFICARE:
"[UTENTE] l'ultima visita di controllo mi ero accordato che avrei fatto la prossima l'8 agosto, tuttavia in Humanitas con te non trovo il mio appuntamento. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - priorità problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 454
   💬 Token conversazione: 461
   📊 Token totali: 915
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 915 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 454
   📊 Token conversazione originale: 461
   📊 Token conversazione finale: 461
   📊 Token totali: 915
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1605 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "La polizza copre anche viaggi all'estero?"
Output: info_copertura_geografica_assicurazione
Ragionamento: Richiesta informazioni sulla copertura geografica
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] non riesco ad accedere all'esito degli esami di mia figlia, minorenne, perchè ID dice non corretto [ASSISTENTE] Per accedere agli esiti degli esami di un minorenne su [Humanitas con te](https://www.humanitasconte.it), è necessario verificare che l'ID sia corretto. L'ID si trova sul tagli..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2903 characters
🔢 Token Analysis:
   📊 Token prompt base: 454
   📊 Token conversazione: 461
   📊 Token totali stimati: 915
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Problema tecnico di accesso - priorità problema_accesso_portale su altre categorie

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "La polizza copre anche viaggi all'estero?"
Output: info_copertura_geografica_assicurazione
Ragionamento: Richiesta informazioni sulla copertura geografica
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] non riesco ad accedere all'esito degli esami di mia figlia, minorenne, perchè ID dice non corretto [ASSISTENTE] Per accedere agli esiti degli esami di un minorenne su [Humanitas con te](https://www.humanitasconte.it), è necessario verificare che l'ID sia corretto. L'ID si trova sul tagli..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 116
   📊 Token totali: 564
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 564 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 116
   📊 Token conversazione finale: 116
   📊 Token totali: 564
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 409 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] salve come posso sapere un contatto di un professore di ematologia? [ASSISTENTE] Per ottenere informazioni sui medici, inclusi i professori di ematologia, ti consiglio di consultare la pagina dedicata alla [Ricerca Medici](https://www.humanitas.it/medici/). Qui potrai trovare i dettagli ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2855 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 116
   📊 Token totali stimati: 564
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte


TESTO DA CLASSIFICARE:
"[UTENTE] salve come posso sapere un contatto di un professore di ematologia? [ASSISTENTE] Per ottenere informazioni sui medici, inclusi i professori di ematologia, ti consiglio di consultare la pagina dedicata alla [Ricerca Medici](https://www.humanitas.it/medici/). Qui potrai trovare i dettagli ..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 217
   📊 Token totali: 645
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 645 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 217
   📊 Token conversazione finale: 217
   📊 Token totali: 645
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 722 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "La polizza copre anche viaggi all'estero?"
Output: info_copertura_geografica_assicurazione
Ragionamento: Richiesta informazioni sulla copertura geografica
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Nicolò Maria buffi chi è? [ASSISTENTE] Il Professor Nicolò Maria Buffi è un medico specializzato in Urologia presso l'Unità Operativa di Urologia dell'Istituto Clinico Humanitas. [...] it/unita-operative/urologia)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2738 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 217
   📊 Token totali stimati: 645
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "La polizza copre anche viaggi all'estero?"
Output: info_copertura_geografica_assicurazione
Ragionamento: Richiesta informazioni sulla copertura geografica
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] Nicolò Maria buffi chi è? [ASSISTENTE] Il Professor Nicolò Maria Buffi è un medico specializzato in Urologia presso l'Unità Operativa di Urologia dell'Istituto Clinico Humanitas. [...] it/unita-operative/urologia)"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 403
   📊 Token totali: 851
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 851 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 403
   📊 Token conversazione finale: 403
   📊 Token totali: 851
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1342 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale


TESTO DA CLASSIFICARE:
"[UTENTE] vorrei prenotare una visita con il dottor furlan sulla disautonomia [ASSISTENTE] Puoi prenotare una visita con il Dottor Raffaello Furlan, specializzato in disautonomia e responsabile dell'Unità Sincopi e Disturbi della Postura presso Humanitas. Per maggiori dettagli e per prenotare, vis..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2860 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 403
   📊 Token totali stimati: 851
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale


TESTO DA CLASSIFICARE:
"[UTENTE] vorrei prenotare una visita con il dottor furlan sulla disautonomia [ASSISTENTE] Puoi prenotare una visita con il Dottor Raffaello Furlan, specializzato in disautonomia e responsabile dell'Unità Sincopi e Disturbi della Postura presso Humanitas. Per maggiori dettagli e per prenotare, vis..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 836
   📊 Token totali: 1284
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1284 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 836
   📊 Token conversazione finale: 836
   📊 Token totali: 1284
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 2583 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Vorrei per favore l'elenco di ortopedici del ginocchio [ASSISTENTE] Gli ortopedici specializzati nel trattamento del ginocchio presso Humanitas includono:

1. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2720 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 836
   📊 Token totali stimati: 1284
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Vorrei per favore l'elenco di ortopedici del ginocchio [ASSISTENTE] Gli ortopedici specializzati nel trattamento del ginocchio presso Humanitas includono:

1. [...]  Buona giornata!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 454
   📊 Token totali: 882
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 882 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 454
   📊 Token conversazione finale: 454
   📊 Token totali: 882
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1624 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] ho fatto una prenotazione a nome Silvana Delogu per una visita oncologica online dalla dottoressa lorenza rimassa il 17/09/205 ore 14. [...] 

Se hai bisogno di ulteriori dettagli, ti consiglio di contattare il servizio di assistenza dedicata"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2748 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 454
   📊 Token totali stimati: 882
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] ho fatto una prenotazione a nome Silvana Delogu per una visita oncologica online dalla dottoressa lorenza rimassa il 17/09/205 ore 14. [...] 

Se hai bisogno di ulteriori dettagli, ti consiglio di contattare il servizio di assistenza dedicata"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 364
   📊 Token totali: 812
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 812 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 364
   📊 Token conversazione finale: 364
   📊 Token totali: 812
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1215 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] vorrei avere conferma dell'orario del prericovero [ASSISTENTE] Il prericovero può essere effettuato in regime privato o tramite il Servizio Sanitario Nazionale (SSN). [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2802 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 364
   📊 Token totali stimati: 812
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] vorrei avere conferma dell'orario del prericovero [ASSISTENTE] Il prericovero può essere effettuato in regime privato o tramite il Servizio Sanitario Nazionale (SSN). [...]  Se hai bisogno di ulteriori informazioni, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 152
   📊 Token totali: 580
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 580 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 152
   📊 Token conversazione finale: 152
   📊 Token totali: 580
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 507 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao, se prenoto con una ricetta SSN posso al telefono, scegliere il medico con cui svolgere la prestazione? [ASSISTENTE] Sì, quando prenoti una prestazione tramite il Servizio Sanitario Nazionale (SSN), puoi esprimere una preferenza per il medico con cui desideri svolgere la prestazione..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2801 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 152
   📊 Token totali stimati: 580
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao, se prenoto con una ricetta SSN posso al telefono, scegliere il medico con cui svolgere la prestazione? [ASSISTENTE] Sì, quando prenoti una prestazione tramite il Servizio Sanitario Nazionale (SSN), puoi esprimere una preferenza per il medico con cui desideri svolgere la prestazione..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta priorità massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 447
   💬 Token conversazione: 545
   📊 Token totali: 992
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 992 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 447
   📊 Token conversazione originale: 545
   📊 Token conversazione finale: 545
   📊 Token totali: 992
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1759 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao Giulia scusa io è 15 giorni che provo a chiamare E dai prericoveri perché ho da dirgli una cosa importante ma non riesco davvero parlare con nessuno [ASSISTENTE] Capisco la tua situazione. [...]  In bocca al lupo per tutto! 😊"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2810 characters
🔢 Token Analysis:
   📊 Token prompt base: 447
   📊 Token conversazione: 545
   📊 Token totali stimati: 992
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta priorità massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Quanto costa la polizza vita per una persona di 35 anni?"
Output: info_costi_premio
Ragionamento: Richiesta informazioni sui costi e premi assicurativi
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao Giulia scusa io è 15 giorni che provo a chiamare E dai prericoveri perché ho da dirgli una cosa importante ma non riesco davvero parlare con nessuno [ASSISTENTE] Capisco la tua situazione. [...]  In bocca al lupo per tutto! 😊"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 884
   📊 Token totali: 1332
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1332 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 884
   📊 Token conversazione finale: 884
   📊 Token totali: 1332
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 2882 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale


TESTO DA CLASSIFICARE:
"[UTENTE] Possibile fare una rinosettoplastica pagando solo la parte estetica? La funzione con ssn [ASSISTENTE] Per quanto riguarda la rinosettoplastica, è possibile che la parte funzionale venga coperta dal Servizio Sanitario Nazionale (SSN) se ci sono indicazioni mediche specifiche, mentre la pa..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2853 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 884
   📊 Token totali stimati: 1332
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale


TESTO DA CLASSIFICARE:
"[UTENTE] Possibile fare una rinosettoplastica pagando solo la parte estetica? La funzione con ssn [ASSISTENTE] Per quanto riguarda la rinosettoplastica, è possibile che la parte funzionale venga coperta dal Servizio Sanitario Nazionale (SSN) se ci sono indicazioni mediche specifiche, mentre la pa..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 185
   📊 Token totali: 633
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 633 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 185
   📊 Token conversazione finale: 185
   📊 Token totali: 633
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 613 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Non ho ricevuto la documentazione della polizza"
Output: problema_amministrativo
Ragionamento: Problemi con documenti o questioni amministrative


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno io effettuato dei esami ma non ancora avuto esiti  [ASSISTENTE] Per aiutarti al meglio, potresti dirmi di che tipo di esami si tratta? Alcuni esami non sono consultabili online e devono essere ritirati presso lo sportello ufficio referti. Se invece hai bisogno di assistenza pe..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2879 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 185
   📊 Token totali stimati: 633
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo fare visite mediche per attivare la polizza?"
Output: info_questionario_medico
Ragionamento: Domande su questionari o visite mediche richieste
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Mi dai l'indirizzo della sede di Wopta?"
Output: info_sede_aziendale
Ragionamento: Richiesta informazioni sulla sede aziendale
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Non ho ricevuto la documentazione della polizza"
Output: problema_amministrativo
Ragionamento: Problemi con documenti o questioni amministrative


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno io effettuato dei esami ma non ancora avuto esiti  [ASSISTENTE] Per aiutarti al meglio, potresti dirmi di che tipo di esami si tratta? Alcuni esami non sono consultabili online e devono essere ritirati presso lo sportello ufficio referti. Se invece hai bisogno di assistenza pe..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta priorità massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 447
   💬 Token conversazione: 537
   📊 Token totali: 984
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 984 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 447
   📊 Token conversazione originale: 537
   📊 Token conversazione finale: 537
   📊 Token totali: 984
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1845 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Cosa copre esattamente la polizza vita Wopta?"
Output: info_condizioni_polizza
Ragionamento: Richiesta di informazioni sulle condizioni di polizza
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] quanto tempo ci vuole per avere i risultati degli esami del sangue [ASSISTENTE] I risultati degli esami del sangue sono generalmente disponibili in breve tempo, variando da pochi giorni a una settimana. Per maggiori informazioni, puoi visitare la pagina [Esami del sangue](https://www.hum..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2866 characters
🔢 Token Analysis:
   📊 Token prompt base: 447
   📊 Token conversazione: 537
   📊 Token totali stimati: 984
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta urgente - valuta priorità massima

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Non riesco ad entrare nel mio account del portale Wopta"
Output: problema_accesso_portale
Ragionamento: Difficoltà di login al portale assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Cosa copre esattamente la polizza vita Wopta?"
Output: info_condizioni_polizza
Ragionamento: Richiesta di informazioni sulle condizioni di polizza
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione


TESTO DA CLASSIFICARE:
"[UTENTE] quanto tempo ci vuole per avere i risultati degli esami del sangue [ASSISTENTE] I risultati degli esami del sangue sono generalmente disponibili in breve tempo, variando da pochi giorni a una settimana. Per maggiori informazioni, puoi visitare la pagina [Esami del sangue](https://www.hum..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 49
   📊 Token totali: 477
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 477 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 49
   📊 Token conversazione finale: 49
   📊 Token totali: 477
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 155 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Risultato? [ASSISTENTE] Potresti specificare meglio la tua richiesta? Intendi il risultato di un esame, un referto o altro? Sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2655 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 49
   📊 Token totali stimati: 477
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Quanti anni può durare al massimo la polizza vita?"
Output: info_durata_polizza
Ragionamento: Richiesta di informazioni sulla durata della polizza vita
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Quando inserisco il CF dice che non è valido"
Output: problema_accesso_portale
Ragionamento: Problema tecnico di accesso al portale online


TESTO DA CLASSIFICARE:
"[UTENTE] Risultato? [ASSISTENTE] Potresti specificare meglio la tua richiesta? Intendi il risultato di un esame, un referto o altro? Sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 415
   📊 Token totali: 863
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 863 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 415
   📊 Token conversazione finale: 415
   📊 Token totali: 863
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1395 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] buongiorno [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] per il ritiro di un esito esame istologico è solo il medico che ha richiesto che lo può consegnare? [ASSISTENTE] Tutti i referti, ad eccezione del test HIV e degli esami istologici con esito positivo, possono ess..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2840 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 415
   📊 Token totali stimati: 863
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] buongiorno [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] per il ritiro di un esito esame istologico è solo il medico che ha richiesto che lo può consegnare? [ASSISTENTE] Tutti i referti, ad eccezione del test HIV e degli esami istologici con esito positivo, possono ess..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 303
   📊 Token totali: 751
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 751 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 303
   📊 Token conversazione finale: 303
   📊 Token totali: 751
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1011 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno, [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] Sono la Sig. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2723 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 303
   📊 Token totali stimati: 751
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno, [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] Sono la Sig. [...] 

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 309
   📊 Token totali: 758
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 758 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 309
   📊 Token conversazione finale: 309
   📊 Token totali: 758
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1101 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Buonasera, non riesco a visualizzare un referto on line su humanitas con te [ASSISTENTE] Se non riesci a visualizzare un referto online su [Humanitas con te](https://www. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2785 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 309
   📊 Token totali stimati: 758
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Buonasera, non riesco a visualizzare un referto on line su humanitas con te [ASSISTENTE] Se non riesci a visualizzare un referto online su [Humanitas con te](https://www. [...] 

Se hai bisogno di ulteriore supporto, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 449
   💬 Token conversazione: 564
   📊 Token totali: 1013
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1013 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 449
   📊 Token conversazione originale: 564
   📊 Token conversazione finale: 564
   📊 Token totali: 1013
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1811 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao, non sono riesco a vedere i miei esami del sangue che ho fatto il 14/06/25 . [...] it, indicando nome, cognome, codice fiscale e motivo della richiesta di assistenza"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2716 characters
🔢 Token Analysis:
   📊 Token prompt base: 449
   📊 Token conversazione: 564
   📊 Token totali stimati: 1013
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta operativa - preferisci etichette di azione

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Ciao, non sono riesco a vedere i miei esami del sangue che ho fatto il 14/06/25 . [...] it, indicando nome, cognome, codice fiscale e motivo della richiesta di assistenza"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 451
   📊 Token totali: 879
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 879 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 451
   📊 Token conversazione finale: 451
   📊 Token totali: 879
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1425 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] gli esami del sangue posso scaricarli dal fascicolo sanitario? [ASSISTENTE] Sì, gli esami del sangue possono essere scaricati dal Fascicolo Sanitario Elettronico (FSE) se sono stati caricati. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2734 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 451
   📊 Token totali stimati: 879
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto


TESTO DA CLASSIFICARE:
"[UTENTE] gli esami del sangue posso scaricarli dal fascicolo sanitario? [ASSISTENTE] Sì, gli esami del sangue possono essere scaricati dal Fascicolo Sanitario Elettronico (FSE) se sono stati caricati. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 428
   💬 Token conversazione: 643
   📊 Token totali: 1071
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 1071 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 428
   📊 Token conversazione originale: 643
   📊 Token conversazione finale: 643
   📊 Token totali: 1071
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 2141 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno  [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] In data 16/07 ho effettuato presso Humanitas di Rozzano RX ginocchio dx e sx ma NON è visualizzabile online referto ginocchio dx [ASSISTENTE] Alcuni referti non sono consultabili online. Ti chiedo gentilmente di..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2764 characters
🔢 Token Analysis:
   📊 Token prompt base: 428
   📊 Token conversazione: 643
   📊 Token totali stimati: 1071
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica




OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come faccio a disdire la polizza vita?"
Output: disdetta_polizza
Ragionamento: L'utente vuole disdire la sua polizza vita


TESTO DA CLASSIFICARE:
"[UTENTE] Buongiorno  [ASSISTENTE] Buongiorno! Come posso esserti utile oggi? [UTENTE] In data 16/07 ho effettuato presso Humanitas di Rozzano RX ginocchio dx e sx ma NON è visualizzabile online referto ginocchio dx [ASSISTENTE] Alcuni referti non sono consultabili online. Ti chiedo gentilmente di..."

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 286
   📊 Token totali: 734
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 734 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 286
   📊 Token conversazione finale: 286
   📊 Token totali: 734
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 1001 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] È proprio obbligatorio avere una richiesta del medico di base per una visita privata? [ASSISTENTE] No, per una visita privata non è obbligatorio avere una richiesta del medico di base. [...]  

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2834 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 286
   📊 Token totali stimati: 734
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "In caso di morte, come funziona l'indennizzo?"
Output: info_caso_morte
Ragionamento: Richiesta informazioni su come funziona la copertura in caso di morte
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Come funziona il riscatto della polizza?"
Output: info_riscatto_polizza
Ragionamento: Richiesta informazioni sul riscatto della polizza


TESTO DA CLASSIFICARE:
"[UTENTE] È proprio obbligatorio avere una richiesta del medico di base per una visita privata? [ASSISTENTE] No, per una visita privata non è obbligatorio avere una richiesta del medico di base. [...]  

Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
============================================================
🤖 ELABORAZIONE CONVERSAZIONE PER LLM
   🆔 Session ID: llm_conversation
   📝 Token prompt: 448
   💬 Token conversazione: 276
   📊 Token totali: 724
   🎯 Limite massimo: 8000
   ✅ Conversazione OK: 724 ≤ 8000
✅ Tokenizzazione LLM completata:
   📊 Token prompt base: 448
   📊 Token conversazione originale: 276
   📊 Token conversazione finale: 276
   📊 Token totali: 724
   📊 Limite configurato: 8000
   ✅ Conversazione entro i limiti, nessun troncamento
============================================================

================================================================================
👤 DEBUG PROMPT USER - DATABASE
================================================================================
📋 Prompt Name: LLM/TEMPLATE/intelligent_classifier_user
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Text Length: 987 chars
--------------------------------------------------------------------------------
📄 USER PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali


TESTO DA CLASSIFICARE:
"[UTENTE] Salve,

attraverso la mia assicurazione "Generali" ho inserito la pratica "Valutazione nutrizionistica/dietista (con relazione finale)" in prestazione diretta presso Medical Care De Angeli (Nr. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):
================================================================================

🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 PROMPT COMPLETO FINALE INVIATO ALL'LLM
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 Model: mistral:7b
🌐 Ollama URL: http://localhost:11434
🏢 Tenant: 015007d9-d413-11ef-86a5-96000228e7fe
📏 Total Prompt Length: 2855 characters
🔢 Token Analysis:
   📊 Token prompt base: 448
   📊 Token conversazione: 276
   📊 Token totali stimati: 724
   📊 Limite configurato: 8000
   ✅ STATUS: Conversazione COMPLETA
--------------------------------------------------------------------------------
📄 FULL PROMPT CONTENT:
--------------------------------------------------------------------------------
<|system|>
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.

<|user|>
Analizza questo testo seguendo l'approccio degli esempi:

ESEMPIO 1 (ALTA CERTEZZA):
Input: "Come posso contattare l'assistenza Wopta?"
Output: info_contatti
Ragionamento: Domanda sui contatti dell'assicurazione
ESEMPIO 2 (ALTA CERTEZZA):
Input: "Il beneficiario della polizza deve essere mio figlio che deve ancora nascere, come posso fare?"
Output: info_beneficiario
Ragionamento: Domanda su come impostare un beneficiario non ancora nato
ESEMPIO 3 (MEDIA CERTEZZA):
Input: "Devo cambiare la mail con cui mi sono registrato al portale"
Output: cambio_anagrafica
Ragionamento: Cambio delle informazioni anagrafiche richiesto
ESEMPIO 4 (MEDIA CERTEZZA):
Input: "Su che sito posso aprire la polizza?"
Output: info_sottoscrizione_online
Ragionamento: Informazioni su come sottoscrivere la polizza online
ESEMPIO 5 (MEDIA CERTEZZA):
Input: "Posso modificare l'importo assicurato dopo la sottoscrizione?"
Output: modifica_condizioni_polizza
Ragionamento: Richiesta di modifica delle condizioni contrattuali


TESTO DA CLASSIFICARE:
"[UTENTE] Salve,

attraverso la mia assicurazione "Generali" ho inserito la pratica "Valutazione nutrizionistica/dietista (con relazione finale)" in prestazione diretta presso Medical Care De Angeli (Nr. [...]  Se hai bisogno di ulteriore assistenza, sono qui per aiutarti!"

RAGIONA STEP-BY-STEP:
1. Identifica l'intento principale
2. Confronta con gli esempi
3. Scegli l'etichetta più appropriata
4. Valuta la tua certezza

OUTPUT (SOLO JSON):

<|assistant|>
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

Connessione al database TAG stabilita con successo
Connessione al database TAG chiusa

================================================================================
🤖 DEBUG PROMPT SYSTEM - DATABASE
================================================================================
📋 Prompt Name: LLM/SYSTEM/intelligent_classifier_system
🏢 Tenant ID: 015007d9-d413-11ef-86a5-96000228e7fe
📝 Variables Used: ['available_labels', 'priority_labels', 'context_guidance']
--------------------------------------------------------------------------------
📄 SYSTEM PROMPT CONTENT (dopo sostituzione placeholder):
--------------------------------------------------------------------------------
Sei un classificatore esperto per l'ospedale Humanitas con profonda conoscenza del dominio sanitario.

MISSIONE: Classifica conversazioni con pazienti/utenti in base al loro intento principale.

APPROCCIO ANALITICO:
1. Identifica l'intento principale (non dettagli secondari)
2. Considera il contesto ospedaliero (prenotazioni, referti, informazioni)
3. Distingui richieste operative da richieste informative
4. Se incerto tra 2 etichette, scegli la più specifica

CONFIDENCE GUIDELINES:
- 0.9-1.0: Intento chiarissimo e inequivocabile
- 0.7-0.8: Intento probabile con piccole ambiguità
- 0.5-0.6: Intento possibile ma con dubbi ragionevoli  
- 0.3-0.4: Molto incerto, probabilmente "altro"
- 0.0-0.2: Impossibile classificare

LABELING GUIDELINES:
la logica con cui devi creare le etichette è: <tipologia di richiesta>_<ambito a cui si riferisce> 

#LABELING EXAMPLE 
- info_prenotazione
- info_esame
- info_ricovero
- info_prericovero
- parere_clinico
- info_fertility_center 
- problema_accesso_portale
- problema_registrazione_portale
- info_ritiro_referto_cartella_clinica



CONTESTO SPECIFICO: Richiesta informativa - preferisci etichette info_*

OUTPUT FORMAT (SOLO JSON):
{"predicted_label": "etichetta_precisa", "confidence": 0.X, "motivation": "ragionamento_breve"}

CRITICAL: Genera ESCLUSIVAMENTE JSON valido. Zero testo aggiuntivo.
================================================================================

🔍 TOKENIZZAZIONE PREVENTIVA LLM CLASSIFICATION
